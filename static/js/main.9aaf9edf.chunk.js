(this["webpackJsonpopening-prep"]=this["webpackJsonpopening-prep"]||[]).push([[0],{107:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return i}));var n=function(e){e!==document.body.classList.contains("dark-theme")&&document.body.classList.toggle("dark-theme")},s=function(e){return e?"opening-tree-logo-white.png":"opening-tree-logo.png"},i=function(e){return e?"white":"grey"}},14:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return i})),a.d(t,"b",(function(){return r}));var n=a(161);function s(e,t,a){n.a.initialize("UA-159149755-1"),n.a.set({dimension2:e,dimension1:t,dimension3:a})}function i(){n.a.pageview(window.location.pathname)}function r(e,t,a,s,i){n.a.event({category:e,action:t,label:a,value:s,nonInteraction:i})}},182:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(16),s=a(17),i=a(48),r=a(2),o=a(69),l=function(){function e(t){Object(n.a)(this,e),this.graph=new c,this.hasMoves=!1,this.variant=t}return Object(s.a)(e,[{key:"setEntries",value:function(e,t){this.graph=new c(e,t),this.hasMoves=!0}},{key:"clear",value:function(){this.graph=new c,this.hasMoves=!1}},{key:"addPGN",value:function(e,t,a,n){var s=this;e.index=this.graph.pgnStats.length,this.graph.pgnStats.push(e),this.graph.playerColor=n,this.hasMoves=!0,t.forEach((function(t){s.addMoveForFen(t.sourceFen,t.targetFen,t.moveSan,e)})),this.addGameResultOnFen(a,e.index),this.addStatsToRoot(e,this.variant)}},{key:"addGameResultOnFen",value:function(e,t){var a=this.getNodeFromGraph(e,!0);a.gameResults||(a.gameResults=[]),a.gameResults.push(t)}},{key:"addStatsToRoot",value:function(e,t){var a=this.getNodeFromGraph(Object(o.b)(t),!0);a.details||(a.details={hasData:!1,blackWins:0,whiteWins:0,draws:0,totalOpponentElo:0,shortestGame:null,longestGame:null,lastPlayed:null});var n=this.getUpdatedMoveDetails(a.details,e);a.details=n}},{key:"getDetailsForFen",value:function(e){var t=this.getNodeFromGraph(Object(i.e)(e),!1),a=t&&t.details;if(Number.isInteger(a))a=this.getUpdatedMoveDetails({hasData:!1,blackWins:0,whiteWins:0,draws:0,totalOpponentElo:0,shortestGame:null,longestGame:null,lastPlayed:null},this.graph.pgnStats[a]);else if(!a)return{hasData:!1,blackWins:0,whiteWins:0,draws:0,totalOpponentElo:0,shortestGame:null,longestGame:null,lastPlayed:null};return a=this.updateCalculatedValues(a)}},{key:"updateCalculatedValues",value:function(e){return Number.isInteger(e.bestWin)&&(e.bestWinGame=this.graph.pgnStats[e.bestWin],e.bestWinElo=this.getOpponentElo(this.graph.playerColor,e.bestWinGame)),Number.isInteger(e.worstLoss)&&(e.worstLossGame=this.graph.pgnStats[e.worstLoss],e.worstLossElo=this.getOpponentElo(this.graph.playerColor,e.worstLossGame)),Number.isInteger(e.lastPlayed)&&(e.lastPlayedGame=this.graph.pgnStats[e.lastPlayed]),Number.isInteger(e.longestGame)&&(e.longestGameInfo=this.graph.pgnStats[e.longestGame]),Number.isInteger(e.shortestGame)&&(e.shortestGameInfo=this.graph.pgnStats[e.shortestGame]),e.count=e.whiteWins+e.blackWins+e.draws,e}},{key:"addMoveForFen",value:function(e,t,a,n){var s=this.getNodeFromGraph(t,!0),i=this.getUpdatedMoveDetails(s.details,n);s.details=i;var r=this.getNodeFromGraph(e,!0);r.playedBy||(r.playedBy={});var o=r.playedBy[a];o||(o=0),o+=1,r.playedBy[a]=o,r.playedByMax=Math.max(r.playedByMax,o)}},{key:"addBookNode",value:function(e,t){var a=Object(i.e)(e);this.graph.book.set(a,this.transform(t))}},{key:"clearBookNodes",value:function(){this.graph.book=new Map}},{key:"transform",value:function(e){return e&&e.moves?{fetch:"success",moves:e.moves.map((function(e){var t=e.black+e.white+e.draws;return{san:e.san,details:{hasData:!0,blackWins:e.black,whiteWins:e.white,draws:e.draws,count:t,averageElo:e.averageRating},moveCount:t}}))}:e}},{key:"getBookNode",value:function(e){var t=Object(i.e)(e);return this.graph.book.get(t)}},{key:"getNodeFromGraph",value:function(e,t){var a=Object(i.e)(e),n=this.graph.nodes.get(a);return!n&&t&&((n=new h).fen=a,this.graph.nodes.set(a,n)),n}},{key:"getUpdatedMoveDetails",value:function(e,t){if(Number.isInteger(e))e=this.getUpdatedMoveDetails({hasData:!1,blackWins:0,whiteWins:0,draws:0,totalOpponentElo:0,shortestGame:null,longestGame:null,lastPlayed:null},this.graph.pgnStats[e]);else if(!e)return t.index;var a=0,n=0,s=0,o=0,l=this.graph.playerColor;"1-0"===t.result?(a=1,o=l===r.cb?1:-1):"0-1"===t.result?(n=1,o=l===r.bb?1:-1):s=1;var c=this.getOpponentElo(l,t);if(1===o){var h=null;Number.isInteger(e.bestWin)&&(h=this.graph.pgnStats[e.bestWin]),(!h||parseInt(c)>parseInt(this.getOpponentElo(l,h)))&&(e.bestWin=t.index)}if(-1===o){var u=null;Number.isInteger(e.worstLoss)&&(u=this.graph.pgnStats[e.worstLoss]),(!u||parseInt(c)<parseInt(this.getOpponentElo(l,u)))&&(e.worstLoss=t.index)}var p=null;Number.isInteger(e.lastPlayed)&&(p=this.graph.pgnStats[e.lastPlayed]),p&&!Object(i.d)(t.date,p.date)||(e.lastPlayed=t.index);var m=null;Number.isInteger(e.longestGame)&&(m=this.graph.pgnStats[e.longestGame]),(!m||t.numberOfPlys>m.numberOfPlys)&&(e.longestGame=t.index);var d=null;return Number.isInteger(e.shortestGame)&&(d=this.graph.pgnStats[e.shortestGame]),(!d||t.numberOfPlys<d.numberOfPlys)&&(e.shortestGame=t.index),e.blackWins+=n,e.whiteWins+=a,e.draws+=s,e.totalOpponentElo+=parseInt(c),e.hasData=!0,e}},{key:"getOpponentElo",value:function(e,t){return e===r.cb?t.blackElo:t.whiteElo}},{key:"gameResultsForFen",value:function(e){var t=this,a=Object(i.e)(e),n=this.graph.nodes.get(a);return n&&n.gameResults?n.gameResults.map((function(e){return t.graph.pgnStats[e]})):null}},{key:"movesForFen",value:function(e){var t=this,a=Object(i.e)(e),n=this.graph.nodes.get(a);return n&&n.playedBy?Array.from(Object.entries(n.playedBy)).map((function(a){var s=Object(o.a)(t.variant,e),i=s.move(a[0],{sloppy:!0});if(!i)return null;var r=t.getDetailsForFen(s.fen());return{orig:i.from,dest:i.to,level:t.levelFor(a[1],n.playedByMax),san:i.san,details:r,moveCount:a[1]}})).filter((function(e){return!!e})):null}},{key:"levelFor",value:function(e,t){return t<=0||e/t>.8?3:e/t>.3?2:1}}]),e}(),c=function e(t,a){var s=this;Object(n.a)(this,e),this.nodes=new Map,this.book=new Map,this.pgnStats=[],this.playerColor="",t&&t.forEach((function(e){s.nodes.set(e[0],e[1])})),a&&(this.pgnStats=a)},h=function e(){Object(n.a)(this,e),this.playedByMax=0}},2:function(e,t,a){"use strict";a.d(t,"vb",(function(){return n})),a.d(t,"qb",(function(){return s})),a.d(t,"pb",(function(){return i})),a.d(t,"ub",(function(){return r})),a.d(t,"rb",(function(){return o})),a.d(t,"sb",(function(){return l})),a.d(t,"tb",(function(){return c})),a.d(t,"x",(function(){return h})),a.d(t,"t",(function(){return u})),a.d(t,"w",(function(){return p})),a.d(t,"u",(function(){return m})),a.d(t,"v",(function(){return d})),a.d(t,"y",(function(){return g})),a.d(t,"kb",(function(){return v})),a.d(t,"ib",(function(){return f})),a.d(t,"nb",(function(){return b})),a.d(t,"jb",(function(){return y})),a.d(t,"ob",(function(){return E})),a.d(t,"mb",(function(){return k})),a.d(t,"lb",(function(){return w})),a.d(t,"Q",(function(){return C})),a.d(t,"R",(function(){return O})),a.d(t,"r",(function(){return N})),a.d(t,"s",(function(){return S})),a.d(t,"m",(function(){return M})),a.d(t,"n",(function(){return T})),a.d(t,"p",(function(){return j})),a.d(t,"k",(function(){return P})),a.d(t,"q",(function(){return R})),a.d(t,"j",(function(){return A})),a.d(t,"o",(function(){return x})),a.d(t,"l",(function(){return I})),a.d(t,"eb",(function(){return F})),a.d(t,"db",(function(){return D})),a.d(t,"cb",(function(){return L})),a.d(t,"bb",(function(){return B})),a.d(t,"P",(function(){return G})),a.d(t,"X",(function(){return z})),a.d(t,"ab",(function(){return W})),a.d(t,"Z",(function(){return U})),a.d(t,"V",(function(){return V})),a.d(t,"W",(function(){return H})),a.d(t,"Y",(function(){return q})),a.d(t,"g",(function(){return _})),a.d(t,"f",(function(){return Q})),a.d(t,"I",(function(){return Y})),a.d(t,"O",(function(){return J})),a.d(t,"H",(function(){return K})),a.d(t,"A",(function(){return X})),a.d(t,"h",(function(){return Z})),a.d(t,"i",(function(){return $})),a.d(t,"zb",(function(){return ee})),a.d(t,"yb",(function(){return te})),a.d(t,"Ab",(function(){return ae})),a.d(t,"xb",(function(){return ne})),a.d(t,"wb",(function(){return se})),a.d(t,"d",(function(){return ie})),a.d(t,"e",(function(){return re})),a.d(t,"c",(function(){return oe})),a.d(t,"b",(function(){return le})),a.d(t,"L",(function(){return ce})),a.d(t,"N",(function(){return he})),a.d(t,"K",(function(){return ue})),a.d(t,"J",(function(){return pe})),a.d(t,"M",(function(){return me})),a.d(t,"D",(function(){return de})),a.d(t,"F",(function(){return ge})),a.d(t,"C",(function(){return ve})),a.d(t,"E",(function(){return fe})),a.d(t,"B",(function(){return be})),a.d(t,"U",(function(){return ye})),a.d(t,"T",(function(){return Ee})),a.d(t,"S",(function(){return ke})),a.d(t,"a",(function(){return we})),a.d(t,"hb",(function(){return Ce})),a.d(t,"fb",(function(){return Oe})),a.d(t,"gb",(function(){return Ne})),a.d(t,"G",(function(){return Se})),a.d(t,"z",(function(){return Me}));var n="ultraBullet",s="bullet",i="blitz",r="rapid",o="classical",l="correspondence",c="daily",h="rated",u="downloadLimit",p="opponent",m="eloRange",d="fromDate",g="toDate",v="lichess",f="chesscom",b="pgnfile",y="eventdb",E="playerdb",k="opntfile",w="tournament",C=2e3,O=3e3,N="loader",S="settings",M="lichess",T="mainAction",j="moves",P="controls",R="navigator",A="chessboard",x="message",I="globalHeader",F="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",D="8/8/8/8/8/8/krbnNBRK/qrbnNBRQ w - - 0 1",L="white",B="black",G=500,z="feedback@openingtree.com",W="opening_tree",U="vannooz",V="vannooz",H="https://discord.gg/hCwKkN8",q=2,_="visitOld",Q="noAction",Y=0,J=1,K=2,X=3,Z="error",$="success",ee="standard",te="racingkings",ae="threecheck",ne="kingofthehill",se="crazyhouse",ie="chess",re="threeCheck",oe="kingofthehill",le="crazyhouse",ce="racingKings",he="threeCheck",ue="kingOfTheHill",pe="crazyhouse",me="standard",de="Racing Kings",ge="Three-check",ve="King of the Hill",fe="Standard",be="Crazyhouse",ye="off",Ee="master",ke="lichess",we=["1600","1800","2000","2200","2500"],Ce="orientation",Oe="darkMode",Ne="movesSettings",Se="https://lichess.org",Me="openingtree.com"},203:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(16),s=a(17),i=a(60),r=function(){function e(){Object(n.a)(this,e),this.userProfile=null}return Object(s.a)(e,[{key:"getUserProfile",value:function(){if(null!==this.userProfile)return this.userProfile;var e=i.a.getVisitInfo(),t=null,a=null;return 0===e.numVisits?(t=o,a="first"):e.numVisits<6?(t=l,a="new"):e.numVisits<12?(t=c,a="occasional"):e.currentVisit-e.firstVisit>2592e6&&e.currentVisit-e.lastVisit<6048e5?(t=u,a="power"):(t=h,a="frequent"),this.userProfile={userType:t,userTypeDesc:a,numVisits:e.numVisits},this.userProfile}}]),e}(),o=1,l=2,c=3,h=4,u=5;t.b=new r},205:function(e,t,a){"use strict";var n=a(0),s=a.n(n),i=function(e){return 2/(1+Math.exp(-.00368208*e))-1},r=function(e){return i(Math.min(Math.max(-1e3,e),1e3))},o=function(e){var t=100*(21-Math.min(10,Math.abs(e)));return i(t*(e>0?1:-1))},l=function(e){return void 0!==e.mate?o(e.mate):r(e.cp||0)},c=function(e,t){var a=l(t);return"white"===e?a:-a},h=function(e){return Math.round(50*(e+1))},u=function(e){var t=Math.max(Math.min(Math.round(e/10)/10,99),-99);return(t>0?"+":"")+t.toFixed(1)},p=function(e){return void 0!==e.mate?(e.mate>0?"":"-")+"M"+Math.abs(e.mate):u(e.cp||0)},m=function(e){var t=l(e);return h(t)},d=(a(844),function(e){var t=e.score,a=e.orientation,n=void 0===a?"white":a,i=e.depth,r=void 0===i?0:i,o=e.isAnalyzing,l=void 0!==o&&o,c=e.height,h=void 0===c?400:c,u=t?m(t):50,d=100-u,g=t?p(t):"0.0",v="black"===n,f=u>50||50===u,b=u<50,y=v?s.a.createElement("div",{className:"eval-bar-section eval-bar-section-white",style:{height:"".concat(u,"%")}},f&&s.a.createElement("span",{className:"eval-bar-score eval-bar-score-white"},g)):s.a.createElement("div",{className:"eval-bar-section eval-bar-section-black",style:{height:"".concat(d,"%")}},b&&s.a.createElement("span",{className:"eval-bar-score eval-bar-score-black"},g)),E=v?s.a.createElement("div",{className:"eval-bar-section eval-bar-section-black",style:{height:"".concat(d,"%")}},b&&s.a.createElement("span",{className:"eval-bar-score eval-bar-score-black"},g)):s.a.createElement("div",{className:"eval-bar-section eval-bar-section-white",style:{height:"".concat(u,"%")}},f&&s.a.createElement("span",{className:"eval-bar-score eval-bar-score-white"},g));return s.a.createElement("div",{className:"eval-bar ".concat(l?"analyzing":""," ").concat(v?"flipped":""),style:{height:"".concat(h,"px")},title:"Evaluation: ".concat(g," (depth ").concat(r,")")},s.a.createElement("div",{className:"eval-bar-fill"},y,E),s.a.createElement("div",{className:"eval-bar-ticks"},s.a.createElement("div",{className:"eval-bar-tick",style:{top:"12.5%"}}),s.a.createElement("div",{className:"eval-bar-tick",style:{top:"25%"}}),s.a.createElement("div",{className:"eval-bar-tick eval-bar-tick-major",style:{top:"37.5%"}}),s.a.createElement("div",{className:"eval-bar-tick eval-bar-tick-zero",style:{top:"50%"}}),s.a.createElement("div",{className:"eval-bar-tick eval-bar-tick-major",style:{top:"62.5%"}}),s.a.createElement("div",{className:"eval-bar-tick",style:{top:"75%"}}),s.a.createElement("div",{className:"eval-bar-tick",style:{top:"87.5%"}})),l&&s.a.createElement("div",{className:"eval-bar-analyzing"},s.a.createElement("div",{className:"eval-bar-analyzing-dot"})))}),g=a(101),v=a.n(g),f=(a(845),function(e){var t=e.pvData,a=e.index,i=e.turnColor,r=e.onMoveClick,o=e.onMoveHover,l=e.fen,h=e.isHighlighted,u=t.score,m=t.pv,d=t.depth,g=p(u),f=c(i,u),b=f>.1,y=f<-.1,E=t.fen||l,k=Object(n.useMemo)((function(){var e=m.slice(0,12),t=function(e,t){if(!e||0===e.length)return[];if(!t)return e.map((function(e){return e||""}));var a=[];try{for(var n=new v.a(t),s=0;s<e.length;s++){var i=e[s];if(!i||i.length<4)break;try{var r=i.substring(0,2),o=i.substring(2,4),l=i.length>4?i[4]:void 0,c=n.move({from:r,to:o,promotion:l});if(!c){console.warn("Failed to convert move ".concat(i," at position ").concat(n.fen()));break}a.push(c.san)}catch(h){console.warn("Error converting move ".concat(i,":"),h.message);break}}return a}catch(h){return console.warn("Error initializing chess.js:",h.message),[]}}(e,E);return t.length<e.length?t.length>0?t:e:t}),[m,E]);return s.a.createElement("div",{className:"pv-line ".concat(h?"highlighted":""," ").concat(b?"good":""," ").concat(y?"bad":""),onMouseEnter:function(){return o&&o(m[0])},onMouseLeave:function(){return o&&o(null)}},s.a.createElement("div",{className:"pv-line-rank"},a+1),s.a.createElement("div",{className:"pv-line-score ".concat(void 0!==u.mate?"mate":""),title:"Depth: ".concat(d)},g),s.a.createElement("div",{className:"pv-line-moves"},k.map((function(e,t){return s.a.createElement("span",{key:t,className:"pv-move ".concat(0===t?"best-move":""),onClick:function(){return r&&r(m.slice(0,t+1))},title:"Click to play ".concat(e)},e)})),m.length>12&&s.a.createElement("span",{className:"pv-more"},"...")))}),b=function(e){var t=e.pvLines,a=void 0===t?[]:t,n=e.turnColor,i=void 0===n?"white":n,r=e.depth,o=void 0===r?0:r,l=e.isAnalyzing,c=void 0!==l&&l,h=e.onMoveClick,u=e.onMoveHover,p=e.fen,m=e.highlightedMove;return a&&0!==a.length?s.a.createElement("div",{className:"pv-lines"},s.a.createElement("div",{className:"pv-lines-header"},s.a.createElement("span",{className:"pv-lines-title"},"Engine Analysis"),s.a.createElement("span",{className:"pv-lines-depth"},"Depth: ",o,c&&s.a.createElement("span",{className:"analyzing-dot"}))),s.a.createElement("div",{className:"pv-lines-list"},a.map((function(e,t){return s.a.createElement(f,{key:t,pvData:e,index:t,turnColor:i,onMoveClick:h,onMoveHover:u,fen:p,isHighlighted:m===e.pv[0]})})))):s.a.createElement("div",{className:"pv-lines empty"},s.a.createElement("div",{className:"pv-lines-placeholder"},c?s.a.createElement(s.a.Fragment,null,s.a.createElement("span",{className:"analyzing-spinner"}),s.a.createElement("span",null,"Analyzing position...")):s.a.createElement("span",null,"Enable analysis to see engine suggestions")))},y=a(42),E=a(75),k=a(16),w=a(17),C=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(k.a)(this,e),this.worker=null,this.isReady=!1,this.isSearching=!1,this.onEvaluation=t.onEvaluation||function(){},this.onBestMove=t.onBestMove||function(){},this.onReady=t.onReady||function(){},this.onError=t.onError||function(){},this.currentEval=null,this.multiPv=t.multiPv||3,this.depth=t.depth||20,this.currentFen=null,this.isWhiteTurn=!0,this.pvLines=[],this.uciOk=!1,this.restartCount=0,this.maxRestarts=3,this.lastError=null,this.init()}return Object(w.a)(e,[{key:"init",value:function(){var e=this;try{var t=window.location.origin+"/stockfish/stockfish.wasm",a=window.location.origin+"/stockfish/stockfish.js#"+t;this.worker=new Worker(a),this.worker.onmessage=function(t){e.handleMessage(t.data)},this.worker.onerror=function(t){console.error("Stockfish worker error:",t),e.handleWorkerError(t.message||"Worker error")},setTimeout((function(){e.send("uci")}),100)}catch(n){console.error("Failed to create Stockfish worker:",n),this.handleWorkerError(n.message)}}},{key:"handleWorkerError",value:function(e){var t=this;if(this.lastError=e,this.isSearching=!1,(e.includes("index out of bounds")||e.includes("RuntimeError")||e.includes("memory"))&&this.restartCount<this.maxRestarts){if(console.log("Stockfish error (attempt ".concat(this.restartCount+1,"/").concat(this.maxRestarts,"), restarting...")),this.restartCount++,this.worker){try{this.worker.terminate()}catch(a){}this.worker=null}this.isReady=!1,this.uciOk=!1,setTimeout((function(){t.init(),t.currentFen&&t.isReady&&setTimeout((function(){t.analyze(t.currentFen,{depth:t.depth,multiPv:t.multiPv})}),500)}),1e3)}else this.onError(e)}},{key:"handleMessage",value:function(e){if("string"===typeof e)if(this.restartCount>0&&("readyok"===e||e.startsWith("info "))&&(this.restartCount=0),"uciok"===e)this.uciOk=!0,this.send("setoption name MultiPV value "+this.multiPv),this.send("setoption name UCI_AnalyseMode value true"),this.send("setoption name Hash value 16"),this.send("isready");else if("readyok"===e)this.isReady=!0,this.onReady();else if(e.startsWith("info "))try{this.parseInfo(e)}catch(t){console.warn("Error parsing info line:",t)}else if(e.startsWith("bestmove "))try{this.parseBestMove(e)}catch(t){console.warn("Error parsing bestmove:",t),this.isSearching=!1}}},{key:"normalizeScore",value:function(e){return this.isWhiteTurn?e:void 0!==e.mate?{mate:-e.mate}:{cp:-(e.cp||0)}}},{key:"parseInfo",value:function(e){for(var t=e.split(" "),a=0,n=0,s=1,i=null,r="cp",o=[],l=0,c=0,h=0,u=1;u<t.length;u++)switch(t[u]){case"depth":a=parseInt(t[++u],10)||0;break;case"seldepth":n=parseInt(t[++u],10)||0;break;case"multipv":s=parseInt(t[++u],10)||1;break;case"score":r=t[++u],i=parseInt(t[++u],10)||0;break;case"nodes":l=parseInt(t[++u],10)||0;break;case"nps":c=parseInt(t[++u],10)||0;break;case"time":h=parseInt(t[++u],10)||0;break;case"pv":o=t.slice(u+1).filter((function(e){return e&&e.length>=4})),u=t.length}if(a>0&&o.length>0){for(var p="mate"===r?{mate:i}:{cp:i},m={depth:a,seldepth:n,multiPv:s,score:this.normalizeScore(p),pv:o,nodes:l,nps:c,time:h,fen:this.currentFen};this.pvLines.length<s;)this.pvLines.push(null);this.pvLines[s-1]=m,this.onEvaluation({depth:a,pvLines:Object(E.a)(this.pvLines).filter(Boolean),fen:this.currentFen})}}},{key:"parseBestMove",value:function(e){var t=e.split(" "),a=t[1],n=null;"ponder"===t[2]&&(n=t[3]),this.isSearching=!1,this.onBestMove({bestMove:a,ponder:n,pvLines:Object(E.a)(this.pvLines).filter(Boolean),fen:this.currentFen})}},{key:"send",value:function(e){if(this.worker)try{this.worker.postMessage(e)}catch(t){console.warn("Error sending command to Stockfish:",t),this.handleWorkerError(t.message)}}},{key:"isWhiteToMove",value:function(e){var t=e.split(" ");return t.length<2||"w"===t[1]}},{key:"analyze",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isReady){this.isSearching&&this.stop(),this.currentFen=e,this.isWhiteTurn=this.isWhiteToMove(e),this.pvLines=[];var a=t.multiPv||this.multiPv;a!==this.multiPv&&(this.multiPv=a,this.send("setoption name MultiPV value "+this.multiPv)),this.send("ucinewgame"),this.send("isready"),this.send("position fen "+e);var n=t.depth||this.depth,s=t.movetime;this.isSearching=!0,s?this.send("go movetime "+s):this.send("go depth "+n)}else console.warn("Stockfish not ready yet")}},{key:"stop",value:function(){this.isSearching&&(this.send("stop"),this.isSearching=!1)}},{key:"setMultiPv",value:function(e){this.multiPv=Math.max(1,Math.min(5,e)),this.isReady&&this.send("setoption name MultiPV value "+this.multiPv)}},{key:"destroy",value:function(){if(this.stop(),this.worker){this.send("quit");try{this.worker.terminate()}catch(e){}this.worker=null}this.isReady=!1}}]),e}(),O=(a(846),function(e){var t=e.enabled,a=e.isReady,n=e.multiPv,i=e.depth,r=e.isAnalyzing,o=e.targetDepth,l=e.onToggle,c=e.onMultiPvChange,h=e.onGoDeeper,u=e.error,p=e.onDismissError;return s.a.createElement("div",{className:"engine-controls"},s.a.createElement("label",{className:"engine-toggle"},s.a.createElement("input",{type:"checkbox",checked:t,onChange:l,disabled:!a}),s.a.createElement("span",{className:"toggle-slider"}),s.a.createElement("span",{className:"toggle-label"},a?"Engine":"Loading...")),t&&a&&s.a.createElement(s.a.Fragment,null,s.a.createElement("select",{className:"engine-multipv",value:n,onChange:function(e){return c(parseInt(e.target.value,10))},title:"Number of lines to show"},s.a.createElement("option",{value:1},"1 line"),s.a.createElement("option",{value:2},"2 lines"),s.a.createElement("option",{value:3},"3 lines"),s.a.createElement("option",{value:5},"5 lines")),s.a.createElement("button",{className:"engine-deeper",onClick:h,disabled:r||o>=40,title:"Analyze deeper"},"Go deeper"),s.a.createElement("span",{className:"engine-depth"},"Depth: ",i)),u&&s.a.createElement("div",{className:"engine-error"},s.a.createElement("span",null,"Engine error: ",u),s.a.createElement("button",{onClick:p},"\xd7")))}),N=function(e){var t=e.fen,a=(e.orientation,e.turnColor),i=void 0===a?"white":a,r=e.onMove,o=e.onHighlightMove,l=e.onStateChange,c=(e.chess,e.boardHeight,e.showPvLines),h=void 0!==c&&c,u=Object(n.useState)(null),p=Object(y.a)(u,2),m=p[0],d=p[1],g=Object(n.useState)(!1),v=Object(y.a)(g,2),f=v[0],E=v[1],k=Object(n.useState)(!1),w=Object(y.a)(k,2),N=w[0],S=w[1],M=Object(n.useState)(!1),T=Object(y.a)(M,2),j=T[0],P=T[1],R=Object(n.useState)(null),A=Object(y.a)(R,2),x=A[0],I=A[1],F=Object(n.useState)([]),D=Object(y.a)(F,2),L=D[0],B=D[1],G=Object(n.useState)(0),z=Object(y.a)(G,2),W=z[0],U=z[1],V=Object(n.useState)(null),H=Object(y.a)(V,2),q=H[0],_=H[1],Q=Object(n.useState)(null),Y=Object(y.a)(Q,2),J=Y[0],K=Y[1],X=Object(n.useState)(3),Z=Object(y.a)(X,2),$=Z[0],ee=Z[1],te=Object(n.useState)(20),ae=Object(y.a)(te,2),ne=ae[0],se=ae[1],ie=Object(n.useRef)(null);Object(n.useEffect)((function(){l&&l({enabled:j,evaluation:x,depth:W,analyzing:N,pvLines:L,fen:ie.current||t,multiPv:$,targetDepth:ne,isReady:f,error:q,highlightedMove:J})}),[j,x,W,N,L,t,$,ne,f,q,J,l]),Object(n.useEffect)((function(){var e=new C({multiPv:$,depth:ne,onReady:function(){console.log("Stockfish engine ready"),E(!0),_(null)},onEvaluation:function(e){U(e.depth),B(e.pvLines),e.pvLines.length>0&&I(e.pvLines[0].score)},onBestMove:function(e){S(!1),B(e.pvLines)},onError:function(e){console.error("Stockfish error:",e),_(e),S(!1)}});return d(e),function(){e.destroy()}}),[]),Object(n.useEffect)((function(){m&&f&&m.setMultiPv($)}),[m,f,$]),Object(n.useEffect)((function(){m&&f&&j&&t&&t!==ie.current&&(ie.current=t,I(null),B([]),U(0),S(!0),m.analyze(t,{depth:ne,multiPv:$}))}),[m,f,j,t,ne,$]),Object(n.useEffect)((function(){!j&&m&&(m.stop(),S(!1))}),[j,m]);var re=Object(n.useCallback)((function(e){if(r&&e.length>0){var t=e[0];r({from:t.substring(0,2),to:t.substring(2,4),promotion:t.length>4?t[4]:void 0})}}),[r]),oe=Object(n.useCallback)((function(e){K(e),o&&o(e?{from:e.substring(0,2),to:e.substring(2,4)}:null)}),[o]),le=Object(n.useCallback)((function(){P((function(e){return!e}))}),[]),ce=Object(n.useCallback)((function(){m&&f&&t&&(se((function(e){return Math.min(e+5,40)})),ie.current=null)}),[m,f,t]);return s.a.createElement("div",{className:"engine-analysis"},s.a.createElement(O,{enabled:j,isReady:f,multiPv:$,depth:W,isAnalyzing:N,targetDepth:ne,onToggle:le,onMultiPvChange:ee,onGoDeeper:ce,error:q,onDismissError:function(){return _(null)}}),h&&j&&s.a.createElement("div",{className:"engine-display"},s.a.createElement("div",{className:"engine-pv-container"},s.a.createElement(b,{pvLines:L,turnColor:i,depth:W,isAnalyzing:N,onMoveClick:re,onMoveHover:oe,fen:t,highlightedMove:J}))))};a.d(t,"b",(function(){return d})),a.d(t,"c",(function(){return b})),a.d(t,"a",(function(){return N}))},276:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return l}));var n=a(199),s=a.n(n),i=a(30),r=a(446);function o(e,t,a){var n=function(e){var t=[{chunk:e.header,index:0,arraySizes:e.arrays.map((function(e){return e.length}))}];return e.arrays.forEach((function(e){Array.prototype.push.apply(t,function(e,t,a){for(var n=[],s=0,i=0;s<e.length;s+=t,i++)n.push({chunk:e.slice(s,s+t),index:a+i});return n}(e,1e3,t.length))})),t}(e),o=[];o.push(h(1)),o.push(h(n.length));var l=n.length,c=!1;n.forEach((function(e){s.a.deflate(new i.Buffer(JSON.stringify(e)),(function(e,n){if(l--,e&&(c=!0),o.push(h(n.byteLength)),o.push(n),l<=0){if(c)return void a("Could not save file");Object(r.saveAs)(new Blob(o,{type:"application/octet-stream"}),t),a(null,"Saved opening tree to file ".concat(t))}}))}))}function l(e,t){var a=new FileReader;a.onload=function(e){var a=e.target.result,n=0,r=c(a.slice(n,n+8));if(n+=8,1===r){var o=c(a.slice(n,n+8));n+=8,o?function(e,t,a,n){var r=t,o=[],l=a,h=!1,u=function(e,t){l--,e&&(console.log(e),h=!0);try{o.push(JSON.parse(t))}catch(a){console.log(a),h=!0}0===l&&(h&&n("Input file seems corrupted",null),n(null,function(e){var t=e.sort((function(e,t){return e.index-t.index})),a=t.slice(1).map((function(e){return e.chunk})).flat(),n=t[0],s=[],i=0;return(n.arraySizes||[a.length]).forEach((function(e){s.push(a.slice(i,i+e)),i+=e})),{header:n.chunk,arrays:s}}(o)))};for(;a>0;){var p=c(e.slice(r,r+8));r+=8,s.a.inflate(i.Buffer.from(e,r,p),u),r+=p,a--}}(a,n,o,t):t("Input file not in correct format",null)}else t("File is not an openingtree save file.",null,"Are you loading the correct file?")},a.onerror=function(e){t("Failed to read openingtree file",null,"".concat(e.target.error.name,":").concat(e.target.error.message))},a.readAsArrayBuffer(e)}function c(e){var t=new DataView(e);return 4919!==t.getUint16(0)||49363!==t.getUint16(6)?null:t.getUint32(2)}function h(e){var t=new ArrayBuffer(8),a=new DataView(t);return a.setUint16(0,4919),a.setUint32(2,e>>>0),a.setUint16(6,49363),t}},31:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"d",(function(){return h})),a.d(t,"b",(function(){return u})),a.d(t,"c",(function(){return p}));var n=a(7),s=a(870),i=a(0),r=a.n(i),o=a(48),l=a(2),c=Object(n.a)({root:{border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:"auto"}},expanded:{}})(s.a);function h(e){return r.a.createElement("img",{alt:"step ".concat(e),className:"lowOpacity styledNumbers",src:"/images/styled-".concat(e,".png"),height:24})}function u(e){return Object(o.a)(e,[l.vb,l.qb,l.pb,l.ub,l.sb,l.tb,l.rb,l.x,l.t,l.u,l.w,l.v,l.y])}function p(e){var t=document.getElementById(e);try{return t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),!0}catch(a){return!1}}},423:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return G}));var n=a(16),s=a(17),i=a(44),r=a(26),o=a(27),l=a(0),c=a.n(l),h=a(424),u=a.n(h),p=(a(497),a(426)),m=a(848),d=a(849),g=a(281),v=a(287),f=a(282),b=a(459),y=a(284),E=a(283),k=a(160),w=a(871),C=a(286),O=a(869),N=a(868),S=a(2),M=a(182),T=a(69),j=a(60),P=a(107),R=a(203),A=a(14),x=a(456),I=a(429),F=a(453),D=a(450),L=a(452),B=a(205),G=function(t){Object(r.a)(l,t);var a=Object(o.a)(l);function l(e){var t;Object(n.a)(this,l),(t=a.call(this,e)).handleEngineHighlight=function(e){t.setState({engineHighlightedMove:e})},t.handleEngineMove=function(e){e&&e.from&&e.to&&t.onMove(e.from,e.to)},t.handleEngineStateChange=function(e){t.setState({engineEnabled:e.enabled,engineEvaluation:e.evaluation,engineDepth:e.depth,engineAnalyzing:e.analyzing,enginePvLines:e.pvLines||[],engineFen:e.fen||t.state.fen})},t.handlePvMoveClick=function(e){if(e&&e.length>0){var a=e[0];t.onMove(a.substring(0,2),a.substring(2,4))}},t.handlePvMoveHover=function(e){e?t.setState({engineHighlightedMove:{from:e.substring(0,2),to:e.substring(2,4)}}):t.setState({engineHighlightedMove:null})};var s=new URLSearchParams(window.location.search).get("variant")||S.zb;t.chess=Object(T.a)(s),Object(D.a)(Object(i.a)(t)),t.state={resize:0,fen:t.chess.fen(),lastMove:null,gamesProcessed:0,openingGraph:new M.a(s),settings:{playerName:"",orientation:S.cb,playerColor:"",movesSettings:t.getMovesSettingsFromCookie(),darkMode:t.getDarkModeSettingFromCookie()},message:"",downloadingGames:!1,feedbackOpen:!1,diagnosticsDataOpen:!1,variant:s,update:0,highlightedMove:null,engineHighlightedMove:null,engineEnabled:!1,engineEvaluation:null,engineDepth:0,engineAnalyzing:!1,enginePvLines:[],engineFen:null},t.chessboardWidth=t.getChessboardWidth(),t.initializeOauth(),t.forBrushes=["blue","paleGrey","paleGreen","green"],t.againstBrushes=["blue","paleRed","paleRed","red"],t.engineBrush="yellow",window.addEventListener("resize",t.handleResize.bind(Object(i.a)(t)));var r=R.b.getUserProfile();return Object(A.a)(r.userTypeDesc,t.state.settings.darkMode?"dark":"light",t.state.settings.movesSettings.openingBookType),t}return Object(s.a)(l,[{key:"initializeOauth",value:function(){var e=this,t=function(){var e=new URL(window.location.href);return e.search="","".concat(e.href,"?source=lichess")}();this.oauth=new p.OAuth2AuthCodePKCE({authorizationUrl:"".concat(S.G,"/oauth"),tokenUrl:"".concat(S.G,"/api/token"),clientId:S.z,scopes:[],redirectUrl:t,onAccessTokenExpiry:function(e){return e()},onInvalidGrant:function(e){}}),this.oauth.isReturningFromAuthServer().then((function(t){return t?e.oauth.getAccessToken():""})).then((function(e){e&&(j.a.setLichessAccessToken(e.token.value),console.log("access token",e),window.location.replace(t))})).catch((function(e){console.log("error",e)}))}},{key:"handleResize",value:function(){this.setState({resize:this.state.resize+1}),this.chessboardWidth=this.getChessboardWidth()}},{key:"getMovesSettingsFromCookie",value:function(){var e=(j.a.getSettingsCookie()||{}).movesSettings;return e&&e.openingBookType||(e={openingBookType:S.S,openingBookRating:S.a,openingBookTimeControls:[S.qb,S.pb,S.ub,S.rb,S.sb],openingBookScoreIndicator:!1,openingBookWinsIndicator:R.b.getUserProfile().userType>R.a}),e}},{key:"getDarkModeSettingFromCookie",value:function(){var e=j.a.getDarkModeCookie();return void 0===e||"true"===e}},{key:"getAutoShapesWithEngine",value:function(e,t,a){var n=this.autoShapes(e,t);return a&&a.from&&a.to&&(n=n.filter((function(e){return!(e.orig===a.from&&e.dest===a.to)}))).unshift({orig:a.from,dest:a.to,brush:this.engineBrush}),n}},{key:"render",value:function(){var e=this.state.lastMove?[this.state.lastMove.from,this.state.lastMove.to]:null,t=Boolean(this.state.message),a=this.getPlayerMoves(),n=this.getBookMoves();this.mergePlayerAndBookMoves(a,n);var s=parseInt(this.chessboardWidth,10)||400;return c.a.createElement("div",{className:"rootView"},c.a.createElement(I.a,{settings:this.state.settings,settingsChange:this.settingsChange.bind(this),toggleFeedback:this.toggleFeedback(!1)}),c.a.createElement(m.a,{className:"mainContainer"},c.a.createElement(d.a,null,c.a.createElement(g.a,{lg:{order:0,size:2},xs:{order:2}},c.a.createElement(x.a,{fen:this.state.fen,move:this.state.lastMove,onChange:this.navigateTo.bind(this),variant:this.state.variant})),c.a.createElement(g.a,{lg:"6"},c.a.createElement(B.a,{fen:this.state.fen,orientation:this.orientation(),turnColor:this.turnColor(),onMove:this.handleEngineMove,onHighlightMove:this.handleEngineHighlight,onStateChange:this.handleEngineStateChange,chess:this.chess,boardHeight:s,showPvLines:!1}),c.a.createElement("div",{className:"board-eval-wrapper",style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"4px"}},this.state.engineEnabled&&c.a.createElement(B.b,{score:this.state.engineEvaluation,orientation:this.orientation(),depth:this.state.engineDepth,isAnalyzing:this.state.engineAnalyzing,height:s}),c.a.createElement("div",{className:"chessboard-container"},c.a.createElement(u.a,{key:this.state.resize,height:this.chessboardWidth,width:this.chessboardWidth,orientation:this.orientation(),turnColor:this.turnColor(),movable:this.calcMovable(),lastMove:e,fen:this.state.fen,onMove:this.onMoveAction.bind(this),drawable:{enabled:!0,visible:!0,autoShapes:this.getAutoShapesWithEngine(a,this.state.highlightedMove,this.state.engineHighlightedMove)}}))),this.state.engineEnabled&&c.a.createElement("div",{className:"engine-pv-below-board",style:{marginTop:"8px"}},c.a.createElement(B.c,{pvLines:this.state.enginePvLines,turnColor:this.turnColor(),depth:this.state.engineDepth,isAnalyzing:this.state.engineAnalyzing,onMoveClick:this.handlePvMoveClick,onMoveHover:this.handlePvMoveHover,fen:this.state.engineFen||this.state.fen,highlightedMove:this.state.engineHighlightedMove?this.state.engineHighlightedMove.from+this.state.engineHighlightedMove.to:null}))),c.a.createElement(g.a,{lg:"4",className:"paddingTop"},c.a.createElement(F.a,{fen:this.state.fen,resize:this.state.resize,gamesProcessed:this.state.gamesProcessed,updateProcessedGames:this.updateProcessedGames.bind(this),settingsChange:this.settingsChange.bind(this),settings:this.state.settings,reset:this.reset.bind(this),clear:this.clear.bind(this),playerMoves:a,bookMoves:n,gameResults:this.gameResults(),onMove:this.onMove.bind(this),turnColor:this.turnColor(),showError:this.showError.bind(this),showInfo:this.showInfo.bind(this),setDownloading:this.setDownloading.bind(this),isDownloading:this.state.downloadingGames,openingGraph:this.state.openingGraph,importCallback:this.importGameState.bind(this),variant:this.state.variant,variantChange:this.variantChange.bind(this),forceFetchBookMoves:this.forceFetchBookMoves.bind(this),highlightArrow:this.highlightArrow.bind(this),oauthManager:this.oauth})))),c.a.createElement(w.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:t,autoHideDuration:6e3,onClose:this.closeError.bind(this)},c.a.createElement(L.a,{onClose:this.closeError.bind(this),variant:this.state.messageSeverity,message:this.state.message,subMessage:this.state.subMessage,showReportButton:"error"===this.state.messageSeverity,action:this.state.errorAction,actionText:this.state.errorActionText})),c.a.createElement(v.a,{isOpen:this.state.feedbackOpen,toggle:this.toggleFeedback(!1)},c.a.createElement(f.a,{toggle:this.toggleFeedback(!1)},"Feedback"),c.a.createElement(b.a,null,"Your feedback is greatly appreciated. Reach out to me for feedback, suggestions, bug report or just a game of chess.",c.a.createElement("ul",null,c.a.createElement("li",null,"Email me: ",c.a.createElement("a",{rel:"noopener noreferrer",href:this.getEmailLink(),target:"_blank"},S.X)),c.a.createElement("li",null,"Message me on reddit ",c.a.createElement("a",{rel:"noopener noreferrer",href:this.getRedditLink(),target:"_blank"},"u/",S.ab)),c.a.createElement("li",null,"Message me on lichess: ",c.a.createElement("a",{rel:"noopener noreferrer",href:"https://lichess.org/inbox/".concat(S.Z),target:"_blank"},S.Z)),c.a.createElement("li",null,"Message me on chess.com: ",c.a.createElement("a",{rel:"noopener noreferrer",href:"https://www.chess.com/messages/compose/".concat(S.V),target:"_blank"},S.V)),c.a.createElement("li",null,"Join my ",c.a.createElement("a",{rel:"noopener noreferrer",href:S.W,target:"_blank"},"discord server")," to chat")),c.a.createElement(C.a,{control:c.a.createElement(O.a,{checked:this.state.diagnosticsDataOpen,onChange:this.toggleDiagnosticsData,name:"diagnostics",color:"primary"}),label:"Add diagnostics data to message"}),c.a.createElement(y.a,{isOpen:this.state.diagnosticsDataOpen},c.a.createElement(N.a,{id:"diagnosticsText",label:"Click to copy.",variant:"outlined",className:"fullWidth",value:this.getDiagnosticsValue(),rowsMax:4,onClick:this.copyDiagnostics,multiline:!0}))),c.a.createElement(E.a,null,c.a.createElement(k.a,{color:"secondary",onClick:this.toggleFeedback(!1)},"Done"))))}},{key:"componentDidMount",value:function(){Object(P.a)(this.state.settings.darkMode),e(this.handleResize.bind(this))}}]),l}(c.a.Component)}).call(this,a(103).setImmediate)},429:function(e,t,a){"use strict";var n=a(42),s=a(0),i=a.n(s),r=a(430),o=a(464),l=a(465),c=a(458),h=a(87),u=a(287),p=a(282),m=a(459),d=a(283),g=a(160),v=a(851),f=a(70),b=a(852),y=a(853),E=a(854),k=a(284),w=a(206),C=a(207),O=a(208),N=a(107),S=(a(499),a(20)),M=a(15),T=a(266),j=a(2),P=a(14);t.a=function(e){var t=e.settings.darkMode,a=Object(s.useState)(!1),R=Object(n.a)(a,2),A=R[0],x=R[1],I=Object(s.useState)(!1),F=Object(n.a)(I,2),D=F[0],L=F[1],B=function(){D||Object(P.b)(j.l,"AcknowledgementsOpen"),L(!D)},G=Object(s.useState)(!1),z=Object(n.a)(G,2),W=z[0],U=z[1],V=function(){W||Object(P.b)(j.l,"FaqOpen"),U(!W)},H=function(e,t){return function(){t&&Object(P.b)(j.l,t),window.open(e,"_blank")}},q={rows:[{title:"What is OpeningTree.com?",content:"OpeningTree.com is an open source website that helps you analyze anyone's lichess or chess.com games. You can use it to prepare for your opponents, improve your own game or learn from openings that grandmasters play."},{title:"How do I use OpeningTree?",content:'To try it out, you can load Magnus Carlsen\'s games by choosing, lichess as the source, enter "DrNykterstein" in the user name, choose "white" and click "Analyze games". Hit the stop link when a few hundred games have loaded and click "View moves". You can see the moves that Carlsen played as white in his recent games and his win percentages there. You can dig deeper into various lines. The moves shown for black are the moves that were played by his opponents against him.'},{title:"What are some of the advanced features of OpeningTree?",content:"You can analyze games of notable grandmasters from Morphy to Nakamura. You can also analyze games from lichess tournaments to see which moves are being played by others. You can also save openingtree files locally and load them fast or load them from pgn files."},{title:"Do I need to login to lichess?",content:"You dont need to, but logging in increases the speed of download of games from lichess. So if you plan on processing hundreds of games, it is recommended that you login."},{title:"Do I need to keep reloading games everytime I want to analyze the same player? OR What is a .tree file?",content:'If you plan to keep reloading the same player\'s games over and over again. The better option is to use the "Save .tree file" button after your games have loaded. This saves a pre-processed file of all the games on your local computer. You can then load the file using the "Load .tree file" option as the source and load the same file. It can load thousands of games in a matter of seconds.'},{title:"Is there a way to filter games by time control, choose only recent games etc.?",content:'Yes. You can click on "Advanced filters" under the "Color and filters" panel of openingtree to see many different filtering options that are available.'},{title:"What do the triangles under the bars indicate?",content:"Little triangles indicate the openingbook statistics on the moves tab and the player statistics on the openingbook tab.\n        Everything left of the white triangle is a win for white, everything right of the black triangle is a win for black and everything in the middle is a draw.\n        If there is only a black triangle and no white, it means there are no draws."}]},_={rowTitleColor:"black",rowContentColor:Object(N.c)(t),rowTitleTextSize:"small",rowContentTextSize:"small",rowContentPaddingTop:"1"},Q={};return i.a.createElement("div",null,i.a.createElement(b.a,{color:t?"dark":"light",dark:t,light:!t,expand:"md"},i.a.createElement("img",{src:Object(N.b)(t),height:"32px",width:"32px",alt:"Logo"}),i.a.createElement(y.a,{href:"/"},"\xa0OpeningTree.com"),i.a.createElement(E.a,{onClick:function(){return x(!A)}}),i.a.createElement(k.a,{isOpen:A,navbar:!0},i.a.createElement(w.a,{className:"mr-auto",navbar:!0},i.a.createElement(C.a,null,i.a.createElement(O.a,{className:"navLinkButton",onClick:H("https://www.youtube.com/watch?v=AJ66-HqdpXE","mainVideo")},i.a.createElement("span",null,'"It\'s so powerful" - IM Eric Rosen'),i.a.createElement("span",{className:"smallText"},"[Video]")))),i.a.createElement(w.a,{className:"ml-auto",navbar:!0},i.a.createElement(C.a,null,i.a.createElement(O.a,{className:"navLinkButton",onClick:function(){Object(P.b)(j.l,"DarkModeToggle"),e.settingsChange(j.fb,!t)}},i.a.createElement(S.a,{icon:t?M.q:M.t,className:"largeHeaderIcon"}),i.a.createElement("span",null,t?"Light mode":"Dark mode")))),i.a.createElement(w.a,{className:"",navbar:!0},i.a.createElement(C.a,null,i.a.createElement(O.a,{className:"navLinkButton",onClick:H("https://youtu.be/9w7GdGuJoyk","tutorial")},i.a.createElement(S.a,{icon:T.b,className:"largeHeaderIcon"}),i.a.createElement("span",null,"Tutorial")))),i.a.createElement(w.a,{className:"",navbar:!0},i.a.createElement(C.a,null,i.a.createElement(O.a,{className:"navLinkButton",onClick:H(j.W,"discord")},i.a.createElement(S.a,{icon:T.a,className:"discordIcon"}),i.a.createElement("span",null,"Discord")))),i.a.createElement(o.a,null,i.a.createElement(l.a,{className:"bootNavColor",nav:!0},i.a.createElement(S.a,{icon:M.v,className:"moreIcon"}),"Help"),i.a.createElement(c.a,{right:!0},i.a.createElement(h.a,{onClick:V},i.a.createElement("span",null,"FAQ")),i.a.createElement(h.a,{onClick:e.toggleFeedback},i.a.createElement("span",null,"Send feedback")),i.a.createElement(h.a,{onClick:H("https://www.openingtree.com/old","OldVersion")},i.a.createElement("span",null,"Old version")))),i.a.createElement(o.a,null,i.a.createElement(l.a,{className:"bootNavColor",nav:!0},i.a.createElement(S.a,{icon:M.b,className:"moreIcon"}),"More"),i.a.createElement(c.a,{right:!0},i.a.createElement(h.a,{onClick:B},i.a.createElement("span",null,"Acknowledgements")),i.a.createElement(h.a,{onClick:H("https://github.com/openingtree/openingtree","github")},i.a.createElement("span",null,"Github")),i.a.createElement(h.a,{divider:!0}),i.a.createElement(h.a,{onClick:H("https://lichess.org/","lichess")},i.a.createElement("span",null,"Lichess.org")),i.a.createElement(h.a,{onClick:H("https://www.lichess4545.com/","lichess4545")},i.a.createElement("span",null,"Lichess4545")),i.a.createElement(h.a,{onClick:H("https://www.chess.com","chessDotCom")},i.a.createElement("span",null,"Chess.com")),i.a.createElement(h.a,{onClick:H("https://www.youtube.com/channel/UCqGhULGgnf6IbY5JXWuVVtQ/live","chilledChess")},i.a.createElement("span",null,"ChilledChess")))))),i.a.createElement(u.a,{isOpen:D,toggle:B},i.a.createElement(p.a,{toggle:B},"Acknowledgements"),i.a.createElement(v.a,{className:"acknowledgement"},i.a.createElement(f.a,{tag:"a",href:"https://lichess.org/api",target:"_blank",action:!0},"Lichess API"),i.a.createElement(f.a,{tag:"a",href:"https://www.chess.com/club/chess-com-developer-community",target:"_blank",action:!0},"Chess.com API"),i.a.createElement(f.a,{tag:"a",href:"https://github.com/ruilisi/react-chessground",target:"_blank",action:!0},"ChessGround"),i.a.createElement(f.a,{tag:"a",href:"https://github.com/jhlywa/chess.js",target:"_blank",action:!0},"Chess.js"),i.a.createElement(f.a,{tag:"a",href:"https://github.com/niklasf/eco",target:"_blank",action:!0},"Eco"),i.a.createElement(f.a,{tag:"a",href:"https://github.com/jimmywarting/StreamSaver.js",target:"_blank",action:!0},"StreamSaver.js"),i.a.createElement(f.a,{tag:"a",href:"https://www.flaticon.com/authors/google/",target:"_blank",action:!0},"Icons made by google"),i.a.createElement(f.a,{tag:"a",href:"https://www.flaticon.com/",target:"_blank",action:!0},"FlatIcons.com"),i.a.createElement(f.a,{tag:"a",href:"https://www.freelogodesign.org",target:"_blank",action:!0},"Free logo design"),i.a.createElement(f.a,{tag:"a",href:"https://github.com/kevinludwig/pgn-parser",target:"_blank",action:!0},"PGN Parser"),i.a.createElement(f.a,{tag:"a",href:"https://www.npmjs.com/package/material-ui-dropzone",target:"_blank",action:!0},"Dropzone"),i.a.createElement(f.a,{tag:"a",href:"https://www.pgnmentor.com",target:"_blank",action:!0},"PGN Mentor"),i.a.createElement(f.a,{tag:"a",href:"https://www.twitch.tv/imrosen",target:"_blank",action:!0},"IM Eric Rosen")),i.a.createElement(d.a,null,i.a.createElement(g.a,{color:"secondary",onClick:B},"Done"))),i.a.createElement(u.a,{isOpen:W,toggle:V},i.a.createElement(p.a,{toggle:V},"Frequently asked questions"),i.a.createElement(m.a,null,i.a.createElement(r.a,{data:q,styles:_,config:Q})),i.a.createElement(d.a,null,i.a.createElement(g.a,{color:"secondary",onClick:V},"Done"))))}},441:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return L}));var n=a(42),s=a(78),i=a(39),r=a(16),o=a(17),l=a(26),c=a(27),h=a(0),u=a.n(h),p=a(31),m=a(857),d=a(858),g=a(198),v=a.n(g),f=a(861),b=a(862),y=a(2),E=a(867),k=a(284),w=a(14),C=a(20),O=a(135),N=a(15),S=a(455),M=a(855),T=a(86),j=a(864),P=a(865),R=a(859),A=a(286),x=a(463),I=a(866),F=a(443),D=a.n(F),L=function(t){Object(l.a)(h,t);var a=Object(c.a)(h);function h(e){var t;return Object(r.a)(this,h),(t=a.call(this,e)).state={playerColor:t.props.playerColor,isAdvancedFiltersOpen:!1},Object.assign(t.state,t.props.advancedFilters),t.defaultAdvancedFilters=t.props.advancedFilters,t}return Object(o.a)(h,[{key:"toggleRated",value:function(){"all"===this.state.rated?this.setState({rated:"rated"}):"rated"===this.state.rated?this.setState({rated:"casual"}):this.setState({rated:"all"}),Object(w.b)(y.r,"AdvancedFilterChange","rated")}},{key:"toggleState",value:function(e){var t=this;return function(){var a={};a[e]=!t.state[e],t.setState(a),Object(w.b)(y.r,"ToggleAdvancedFilters",t.state.site)}}},{key:"playerColorChange",value:function(t){var a=t.target.value;this.setState({playerColor:a}),Object(w.b)(y.r,"ColorChange",a),T.b(this.props.site)||e(this.setFilters.bind(this))}},{key:"handleTimeControlChange",value:function(e){this.setState(Object(i.a)({},e.target.name,e.target.checked))}},{key:"handleEloRangeChange",value:function(e,t){this.setState(Object(i.a)({},y.u,t))}},{key:"handleDownloadLimitChange",value:function(e,t){this.setState(Object(i.a)({},y.t,t))}},{key:"handleOpponentNameChange",value:function(e){this.setState(Object(i.a)({},y.w,e.target.value))}},{key:"handleFromDate",value:function(e){this.setState(Object(i.a)({},y.v,e))}},{key:"handleToDate",value:function(e){this.setState(Object(i.a)({},y.y,e))}},{key:"setFilters",value:function(){this.state.playerColor?(this.setState({colorError:"",isAdvancedFiltersOpen:!1}),this.props.filtersChange(this.state)):this.setState({colorError:"Please select a color"})}},{key:"getSummary",value:function(e){return this.props.playerColor&&!e?u.a.createElement("span",null,Object(p.d)("done"),"Color: ",u.a.createElement("b",null,this.props.playerColor===y.cb?"White":"Black"," "),this.areAdvancedFiltersApplied()?u.a.createElement("span",{className:"smallText"},"(Filters applied)"):null):u.a.createElement("span",null,Object(p.d)(3)," Color and filters")}},{key:"componentWillReceiveProps",value:function(e){this.setState(Object(s.a)(Object(s.a)({},e.advancedFilters),{},{playerColor:e.playerColor}))}},{key:"areAdvancedFiltersApplied",value:function(){for(var e=0,t=Object.entries(this.defaultAdvancedFilters);e<t.length;e++){var a=Object(n.a)(t[e],2),s=a[0],i=a[1];if(this.props.advancedFilters[s]!==i&&!D()(this.props.advancedFilters[s],i))return!0}return!1}},{key:"render",value:function(){var e=!T.c(this.props.site,this.props.playerName,this.props.selectedNotablePlayer);return u.a.createElement(p.a,{expanded:"filters"===this.props.expandedPanel,TransitionComponent:M.a,TransitionProps:{timeout:y.P},onChange:this.props.handleExpansionChange,disabled:e},u.a.createElement(m.a,{expandIcon:u.a.createElement(v.a,null)},this.getSummary(e)),u.a.createElement(d.a,null,u.a.createElement("div",{className:"pgnloadersection"},u.a.createElement(j.a,{component:"fieldset",error:!!this.state.colorError},u.a.createElement(P.a,{component:"legend"},"Games where ",u.a.createElement("b",null,this.props.playerName)," is playing as:"),u.a.createElement(R.a,{onChange:this.playerColorChange.bind(this),value:this.state.playerColor},u.a.createElement(A.a,{className:"whitelabel",control:u.a.createElement(x.a,{color:"primary"}),value:y.cb,label:this.state.playerColor===y.cb?u.a.createElement("b",null,"White"):"White"}),u.a.createElement(A.a,{className:"blacklabel",control:u.a.createElement(x.a,{color:"primary"}),value:y.bb,label:this.state.playerColor===y.bb?u.a.createElement("b",null,"Black"):"Black"})),u.a.createElement(I.a,null,this.state.colorError))),T.b(this.props.site)?u.a.createElement("div",{className:"pgnloadersection"},u.a.createElement("span",{className:"linkStyle",onClick:this.toggleState("isAdvancedFiltersOpen").bind(this)},"Advanced filters ",u.a.createElement(C.a,{icon:this.state.isAdvancedFiltersOpen?N.c:N.b})," ",this.state.isAdvancedFiltersOpen?null:u.a.createElement(E.a,{className:"sourceName",color:"info"},"New!")),u.a.createElement(k.a,{isOpen:this.state.isAdvancedFiltersOpen},u.a.createElement(S.a,{site:this.props.site,toggleRated:this.toggleRated.bind(this),handleTimeControlChange:this.handleTimeControlChange.bind(this),handleEloRangeChange:this.handleEloRangeChange.bind(this),handleOpponentNameChange:this.handleOpponentNameChange.bind(this),handleDownloadLimitChange:this.handleDownloadLimitChange.bind(this),handleFromDate:this.handleFromDate.bind(this),handleToDate:this.handleToDate.bind(this),advancedFilters:Object(p.b)(this.state)}))):null),u.a.createElement(f.a,null),u.a.createElement(b.a,null,u.a.createElement(O.a,{size:"small",color:"primary",onClick:this.setFilters.bind(this)},"Continue")))}}]),h}(u.a.Component)}).call(this,a(103).setImmediate)},444:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return R}));var n=a(16),s=a(17),i=a(26),r=a(27),o=a(0),l=a.n(o),c=a(2),h=a(14),u=a(20),p=a(135),m=a(445),d=a(15),g=a(279),v=a.n(g),f=a(447),b=a.n(f),y=a(462),E=a(449),k=a.n(E),w=a(86),C=a(872),O=a(278),N=a.n(O),S=a(276),M=a(111),T=a(277),j=a.n(T),P=a(60),R=function(t){Object(i.a)(o,t);var a=Object(r.a)(o);function o(e){var t;return Object(n.a)(this,o),(t=a.call(this,e)).unload=function(){t.pgnReader&&t.pgnReader.stopDownloading()},t.state={isGamesSubsectionOpen:!1,exportingInProgress:!1},j.a.mitm="download/download-mitm.html",t.encoder=new TextEncoder,t}return Object(s.a)(o,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",this.unload)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.unload)}},{key:"importTreeClicked",value:function(){this.setState({exportingInProgress:!0}),Object(h.b)(c.n,"LoadTree",this.props.site,this.props.playerColor===c.cb?1:0),e(this.importOpeningTree.bind(this))}},{key:"importOpeningTree",value:function(){var e=this;Object(S.a)(this.props.files[0],(function(t,a,n){if(t)return e.props.showError(t,null,n),void e.setState({exportingInProgress:!1});var s=e.props.importOpeningTreeObject(a);e.setState({exportingInProgress:!1}),s&&e.props.showInfo("Successfuly loaded openingtree")}))}},{key:"exportTreeClicked",value:function(){this.setState({exportingInProgress:!0}),Object(h.b)(c.n,"SaveTree",this.props.site,this.props.playerColor===c.cb?1:0),e(this.exportOpeningTree.bind(this))}},{key:"exportOpeningTree",value:function(){var e=this;Object(S.b)(this.props.exportOpeningTreeObject(),w.a(this.props.site,this.props.playerName,this.props.playerColor,null,"tree"),(function(t,a){t?e.props.showError(t):e.props.showInfo(a),e.setState({exportingInProgress:!1})}))}},{key:"abortDownloading",value:function(){this.fileWriter&&(this.fileWriter.close(),this.fileWriter=null)}},{key:"getPgnString",value:function(e){return"".concat(Object.entries(e.headers).map((function(e){return"[".concat(e[0],' "').concat(e[1],'"]')})).join("\n"),"\n                \n").concat(e.moves.map((function(e,t){return"".concat(t%2!==0?"":t/2+1+"."," ").concat(e.move)})).join(" ")," ").concat(e.result,"\n\n\n")}},{key:"downloadResponse",value:function(e,t){var a=this;return this.fileWriter.write(this.encoder.encode(e.map((function(e){return a.getPgnString(e)})).join(""))).then((function(){if(!t)return a.abortDownloading(),!1})),!0}},{key:"readPgn",value:function(e){var t=this;if(e){var a=j.a.createWriteStream(w.a(this.props.site,this.props.playerName,this.props.playerColor,this.props.selectedNotableEvent,"pgn"));this.fileWriter=a.getWriter()}new m.a(this.props.variant).then((function(a){t.pgnReader=a,t.pgnReader.fetchPGNFromSite(t.props.playerName,t.props.playerColor,t.props.site,t.props.selectedNotablePlayer,t.props.selectedNotableEvent,t.props.selectedOnlineTournament,e,t.props.advancedFilters,Object(M.a)(t.props.notify),Object(M.a)(t.props.showError),Object(M.a)(t.stopDownloading.bind(t)),t.props.files,Object(M.a)(t.downloadResponse.bind(t)),t.getTokens())}))}},{key:"getTokens",value:function(){return{lichess:P.a.getLichessAccessToken()}}},{key:"download",value:function(){this.readPgn(!0),Object(h.b)(c.n,"Download",this.props.site,this.props.playerColor===c.cb?1:0)}},{key:"getPlayerName",value:function(){return this.props.site===c.ob?this.props.selectedNotablePlayer.name:this.props.playerName}},{key:"componentWillReceiveProps",value:function(e){e.gamesProcessed>0&&this.setState({isGamesSubsectionOpen:!0})}},{key:"load",value:function(){this.props.clear(),this.setState({isGamesSubsectionOpen:!0,loadedSite:this.props.site}),this.props.onChange("playerName",this.props.playerName),this.props.onChange("playerColor",this.props.playerColor),this.readPgn(!1),this.props.setDownloading(!0),Object(h.b)(c.n,"Load",this.props.site,this.props.playerColor===c.cb?1:0)}},{key:"stopDownloading",value:function(){this.props.setDownloading(!1)}},{key:"stopDownloadingAction",value:function(){this.stopDownloading(),Object(h.b)(c.n,"StopDownloading",this.props.site)}},{key:"openingTreeLoadActions",value:function(){return l.a.createElement("div",{className:"pgnloadersection"},l.a.createElement(p.a,{onClick:this.importTreeClicked.bind(this),variant:"contained",color:"primary",startIcon:this.state.exportingInProgress?l.a.createElement(N.a,null):l.a.createElement(v.a,null),className:"mainButton",disableElevation:!0,disabled:this.state.exportingInProgress},this.state.exportingInProgress?"Loading from file":"Load openingtree"))}},{key:"regularActions",value:function(){var e=this,t=w.d(this.state.loadedSite,this.props.site,this.props.gamesProcessed,this.props.isDownloading);return l.a.createElement("div",null,l.a.createElement("div",{className:"pgnloadersection"},l.a.createElement(p.a,{onClick:this.load.bind(this),variant:"contained",color:"primary",startIcon:l.a.createElement(b.a,null),className:"mainButton",disableElevation:!0},"Analyze games")),l.a.createElement("div",{className:"pgnloadersection"},l.a.createElement(p.a,{onClick:this.download.bind(this),variant:"contained",color:"default",startIcon:l.a.createElement(v.a,null),className:"mainButton",disableElevation:!0},"Export as PGN")),l.a.createElement("div",{className:"pgnloadersection"},l.a.createElement(C.a,{placement:"top",title:t||"Save a .tree file locally for faster reload later"},l.a.createElement("span",null,l.a.createElement(p.a,{onClick:this.exportTreeClicked.bind(this),variant:"contained",color:"default",startIcon:this.state.exportingInProgress?l.a.createElement(N.a,null):l.a.createElement(k.a,null),className:"mainButton",disableElevation:!0,disabled:!!t||this.state.exportingInProgress},this.state.exportingInProgress?"Saving to file":"Save .tree file")))),this.state.isGamesSubsectionOpen?l.a.createElement("div",null,l.a.createElement("div",{className:"pgnloadersection"},this.props.playerColor?this.props.playerColor===c.cb?"White games":"Black games":"Games"," loaded: ".concat(this.props.gamesProcessed," "),this.props.isDownloading?l.a.createElement("span",{className:"stopDownloading"},"[",l.a.createElement("span",{className:"linkStyle",onClick:this.stopDownloadingAction.bind(this)},l.a.createElement("img",{alt:"loading spinner",src:"./spinner.gif",height:"15"}),"stop"),"]"):""),l.a.createElement("div",{onClick:function(){return e.props.switchToMovesTab()},className:"navLinkButton pgnloadersection"},l.a.createElement(u.a,{icon:d.r})," View Moves>>")):"")}},{key:"mainComponent",value:function(){return this.props.site===c.mb?this.openingTreeLoadActions():this.regularActions()}},{key:"render",value:function(){return this.props.expandedPanel?l.a.createElement(y.a,{timeout:2*c.P},this.mainComponent()):l.a.createElement(y.a,{in:!0,timeout:3*c.P},this.mainComponent())}}]),o}(l.a.Component)}).call(this,a(103).setImmediate)},445:function(e,t,a){"use strict";(function(e){var n=a(111),s=Object(n.b)(new Worker(e,void 0));t.a=s}).call(this,a(618))},450:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return K}));var n=a(2),s=a(14),i=a(31),r=a(69),o=a(182),l=a(451),c=a(60),h=a(107),u=0;function p(){return"w"===this.chess.turn()?n.cb:n.bb}function m(){return this.state.settings.playerColor}function d(){return this.playerColor()&&this.playerColor()!==this.turnColor()?this.againstBrushes:this.forBrushes}function g(e){this.setState({highlightedMove:e})}function v(){var e=this,t={};return this.chess.SQUARES.forEach((function(a){var n=e.chess.moves({square:a,verbose:!0});n.length&&(t[a]=n.map((function(e){return e.to})))})),{free:!1,dests:t,color:this.turnColor()}}function f(){return this.state.settings.orientation}function b(e,t){var a=null;a=t?{from:e,to:t,promotion:"q"}:e;var n=this.chess,s=n.move(a);this.setState({fen:n.fen(),lastMove:s})}function y(e,t){this.onMove(e,t),Object(s.b)(n.j,"Move")}function E(e,t){this.chess=Object(r.a)(this.state.variant,e),this.setState({fen:e,lastMove:t})}function k(e,t,a){var s=this.state.gamesProcessed+t;return this.state.openingGraph.addPGN(a.pgnStats,a.parsedMoves,a.latestFen,a.playerColor,this.state.variant),this.setState({gamesProcessed:s,downloadingGames:(s<e||e>=n.Q)&&this.state.downloadingGames}),(s<e||e>=n.Q)&&this.state.downloadingGames}function w(e){return{orig:e.orig,dest:e.dest!==e.orig?e.dest:null,brush:this.brushes()[e.level]}}function C(e,t){var a=[];if(t){if(!t.orig||!t.dest){var n=Object(r.a)(this.state.variant,this.state.fen).move(t.san);t.orig=n.from,t.dest=n.to}t.level=0,a.push(this.moveToShape(t))}return e&&(a=a.concat(e.filter((function(e){return!t||(t.orig!==e.orig||t.dest!==e.dest)})).map(this.moveToShape.bind(this)))),u=Math.max(u,a.length),this.fillArray(a,u)}function O(){if(!this.state.openingGraph.hasMoves)return null;var e=this.state.openingGraph.movesForFen(this.chess.fen());return e?e.sort((function(e,t){return e.moveCount===t.moveCount?t.details.count-e.details.count:t.moveCount-e.moveCount})):[]}function N(){return this.state.openingGraph.gameResultsForFen(this.chess.fen())}function S(e,t){for(var a=e.length;a<t;a++)e.push({orig:"i"+a,dest:"i"+(a+1),brush:this.brushes()[0]});return e}function M(){this.chess=Object(r.a)(this.state.variant),this.setState({fen:this.chess.fen(),lastMove:null})}function T(){this.state.openingGraph.clear(),this.state.gamesProcessed=0,this.reset()}function j(t,a){if(t===n.gb){var s={};s[t]=a,c.a.setSettingsCookie(s),this.state.openingGraph.clearBookNodes()}else t===n.fb&&c.a.setDarkModeCookie(a);var i=this.state.settings;i[t]=a,this.setState({settings:i}),t===n.fb&&e((function(){return Object(h.a)(a)}))}function P(e,t,a,i,r){var o,l,c,h=r||n.h;i===n.g?(o="Visit old site",c="https://www.openingtree.com/old",l=function(){window.open(c,"_blank")}):i!==n.f&&(o="Report this",l=this.toggleFeedback(!0)),this.setState({message:e,subMessage:a,errorAction:l,errorActionText:o,messageSeverity:h});var u=h+"Shown";t&&(u=u+":"+t),Object(s.b)(n.o,u,e)}function R(e,t){this.setState({message:e,messageSeverity:n.i}),Object(s.b)(n.o,"infoShown",t||e)}function A(){this.setState({message:"",subMessage:""})}function x(e){var t=this;return function(){var a=t.state.feedbackOpen;a||Object(s.b)(n.l,"feedbackOpen"),t.closeError(),t.setState({feedbackOpen:!a,diagnosticsDataOpen:e})}}function I(e){this.setState({downloadingGames:e})}function F(){this.setState({diagnosticsDataOpen:!this.state.diagnosticsDataOpen})}function D(){Object(i.c)("diagnosticsText"),this.showInfo("Copied Diagnostics data")}function L(t){t.settings.movesSettings=this.state.settings.movesSettings,this.setState({settings:t.settings,openingGraph:t.openingGraph,gamesProcessed:t.gamesProcessed,variant:t.variant?t.variant:n.zb}),e(this.reset.bind(this))}function B(){return"".concat(function(e){for(;e%8!==0;)e++;return e}(window.innerWidth<=768?Math.round(95*window.innerWidth/100):window.innerWidth<=1424?Math.round(Math.min(48*window.innerWidth/100,Math.max(512,window.innerHeight-100))):Math.round(Math.min(712,Math.max(512,window.innerHeight-100)))),"px")}function G(){return"--------------------\n  ".concat(navigator.userAgent,"\n  -------------------\n  ").concat(JSON.stringify(this.state),"\n  -------------------\n  ")}function z(){return"https://www.reddit.com/message/compose/?to=".concat(n.ab,"&subject=").concat(this.getSubject(),"&message=%0D%0A%0D%0A%0D%0A").concat(this.getBody())}function W(){return"mailto:".concat(n.X,"?subject=").concat(this.getSubject(),"&body=%0D%0A%0D%0A%0D%0A").concat(this.getBody())}function U(){return this.state.diagnosticsDataOpen?"Possible Openingtree bug":"Feedback on Openingtree"}function V(){return this.state.diagnosticsDataOpen?this.getDiagnosticsValue():""}function H(t){this.setState({variant:t,openingGraph:new o.a(t)}),e(this.reset.bind(this))}function q(){var e=this.state.openingGraph.getBookNode(this.chess.fen());return this.state.settings.movesSettings.openingBookType===n.U?{fetch:"off"}:(e||(e=this.forceFetchBookMoves()),e)}function _(){var t=this,a=Object(l.a)(this.state.fen,this.state.variant,this.state.settings.movesSettings,(function(e){t.state.openingGraph.addBookNode(t.chess.fen(),e),t.setState({update:t.state.update+1})}));return this.state.openingGraph.addBookNode(this.chess.fen(),a),e((function(){return t.setState({update:t.state.update+1})})),a}function Q(e,t){if(e){var a=function(e){var t=new Map;if(!e)return t;return e.forEach((function(e){t.set(e.san,e)})),t}(t.moves);e.forEach((function(e){var t=a.get(e.san);t&&(e.compareTo={bookScore:Y(t),userScore:Y(e),values:J(t)},t.compareTo={bookScore:Y(t),userScore:Y(e),values:J(e)})}))}}function Y(e){return(e.details.whiteWins+e.details.draws/2)/e.details.count*100}function J(e){return[e.details.whiteWins/e.details.count*100,(e.details.whiteWins+e.details.draws)/e.details.count*100]}function K(e){e.orientation=f,e.turnColor=p,e.calcMovable=v,e.onMove=b,e.onMoveAction=y,e.autoShapes=C,e.updateProcessedGames=k,e.settingsChange=j,e.reset=M,e.clear=T,e.navigateTo=E,e.playerColor=m,e.fillArray=S,e.brushes=d,e.moveToShape=w,e.getPlayerMoves=O,e.gameResults=N,e.showError=P,e.showInfo=R,e.closeError=A,e.toggleFeedback=x.bind(e),e.setDownloading=I,e.toggleDiagnosticsData=F.bind(e),e.copyDiagnostics=D.bind(e),e.importGameState=L,e.getDiagnosticsValue=G,e.getChessboardWidth=B,e.getEmailLink=W,e.getSubject=U,e.getBody=V.bind(e),e.getRedditLink=z,e.variantChange=H,e.getBookMoves=q,e.forceFetchBookMoves=_,e.mergePlayerAndBookMoves=Q,e.highlightArrow=g}}).call(this,a(103).setImmediate)},451:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(158),s=a.n(n),i=a(66);function r(e,t,a,n){var r=a.openingBookRating,l=a.openingBookTimeControls,c=a.openingBookType,h="https://explorer.lichess.ovh/".concat(c,"?fen=").concat(e,"&play=&variant=").concat(i.e(t),"&ratings=").concat(o(r),"&speeds=").concat(o(l));return s.a.get(h,(function(e,t){if(e)n({fetch:"failed"});else{try{return void n(JSON.parse(t.body))}catch(a){console.log(a)}n({fetch:"failed"})}})),{fetch:"pending"}}function o(e){return e.join(",")}},452:function(e,t,a){"use strict";var n=a(457),s=a(194),i=a.n(s),r=a(195),o=a.n(r),l=a(285),c=a(863),h=a(135),u=a(7),p=a(190),m=a.n(p),d=a(196),g=a.n(d),v=a(192),f=a.n(v),b=a(193),y=a.n(b),E=a(191),k=a.n(E),w=a(5),C=a(0),O={success:m.a,warning:k.a,error:f.a,info:y.a};t.a=Object(u.a)((function(e){return{success:{backgroundColor:i.a[600]},error:{backgroundColor:e.palette.error.dark},info:{backgroundColor:e.palette.primary.dark},warning:{backgroundColor:o.a[700]},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:e.spacing(1)},message:{display:"flex",alignItems:"center"}}}))((function(e){var t=e.classes,a=e.className,s=e.message,i=e.onClose,r=e.variant,o=e.subMessage,u=e.action,p=e.actionText,m=e.showReportButton,d=Object(n.a)(e,["classes","className","message","onClose","variant","subMessage","action","actionText","showReportButton"]),v=O[r];return C.createElement(c.a,Object.assign({className:Object(w.a)(t[r],a),"aria-describedby":"client-snackbar",message:C.createElement("div",null,C.createElement("span",{id:"client-snackbar",className:t.message},C.createElement(v,{className:Object(w.a)(t.icon,t.iconVariant)}),s),o?C.createElement("div",{className:"smallText"},"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0",o):null),action:[m?C.createElement(h.a,{key:"report",onClick:u,color:"inherit",size:"small"},p):null,C.createElement(l.a,{key:"close","aria-label":"Close",color:"inherit",className:t.close,onClick:i},C.createElement(g.a,{className:t.icon}))]},d))}))},453:function(e,t,a){"use strict";var n,s=a(16),i=a(17),r=a(26),o=a(27),l=a(0),c=a.n(l),h=a(78),u=a(75),p=a(48),m=a(2),d=a(14),g=a(39),v=a(31),f=a(855),b=a(857),y=a(858),E=a(859),k=a(861),w=a(862),C=a(135),O=a(286),N=a(463),S=a(914),M=a(915),T=a(916),j=a(917),P=a(918),R=a(20),A=a(15),x=(n={},Object(g.a)(n,m.yb,[m.kb,m.lb,m.mb,m.nb]),Object(g.a)(n,m.xb,[m.ib,m.kb,m.lb,m.mb,m.nb]),Object(g.a)(n,m.Ab,[m.ib,m.kb,m.lb,m.mb,m.nb]),Object(g.a)(n,m.wb,[m.ib,m.kb,m.lb,m.mb,m.nb]),n),I=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"getSourceOption",value:function(e,t){return e===m.kb?c.a.createElement("span",null,t?Object(v.d)("done",t):null,c.a.createElement("img",{alt:"lichess",className:"siteimage",src:"./lichesslogo.png"}),c.a.createElement("span",{className:"sourceName"}," lichess.org ")):e===m.ib?c.a.createElement("span",null,t?Object(v.d)("done",t):null,c.a.createElement("img",{alt:"chess.com",className:"siteimage",src:"./chesscomlogo.png"})):e===m.nb?c.a.createElement("span",null,t?Object(v.d)("done",t):null,c.a.createElement(S.a,{className:"lowOpacity"}),c.a.createElement("span",{className:"sourceName"}," Load ",c.a.createElement("i",null,"PGN")," file")):e===m.jb?c.a.createElement("span",null,t?Object(v.d)("done",t):null,c.a.createElement(M.a,{className:"lowOpacity"}),c.a.createElement("span",{className:"sourceName"}," Notable chess events")):e===m.ob?c.a.createElement("span",null,t?Object(v.d)("done",t):null,c.a.createElement(T.a,{className:"lowOpacity"}),c.a.createElement("span",{className:"sourceName"}," Notable chess players")):e===m.mb?c.a.createElement("span",null,t?Object(v.d)("done",t):null,c.a.createElement(j.a,{className:"lowOpacity"}),c.a.createElement("span",{className:"sourceName"}," Load ",c.a.createElement("b",null,".tree")," file")):e===m.lb?c.a.createElement("span",null,t?Object(v.d)("done",t):null,c.a.createElement(R.a,{icon:A.g,className:"lowOpacity"}),c.a.createElement("span",{className:"sourceName"}," Lichess tournaments")):c.a.createElement("span",null,Object(v.d)(1,t),"Select a source")}},{key:"continue",value:function(){this.props.siteChange(this.props.site)}},{key:"setSite",value:function(e){var t=e.target.value;this.props.siteChange(t)}},{key:"isSourceAvailable",value:function(e,t){var a=x[t];return!a||a.includes(e)}},{key:"render",value:function(){return c.a.createElement(v.a,{TransitionComponent:f.a,TransitionProps:{timeout:m.P},expanded:"source"===this.props.expandedPanel,onChange:this.props.handleExpansionChange},c.a.createElement(b.a,{expandIcon:c.a.createElement(P.a,null),"aria-controls":"panel1c-content",id:"panel1c-header"},c.a.createElement("div",null,this.getSourceOption(this.props.site,!0))),c.a.createElement(y.a,null,c.a.createElement(E.a,{onChange:this.setSite.bind(this),value:this.props.site},this.getSourceRadio(m.kb),this.getSourceRadio(m.ib),this.getSourceRadio(m.lb),this.getSourceRadio(m.mb),this.props.variant===m.zb?c.a.createElement(k.a,{className:"dividerMargin"}):null,this.getSourceRadio(m.ob),this.getSourceRadio(m.jb),this.getSourceRadio(m.nb))),this.props.site?c.a.createElement("span",null,c.a.createElement(k.a,null),c.a.createElement(w.a,null,c.a.createElement(C.a,{size:"small",color:"primary",onClick:this.continue.bind(this)},"Continue"))):null)}},{key:"getSourceRadio",value:function(e){return this.isSourceAvailable(e,this.props.variant)?c.a.createElement(O.a,{className:"sitelabel",value:e,control:c.a.createElement(N.a,{color:"primary"}),label:this.getSourceOption(e)}):null}}]),a}(c.a.Component),F=a(868),D=a(198),L=a.n(D),B=a(454),G=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"handleFileChange",value:function(e){Object(d.b)(m.r,"FileSaved",e.length>0?e[0].name:null),this.props.filesChange(e)}},{key:"render",value:function(){return c.a.createElement(B.a,{acceptedFiles:[],dropzoneText:this.props.dropzoneText,onChange:this.handleFileChange.bind(this),dropzoneParagraphClass:"dropzonetext",showFileNames:!0,useChipsForPreview:!0,previewChipProps:{className:"previewChip"},dropzoneClass:"dropzone",filesLimit:this.props.filesLimit,maxFileSize:3e12})}}]),a}(c.a.Component),z=a(438),W=a.n(z),U=a(439),V=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).updateDetails=function(t){Object(d.b)(m.r,"NotableGameSelected",t.value),e.props.onChange(t)},e}return Object(i.a)(a,[{key:"renderDetails",value:function(e){return c.a.createElement("div",null,c.a.createElement("span",null,c.a.createElement(U.LazyLoadImage,{alt:e.name,className:"profilePicture",width:"40",height:"40",src:e.profile.imageUrl})),c.a.createElement("div",null,e.name),c.a.createElement("div",{className:"smallText"},e.profile.subText))}},{key:"render",value:function(){if(!this.props.list)return c.a.createElement("div",{className:"lowOpacity textCenter"},c.a.createElement("img",{alt:"loading",width:"25",height:"25",src:"./spinner.gif"})," Loading List");if(!this.props.list.length)return c.a.createElement("div",{className:"lowOpacity textCenter"}," Could not fetch list");var e=this.props.list.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{value:e.name})}));return c.a.createElement(W.a,{name:"goatPlayers",value:this.props.selectedDetail.value,options:e,placeholder:this.props.placeholder,renderOption:this.renderDetails,onChange:this.updateDetails})}}]),a}(c.a.Component),H=a(921),q=a(923),_=a(924),Q=a(925),Y=a(273),J=a.n(Y),K=a(440),X=a.n(K),Z=a(922),$=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={playerName:"",tournamentUrl:"",files:[],selectedPlayer:{},selectedEvent:{}},n}return Object(i.a)(a,[{key:"editPlayerName",value:function(e){this.setState({playerName:e.target.value,playerNameError:""})}},{key:"editTournamentUrl",value:function(e){this.setState({tournamentUrl:e.target.value,tournamentUrlError:""})}},{key:"filesChange",value:function(e){this.setState({files:e})}},{key:"notablePlayerChange",value:function(e){this.setState({selectedPlayer:e})}},{key:"notableEventChange",value:function(e){this.setState({selectedEvent:e})}},{key:"componentWillReceiveProps",value:function(e){this.setState({playerNameError:"",tournamentUrlError:""})}},{key:"validateInputDetailsSet",value:function(){if(this.props.site===m.jb){if(!this.state.selectedEvent)return this.props.showError("Please select an event"),!1}else if(this.props.site===m.ob){if(!this.state.selectedPlayer)return this.props.showError("Please select a player"),!1}else if(this.props.site===m.kb||this.props.site===m.ib){if(!this.state.playerName)return this.setState({playerNameError:"Please enter a username"}),!1}else if(this.props.site===m.nb){if(0===this.state.files.length)return this.props.showError("Please upload a PGN file"),!1}else if(this.props.site===m.mb){if(0===this.state.files.length)return this.props.showError("Please upload an openingtree file"),!1}else if(this.props.site===m.lb){if(!this.state.tournamentUrl)return this.setState({tournamentUrlError:"Please enter a url"}),!1;var e=this.state.tournamentUrl.trim();e.startsWith("http")||(e="https://"+e);var t=null;try{t=new URL(e)}catch(c){return this.setState({tournamentUrlError:"Please enter a valid url"}),!1}var a=t.hostname,n=null;if("lichess.org"===a||a.endsWith(".lichess.org"))n=m.kb;else if("chess.com"===a||a.endsWith(".chess.com"))return this.setState({tournamentUrlError:"chess.com tournaments are not currently supported"}),!1;if(!n)return this.setState({tournamentUrlError:"Please enter a lichess.org url"}),!1;for(var s=t.pathname.split("/"),i=null,r=null,o=0;o<s.length;o++)if(s[o]){r=s[o];break}for(var l=s.length-1;l>=0;l--)if(s[l]){i=s[l];break}if(!i)return this.setState({tournamentUrlError:"Please enter a valid tournament url"}),!1;this.selectedOnlineTournament={tournamentSite:n,tournamentId:i,tournamentType:r}}return!0}},{key:"finalPlayerName",value:function(e,t,a){return e===m.ob?a.name:e===m.jb?"":t?t.trim():t}},{key:"setPlayerDetails",value:function(){this.validateInputDetailsSet()&&this.props.playerDetailsChange(this.finalPlayerName(this.props.site,this.state.playerName,this.state.selectedPlayer),this.state.files,this.state.selectedEvent,this.state.selectedPlayer,this.selectedOnlineTournament)}},{key:"getSummary",value:function(){if(this.props.site===m.ob){if(this.props.selectedPlayer&&this.props.selectedPlayer.name)return c.a.createElement("span",null,Object(v.d)("done"),this.props.selectedPlayer.profile.title,"\xa0",c.a.createElement("b",null,this.props.selectedPlayer.name))}else if(this.props.site===m.kb||this.props.site===m.ib){if(this.props.playerName)return c.a.createElement("span",null,Object(v.d)("done"),"User: ",c.a.createElement("b",null,this.props.playerName))}else if(this.props.site===m.nb||this.props.site===m.mb){if(1===this.props.files.length)return c.a.createElement("span",null,Object(v.d)("done"),"File: ",c.a.createElement("b",null,this.props.files[0].name));if(this.props.files.length>1)return c.a.createElement("span",null,Object(v.d)("done"),this.props.files.length," PGN files uploaded")}else if(this.props.site===m.jb){if(this.props.selectedEvent&&this.props.selectedEvent.name)return c.a.createElement("span",null,Object(v.d)("done"),this.props.selectedEvent.name)}else if(this.props.site===m.lb&&this.props.selectedOnlineTournament)return c.a.createElement("span",null,Object(v.d)("done"),"Id: ",c.a.createElement("b",null,this.props.selectedOnlineTournament.tournamentId));return c.a.createElement("span",null,Object(v.d)(2),this.title(this.props.site))}},{key:"title",value:function(e){return e===m.lb||e===m.jb?"Tournament details":e===m.mb||e===m.nb?"File details":"Player details"}},{key:"launchLichessOauth",value:function(){Object(d.b)(m.m,"lichessLogin"),console.log(this),setTimeout(this.props.oauthManager.fetchAuthorizationCode.bind(this.props.oauthManager),150)}},{key:"getLichessSelection",value:function(){return c.a.createElement("div",null,this.getLichessCardBody(),c.a.createElement("br",null),this.getPlayerNameInput("lichess username"))}},{key:"getLichessCardBody",value:function(){return this.props.lichessLoginState===m.O?c.a.createElement(H.a,null,c.a.createElement("div",{className:"center"},c.a.createElement(Z.a,{className:"bigSpinner dividerMargin"}),c.a.createElement("br",null))):this.props.lichessLoginState===m.A?c.a.createElement(H.a,null,c.a.createElement(q.a,{className:"singlePadding"},c.a.createElement(_.a,{className:"smallBottomMargin redColor"},c.a.createElement(R.a,{icon:A.p,className:"lowOpacity"})," Failed to fetch login status"),c.a.createElement(_.a,{className:"smallBottomMargin"},c.a.createElement(R.a,{icon:A.A,className:"lowOpacity smallText leftMargin2"}),c.a.createElement("span",{onClick:this.props.refreshLichessStatus,className:"smallText linkStyle leftMargin4"}," Retry fetching status")),c.a.createElement(_.a,null,c.a.createElement(R.a,{icon:A.x,className:"lowOpacity smallText leftMargin2"}),c.a.createElement("span",{onClick:this.props.logoutOfLichess,className:"smallText linkStyle leftMargin4"}," Logout of lichess")),c.a.createElement(C.a,{onClick:this.launchLichessOauth.bind(this),variant:"contained",color:"default",className:"mainButton",disableElevation:!0,startIcon:c.a.createElement(J.a,null)},"LOGIN AGAIN"))):this.props.lichessLoginState===m.H&&this.props.lichessLoginName?c.a.createElement(H.a,null,c.a.createElement(q.a,{className:"singlePadding"},c.a.createElement(_.a,null,c.a.createElement(R.a,{icon:A.e,className:"lowOpacity greenColor"})," Logged in as",c.a.createElement("b",null," ",this.props.lichessLoginName)),c.a.createElement(C.a,{onClick:this.props.logoutOfLichess,variant:"contained",color:"default",className:"mainButton",disableElevation:!0,startIcon:c.a.createElement(X.a,null)},"LOGOUT"))):c.a.createElement(H.a,null,c.a.createElement(q.a,{className:"singlePadding"},c.a.createElement(_.a,{className:"smallBottomMargin"},c.a.createElement(R.a,{icon:A.p,className:"lowOpacity"})," Speed up tree building (optional)"),c.a.createElement(Q.a,{className:"smallText"},"Lichess allows much faster download of games if you login. You can learn more about this ",c.a.createElement("a",{href:"https://lichess.org/api#operation/apiGamesUser",rel:"noopener noreferrer",target:"_blank"},"here"),". Recommended for viewing your own games or when your opponent has lots of games."),c.a.createElement(C.a,{onClick:this.launchLichessOauth.bind(this),variant:"contained",color:"default",className:"mainButton",disableElevation:!0,startIcon:c.a.createElement(J.a,null)},"LOGIN TO LICHESS")))}},{key:"getChessComSelection",value:function(){return this.getPlayerNameInput("chess.com username")}},{key:"getPlayerNameInput",value:function(e,t){return c.a.createElement(F.a,{className:"playernameField",name:"playerName",id:"playerNameTextBox",margin:"dense",onChange:this.editPlayerName.bind(this),label:e,variant:"outlined",value:this.state.playerName,helperText:this.state.playerNameError?this.state.playerNameError:t,error:!!this.state.playerNameError,onKeyUp:this.playerNameKeyUp.bind(this)})}},{key:"getOnlineTournamentSelection",value:function(){return c.a.createElement("div",null,this.getOnlineTournamentCard(),c.a.createElement("br",null),this.getOnlineTournamentInput("Enter tournament url","eg. https://lichess.org/tournament/QlooVt7W"))}},{key:"getOnlineTournamentCard",value:function(){return c.a.createElement(H.a,null,c.a.createElement(q.a,{className:"singlePadding"},c.a.createElement(_.a,{className:"smallBottomMargin"},c.a.createElement(R.a,{icon:A.p,className:"lowOpacity"})," How it works"),c.a.createElement(Q.a,{className:"smallText"},"You can load all of the games of a lichess tournament by copying the  url from your address bar on those sites and pasting it below.",c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("b",null,"Why is chess.com not supported?"),c.a.createElement("br",null),"chess.com API has a few bugs in returning tournament games so we are not able to support them currently. Bugs have been reported to chess.com.")))}},{key:"getOnlineTournamentInput",value:function(e,t){return c.a.createElement(F.a,{className:"urlField",name:"onlineTournament",id:"onlineTournamentTextBox",margin:"dense",onChange:this.editTournamentUrl.bind(this),label:e,variant:"outlined",value:this.state.tournamentUrl,helperText:this.state.tournamentUrlError?this.state.tournamentUrlError:t,error:!!this.state.tournamentUrlError,onKeyUp:this.playerNameKeyUp.bind(this)})}},{key:"playerNameKeyUp",value:function(e){13===e.keyCode&&this.setPlayerDetails()}},{key:"getGoatDBSelection",value:function(){return c.a.createElement(V,{list:this.props.notablePlayers,placeholder:"Select a player",onChange:this.notablePlayerChange.bind(this),selectedDetail:this.state.selectedPlayer})}},{key:"getGoatDBEventSelection",value:function(){return c.a.createElement(V,{list:this.props.notableEvents,placeholder:"Select an event",onChange:this.notableEventChange.bind(this),selectedDetail:this.state.selectedEvent})}},{key:"getPgnFileSelection",value:function(){return c.a.createElement("div",null,c.a.createElement(G,{filesChange:this.filesChange.bind(this),filesLimit:10,dropzoneText:"Drag and drop up to 10 pgn files here or click here to select files"}),this.getPlayerNameInput("player name in PGN","Leave blank to load all games"))}},{key:"getOpeningTreeSelection",value:function(){return c.a.createElement("div",null,c.a.createElement(H.a,null,c.a.createElement(q.a,{className:"singlePadding"},c.a.createElement(_.a,{className:"smallBottomMargin"},c.a.createElement(R.a,{icon:A.p,className:"lowOpacity"})," How it works"),c.a.createElement(Q.a,{className:"smallText"},"If you plan to revisit the same player, you can save a ",c.a.createElement("b",null,".tree")," file locally by loading a tree and then clicking ",c.a.createElement("i",null,'"Save .tree file"'),". To reload the same tree, drop the ",c.a.createElement("b",null,".tree")," file in the dropzone below."))),c.a.createElement("br",null),c.a.createElement(G,{filesChange:this.filesChange.bind(this),filesLimit:1,dropzoneText:"Drag and drop openingtree save file here or click here to select a file"}))}},{key:"getInputsToShow",value:function(){return this.props.site===m.nb?this.getPgnFileSelection():this.props.site===m.kb?this.getLichessSelection():this.props.site===m.ib?this.getChessComSelection():this.props.site===m.jb?this.getGoatDBEventSelection():this.props.site===m.ob?this.getGoatDBSelection():this.props.site===m.mb?this.getOpeningTreeSelection():this.props.site===m.lb?this.getOnlineTournamentSelection():c.a.createElement("div",null)}},{key:"render",value:function(){return c.a.createElement(v.a,{expanded:"user"===this.props.expandedPanel,TransitionComponent:f.a,TransitionProps:{timeout:m.P},onChange:this.props.handleExpansionChange,disabled:""===this.props.site},c.a.createElement(b.a,{expandIcon:c.a.createElement(L.a,null)},this.getSummary()),c.a.createElement(y.a,null,this.getInputsToShow()),c.a.createElement(k.a,null),c.a.createElement(w.a,null,c.a.createElement(C.a,{size:"small",color:"primary",onClick:this.setPlayerDetails.bind(this)},"Continue")))}}]),a}(c.a.Component),ee=a(441),te=a(444),ae=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"getVariantOption",value:function(e,t){return c.a.createElement("span",null,t?Object(v.d)("done",t):null,c.a.createElement(R.a,{icon:this.getVariantIcon(e)})," ",c.a.createElement("span",null," ",this.getVariantText(e)," "))}},{key:"getVariantText",value:function(e){return e===m.yb?"Racing kings":e===m.Ab?"Three check":e===m.xb?"King of the hill":e===m.wb?"Crazyhouse":"Standard rules"}},{key:"getVariantIcon",value:function(e){return e===m.yb?A.n:e===m.Ab?A.j:e===m.xb?A.u:e===m.wb?A.o:A.f}},{key:"changeLink",value:function(){return"variant"===this.props.expandedPanel?null:c.a.createElement("span",{className:"smallText",style:{verticalAlign:"text-bottom"}},"\xa0[",c.a.createElement("span",{className:"linkStyle"},"change"),"]")}},{key:"getVariantRadio",value:function(e){return c.a.createElement(O.a,{className:"sitelabel",value:e,control:c.a.createElement(N.a,{color:"primary"}),label:this.getVariantOption(e)})}},{key:"continue",value:function(){this.props.variantChange(this.props.variant)}},{key:"setVariant",value:function(e){var t=e.target.value;this.props.variantChange(t)}},{key:"render",value:function(){return c.a.createElement(v.a,{TransitionComponent:f.a,TransitionProps:{timeout:m.P},expanded:"variant"===this.props.expandedPanel,onChange:this.props.handleExpansionChange},c.a.createElement(b.a,{expandIcon:c.a.createElement(P.a,null),"aria-controls":"panel1c-content",id:"panel1c-header"},c.a.createElement("div",null,this.getVariantOption(this.props.variant,!0)),c.a.createElement("div",null,this.changeLink())),c.a.createElement(y.a,null,c.a.createElement(E.a,{onChange:this.setVariant.bind(this),value:this.props.variant},this.getVariantRadio(m.zb),this.getVariantRadio(m.wb),this.getVariantRadio(m.Ab),this.getVariantRadio(m.xb),this.getVariantRadio(m.yb))),c.a.createElement(k.a,null),c.a.createElement(w.a,null,c.a.createElement(C.a,{size:"small",color:"primary",onClick:this.continue.bind(this)},"Continue")))}}]),a}(c.a.Component),ne=a(158),se=a.n(ne),ie=a(86),re=a(60),oe=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;Object(s.a)(this,a),n=t.call(this,e);var i=new URLSearchParams(window.location.search).get("source");return n.state={playerName:"",site:i||"",playerColor:n.props.settings.playerColor,isAdvancedFiltersOpen:!1,isGamesSubsectionOpen:!1,expandedPanel:i?"user":"source",notablePlayers:null,notableEvents:null,files:[],selectedNotableEvent:{},selectedNotablePlayer:{},lichessLoginState:m.I,lichessLoginName:null},i===m.kb&&n.fetchLichessLoginStatus(),n.state[m.t]=m.Q,n.state[m.vb]=!0,n.state[m.qb]=!0,n.state[m.pb]=!0,n.state[m.ub]=!0,n.state[m.rb]=!0,n.state[m.sb]=!0,n.state[m.tb]=!0,n.state[m.x]="all",n.state[m.u]=[0,m.R],n.state[m.w]="",n}return Object(i.a)(a,[{key:"advancedFilters",value:function(){return Object(p.a)(this.state,[m.vb,m.qb,m.pb,m.ub,m.sb,m.tb,m.rb,m.x,m.t,m.u,m.w,m.v,m.y])}},{key:"handleExpansionChange",value:function(e){var t=this;return function(a,n){t.setState({expandedPanel:!!n&&e})}}},{key:"exportOpeningTreeObject",value:function(){return{header:{version:2,timestamp:Math.floor(Date.now()/1e3),gamesProcessed:this.props.gamesProcessed,settings:this.props.settings,playerName:this.state.playername,site:this.state.site,advancedFilters:this.advancedFilters(),variant:this.props.variant},arrays:[Object(u.a)(this.props.openingGraph.graph.nodes.entries()),Object(u.a)(this.props.openingGraph.graph.pgnStats)]}}},{key:"importOpeningTreeObject",value:function(e){var t=1;return e.header.version&&(t=e.header.version),t<m.Y?(this.props.showError("This is an old format of openingtree file.",null,"You can try loading it by visiting the old website",m.g),!1):(this.setState(Object(h.a)(Object(h.a)({},e.header.advancedFilters),{},{playerColor:e.header.settings.playerColor,site:e.header.site,playerName:e.header.settings.playerName})),this.props.openingGraph.setEntries(e.arrays[0],e.arrays[1]),this.props.importCallback({settings:e.header.settings,gamesProcessed:e.header.gamesProcessed,openingGraph:this.props.openingGraph,variant:e.header.variant}),!0)}},{key:"playerDetailsChange",value:function(e,t,a,n,s){this.setState({playerName:e,expandedPanel:ie.c(this.state.site,e,n)?"filters":"",files:t,selectedNotableEvent:a,selectedNotablePlayer:n,playerColor:"",selectedOnlineTournament:s}),Object(d.b)(m.r,"PlayerNameSaved")}},{key:"fetchGOATGames",value:function(e,t){var a=this;se.a.get(e,(function(e,n){if(e)return a.props.showError("Could not fetch player list. Failed to connect to DB."),void t([]);var s;try{s=JSON.parse(n.body).list}catch(i){console.log(i)}s?t(s):(a.props.showError("Failed to load games."),t([]))}))}},{key:"siteChange",value:function(e){var t=this;e!==m.ob||this.state.notablePlayers||this.fetchGOATGames("https://goatchess.github.io/list.json",(function(e){t.setState({notablePlayers:e})})),e!==m.jb||this.state.notableEvents||this.fetchGOATGames("https://goatevents.github.io/list.json",(function(e){t.setState({notableEvents:e})})),e===m.kb&&this.fetchLichessLoginStatus(),this.setState({site:e,expandedPanel:"user"}),Object(d.b)(m.r,"ChangeSite",e)}},{key:"fetchLichessLoginStatus",value:function(){var e=this;re.a.getLichessAccessToken()?(Object(d.b)(m.m,"lichessTokenFound"),this.setState({lichessLoginState:m.O}),se.a.get("https://lichess.org/api/account",{timeout:5e3,auth:{bearer:re.a.getLichessAccessToken()}},(function(t,a){if(!t&&a){var n=JSON.parse(a.body);if(n&&n.username)return e.setState({lichessLoginState:m.H,lichessLoginName:n.username}),void Object(d.b)(m.m,"lichessFetchSuccess")}Object(d.b)(m.m,"lichessFetchFailed"),e.setState({lichessLoginState:m.A})}))):Object(d.b)(m.m,"lichessNoToken")}},{key:"logoutOfLichess",value:function(){re.a.deleteLichessAccessToken(),this.setState({lichessLoginState:m.I,lichessLoginName:""}),Object(d.b)(m.m,"lichessLogout")}},{key:"filtersChange",value:function(e){this.setState(Object(h.a)(Object(h.a)({},e),{},{expandedPanel:""})),Object(d.b)(m.r,"FitlersSaved",this.state.site)}},{key:"variantChange",value:function(e){this.setState({expandedPanel:"source"}),this.props.variantChange(e),Object(d.b)(m.r,"VariantChange",e)}},{key:"render",value:function(){return c.a.createElement("div",null,c.a.createElement("div",{className:"pgnloadersection"},c.a.createElement(ae,{expandedPanel:this.state.expandedPanel,handleExpansionChange:this.handleExpansionChange("variant").bind(this),variantChange:this.variantChange.bind(this),variant:this.props.variant}),c.a.createElement(I,{expandedPanel:this.state.expandedPanel,handleExpansionChange:this.handleExpansionChange("source").bind(this),site:this.state.site,siteChange:this.siteChange.bind(this),variant:this.props.variant}),c.a.createElement($,{expandedPanel:this.state.expandedPanel,playerName:this.state.playerName,handleExpansionChange:this.handleExpansionChange("user").bind(this),showError:this.props.showError,files:this.state.files,notablePlayers:this.state.notablePlayers,notableEvents:this.state.notableEvents,site:this.state.site,playerDetailsChange:this.playerDetailsChange.bind(this),pgnUrl:this.state.pgnUrl,selectedPlayer:this.state.selectedNotablePlayer,selectedEvent:this.state.selectedNotableEvent,lichessLoginState:this.state.lichessLoginState,lichessLoginName:this.state.lichessLoginName,logoutOfLichess:this.logoutOfLichess.bind(this),refreshLichessStatus:this.fetchLichessLoginStatus.bind(this),selectedOnlineTournament:this.state.selectedOnlineTournament,oauthManager:this.props.oauthManager}),c.a.createElement(ee.a,{expandedPanel:this.state.expandedPanel,playerColor:this.state.playerColor,handleExpansionChange:this.handleExpansionChange("filters").bind(this),site:this.state.site,playerName:this.state.playerName,advancedFilters:this.advancedFilters(),filtersChange:this.filtersChange.bind(this),selectedNotablePlayer:this.state.selectedNotablePlayer})),c.a.createElement(te.a,{expandedPanel:this.state.expandedPanel,playerColor:this.state.playerColor,files:this.state.files,playerName:this.state.playerName,site:this.state.site,advancedFilters:this.advancedFilters(),notify:this.props.notify,showError:this.props.showError,onChange:this.props.onChange,setDownloading:this.props.setDownloading,clear:this.props.clear,isDownloading:this.props.isDownloading,switchToMovesTab:this.props.switchToMovesTab,gamesProcessed:this.props.gamesProcessed,selectedNotablePlayer:this.state.selectedNotablePlayer,selectedNotableEvent:this.state.selectedNotableEvent,exportOpeningTreeObject:this.exportOpeningTreeObject.bind(this),showInfo:this.props.showInfo,importOpeningTreeObject:this.importOpeningTreeObject.bind(this),selectedOnlineTournament:this.state.selectedOnlineTournament,variant:this.props.variant}))}}]),a}(c.a.Component),le=a(44),ce=a(848),he=a(849),ue=a(281),pe=a(160),me=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(s.a)(this,a),n=t.call(this,e),window.addEventListener("keydown",n.keyHandler.bind(Object(le.a)(n))),n}return Object(i.a)(a,[{key:"keyHandler",value:function(e){if(!e.srcElement||"INPUT"!==e.srcElement.tagName)switch(e.keyCode){case 70:this.toggle(m.hb)()}}},{key:"toggle",value:function(e){var t=this;return function(){var a;switch(e){case m.hb:a=t.props.settings[e]===m.cb?m.bb:m.cb,Object(d.b)(m.k,"ChangeOrientation");break;case m.fb:a=!t.props.settings[e],Object(d.b)(m.k,"DarkMode")}t.props.onChange(e,a)}}},{key:"analyse",value:function(){window.open("https://www.lichess.org/analysis/standard/".concat(this.props.fen),"_blank"),Object(d.b)(m.k,"AnalyzeGame")}},{key:"resetAction",value:function(){this.props.reset(),Object(d.b)(m.k,"Reset")}},{key:"clearAction",value:function(){this.props.clear(),Object(d.b)(m.k,"Clear")}},{key:"render",value:function(){return c.a.createElement("div",null,c.a.createElement(ce.a,null,c.a.createElement(he.a,null,c.a.createElement(ue.a,{xs:"4"},c.a.createElement(pe.a,{className:"settingButton",onClick:this.toggle(m.hb),color:""},c.a.createElement("h3",null,c.a.createElement(R.a,{icon:A.w})),c.a.createElement("span",null,"Flip board"))),c.a.createElement(ue.a,{xs:"4"},c.a.createElement(pe.a,{className:"settingButton",onClick:this.clearAction.bind(this),color:""},c.a.createElement("h3",null,c.a.createElement(R.a,{icon:A.B})),c.a.createElement("span",null,"Clear games"))),c.a.createElement(ue.a,{xs:"4"},c.a.createElement(pe.a,{className:"settingButton",onClick:this.resetAction.bind(this),color:""},c.a.createElement("h3",null,c.a.createElement(R.a,{icon:A.m})),c.a.createElement("span",null,"Starting position"))),c.a.createElement(ue.a,{xs:"4"},c.a.createElement(pe.a,{className:"settingButton",onClick:this.analyse.bind(this),color:""},c.a.createElement("h3",null,c.a.createElement(R.a,{icon:A.i})),c.a.createElement("span",null,"Computer analysis"))),c.a.createElement(ue.a,{xs:"4"},c.a.createElement(pe.a,{className:"settingButton",onClick:this.toggle(m.fb),color:""},c.a.createElement("h3",null,c.a.createElement(R.a,{icon:this.props.settings.darkMode?A.q:A.t})),c.a.createElement("span",null,this.props.settings.darkMode?"Light mode":"Dark mode"))))))}}]),a}(c.a.Component),de=a(287),ge=a(282),ve=a(283),fe=a(206),be=a(207),ye=a(208),Ee=a(941),ke=a(942),we=a(8),Ce=a.n(we),Oe=a(944),Ne=a(935),Se=a(926),Me=a(927),Te=a(928),je=a(929),Pe=a(930),Re=a(931),Ae=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"eatClicks",value:function(e){e.stopPropagation()}},{key:"copyFen",value:function(){Object(v.c)("fenField"),this.props.showInfo("FEN copied")}},{key:"getFenField",value:function(){return this.props.simplifiedView?null:c.a.createElement("div",{className:"fenDiv"},c.a.createElement(F.a,{id:"fenField",multiline:!0,label:"FEN",rowsMax:"2",value:this.props.fen,inputProps:{style:{fontSize:12},spellCheck:!1},variant:"outlined",className:"fenField",margin:"dense",onClick:this.copyFen.bind(this)}))}},{key:"render",value:function(){var e=this,t=this.props.moveDetails;if(!t.hasData)return c.a.createElement("div",null,this.getFenField(),c.a.createElement("div",{className:"infoMessage"},"No data to show. Please enter a lichess or chess.com user name in the",c.a.createElement("span",{className:"navLinkButton",onClick:function(){return e.props.switchToUserTab()}}," ",c.a.createElement(R.a,{icon:A.C})," User"),' tab and click "Load"'));var a={};return this.props.isOpen&&(a=Object(p.b)(t.totalOpponentElo,t.averageElo,t.whiteWins,t.draws,t.blackWins,this.props.settings.playerColor)),c.a.createElement("div",{className:"performanceOverlay"},this.getFenField(),c.a.createElement(Se.a,{onClick:this.eatClicks},a.performanceRating&&!isNaN(a.performanceRating)&&this.props.settings.playerName?c.a.createElement(Me.a,{className:"performanceRatingRow".concat(this.props.simplifiedView?" performanceHeader":"")},c.a.createElement(Te.a,null,c.a.createElement(je.a,{className:"performanceRatingRow"},c.a.createElement("b",null,"Performance")),c.a.createElement(je.a,{className:"performanceRatingRow"},c.a.createElement("b",null,a.performanceRating)))):null,c.a.createElement(Pe.a,null,c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Results"),c.a.createElement(je.a,{className:"performanceRatingRow"},a.results)),isNaN(a.averageOpponentElo)||a.averageOpponentElo<=0||!this.props.settings.playerName?null:c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Avg opponent"),c.a.createElement(je.a,{className:"performanceRatingRow"},a.averageOpponentElo)),isNaN(a.averageElo)?null:c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Avg Rating"),c.a.createElement(je.a,{className:"performanceRatingRow"},a.averageElo)),c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Score"),c.a.createElement(je.a,{className:"performanceRatingRow"},a.score)),this.props.simplifiedView||isNaN(a.averageElo)||!this.props.settings.playerName?null:c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Rating change"),c.a.createElement(je.a,{className:"performanceRatingRow"},a.ratingChange)),this.props.settings.playerName&&!this.props.simplifiedView&&t.bestWinElo?c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Best win"),c.a.createElement(je.a,{className:"performanceRatingRow"},t.bestWinElo," ",c.a.createElement(R.a,{className:"pointerExternalLink",onClick:this.props.launchGame(t.bestWinGame),icon:A.l}))):null,this.props.settings.playerName&&!this.props.simplifiedView&&t.worstLossElo?c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Worst loss"),c.a.createElement(je.a,{className:"performanceRatingRow"},t.worstLossElo," ",c.a.createElement(R.a,{className:"pointerExternalLink",onClick:this.props.launchGame(t.worstLossGame),icon:A.l}))):null,!this.props.simplifiedView&&t.longestGameInfo?c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Longest game"),c.a.createElement(je.a,{className:"performanceRatingRow"},t.longestGameInfo.numberOfPlys," Plys ",c.a.createElement(R.a,{className:"pointerExternalLink",onClick:this.props.launchGame(t.longestGameInfo),icon:A.l}))):null,!this.props.simplifiedView&&t.shortestGameInfo?c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Shortest game"),c.a.createElement(je.a,{className:"performanceRatingRow"},t.shortestGameInfo.numberOfPlys," Plys ",c.a.createElement(R.a,{className:"pointerExternalLink",onClick:this.props.launchGame(t.shortestGameInfo),icon:A.l}))):null,t.lastPlayedGame?c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},"Last played"),c.a.createElement(je.a,{className:"performanceRatingRow"},this.removeQuestionMarksFromDate(t.lastPlayedGame.date)," ",c.a.createElement(R.a,{className:"pointerExternalLink",onClick:this.props.launchGame(t.lastPlayedGame),icon:A.l}))):null),this.props.reportFooter?c.a.createElement(Re.a,null,c.a.createElement(Te.a,null,c.a.createElement(je.a,{colSpan:"2"},this.props.reportFooter))):null))}},{key:"removeQuestionMarksFromDate",value:function(e){return e&&-1!==e.indexOf("?")?e.slice(0,e.indexOf(".")):e}}]),a}(c.a.Component),xe=(a(839),a(204));function Ie(e,t){return"".concat(e).concat(t?"(".concat(t,")"):"")}function Fe(e,t,a,n,s){return c.a.createElement(H.a,{className:"errorCard"},c.a.createElement(q.a,{className:"singlePadding"},c.a.createElement(_.a,{className:"smallBottomMargin"},c.a.createElement(R.a,{icon:A.p,className:"lowOpacity"})," "+e),c.a.createElement(Q.a,{className:"smallText"},t,c.a.createElement("br",null),c.a.createElement("br",null),n?c.a.createElement(C.a,{onClick:a,variant:"contained",color:"default",className:"mainButton",disableElevation:!0,startIcon:s},n):null)))}var De=a(459),Le=a(933),Be=a(946),Ge=a(934),ze=a(284),We=a(932),Ue=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;Object(s.a)(this,a),n=t.call(this,e);var i=Object.assign({},n.props.settings.movesSettings);return i.openingBookType=n.getTransformedBookType(i.openingBookType),n.state={movesSettings:i,indicatorInfoOpen:!1},n}return Object(i.a)(a,[{key:"updateMoveSetting",value:function(e){var t=this;return function(a,n){if(!(Array.isArray(n)&&n.length<1)){var s=Object.assign({},t.state.movesSettings);s[e]=n,t.setState({movesSettings:s})}}}},{key:"cancel",value:function(){this.setState({movesSettings:this.props.settings.movesSettings}),this.props.toggle(),Object(d.b)(m.s,"MoveSettingsCancel")}},{key:"set",value:function(){this.props.settingsChange(m.gb,this.state.movesSettings),this.props.toggle(),Object(d.b)(m.s,"MoveSettingsSet")}},{key:"toggleIndicatorInfo",value:function(e){this.setState({indicatorInfoOpen:!this.state.indicatorInfoOpen}),this.state.indicatorInfoOpen||Object(d.b)(m.s,"MoveSettingsIndicatorInfo")}},{key:"render",value:function(){return c.a.createElement(de.a,{isOpen:this.props.isOpen,toggle:this.cancel.bind(this)},c.a.createElement(ge.a,{toggle:this.cancel.bind(this)},"Opening book settings"),c.a.createElement(De.a,null,c.a.createElement("div",{className:"littlePaddingTop"},this.getOpeningBookType()),this.state.movesSettings.openingBookType===m.S?c.a.createElement("div",{className:"littlePaddingTop"},this.getOpeningBookRating()):null,this.state.movesSettings.openingBookType===m.S?c.a.createElement("div",{className:"littlePaddingTop"},this.getOpeningBookTimeControls()):null,c.a.createElement("div",{className:"littlePaddingTop"},this.getIndicatorSwitch("openingBookWinsIndicator",c.a.createElement("span",null,"Book indicators ",c.a.createElement(We.a,{href:"#",className:"smallText",onClick:this.toggleIndicatorInfo.bind(this)},"whats this?")))),c.a.createElement(ze.a,{isOpen:this.state.indicatorInfoOpen},c.a.createElement(H.a,null,c.a.createElement(q.a,{className:"singlePadding"},c.a.createElement("img",{src:"./images/bookIndicator.png",alt:"bookIndicator"}),c.a.createElement(Q.a,{className:"smallText"},"Little triangles indicate the openingbook statistics on the moves tab and the player statistics on the openingbook tab. ",c.a.createElement("br",null),"Everything left of the white triangle is a win for white, everything right of the black triangle is a win for black and everything in the middle is a draw.",c.a.createElement("br",null),"If there is only a black triangle and no white, it means there are no draws."))))),c.a.createElement(ve.a,null,c.a.createElement(pe.a,{color:"link",onClick:this.cancel.bind(this)},"Cancel"),c.a.createElement(pe.a,{color:"primary",onClick:this.set.bind(this)},"Set")))}},{key:"getIndicatorSwitch",value:function(e,t){return c.a.createElement("div",null,c.a.createElement(O.a,{control:c.a.createElement(Le.a,{checked:this.state.movesSettings[e],name:e,color:"primary"}),onChange:this.updateMoveSetting(e),label:t}))}},{key:"mastersBookAvailable",value:function(){return this.props.variant===m.zb}},{key:"getTransformedBookType",value:function(e){return e!==m.T||this.mastersBookAvailable()?e:m.S}},{key:"getOpeningBookType",value:function(){return c.a.createElement("div",null,"Book type",c.a.createElement("br",null),c.a.createElement(Be.a,{size:"small",exclusive:!0,value:this.getTransformedBookType(this.state.movesSettings.openingBookType),onChange:this.updateMoveSetting("openingBookType"),"aria-label":"book type"},c.a.createElement(Ge.a,{value:m.U,"aria-label":m.U},"Off")," ",this.mastersBookAvailable()?c.a.createElement(Ge.a,{value:m.T,"aria-label":m.T},"Masters"):null,c.a.createElement(Ge.a,{value:m.S,"aria-label":m.S},"Lichess")))}},{key:"getOpeningBookRating",value:function(){return c.a.createElement("div",null,"Rating",c.a.createElement("br",null),c.a.createElement(Be.a,{size:"small",value:this.state.movesSettings.openingBookRating,onChange:this.updateMoveSetting("openingBookRating"),"aria-label":"text formatting"},c.a.createElement(Ge.a,{value:"1600","aria-label":"1600"},"1600"),c.a.createElement(Ge.a,{value:"1800","aria-label":"1800"},"1800"),c.a.createElement(Ge.a,{value:"2000","aria-label":"2000"},"2000"),c.a.createElement(Ge.a,{value:"2200","aria-label":"2200"},"2200"),c.a.createElement(Ge.a,{value:"2500","aria-label":"2500"},"2500")))}},{key:"getOpeningBookTimeControls",value:function(){return c.a.createElement("div",null,"Time controls",c.a.createElement("br",null),c.a.createElement(Be.a,{size:"small",value:this.state.movesSettings.openingBookTimeControls,onChange:this.updateMoveSetting("openingBookTimeControls"),"aria-label":"text formatting"},c.a.createElement(Ge.a,{value:"bullet","aria-label":"bullet"},"Bullet"),c.a.createElement(Ge.a,{value:"blitz","aria-label":"blitz"},"Blitz"),c.a.createElement(Ge.a,{value:"rapid","aria-label":"rapid"},"Rapid"),c.a.createElement(Ge.a,{value:"classical","aria-label":"classical"},"Classical"),c.a.createElement(Ge.a,{value:"correspondence","aria-label":"correspondence"},"Correspondence")))}}]),a}(c.a.Component),Ve=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={openPerformanceIndex:null,moveSettingsOpen:!1},n}return Object(i.a)(a,[{key:"isTouchDevice",value:function(){return"ontouchstart"in window}},{key:"componentDidUpdate",value:function(e,t){e.turnColor!==this.props.turnColor&&this.setState({openPerformanceIndex:null})}},{key:"move",value:function(e){var t=this;return function(){t.props.onMove(e),Object(d.b)(m.p,t.props.clickedEventName)}}},{key:"toggleMovesSettings",value:function(){this.state.moveSettingsOpen||Object(d.b)(m.s,"MoveSettingsOpen"),this.setState({moveSettingsOpen:!this.state.moveSettingsOpen})}},{key:"togglePerformancePopover",value:function(e){var t=this;return function(a){null!==t.state.openPerformanceIndex?t.setState({openPerformanceIndex:null}):t.setState({openPerformanceIndex:e}),a&&a.stopPropagation&&a.stopPropagation()}}},{key:"compareClicked",value:function(e){var t=this;return function(a){a.stopPropagation(),t.props.compareToClicked(e)}}},{key:"compareScores",value:function(e){var t=e.compareTo;if(!t)return null;var a=[t.bookScore,t.userScore];return c.a.createElement(xe.ProgressBar,{percent:0,stepPositions:a},this.getIndicator("./images/book.png","12","12",this.constructAlt(this.props.compareToAlt,a),this.compareClicked(e.san)),this.getIndicator("./images/user.png","12","12",this.constructAlt(this.props.compareToAlt,a),this.compareClicked(e.san)))}},{key:"compareProgress",value:function(e){var t=e.compareTo;return t?c.a.createElement(xe.ProgressBar,{percent:0,stepPositions:t.values},this.getIndicator("./images/arrow-white.png","20","16",this.constructAlt(this.props.compareToAlt,t.values),this.compareClicked(e.san)),this.getIndicator("./images/arrow-black.png","18","14",this.constructAlt(this.props.compareToAlt,t.values),this.compareClicked(e.san))):null}},{key:"constructAlt",value:function(e,t){var a=Math.round(t[0]),n=Math.round(t[1])-a,s=100-a-n;return"".concat(e," \nWhite wins ").concat(a,"% \nDraws ").concat(n,"% \nBlack wins ").concat(s,"%")}},{key:"getIndicator",value:function(e,t,a,n,s){return c.a.createElement(xe.Step,{transition:"scale"},(function(i){i.accomplished;return c.a.createElement("img",{onClick:s,alt:n,title:n,className:"pointerExternalLink",width:a,height:t,src:e})}))}},{key:"getPopover",value:function(e){var t=this.state.openPerformanceIndex===e,a=this.props.movesToShow[e];return c.a.createElement(Oe.a,{trigger:"hover",placement:"right",isOpen:t,target:"p".concat(this.props.namespace).concat(e),toggle:this.togglePerformancePopover(e)},c.a.createElement(Ae,{moveDetails:a.details,simplifiedView:!0,isOpen:t,launchGame:this.props.launchGame,settings:this.props.settings,reportFooter:this.reportFooter(e)}))}},{key:"reportFooter",value:function(e){var t=this.props.movesToShow[e];if("none"!==this.getTranspositionWarningLevel(e))return c.a.createElement("div",null,this.getInfoIcon(e),c.a.createElement("b",null," This move has transpositions")," ",c.a.createElement("div",null,t.san," has been played ",1===t.moveCount?"once":"".concat(t.moveCount," times"),"  in this position but the resulting position has appeared ",t.details.count," times through other move orders."))}},{key:"getTranspositionWarningLevel",value:function(e){var t=this.props.movesToShow[e],a=t.details.count,n=a-t.moveCount;return n>0?1===t.moveCount||n>10&&n/a>.1?"warning":"info":"none"}},{key:"render",value:function(){var e=this;return this.props.movesToShow&&this.props.movesToShow.length>0?c.a.createElement(Se.a,null,c.a.createElement(Me.a,null,c.a.createElement(Te.a,null,c.a.createElement(je.a,{size:"small",className:"smallCol"},c.a.createElement("b",null,"Move")),c.a.createElement(je.a,{size:"small",className:"smallCol"},c.a.createElement("b",null,"Games")),c.a.createElement(je.a,null,c.a.createElement("b",null,"Results"),c.a.createElement(R.a,{className:"floatRight pointer",icon:A.D,onClick:this.toggleMovesSettings.bind(this)}),c.a.createElement(Ue,{isOpen:this.state.moveSettingsOpen,toggle:this.toggleMovesSettings.bind(this),settingsChange:this.props.settingsChange,updateSettings:this.props.updateSettings,settings:this.props.settings,variant:this.props.variant})))),c.a.createElement(Pe.a,null,this.props.movesToShow.map((function(t,a){var n=t.details.lastPlayedGame;return n&&1===t.details.count?e.getSingleItemRow(t,n):e.getMultiItemRow(t,a)}))),c.a.createElement(Re.a,null,c.a.createElement(Te.a,null,c.a.createElement(je.a,{colSpan:"3"},this.props.tableFooter)))):Fe("No moves found","The opening book does not have any moves in this position",this.toggleMovesSettings.bind(this),c.a.createElement("b",null,"Modify Book Settings",c.a.createElement(Ue,{isOpen:this.state.moveSettingsOpen,toggle:this.toggleMovesSettings.bind(this),settingsChange:this.props.settingsChange,updateSettings:this.props.updateSettings,settings:this.props.settings,variant:this.props.variant})))}},{key:"highlightArrowFn",value:function(e){var t=this;return this.isTouchDevice()?function(){}:function(){t.props.highlightArrow(e)}}},{key:"getMultiItemRow",value:function(e,t){var a=this;return c.a.createElement(Te.a,{className:"".concat(this.props.highlightMove===e.san?"bgColor ":"","moveRow"),key:"m".concat(e.orig).concat(e.dest).concat(e.san),onClick:this.move(e.san),onMouseOver:this.highlightArrowFn(e).bind(this),onMouseOut:function(){return a.props.highlightArrow(null)}},c.a.createElement(je.a,{size:"small",className:"smallCol"},e.san," "),c.a.createElement(je.a,{size:"small",id:"p".concat(this.props.namespace).concat(t),className:"smallCol",onClick:this.togglePerformancePopover(t)},Object(p.f)(e.moveCount),this.getInfoIcon(t),this.getPopover(t)),c.a.createElement(je.a,null,c.a.createElement(ce.a,null,this.props.settings.movesSettings.openingBookScoreIndicator?c.a.createElement(he.a,{className:"scoresProgress"},c.a.createElement(ue.a,{className:"navCol"},this.compareScores(e))):null,c.a.createElement(he.a,null,c.a.createElement(ue.a,{className:"navCol"},c.a.createElement(Ne.a,{className:"border",multi:!0},c.a.createElement(Ne.a,{bar:!0,className:"whiteMove",value:"".concat(this.percentage(e.details.whiteWins,e.details.count))},this.getProgressLabel(e.details.whiteWins,e.details.count)),c.a.createElement(Ne.a,{bar:!0,className:"grayMove",value:"".concat(this.percentage(e.details.draws,e.details.count))},this.getProgressLabel(e.details.draws,e.details.count)),c.a.createElement(Ne.a,{bar:!0,className:"blackMove",value:"".concat(this.percentage(e.details.blackWins,e.details.count))},this.getProgressLabel(e.details.blackWins,e.details.count))))),this.props.settings.movesSettings.openingBookWinsIndicator?c.a.createElement(he.a,{className:"zeroHeight"},c.a.createElement(ue.a,{className:"navCol"},this.compareProgress(e))):null)))}},{key:"getInfoIcon",value:function(e){return"warning"===this.getTranspositionWarningLevel(e)?c.a.createElement(R.a,{className:"leftPadding redColor lowOpacity",icon:A.k}):c.a.createElement(R.a,{className:"lowOpacity leftPadding",icon:A.p})}},{key:"getProgressLabel",value:function(e,t){var a=this.percentage(e,t);return a<10?"":this.props.showAsPercentage?"".concat(a.toFixed(1),"%"):e}},{key:"percentage",value:function(e,t){return e/t*100}},{key:"getSingleItemRow",value:function(e,t){var a=this,n=Ie(t.white,t.whiteElo),s=Ie(t.black,t.blackElo),i=t.result;return c.a.createElement(Te.a,{className:"".concat(this.props.highlightMove===e.san?"bgColor ":"","moveRow"),key:"".concat(e.orig).concat(e.dest),onClick:this.move(e.san),onMouseOver:this.highlightArrowFn(e).bind(this),onMouseOut:function(){return a.props.highlightArrow(null)}},c.a.createElement(je.a,{size:"small",className:"smallCol"},e.san),c.a.createElement(je.a,{colSpan:"2"},n," ",i," ",s," ",c.a.createElement(R.a,{className:"pointerExternalLink",onClick:this.props.launchGame(e.details.lastPlayedGame),icon:A.l})))}}]),a}(c.a.Component),He=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return c.a.createElement(Se.a,null,c.a.createElement(Pe.a,null,this.props.gameResults.map((function(t){var a=Ie(t.white,t.whiteElo),n=Ie(t.black,t.blackElo);return c.a.createElement(Te.a,{className:"moveRow",key:"".concat(t.url),onClick:e.props.launchGame(t)},c.a.createElement(je.a,null,"1-0"===t.result?c.a.createElement("b",null,a):a," ",t.result," ","0-1"===t.result?c.a.createElement("b",null,n):n))}))))}}]),a}(c.a.Component),qe=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return this.props.playerMoves?c.a.createElement("div",null,this.props.gameResults&&this.props.gameResults.length>0?this.resultsTable():null,this.movesTable()):c.a.createElement("div",{className:"infoMessage"},"No moves to show. Please select a source from the",c.a.createElement("span",{className:"navLinkButton",onClick:function(){return e.props.switchToUserTab()}}," ",c.a.createElement(R.a,{icon:A.C})," User")," tab and enter the details.")}},{key:"movesTable",value:function(){return c.a.createElement(Ve,{movesToShow:this.props.playerMoves,namespace:"moves",launchGame:this.props.launchGame,settings:this.props.settings,turnColor:this.props.turnColor,onMove:this.props.onMove,clickedEventName:"MoveClicked",tableFooter:this.tableFooter(),highlightMove:this.props.highlightMove,compareToClicked:this.props.switchToBookTab,compareToAlt:"Indicator for book moves - Click me",settingsChange:this.props.settingsChange,variant:this.props.variant,highlightArrow:this.props.highlightArrow})}},{key:"resultsTable",value:function(){return c.a.createElement(He,{gameResults:this.props.gameResults,launchGame:this.props.launchGame})}},{key:"tableFooter",value:function(){var e=this.props.playerMoves&&this.props.playerMoves.length>0;return this.props.settings.playerName?e?c.a.createElement("span",null,"Showing moves that have been  played ",this.props.turnColor===this.props.settings.playerColor?"by":"by others against"," ",c.a.createElement("b",null,this.props.settings.playerName)," in this position. ",c.a.createElement("b",null,this.props.settings.playerName)," is playing as ",c.a.createElement("b",null,this.props.settings.playerColor),"."):c.a.createElement("span",null,"No moves found played by ",this.props.turnColor===this.props.settings.playerColor?"by":"by others against"," ",c.a.createElement("b",null,this.props.settings.playerName)," in this position. ",c.a.createElement("b",null,this.props.settings.playerName)," is playing as ",c.a.createElement("b",null,this.props.settings.playerColor),"."):e?c.a.createElement("span",null,"Showing all moves that have been played by ",c.a.createElement("b",null,this.props.turnColor)," in this position."):c.a.createElement("span",null,"No moves found played by ",c.a.createElement("b",null,this.props.turnColor)," in this position.")}}]),a}(c.a.Component),_e=a(280),Qe=a.n(_e),Ye=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return this.props.bookMoves?c.a.createElement("div",null,this.props.gameResults&&this.props.gameResults.length>0?this.resultsTable():null,this.movesTable()):c.a.createElement("div",{className:"infoMessage"},"No book moves found in this position")}},{key:"enableBook",value:function(){var e=Object.assign({},this.props.settings.movesSettings);e.openingBookType=m.S,this.props.settingsChange(m.gb,e)}},{key:"movesTable",value:function(){return"pending"===this.props.bookMoves.fetch?c.a.createElement("div",{className:"center"},c.a.createElement("br",null),c.a.createElement(Z.a,null)):"off"===this.props.bookMoves.fetch?Fe("Opening book is disabled","Click the button below to enable it",this.enableBook.bind(this),"Enable opening book",c.a.createElement(Qe.a,null)):"failed"===this.props.bookMoves.fetch?Fe("Failed to fetch book moves","Please check your internet connection. Lichess could also be down.",this.props.forceFetchBookMoves,"Try again",c.a.createElement(Qe.a,null)):c.a.createElement(Ve,{movesToShow:this.props.bookMoves.moves,namespace:"book",launchGame:this.props.launchGame,settings:this.props.settings,turnColor:this.props.turnColor,onMove:this.props.onMove,clickedEventName:"BookMoveClicked",tab:"book",showAsPercentage:!0,highlightMove:this.props.highlightMove,compareToClicked:this.props.switchToMovesTab,compareToAlt:"Indicator for player moves - Click me",settingsChange:this.props.settingsChange,variant:this.props.variant,highlightArrow:this.props.highlightArrow})}},{key:"resultsTable",value:function(){return c.a.createElement(He,{gameResults:this.props.gameResults,launchGame:this.props.launchGame})}}]),a}(c.a.Component),Je=a(76),Ke=a.n(Je),Xe=a(110),Ze=a(856),$e=a(461),et=a(945),tt=a(872),at=a(285),nt=a(940),st=a(871),it=a(936),rt=a(937),ot=a(938),lt=a(939),ct="uninitialized",ht="initializing",ut="ready",pt="analyzing",mt="stopping",dt="error",gt=function(){function e(){Object(s.a)(this,e),this.worker=null,this.state=ct,this.currentFen=null,this.analysisCallback=null,this.depth=20,this.multiPV=3,this.pendingAnalysis=null,this.analysisId=0,this.currentAnalysisId=0,this.debounceTimer=null,this.debounceDelay=100,this.lastActivityTime=Date.now(),this.healthCheckInterval=null,this.commandQueue=[],this.isProcessingQueue=!1,this.initPromise=null,this.initResolve=null,this.initReject=null,this.readyPromise=null,this.readyResolve=null,this.stopPromise=null,this.stopResolve=null,this.recoveryAttempts=0,this.maxRecoveryAttempts=3,this.lastFenForGame=null,this.messageBuffer=""}return Object(i.a)(e,[{key:"init",value:function(){var e=this;return this.initPromise&&this.state===ht?this.initPromise:this.state===ut&&this.worker?Promise.resolve():(this.initPromise=new Promise((function(t,a){e.initResolve=t,e.initReject=a,e.cleanup(),e.state=ht;try{e.worker=new Worker("./stockfish-17.js"),e.worker.onmessage=function(t){var a="string"===typeof t?t:t.data;e.lastActivityTime=Date.now(),e.handleMessage(a)},e.worker.onerror=function(t){console.error("Stockfish worker error:",t),e.state=dt,e.initReject&&(e.initReject(t),e.initReject=null,e.initResolve=null),e.scheduleRecovery()},e.sendCommand("uci"),setTimeout((function(){if(e.state===ht){var t=new Error("Stockfish initialization timeout");e.initReject&&(e.initReject(t),e.initReject=null,e.initResolve=null),e.state=dt}}),15e3)}catch(n){console.error("Failed to initialize Stockfish:",n),e.state=dt,a(n)}})),this.initPromise)}},{key:"cleanup",value:function(){if(this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null),this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.worker){try{this.worker.terminate()}catch(e){}this.worker=null}this.state=ct,this.pendingAnalysis=null,this.commandQueue=[],this.isProcessingQueue=!1,this.readyPromise=null,this.readyResolve=null,this.stopPromise=null,this.stopResolve=null,this.messageBuffer=""}},{key:"startHealthCheck",value:function(){var e=this;this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.healthCheckInterval=setInterval((function(){e.state===pt&&Date.now()-e.lastActivityTime>15e3&&(console.warn("Stockfish appears stalled, attempting recovery..."),e.recoverEngine()),e.state===mt&&Date.now()-e.lastActivityTime>5e3&&(console.warn("Stockfish stop timeout, forcing recovery..."),e.forceStopComplete())}),5e3)}},{key:"forceStopComplete",value:function(){this.stopResolve&&(this.stopResolve(),this.stopResolve=null,this.stopPromise=null),this.state=ut,this.processPendingAnalysis()}},{key:"scheduleRecovery",value:function(){var e=this;if(this.recoveryAttempts>=this.maxRecoveryAttempts)return console.error("Max recovery attempts reached, giving up"),void(this.state=dt);var t=Math.min(1e3*Math.pow(2,this.recoveryAttempts),1e4);this.recoveryAttempts++,setTimeout((function(){e.recoverEngine()}),t)}},{key:"recoverEngine",value:function(){var e=Object(Xe.a)(Ke.a.mark((function e(){var t,a,n;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Recovering Stockfish engine..."),t=this.state===pt,a=this.currentFen,n=this.analysisCallback,this.cleanup(),e.prev=5,e.next=8,this.init();case 8:console.log("Stockfish engine recovered"),this.recoveryAttempts=0,t&&a&&n&&this.analyzeInfinite(a,n),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),console.error("Failed to recover Stockfish engine:",e.t0),this.scheduleRecovery();case 17:case"end":return e.stop()}}),e,this,[[5,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"sendCommand",value:function(e){if(this.worker)try{this.worker.postMessage(e)}catch(t){console.error("Error sending command to Stockfish:",t),this.scheduleRecovery()}}},{key:"handleMessage",value:function(e){var t=this;e&&(e.indexOf("\n")>-1?e.split("\n").forEach((function(e){e.trim()&&t.handleSingleMessage(e.trim())})):this.handleSingleMessage(e.trim()))}},{key:"handleSingleMessage",value:function(e){if(e&&("uciok"===e&&(this.sendCommand("setoption name MultiPV value "+this.multiPV),this.sendCommand("isready")),"readyok"===e&&(this.state===ht&&(this.state=ut,this.startHealthCheck(),this.initResolve&&(this.initResolve(),this.initResolve=null,this.initReject=null)),this.readyResolve&&(this.readyResolve(),this.readyResolve=null,this.readyPromise=null),this.processPendingAnalysis()),e.startsWith("info")&&e.includes(" pv ")&&e.includes(" score ")&&this.parseInfo(e),e.startsWith("bestmove"))){this.state;var t=this.state===mt;this.state=ut,t&&this.stopResolve&&(this.stopResolve(),this.stopResolve=null,this.stopPromise=null),this.processPendingAnalysis()}}},{key:"processPendingAnalysis",value:function(){if(this.state===ut&&this.pendingAnalysis){var e=this.pendingAnalysis,t=e.fen,a=e.callback,n=e.infinite,s=e.id;this.pendingAnalysis=null,s===this.analysisId&&(this.currentAnalysisId=s,n?this._doAnalyzeInfinite(t,a):this._doAnalyze(t,a))}}},{key:"waitForReady",value:function(){var e=this;return this.state===ut?Promise.resolve():(this.readyPromise||(this.readyPromise=new Promise((function(t){e.readyResolve=t,e.sendCommand("isready"),setTimeout((function(){e.readyResolve&&(console.warn("Ready timeout, resolving anyway"),e.readyResolve(),e.readyResolve=null,e.readyPromise=null)}),3e3)}))),this.readyPromise)}},{key:"stopAndWait",value:function(){var e=Object(Xe.a)(Ke.a.mark((function e(){var t=this;return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state===pt){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return this.stopPromise||(this.stopPromise=new Promise((function(e){t.stopResolve=e,t.state=mt,t.sendCommand("stop"),setTimeout((function(){t.stopResolve&&(console.warn("Stop timeout, forcing completion"),t.forceStopComplete())}),3e3)}))),e.abrupt("return",this.stopPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"parseInfo",value:function(e){for(var t={depth:0,seldepth:0,multipv:1,score:null,scoreType:"cp",pv:[],nodes:0,nps:0,time:0},a=e.split(" "),n=0;n<a.length;n++)switch(a[n]){case"depth":t.depth=parseInt(a[n+1])||0;break;case"seldepth":t.seldepth=parseInt(a[n+1])||0;break;case"multipv":t.multipv=parseInt(a[n+1])||1;break;case"score":t.scoreType=a[n+1],t.score=parseInt(a[n+2])||0;break;case"nodes":t.nodes=parseInt(a[n+1])||0;break;case"nps":t.nps=parseInt(a[n+1])||0;break;case"time":t.time=parseInt(a[n+1])||0;break;case"pv":t.pv=a.slice(n+1).filter((function(e){return e&&e.length>=4&&/^[a-h][1-8][a-h][1-8]/.test(e)})),n=a.length}this.analysisCallback&&t.pv.length>0&&t.depth>0&&this.currentAnalysisId===this.analysisId&&this.analysisCallback(t)}},{key:"_doAnalyze",value:function(e,t){this.currentFen=e,this.analysisCallback=t,this.state=pt,this.lastActivityTime=Date.now(),this.sendCommand("position fen "+e),this.sendCommand("go depth "+this.depth)}},{key:"_doAnalyzeInfinite",value:function(e,t){this.currentFen=e,this.analysisCallback=t,this.state=pt,this.lastActivityTime=Date.now(),this.sendCommand("position fen "+e),this.sendCommand("go infinite")}},{key:"analyze",value:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.worker&&this.state!==ct&&this.state!==dt){n&&(this.depth=n),this.analysisId++;var s=this.analysisId;this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((function(){a._startAnalysis(e,t,!1,s)}),this.debounceDelay)}else console.error("Stockfish not ready")}},{key:"analyzeInfinite",value:function(e,t){var a=this;if(this.worker&&this.state!==ct&&this.state!==dt){this.analysisId++;var n=this.analysisId;this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((function(){a._startAnalysis(e,t,!0,n)}),this.debounceDelay)}else console.error("Stockfish not ready")}},{key:"_startAnalysis",value:function(){var e=Object(Xe.a)(Ke.a.mark((function e(t,a,n,s){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s===this.analysisId){e.next=2;break}return e.abrupt("return");case 2:if(this.pendingAnalysis={fen:t,callback:a,infinite:n,id:s},this.state!==pt&&this.state!==mt){e.next=6;break}return e.next=6,this.stopAndWait();case 6:if(this.state!==ut){e.next=10;break}this.processPendingAnalysis(),e.next=14;break;case 10:if(this.state!==ht){e.next=14;break}return e.next=13,this.initPromise;case 13:this.processPendingAnalysis();case 14:case"end":return e.stop()}}),e,this)})));return function(t,a,n,s){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.analysisId++,this.pendingAnalysis=null,this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.state===pt&&(this.state=mt,this.sendCommand("stop"))}},{key:"newGame",value:function(){this.state===ut&&(this.sendCommand("ucinewgame"),this.sendCommand("isready"),this.lastFenForGame=null)}},{key:"setMultiPV",value:function(e){this.multiPV=e,this.state!==ut&&this.state!==pt||this.sendCommand("setoption name MultiPV value "+e)}},{key:"setDepth",value:function(e){this.depth=e}},{key:"isReady",value:function(){return this.state===ut||this.state===pt}},{key:"isAnalyzing",value:function(){return this.state===pt}},{key:"terminate",value:function(){this.cleanup()}},{key:"getState",value:function(){return this.state}}],[{key:"uciToMove",value:function(e,t){if(!e||e.length<4)return null;var a=e.substring(0,2),n=e.substring(2,4),s=e.length>4?e[4]:void 0;try{var i=t.moves({verbose:!0}).find((function(e){return e.from===a&&e.to===n&&(!s||e.promotion===s)}));if(i)return{from:a,to:n,san:i.san,promotion:s}}catch(r){console.error("Error converting UCI move:",r)}return{from:a,to:n,san:e,promotion:s}}},{key:"formatScore",value:function(e,t,a){var n="b"===a?-e:e;if("mate"===t){var s="b"===a?-e:e;return"M".concat(s)}var i=n/100;return i>=0?"+".concat(i.toFixed(2)):i.toFixed(2)}},{key:"getEvalBarPercent",value:function(e,t,a){if("mate"===t)return("b"===a?-e:e)>0?100:0;var n="b"===a?-e:e,s=Math.max(-1e3,Math.min(1e3,n)),i=50+50*(2/(1+Math.exp(-s/200))-1);return Math.max(0,Math.min(100,i))}},{key:"getVersion",value:function(){return"Stockfish 17.1 (NNUE Lite)"}}]),e}(),vt=null;var ft=gt,bt=a(69),yt=(a(843),function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={isEngineReady:!1,isAnalyzing:!1,evaluation:null,topMoves:[],depth:0,showSettings:!1,analysisDepth:20,multiPV:3,error:null,engineState:"uninitialized",showError:!1,errorMessage:""},n.engine=null,n.analysisResults=new Map,n.lastFen=null,n.mounted=!1,n.startAnalysis=n.startAnalysis.bind(Object(le.a)(n)),n.stopAnalysis=n.stopAnalysis.bind(Object(le.a)(n)),n.toggleAnalysis=n.toggleAnalysis.bind(Object(le.a)(n)),n.handleAnalysisUpdate=n.handleAnalysisUpdate.bind(Object(le.a)(n)),n.handleDepthChange=n.handleDepthChange.bind(Object(le.a)(n)),n.handleMultiPVChange=n.handleMultiPVChange.bind(Object(le.a)(n)),n.toggleSettings=n.toggleSettings.bind(Object(le.a)(n)),n.handleMoveClick=n.handleMoveClick.bind(Object(le.a)(n)),n.handleMoveHover=n.handleMoveHover.bind(Object(le.a)(n)),n.handleMoveLeave=n.handleMoveLeave.bind(Object(le.a)(n)),n.handleCloseError=n.handleCloseError.bind(Object(le.a)(n)),n.retryInit=n.retryInit.bind(Object(le.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.mounted=!0,this.initEngine()}},{key:"componentDidUpdate",value:function(e){e.fen!==this.props.fen&&this.state.isAnalyzing&&(this.analysisResults.clear(),this.setState({topMoves:[],depth:0}),this.startAnalysis())}},{key:"componentWillUnmount",value:function(){this.mounted=!1,this.engine&&this.engine.stop()}},{key:"safeSetState",value:function(e,t){this.mounted&&this.setState(e,t)}},{key:"initEngine",value:function(){var e=Object(Xe.a)(Ke.a.mark((function e(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.engine=(vt||(vt=new gt),vt),e.next=4,this.engine.init();case 4:this.mounted&&this.setState({isEngineReady:!0,engineState:this.engine.getState()}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to initialize Stockfish:",e.t0),this.mounted&&this.setState({error:"Failed to load Stockfish engine. Click refresh to retry.",showError:!0,errorMessage:"Engine initialization failed"});case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"retryInit",value:function(){var e=Object(Xe.a)(Ke.a.mark((function e(){return Ke.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({error:null,isEngineReady:!1,showError:!1}),e.next=3,this.initEngine();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startAnalysis",value:function(){if(this.engine&&this.state.isEngineReady){if("error"===this.engine.getState())return this.setState({showError:!0,errorMessage:"Engine error. Attempting recovery..."}),void this.retryInit();this.lastFen=this.props.fen,this.analysisResults.clear(),this.safeSetState({isAnalyzing:!0,topMoves:[],evaluation:null,depth:0,engineState:"analyzing"}),this.engine.setMultiPV(this.state.multiPV),this.engine.analyzeInfinite(this.props.fen,this.handleAnalysisUpdate)}else this.setState({showError:!0,errorMessage:"Engine not ready. Please wait or refresh."})}},{key:"stopAnalysis",value:function(){this.engine&&this.engine.stop(),this.safeSetState({isAnalyzing:!1,engineState:this.engine?this.engine.getState():"ready"})}},{key:"toggleAnalysis",value:function(){this.state.isAnalyzing?this.stopAnalysis():this.startAnalysis()}},{key:"handleAnalysisUpdate",value:function(e){if(this.mounted&&this.props.fen===this.lastFen){var t;this.analysisResults.set(e.multipv,e);try{t=Object(bt.a)(this.props.variant,this.props.fen)}catch(c){return void console.error("Error creating chess instance:",c)}for(var a=t.turn(),n=[],s=1;s<=this.state.multiPV;s++){var i=this.analysisResults.get(s);if(i&&i.pv.length>0){var r=ft.uciToMove(i.pv[0],t);n.push({rank:s,move:r,score:i.score,scoreType:i.scoreType,depth:i.depth,pv:i.pv,formattedScore:ft.formatScore(i.score,i.scoreType,a)})}}var o=this.analysisResults.get(1),l=null;o&&(l={score:o.score,scoreType:o.scoreType,formatted:ft.formatScore(o.score,o.scoreType,a),barPercent:ft.getEvalBarPercent(o.score,o.scoreType,a)}),this.safeSetState({topMoves:n,evaluation:l,depth:o?o.depth:0,engineState:this.engine?this.engine.getState():"unknown"}),this.props.onAnalysisUpdate&&this.props.onAnalysisUpdate(n)}}},{key:"handleDepthChange",value:function(e,t){this.setState({analysisDepth:t}),this.engine&&this.engine.setDepth(t)}},{key:"handleMultiPVChange",value:function(e,t){var a=this;this.setState({multiPV:t},(function(){a.state.isAnalyzing&&(a.analysisResults.clear(),a.startAnalysis())}))}},{key:"toggleSettings",value:function(){this.setState({showSettings:!this.state.showSettings})}},{key:"handleMoveClick",value:function(e){this.props.onMove&&e.move&&this.props.onMove(e.move.from,e.move.to)}},{key:"handleMoveHover",value:function(e){this.props.highlightArrow&&e.move&&this.props.highlightArrow({orig:e.move.from,dest:e.move.to,san:e.move.san})}},{key:"handleMoveLeave",value:function(){this.props.highlightArrow&&this.props.highlightArrow(null)}},{key:"handleCloseError",value:function(){this.setState({showError:!1})}},{key:"renderEvalBar",value:function(){var e=this.state.evaluation,t=e?e.barPercent:50;return c.a.createElement("div",{className:"eval-bar-container"},c.a.createElement("div",{className:"eval-bar"},c.a.createElement("div",{className:"eval-bar-white",style:{height:"".concat(t,"%")}}),c.a.createElement("div",{className:"eval-bar-black",style:{height:"".concat(100-t,"%")}})),c.a.createElement("div",{className:"eval-score"},e?e.formatted:"0.00"))}},{key:"renderTopMoves",value:function(){var e=this,t=this.state,a=t.topMoves,n=t.isAnalyzing,s=t.depth;return 0===a.length?c.a.createElement("div",{className:"no-analysis"},n?0===s?"Starting analysis...":"Analyzing...":"Click play to start analysis"):c.a.createElement("div",{className:"top-moves-list"},a.map((function(t,a){return c.a.createElement("div",{key:"".concat(t.rank,"-").concat(t.pv[0]),className:"top-move-item ".concat(0===a?"best-move":""),onClick:function(){return e.handleMoveClick(t)},onMouseEnter:function(){return e.handleMoveHover(t)},onMouseLeave:function(){return e.handleMoveLeave()}},c.a.createElement("span",{className:"move-rank"},t.rank),c.a.createElement("span",{className:"move-san"},t.move?t.move.san:t.pv[0]),c.a.createElement("span",{className:"move-score ".concat(e.getScoreClass(t))},t.formattedScore),c.a.createElement("span",{className:"move-depth"},"d",t.depth))})))}},{key:"getScoreClass",value:function(e){if("mate"===e.scoreType)return e.score>0?"score-winning":"score-losing";var t=e.score;return t>100?"score-winning":t<-100?"score-losing":"score-equal"}},{key:"renderSettings",value:function(){return this.state.showSettings?c.a.createElement(Ze.a,{className:"analysis-settings",elevation:2},c.a.createElement($e.a,{variant:"subtitle2",gutterBottom:!0},"Analysis Settings"),c.a.createElement("div",{className:"setting-item"},c.a.createElement($e.a,{variant:"body2"},"Lines: ",this.state.multiPV),c.a.createElement(et.a,{value:this.state.multiPV,onChange:this.handleMultiPVChange,min:1,max:5,step:1,marks:!0,valueLabelDisplay:"auto"}))):null}},{key:"render",value:function(){var e=this.state,t=e.isEngineReady,a=e.isAnalyzing,n=e.depth,s=e.error,i=e.showError,r=e.errorMessage;return s?c.a.createElement("div",{className:"stockfish-analysis error"},c.a.createElement($e.a,{color:"error"},s),c.a.createElement(tt.a,{title:"Retry initialization"},c.a.createElement(at.a,{onClick:this.retryInit,color:"primary",size:"small"},c.a.createElement(it.a,null)))):c.a.createElement("div",{className:"stockfish-analysis"},c.a.createElement("div",{className:"analysis-header"},c.a.createElement("div",{className:"analysis-title"},c.a.createElement($e.a,{variant:"h6"},"Stockfish 17"),a&&c.a.createElement($e.a,{variant:"caption",className:"depth-indicator"},"Depth: ",n)),c.a.createElement("div",{className:"analysis-controls"},c.a.createElement(tt.a,{title:a?"Stop":"Analyze"},c.a.createElement("span",null,c.a.createElement(at.a,{onClick:this.toggleAnalysis,disabled:!t,color:a?"secondary":"primary",size:"small"},a?c.a.createElement(rt.a,null):c.a.createElement(ot.a,null)))),c.a.createElement(tt.a,{title:"Settings"},c.a.createElement(at.a,{onClick:this.toggleSettings,size:"small"},c.a.createElement(lt.a,null))))),this.renderSettings(),c.a.createElement("div",{className:"analysis-content"},this.renderEvalBar(),c.a.createElement("div",{className:"analysis-moves"},this.renderTopMoves())),!t&&c.a.createElement("div",{className:"loading-engine"},c.a.createElement($e.a,{variant:"body2"},"Loading Stockfish..."),c.a.createElement(nt.a,null)),c.a.createElement(st.a,{open:i,autoHideDuration:4e3,onClose:this.handleCloseError,message:r}))}}]),a}(c.a.Component));a.d(t,"a",(function(){return Et}));var Et=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={activeTab:"user",activeGame:null},n.toggleModal=function(){n.setState({activeGame:null})},n}return Object(i.a)(a,[{key:"launchGame",value:function(e){var t=this;return e.url?function(t){t.stopPropagation(),window.open(e.url,"_blank"),Object(d.b)(m.p,"ViewGameExternal")}:function(a){a.stopPropagation(),t.setState({activeGame:e})}}},{key:"shouldComponentUpdate",value:function(e){return this.props.resize===e.resize}},{key:"toggle",value:function(e){this.state.activeTab!==e&&(this.setState({activeTab:e}),Object(d.b)(m.k,"activeTab:".concat(e)))}},{key:"switchToUserTab",value:function(){this.toggle("user")}},{key:"switchToMovesTab",value:function(e){var t=this;this.toggle("moves"),e&&(this.setState({highlightPlayerMove:e}),setTimeout((function(){t.setState({highlightPlayerMove:null})}),1e3))}},{key:"switchToBookTab",value:function(e){var t=this;this.toggle("book"),e&&(this.setState({highlightBookMove:e}),setTimeout((function(){t.setState({highlightBookMove:null})}),1e3))}},{key:"render",value:function(){var e=this;return c.a.createElement("div",null,c.a.createElement(de.a,{isOpen:this.state.activeGame,toggle:this.toggleModal},c.a.createElement(ge.a,{toggle:this.toggleModal},"Game details"),this.state.activeGame?c.a.createElement(Se.a,null,c.a.createElement(Pe.a,null,Object.entries(this.state.activeGame.headers).map((function(e){return e[1]?c.a.createElement(Te.a,{className:"performanceRatingRow"},c.a.createElement(je.a,{className:"performanceRatingRow"},e[0]),c.a.createElement(je.a,{className:"performanceRatingRow"},e[1])):null})))):null,c.a.createElement(ve.a,null,c.a.createElement(pe.a,{color:"secondary",onClick:this.toggleModal},"Done"))),c.a.createElement(fe.a,{tabs:!0},c.a.createElement(be.a,null,c.a.createElement(ye.a,{className:Ce()({active:"user"===this.state.activeTab}),onClick:function(){e.toggle("user")}},c.a.createElement(R.a,{icon:A.C})," ","user"===this.state.activeTab?"User":"")),c.a.createElement(be.a,null,c.a.createElement(ye.a,{className:Ce()({active:"moves"===this.state.activeTab}),onClick:function(){e.toggle("moves")}},c.a.createElement(R.a,{icon:A.r})," ","moves"===this.state.activeTab?"Moves":"")),c.a.createElement(be.a,null,c.a.createElement(ye.a,{className:Ce()({active:"book"===this.state.activeTab}),onClick:function(){e.toggle("book")}},c.a.createElement(R.a,{icon:A.a})," ","book"===this.state.activeTab?"Opening book":"")),c.a.createElement(be.a,null,c.a.createElement(ye.a,{className:Ce()({active:"analysis"===this.state.activeTab}),onClick:function(){e.toggle("analysis")}},c.a.createElement(R.a,{icon:A.s})," ","analysis"===this.state.activeTab?"Analysis":"")),c.a.createElement(be.a,null,c.a.createElement(ye.a,{className:Ce()({active:"report"===this.state.activeTab}),onClick:function(){e.toggle("report")}},c.a.createElement(R.a,{icon:A.d})," ","report"===this.state.activeTab?"Report":"")),c.a.createElement(be.a,null,c.a.createElement(ye.a,{className:Ce()({active:"settings"===this.state.activeTab}),onClick:function(){e.toggle("settings")}},c.a.createElement(R.a,{icon:A.h})," ","settings"===this.state.activeTab?"Controls":""))),c.a.createElement(Ee.a,{activeTab:this.state.activeTab},c.a.createElement(ke.a,{tabId:"user"},c.a.createElement(oe,{switchToMovesTab:this.switchToMovesTab.bind(this),clear:this.props.clear,gamesProcessed:this.props.gamesProcessed,settings:this.props.settings,onChange:this.props.settingsChange,notify:this.props.updateProcessedGames,showError:this.props.showError,showInfo:this.props.showInfo,setDownloading:this.props.setDownloading,isDownloading:this.props.isDownloading,openingGraph:this.props.openingGraph,importCallback:this.props.importCallback,variant:this.props.variant,variantChange:this.props.variantChange,oauthManager:this.props.oauthManager})),c.a.createElement(ke.a,{tabId:"moves"},c.a.createElement(qe,{switchToUserTab:this.switchToUserTab.bind(this),playerMoves:this.props.playerMoves,gameResults:this.props.gameResults,onMove:this.props.onMove,settings:this.props.settings,turnColor:this.props.turnColor,settingsChange:this.props.settingsChange,launchGame:this.launchGame.bind(this),switchToBookTab:this.switchToBookTab.bind(this),highlightMove:this.state.highlightPlayerMove,variant:this.props.variant,highlightArrow:this.props.highlightArrow})),c.a.createElement(ke.a,{tabId:"book"},c.a.createElement(Ye,{bookMoves:this.props.bookMoves,gameResults:this.props.bookResults,onMove:this.props.onMove,settings:this.props.settings,turnColor:this.props.turnColor,settingsChange:this.props.settingsChange,launchGame:this.launchGame.bind(this),switchToMovesTab:this.switchToMovesTab.bind(this),highlightMove:this.state.highlightBookMove,forceFetchBookMoves:this.props.forceFetchBookMoves,variant:this.props.variant,highlightArrow:this.props.highlightArrow})),c.a.createElement(ke.a,{tabId:"analysis"},c.a.createElement(yt,{fen:this.props.fen,variant:this.props.variant,onMove:this.props.onMove,highlightArrow:this.props.highlightArrow,onAnalysisUpdate:this.props.onAnalysisUpdate})),c.a.createElement(ke.a,{tabId:"report"},c.a.createElement(Ae,{fen:this.props.fen,simplifiedView:!1,moveDetails:this.props.openingGraph.getDetailsForFen(this.props.fen),launchGame:this.launchGame.bind(this),settings:this.props.settings,switchToUserTab:this.switchToUserTab.bind(this),isOpen:"report"===this.state.activeTab,showInfo:this.props.showInfo,reportFooter:this.reportFooter()})),c.a.createElement(ke.a,{tabId:"settings"},c.a.createElement(he.a,null,c.a.createElement(ue.a,{md:"9",xs:"12"},c.a.createElement(me,{fen:this.props.fen,settings:this.props.settings,isOpen:!0,clear:this.props.clear,reset:this.props.reset,onChange:this.props.settingsChange}))))))}},{key:"reportFooter",value:function(){return c.a.createElement("span",null,"Performance rating calculated based on ",c.a.createElement("a",{href:"https://handbook.fide.com/chapter/B022017",target:"_blank",rel:"noopener noreferrer"},"FIDE regulations"))}}]),a}(c.a.Component)},455:function(e,t,a){"use strict";var n=a(16),s=a(17),i=a(26),r=a(27),o=a(864),l=a(860),c=a(869),h=a(0),u=a.n(h),p=a(284),m=a(848),d=a(849),g=a(281),v=a(867),f=a(945),b=a(286),y=a(2),E=a(66),k=a(48),w=[{label:"Fast time controls",selectedTimeControls:[y.qb,y.vb,y.pb],unselectedTimeControls:[y.ub,y.rb,y.sb]},{label:"Slow time controls",selectedTimeControls:[y.ub,y.rb,y.sb],unselectedTimeControls:[y.qb,y.vb,y.pb]},{label:"Reasonable time controls",selectedTimeControls:[y.pb,y.ub,y.rb,y.sb],unselectedTimeControls:[y.qb,y.vb]},{label:"Exclude slow time controls",selectedTimeControls:[y.qb,y.vb,y.pb,y.ub],unselectedTimeControls:[y.rb,y.sb]}];function C(e,t){return t.every((function(t){return e.includes(t)}))}var O=function(e,t){var a=Object(k.c)(e,t,!0),n=Object(k.c)(e,t,!1);return 0===n.length||0===a.length?"All time controls":1===a.length?E.d[a[0]]:1===n.length?"All except ".concat(E.d[n[0]]):2===a.length?"".concat(E.d[a[0]]," and ").concat(E.d[a[1]]):function(e,t){var a=w.filter((function(a){return C(t,a.unselectedTimeControls)&&C(e,a.selectedTimeControls)}));if(a.length)return a[0].label;return e.map((function(e){return E.d[e]})).join(", ")}(a,n)};var N=a(14),S=a(868),M=a(274),T=a.n(M);a(519);a.d(t,"a",(function(){return j}));var j=function(e){Object(i.a)(a,e);var t=Object(r.a)(a);function a(e){var s;return Object(n.a)(this,a),(s=t.call(this,e)).state={currentlyOpenAdvancedFilter:""},s.downloadLimitMarks=[{value:0,label:"0"},{value:y.Q,label:"No limit"}],s.eloRangeMarks=[{value:0,label:"0"},{value:y.R,label:"No limit"}],s}return Object(s.a)(a,[{key:"setCurrentlyOpenAdvancedFilter",value:function(e){var t=this;return function(){t.state.currentlyOpenAdvancedFilter===e&&(e=""),t.setState({currentlyOpenAdvancedFilter:e}),Object(N.b)(y.r,"AdvancedFilterChange",e)}}},{key:"getFilters",value:function(e){return u.a.createElement("div",null,this.subSectionComponent("Mode","all"===(s=this.props.advancedFilters.rated)?"Rated and casual":"rated"===s?"Rated only":"casual"===s?"Casual only":void 0,this.props.toggleRated),this.subSectionComponent("Time control",O(this.props.site,this.props.advancedFilters),this.setCurrentlyOpenAdvancedFilter("timeControl").bind(this),u.a.createElement(p.a,{isOpen:"timeControl"===this.state.currentlyOpenAdvancedFilter},this.getTimeControlFilters(e,4))),this.subSectionComponent("From Date",(n=this.props.advancedFilters[y.v])?n.toLocaleDateString("en-US"):"Big Bang",this.setCurrentlyOpenAdvancedFilter("fromDate").bind(this),u.a.createElement(p.a,{isOpen:"fromDate"===this.state.currentlyOpenAdvancedFilter},this.getFromDateFilter()),!0),this.subSectionComponent("To Date",function(e){return e?e.toLocaleDateString("en-US"):"Now"}(this.props.advancedFilters[y.y]),this.setCurrentlyOpenAdvancedFilter("toDate").bind(this),u.a.createElement(p.a,{isOpen:"toDate"===this.state.currentlyOpenAdvancedFilter},this.getToDateFilter()),!0),this.subSectionComponent("Opponent rating range",0===(a=this.props.advancedFilters[y.u])[0]&&a[1]===y.R?"Any rating":0===a[0]?"Below ".concat(a[1]):a[1]===y.R?"Above ".concat(a[0]):"Between ".concat(a[0]," and ").concat(a[1]),this.setCurrentlyOpenAdvancedFilter("eloRange").bind(this),u.a.createElement(p.a,{isOpen:"eloRange"===this.state.currentlyOpenAdvancedFilter},this.getEloRangeFilters())),this.subSectionComponent("Opponent name",this.props.advancedFilters[y.w]||"All opponents",this.setCurrentlyOpenAdvancedFilter("opponent").bind(this),u.a.createElement(p.a,{isOpen:"opponent"===this.state.currentlyOpenAdvancedFilter},this.getOpponentNameFilter()),!0),this.subSectionComponent("Download limit",(t=this.props.advancedFilters[y.t])>=y.Q?"No limit":"".concat(t," games"),this.setCurrentlyOpenAdvancedFilter("downloadLimit").bind(this),u.a.createElement(p.a,{isOpen:"downloadLimit"===this.state.currentlyOpenAdvancedFilter},this.getDownloadLimitFilters())));var t,a,n,s}},{key:"getDownloadLimitFilters",value:function(){return u.a.createElement(f.a,{className:"sliderCustom",value:this.props.advancedFilters[y.t],onChange:this.props.handleDownloadLimitChange,valueLabelDisplay:"auto",valueLabelFormat:function(e){return e>=y.Q?"All":e},step:100,min:0,marks:this.downloadLimitMarks,max:y.Q})}},{key:"getFromDateFilter",value:function(){return u.a.createElement(T.a,{placeholderText:"mm/dd/yyyy",selected:this.props.advancedFilters[y.v],onChange:this.props.handleFromDate})}},{key:"getToDateFilter",value:function(){return u.a.createElement(T.a,{placeholderText:"mm/dd/yyyy",selected:this.props.advancedFilters[y.y],onChange:this.props.handleToDate})}},{key:"getEloRangeFilters",value:function(){return u.a.createElement(f.a,{className:"sliderCustom",value:this.props.advancedFilters[y.u],onChange:this.props.handleEloRangeChange,valueLabelDisplay:"off",marks:this.eloRangeMarks,min:0,max:y.R})}},{key:"getOpponentNameFilter",value:function(){return u.a.createElement(S.a,{className:"playernameField",name:"opponentName",id:"opponentNameTextBox",margin:"dense",onChange:this.props.handleOpponentNameChange,label:"Opponent Name",variant:"outlined",value:this.props.advancedFilters[y.w]})}},{key:"getTimeControlFilters",value:function(e){var t=null,a=null,n=null,s=null;return"lichess"===e?(t=[y.qb,y.vb],a=[y.pb,y.rb],n=[y.ub,y.sb],s="4"):(t=[y.qb,y.pb],n=[y.ub,y.tb],s="6"),u.a.createElement(o.a,null,u.a.createElement(l.a,null,u.a.createElement(m.a,null,this.getTimeControlFilterRow(t,s,"first"),a?this.getTimeControlFilterRow(a,s,"middle"):null,this.getTimeControlFilterRow(n,s,"last"))))}},{key:"getTimeControlFilterRow",value:function(e,t,a){var n=this,s="topBottomNegativeMargin";return"first"===a?s="bottomNegativeMargin":"last"===a&&(s="topNegativeMargin"),u.a.createElement(d.a,{className:s},e.map((function(e){return u.a.createElement(g.a,{sm:t,key:"ctrl".concat(e)},u.a.createElement(b.a,{className:"nomargin",control:u.a.createElement(c.a,{checked:n.props.advancedFilters[e],color:"primary",onChange:n.props.handleTimeControlChange,name:e}),label:E.d[e]}))})))}},{key:"subSectionComponent",value:function(e,t,a,n,s){return u.a.createElement("div",{className:"pgnloadersection"},e,": ",u.a.createElement("span",{className:"smallText"},"[",u.a.createElement("span",{className:"linkStyle",onClick:a},"change"),"]")," ",s?u.a.createElement(v.a,{className:"sourceName",color:"info"},"New!"):null,u.a.createElement("div",null,u.a.createElement("b",null,t)),n)}},{key:"render",value:function(){return this.getFilters(this.props.site)}}]),a}(u.a.Component)},456:function(e,t,a){"use strict";var n=a(16),s=a(17),i=a(44),r=a(26),o=a(27),l=a(0),c=a.n(l),h=a(427),u=a.n(h),p=a(75),m=a(69),d=function(){function e(t){Object(n.a)(this,e),this.plys=[],this.currentIndex=0,this.plys=[{pgn:"",fen:m.b(t),move:null}],this.currentIndex=0}return Object(s.a)(e,[{key:"addPly",value:function(e,t){if(!(this.currentIndex<this.plys.length-1&&this.plys[this.currentIndex+1].move.san===t.san))return this.plys=this.plys.slice(0,this.currentIndex+1),this.plys.push({pgnAsList:this.pgnAsList(t.san),fen:e,move:t}),this.currentIndex++,this.plys[this.currentIndex];this.moveForward()}},{key:"pgnAsList",value:function(e){var t,a=this.pgnListSoFar();if(t=a?Object(p.a)(a):[],this.plys.length%2!==0)t.push({moveNumber:t.length+1,whitePly:e,blackPly:""});else{var n=t[t.length-1];n.blackPly=e,t[t.length-1]=n}return t}},{key:"currentMove",value:function(){return Math.floor((this.currentIndex-1)/2)}},{key:"pgnListSoFar",value:function(){return this.plys[this.plys.length-1].pgnAsList}},{key:"fen",value:function(){return this.plys[this.currentIndex].fen}},{key:"moveForward",value:function(){return this.moveTo(this.currentIndex+1)}},{key:"moveBack",value:function(){return this.moveTo(this.currentIndex-1)}},{key:"moveTo",value:function(e){return e>=0&&e<this.plys.length&&(this.currentIndex=e),this.plys[this.currentIndex]}}]),e}(),g=a(848),v=a(849),f=a(281),b=a(160),y=a(20),E=a(15),k=a(2),w=a(14);a.d(t,"a",(function(){return C}));var C=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var s;return Object(n.a)(this,a),(s=t.call(this,e)).openingManager=new d(s.props.variant),s.state={currentMove:0},window.addEventListener("keydown",s.keyHandler.bind(Object(i.a)(s))),s}return Object(s.a)(a,[{key:"keyHandler",value:function(e){switch(e.keyCode){case 37:this.previous(e,"keyboard");break;case 39:this.next(e,"keyboard")}}},{key:"shouldComponentUpdate",value:function(e){return e.variant!==this.props.variant?(this.openingManager=new d(e.variant),!0):e.fen===this.openingManager.fen()||(null===e.move?(this.openingManager=new d(e.variant),!0):(this.openingManager.addPly(e.fen,e.move),!0))}},{key:"previous",value:function(e,t){var a=this.openingManager.moveBack();this.props.onChange(a.fen,a.move),this.setState({currentMove:this.openingManager.currentMove()}),Object(w.b)(k.q,"Previous",t||"mouse")}},{key:"next",value:function(e,t){var a=this.openingManager.moveForward();this.props.onChange(a.fen,a.move),this.setState({currentMove:this.openingManager.currentMove()}),Object(w.b)(k.q,"Next",t||"mouse")}},{key:"moveTo",value:function(e){var t=this;return function(){var a=t.openingManager.moveTo(e+1);t.props.onChange(a.fen,a.move),t.setState({currentMove:t.openingManager.currentMove()}),Object(w.b)(k.q,"move",null,e)}}},{key:"render",value:function(){var e=this,t=u()(this.openingManager.fen());return t&&(this.opening=t.name,this.openingCode=t.code),this.openingManager.pgnListSoFar()?c.a.createElement(g.a,{id:"navigator"},c.a.createElement(v.a,null,c.a.createElement(f.a,{lg:"6",className:"navSection"},c.a.createElement(b.a,{color:"",onClick:this.previous.bind(this)},c.a.createElement(y.a,{icon:E.y}),"\xa0",c.a.createElement("span",null,"prev"))),c.a.createElement(f.a,{lg:"6",className:"navSection"},c.a.createElement(b.a,{color:"",onClick:this.next.bind(this)},c.a.createElement("span",null,"next"),"\xa0",c.a.createElement(y.a,{icon:E.z})))),c.a.createElement(v.a,{className:"greyText"},this.openingCode,": ",this.opening),this.openingManager.pgnListSoFar().map((function(t,a){return c.a.createElement(v.a,{key:"".concat(t.moveNumber),className:"navCol"},c.a.createElement(f.a,{sm:"2",className:"navItem navMoveNumber"},"".concat(t.moveNumber,".")),c.a.createElement(f.a,{sm:"5",className:"navItem navMove border ".concat(e.openingManager.currentIndex-1===2*a?"selectedMove":""),onClick:e.moveTo(2*a).bind(e)},"".concat(t.whitePly)),c.a.createElement(f.a,{sm:"5",className:"navItem navMove border ".concat(e.openingManager.currentIndex-1===2*a+1?"selectedMove":""),onClick:e.moveTo(2*a+1).bind(e)},"".concat(t.blackPly)))}))):c.a.createElement("div",null)}}]),a}(c.a.Component)},475:function(e,t,a){e.exports=a(476)},476:function(e,t,a){"use strict";a.r(t);var n=a(28),s=a.n(n),i=a(423),r=a(0),o=a.n(r),l=a(14);s.a.render(o.a.createElement(i.a,null),document.getElementById("root")),Object(l.c)()},48:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"e",(function(){return r})),a.d(t,"c",(function(){return o})),a.d(t,"f",(function(){return l})),a.d(t,"b",(function(){return c})),a.d(t,"d",(function(){return h}));var n=a(2),s=a(66);function i(e,t){var a={};return t.forEach((function(t){a[t]=e[t]})),a}function r(e){var t=e.split(" ");return t.length<=4?e:"".concat(t[0]," ").concat(t[1]," ").concat(t[2])}function o(e,t,a){return(e===n.kb?s.c:s.a).filter((function(e){return!!t[e]===a}))}function l(e){return e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e4?"".concat(Math.round(e/1e3),"k"):e}function c(e,t,a,i,r,o){var c=a+i+r,h=e?Math.round(e/c):null,u=o===n.bb?r:a,p=o!==n.bb?r:a,m=100*(u+i/2)/c,d=s.b[Math.round(m)],g=null;return h&&(g=h+d),{results:"+".concat(l(u),"-").concat(l(p),"=").concat(l(i)),performanceRating:g,averageOpponentElo:h,averageElo:t,score:"".concat(Number.isInteger(m)?m:m.toFixed(1),"% for ").concat(o===n.bb?"black":"white"),ratingChange:"".concat(0===d?"":d>0?"+":"-").concat(Math.abs(d))}}function h(e,t){return!!t&&(!e||new Date(e)>new Date(t))}},60:function(e,t,a){"use strict";var n=a(16),s=a(17),i=a(61),r=a.n(i),o=function(){function e(){Object(n.a)(this,e),this.currentVisit=null}return Object(s.a)(e,[{key:"getLichessAccessToken",value:function(){return r.a.get("at")}},{key:"setLichessAccessToken",value:function(e){r.a.set("at",e,{expires:365})}},{key:"deleteLichessAccessToken",value:function(){r.a.remove("at",{path:"/",domain:"www.openingtree.com"}),r.a.remove("at")}},{key:"setSettingsCookie",value:function(e){r.a.set("set",JSON.stringify(e))}},{key:"setDarkModeCookie",value:function(e){r.a.set("dm",e)}},{key:"getDarkModeCookie",value:function(){return r.a.get("dm")}},{key:"getSettingsCookie",value:function(){var e=null;try{e=r.a.get("set")}catch(t){return console.log(t),null}return e?JSON.parse(e):null}},{key:"getVisitInfo",value:function(){if(this.currentVisit)return this.currentVisit;var e=r.a.get("lst"),t=r.a.get("vcnt"),a=r.a.get("fst"),n=e?parseInt(e):null,s=t?parseInt(t):0,i=a?parseInt(a):null,o=(new Date).getTime();return this.currentVisit={firstVisit:i,lastVisit:n,currentVisit:o,numVisits:s},(null===n||o-n>864e5)&&(r.a.set("lst",o),r.a.set("vcnt",s+1)),null===i&&r.a.set("fst",o),this.currentVisit}}]),e}();t.a=new o},612:function(e,t){},618:function(e,t,a){e.exports=a.p+"static/js/0.a1253645.chunk.worker.js"},621:function(e,t){},623:function(e,t){},650:function(e,t){},652:function(e,t){},66:function(e,t,a){"use strict";a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return o})),a.d(t,"d",(function(){return l})),a.d(t,"e",(function(){return c})),a.d(t,"b",(function(){return h}));var n,s=a(39),i=a(2),r=[i.vb,i.qb,i.pb,i.ub,i.rb,i.sb],o=[i.qb,i.pb,i.ub,i.tb],l=(n={},Object(s.a)(n,i.vb,"Ultrabullet"),Object(s.a)(n,i.qb,"Bullet"),Object(s.a)(n,i.pb,"Blitz"),Object(s.a)(n,i.ub,"Rapid"),Object(s.a)(n,i.rb,"Classical"),Object(s.a)(n,i.sb,"Correspondence"),Object(s.a)(n,i.tb,"Daily"),n);function c(e){return e===i.xb?i.K:e===i.yb?i.L:e===i.Ab?i.N:e===i.wb?i.J:e===i.zb?i.M:void 0}var h={100:800,99:677,98:589,97:538,96:501,95:470,94:444,93:422,92:401,91:383,90:366,89:351,88:336,87:322,86:309,85:296,84:284,83:273,82:262,81:251,80:240,79:230,78:220,77:211,76:202,75:193,74:184,73:175,72:166,71:158,70:149,69:141,68:133,67:125,66:117,65:110,64:102,63:95,62:87,61:80,60:72,59:65,58:57,57:50,56:43,55:36,54:29,53:21,52:14,51:7,50:0,49:-7,48:-14,47:-21,46:-29,45:-36,44:-43,43:-50,42:-57,41:-65,40:-72,39:-80,38:-87,37:-95,36:-102,35:-110,34:-117,33:-125,32:-133,31:-141,30:-149,29:-158,28:-166,27:-175,26:-184,25:-193,24:-202,23:-211,22:-220,21:-230,20:-240,19:-251,18:-262,17:-273,16:-284,15:-296,14:-309,13:-322,12:-336,11:-351,10:-366,9:-383,8:-401,7:-422,6:-444,5:-470,4:-501,3:-538,2:-589,1:-677,0:-800}},680:function(e,t){},681:function(e,t){},686:function(e,t){},688:function(e,t){},69:function(e,t,a){"use strict";var n=a(2),s=a(101),i=a.n(s),r=a(16),o=a(17),l=function(){function e(t){Object(r.a)(this,e),this.chess=new i.a(t),this.SQUARES=this.chess.SQUARES}return Object(o.a)(e,[{key:"fen",value:function(){return this.chess.fen()}},{key:"turn",value:function(){return this.chess.turn()}},{key:"load",value:function(e){this.chess.load(e)}},{key:"moves",value:function(e){return this.chess.moves(e).filter((function(e){var t=e.san||e;return!t.endsWith("+")&&!t.endsWith("#")}))}},{key:"move",value:function(e,t){if("string"!==typeof e)return this.chess.move(e,t);e.endsWith("#")&&(e=e.substring(0,e.length-1));var a=this.chess.move(e,t);if(a)return a;var n=function(e,t){var a=t.filter((function(t){return e.charAt(0)===t.charAt(0)&&e.slice(-2)===t.slice(-2)}));if(1!==a.length)return null;return a[0]}(e,this.moves());return n?this.chess.move(n,t):a}}]),e}();var c=function(){function e(t){Object(r.a)(this,e),this.chess=new i.a(t),this.SQUARES=this.chess.SQUARES}return Object(o.a)(e,[{key:"fen",value:function(){return this.chess.fen()}},{key:"turn",value:function(){return this.chess.turn()}},{key:"moves",value:function(e){return this.chess.moves(e)}},{key:"load",value:function(e){this.chess.load(e)}},{key:"move",value:function(e,t){var a=this.chess.move(e,t);return a||("string"===typeof e?this.moveSan(e):this.moveSan(e.san))}},{key:"moveSan",value:function(e){if(e.includes("@")){var t=e.indexOf("@"),a="";a=0===t?this.chess.PAWN:e.charAt(0).toLowerCase();var n=e.slice(t+1,t+3);if(!this.chess.put({type:a,color:this.turn()},n))return null;var s=this.turn();return this.toggleTurn(),{color:s,from:n,to:n,san:e}}return null}},{key:"toggleTurn",value:function(){var e=this.chess.fen().split(" ");e[1]="b"===e[1]?"w":"b",e[3]="-",this.chess.load(e.join(" "))}}]),e}();function h(e,t){return t||(t=u(e)),e===n.yb?new l(t):e===n.wb?new c(t):new i.a(t)}function u(e){return e===n.yb?n.db:n.eb}a.d(t,"a",(function(){return h})),a.d(t,"b",(function(){return u}))},712:function(e,t){},745:function(e,t){},843:function(e,t,a){},844:function(e,t,a){},845:function(e,t,a){},846:function(e,t,a){},86:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return r})),a.d(t,"a",(function(){return o}));var n=a(2);function s(e){return e===n.ib||e===n.kb}function i(e,t){return e!==n.jb&&e!==n.mb&&e!==n.lb&&!!t}function r(e,t,a,s){return t===n.lb?"Not currently supported for tournaments":t!==n.kb&&t!==n.ib?"Only supported for chess.com and lichess":e!==t||a<=0?"You need to analyze games before saving":s?"Action not supported while games are loading":""}function o(e,t,a,s,i){return e===n.jb?"".concat(s.name,".").concat(i):t?"".concat(t,"-").concat(a,".").concat(i):"openingtree-exportedgames.".concat(i)}}},[[475,1,2]]]);
//# sourceMappingURL=main.9aaf9edf.chunk.js.map