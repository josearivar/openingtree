{"version":3,"sources":["pres/DarkMode.js","app/Analytics.js","app/OpeningGraph.js","app/Constants.js","app/UserProfile.js","app/stockfish/winningChances.js","pres/stockfish/EvalBar.js","pres/stockfish/PvLines.js","app/stockfish/StockfishEngine.js","pres/stockfish/EngineAnalysis.js","pres/stockfish/index.js","app/OpeningTreeSerializer.js","pres/loader/Common.js","pres/MainContainer.js","pres/GlobalHeader.js","pres/loader/Filters.js","pres/loader/Actions.js","app/PGNReaderWorker.js","pres/StateManagement.js","app/OpeningBook.js","pres/SnackbarContentWrapper.js","pres/loader/Source.js","pres/loader/Dropzone.js","pres/loader/NotableChessGames.js","pres/loader/User.js","pres/loader/Variants.js","pres/loader/PGNLoader.js","pres/Settings.js","pres/ReportControls.js","pres/moves/MovesCommon.js","pres/moves/MovesSettings.js","pres/moves/MovesTable.js","pres/moves/ResultsTable.js","pres/moves/MovesList.js","pres/moves/BookMoves.js","app/StockfishEngine.js","pres/analysis/StockfishAnalysis.js","pres/ControlsContainer.js","pres/loader/TimeControlLabels.js","pres/loader/FilterLabels.js","pres/loader/AdvancedFilters.js","app/OpeningManager.js","pres/Navigator.js","index.js","app/util.js","app/CookieManager.js","app/PGNReader.js","app/Common.js","app/chess/RacingKingsChess.js","app/chess/CrazyhouseChess.js","app/chess/ChessLogic.js","app/SitePolicy.js"],"names":["handleDarkMode","darkMode","document","body","classList","contains","toggle","logoName","rowContentColor","initializeAnalytics","segment","openingBookType","ReactGA","initialize","set","dimension2","dimension1","dimension3","trackPageView","pageview","window","location","pathname","trackEvent","category","action","label","value","nonInteraction","event","OpeningGraph","variant","this","graph","Graph","hasMoves","arrayEntries","pgnStats","parsedMoves","lastFen","playerColor","index","length","push","forEach","parsedMove","addMoveForFen","sourceFen","targetFen","moveSan","addGameResultOnFen","addStatsToRoot","fullFen","resultIndex","currNode","getNodeFromGraph","gameResults","targetNode","rootFen","details","hasData","blackWins","whiteWins","draws","totalOpponentElo","shortestGame","longestGame","lastPlayed","newDetails","getUpdatedMoveDetails","node","simplifiedFen","Number","isInteger","updateCalculatedValues","bestWin","bestWinGame","bestWinElo","getOpponentElo","worstLoss","worstLossGame","worstLossElo","lastPlayedGame","longestGameInfo","shortestGameInfo","count","fullSourceFen","fullTargetFen","move","resultObject","playedBy","moveCount","playedByMax","Math","max","book","fen","transform","Map","moves","fetch","map","black","white","san","averageElo","averageRating","get","addIfNull","nodes","GraphNode","currentMoveDetails","whiteWin","blackWin","draw","resultInt","result","Constants","opponentElo","currentBestWinGame","parseInt","currentWorstLossGame","currentLastPlayedGame","isDateMoreRecentThan","date","currentLongestGame","numberOfPlys","currentShortestGame","blackElo","whiteElo","Array","from","Object","entries","entry","chess","chessLogic","sloppy","targetNodeDetails","getDetailsForFen","orig","dest","to","level","levelFor","filter","e","maxCount","TIME_CONTROL_ULTRA_BULLET","TIME_CONTROL_BULLET","TIME_CONTROL_BLITZ","TIME_CONTROL_RAPID","TIME_CONTROL_CLASSICAL","TIME_CONTROL_CORRESPONDENCE","TIME_CONTROL_DAILY","FILTER_NAME_RATED","FILTER_NAME_DOWNLOAD_LIMIT","FILTER_NAME_OPPONENT","FILTER_NAME_ELO_RANGE","FILTER_NAME_FROM_DATE","FILTER_NAME_TO_DATE","SITE_LICHESS","SITE_CHESS_DOT_COM","SITE_PGN_FILE","SITE_EVENT_DB","SITE_PLAYER_DB","SITE_OPENING_TREE_FILE","SITE_ONLINE_TOURNAMENTS","MAX_DOWNLOAD_LIMIT","MAX_ELO_RATING","EVENT_CATEGORY_PGN_LOADER","EVENT_CATEGORY_SETTINGS","EVENT_CATEGORY_LICHESS_LOGIN","EVENT_CATEGORY_MAIN_ACTION","EVENT_CATEGORY_MOVES_LIST","EVENT_CATEGORY_CONTROLS","EVENT_CATEGORY_NAVIGATOR","EVENT_CATEGORY_CHESSBOARD","EVENT_CATEGORY_MESSAGE_SHOWN","EVENT_CATEGORY_GLOBAL_HEADER","ROOT_FEN","RACING_KINGS_ROOT_FEN","PLAYER_COLOR_WHITE","PLAYER_COLOR_BLACK","LOADER_ANIMATION_DURATION_MS","OPENING_TREE_EMAIL","OPENING_TREE_REDDIT","OPENING_TREE_LICHESS","OPENING_TREE_CHESS_COM","OPENING_TREE_DISCORD","OPENING_TREE_FILE_CURRENT_VERSION","ERROR_ACTION_VISIT_OLD_SITE","ERROR_ACTION_NONE","LICHESS_NOT_LOGGED_IN","LICHESS_STATE_PENDING","LICHESS_LOGGED_IN","LICHESS_FAILED_FETCH","ERROR_SEVERITY_ERROR","ERROR_SEVERITY_SUCCESS","VARIANT_STANDARD","VARIANT_RACING_KINGS","VARIANT_THREE_CHECK","VARIANT_KING_OF_THE_HILL","VARIANT_CRAZYHOUSE","CHESS_COM_RULES_STANDARD","CHESS_COM_RULES_THREE_CHECK","CHESS_COM_RULES_KING_OF_THE_HILL","CHESS_COM_RULES_CRAZYHOUSE","LICHESS_PERF_RACING_KINGS","LICHESS_PERF_THREE_CHECK","LICHESS_PERF_KING_OF_THE_HILL","LICHESS_PERF_CRAZYHOUSE","LICHESS_PERF_STANDARD","LICHESS_HEADER_RACING_KINGS","LICHESS_HEADER_THREE_CHECK","LICHESS_HEADER_KING_OF_THE_HILL","LICHESS_HEADER_STANDARD","LICHESS_HEADER_CRAZYHOUSE","OPENING_BOOK_TYPE_OFF","OPENING_BOOK_TYPE_MASTERS","OPENING_BOOK_TYPE_LICHESS","ALL_BOOK_RATINGS","SETTING_NAME_ORIENTATION","SETTING_NAME_DARK_MODE","SETTING_NAME_MOVES_SETTINGS","LICHESS_HOST","LICHESS_CLIENT_ID","UserProfile","userProfile","visitInfo","cookieManager","getVisitInfo","userType","userTypeDesc","numVisits","USER_PROFILE_FIRST_TIME_USER","USER_PROFILE_NEW_USER","USER_PROFILE_OCCAISONAL_USER","currentVisit","firstVisit","lastVisit","USER_PROFILE_POWER_USER","USER_PROFILE_FREQUENT_USER","rawWinningChances","cp","exp","cpWinningChances","min","mateWinningChances","mate","abs","evalWinningChances","score","undefined","povChances","color","chances","chancesToPercent","round","formatCp","toFixed","formatScore","getEvalBarPercent","EvalBar","orientation","depth","isAnalyzing","height","whitePercent","blackPercent","scoreText","isFlipped","showScoreOnWhite","showScoreOnBlack","topSection","className","style","bottomSection","title","top","PvLine","pvData","turnColor","onMoveClick","onMoveHover","isHighlighted","pv","isGood","isBad","effectiveFen","displayMoves","useMemo","uciMoves","slice","sanMoves","uci","tempChess","Chess","i","substring","promotion","console","warn","message","convertPvToSan","onMouseEnter","onMouseLeave","key","onClick","PvLines","pvLines","highlightedMove","StockfishEngine","options","worker","isReady","isSearching","onEvaluation","onBestMove","onReady","onError","currentEval","multiPv","currentFen","isWhiteTurn","uciOk","restartCount","maxRestarts","lastError","init","wasmPath","origin","workerUrl","Worker","onmessage","handleMessage","data","onerror","error","handleWorkerError","setTimeout","send","err","errorMessage","includes","log","terminate","analyze","line","startsWith","parseInfo","parseBestMove","parts","split","seldepth","scoreType","nps","time","m","rawScore","evalData","normalizeScore","Boolean","bestMove","ponder","cmd","postMessage","stop","isWhiteToMove","movetime","EngineControls","enabled","targetDepth","onToggle","onMultiPvChange","onGoDeeper","onDismissError","type","checked","onChange","disabled","target","EngineAnalysis","onMove","onHighlightMove","onStateChange","boardHeight","showPvLines","useState","engine","setEngine","setIsReady","setIsAnalyzing","setEnabled","evaluation","setEvaluation","setPvLines","setDepth","setError","setHighlightedMove","setMultiPv","setTargetDepth","lastFenRef","useRef","useEffect","analyzing","current","sf","msg","destroy","handleMoveClick","useCallback","handleMoveHover","toggleAnalysis","prev","goDeeper","serializeOpeningTree","treeData","filename","callback","chunkedArray","chunks","chunk","header","arraySizes","arrays","arr","array","prototype","apply","chunkSize","startIndex","chunkIndex","chunkArray","deflatedChunks","packControlWord","remainingChunks","hasError","zlib","deflate","Buffer","JSON","stringify","byteLength","saveAs","Blob","deserializeOpeningTree","file","reader","FileReader","onload","evt","version","unpackControlWord","numChunks","handleInflate","parse","sortedChunks","sort","a","b","flattenedChunks","el","flat","size","reconstructObjectFromChunks","inflate","getInflatedChunks","name","readAsArrayBuffer","control","view","DataView","getUint16","getUint32","buffer","ArrayBuffer","setUint16","setUint32","Accordion","withStyles","root","border","boxShadow","borderBottom","display","margin","expanded","MUIAccordion","getNumberIcon","n","alt","src","advancedFilters","state","createSubObjectWithProperties","copyText","elementId","getElementById","select","setSelectionRange","execCommand","MainContainer","props","handleEngineHighlight","setState","engineHighlightedMove","handleEngineMove","handleEngineStateChange","engineEnabled","engineEvaluation","engineDepth","engineAnalyzing","enginePvLines","engineFen","handlePvMoveClick","handlePvMoveHover","selectedVariant","URLSearchParams","search","addStateManagement","resize","lastMove","gamesProcessed","openingGraph","settings","playerName","movesSettings","getMovesSettingsFromCookie","getDarkModeSettingFromCookie","downloadingGames","feedbackOpen","diagnosticsDataOpen","update","chessboardWidth","getChessboardWidth","initializeOauth","forBrushes","againstBrushes","engineBrush","addEventListener","handleResize","bind","getUserProfile","clientUrl","url","URL","href","oauth","OAuth2AuthCodePKCE","authorizationUrl","tokenUrl","clientId","scopes","redirectUrl","onAccessTokenExpiry","refreshAccessToken","onInvalidGrant","_retry","isReturningFromAuthServer","then","hasAuthCode","getAccessToken","accessToken","setLichessAccessToken","token","replace","catch","getSettingsCookie","openingBookRating","openingBookTimeControls","openingBookScoreIndicator","openingBookWinsIndicator","darkModeCookie","getDarkModeCookie","playerMoves","shapes","autoShapes","shape","unshift","brush","lastMoveArray","snackBarOpen","getPlayerMoves","bookMoves","getBookMoves","mergePlayerAndBookMoves","boardHeightNum","settingsChange","toggleFeedback","lg","order","xs","navigateTo","alignItems","justifyContent","gap","width","movable","calcMovable","onMoveAction","drawable","visible","getAutoShapesWithEngine","marginTop","updateProcessedGames","reset","clear","showError","showInfo","setDownloading","isDownloading","importCallback","importGameState","variantChange","forceFetchBookMoves","highlightArrow","oauthManager","anchorOrigin","vertical","horizontal","open","autoHideDuration","onClose","closeError","messageSeverity","subMessage","showReportButton","errorAction","actionText","errorActionText","isOpen","rel","getEmailLink","getRedditLink","toggleDiagnosticsData","id","getDiagnosticsValue","rowsMax","copyDiagnostics","multiline","setImmediate","React","Component","GlobalHeader","setIsOpen","modal","setModal","toggleModal","isFAQOpen","setFAQOpen","toggleFAQModal","launch","eventName","rows","content","styles","rowTitleColor","rowTitleTextSize","rowContentTextSize","rowContentPaddingTop","config","dark","light","expand","navbar","icon","faLightbulb","faMoon","faYoutube","faDiscord","nav","faQuestionCircle","right","faCaretDown","divider","tag","Filters","isAdvancedFiltersOpen","assign","defaultAdvancedFilters","rated","property","newState","site","SitePolicy","setFilters","newValue","colorError","filtersChange","isDisabled","areAdvancedFiltersApplied","newProps","deepEqual","selectedNotablePlayer","expandedPanel","TransitionComponent","MuiCollapse","TransitionProps","timeout","handleExpansionChange","expandIcon","getSummary","component","playerColorChange","toggleState","faCaretUp","toggleRated","handleTimeControlChange","handleEloRangeChange","handleOpponentNameChange","handleDownloadLimitChange","handleFromDate","handleToDate","Actions","unload","pgnReader","stopDownloading","isGamesSubsectionOpen","exportingInProgress","streamsaver","mitm","encoder","TextEncoder","removeEventListener","importOpeningTree","files","subMesage","success","importOpeningTreeObject","exportOpeningTree","exportOpeningTreeObject","info","fileWriter","close","game","headers","join","moveObject","pendingDownloads","write","encode","getPgnString","abortDownloading","shouldDownloadToFile","fileStream","createWriteStream","selectedNotableEvent","getWriter","PGNReader","readerInstance","fetchPGNFromSite","selectedOnlineTournament","proxy","notify","downloadResponse","getTokens","lichess","getLichessAccessToken","readPgn","loadedSite","importTreeClicked","startIcon","disableElevation","downloadDisabledReason","load","download","placement","exportTreeClicked","stopDownloadingAction","switchToMovesTab","faList","openingTreeLoadActions","regularActions","mainComponent","in","wrap","maxArrowsDrawn","turn","brushes","dests","SQUARES","s","ms","square","verbose","free","sanOrOrig","moveObj","previousMove","downloadLimit","parsedGame","totalGamesProcessed","addPGN","latestFen","moveToShape","concat","fillArray","movesForFen","gameResultsForFen","len","settingsToPersist","CookieManager","setSettingsCookie","clearBookNodes","setDarkModeCookie","trackingEvent","severity","trackingLabel","diagnosticsOpen","val","importState","nearestMultipleOf8","innerWidth","innerHeight","navigator","userAgent","getSubject","getBody","newVariant","getBookNode","fetchBookMoves","addBookNode","playerMovesToShow","bookMovesToShow","bookMovesMap","movesToShow","createMap","bookMove","compareTo","bookScore","getCompareScores","userScore","values","getCompareToValues","obj","bookSettings","ratings","speeds","bookType","Common","joinParams","request","response","paramValues","variantIcon","CheckCircleIcon","warning","WarningIcon","ErrorIcon","InfoIcon","theme","backgroundColor","green","palette","primary","amber","fontSize","iconVariant","opacity","marginRight","spacing","classes","other","Icon","clsx","aria-describedby","aria-label","SOURCE_VARIANT_COMBINATION","Source","source","addNumber","Backup","DateRange","People","Save","faChessRook","siteChange","newSite","supportedSources","Collapse","AccordionSummary","ExpandMore","aria-controls","getSourceOption","AccordionDetails","RadioGroup","setSite","getSourceRadio","Divider","AccordionActions","continue","isSourceAvailable","FormControlLabel","Radio","Dropzone","newFiles","filesChange","acceptedFiles","dropzoneText","handleFileChange","dropzoneParagraphClass","showFileNames","useChipsForPreview","previewChipProps","dropzoneClass","filesLimit","maxFileSize","NotableChessGames","updateDetails","option","profile","imageUrl","subText","list","selectedDetail","placeholder","renderOption","renderDetails","User","tournamentUrl","selectedPlayer","selectedEvent","playerNameError","tournamentUrlError","player","nextProps","trim","parsedUrl","hostname","tournamentSite","endsWith","pathComponents","tournamentId","tournamentType","validateInputDetailsSet","playerDetailsChange","finalPlayerName","fetchAuthorizationCode","getLichessCardBody","getPlayerNameInput","lichessLoginState","Card","Spinner","CardBody","CardTitle","faInfoCircle","faSync","refreshLichessStatus","faSignOutAlt","logoutOfLichess","launchLichessOauth","lichessLoginName","faCheck","CardText","helperText","TextField","editPlayerName","onKeyUp","playerNameKeyUp","getOnlineTournamentCard","getOnlineTournamentInput","editTournamentUrl","keyCode","setPlayerDetails","notablePlayers","notablePlayerChange","notableEvents","notableEventChange","getPgnFileSelection","getLichessSelection","getChessComSelection","getGoatDBEventSelection","getGoatDBSelection","getOpeningTreeSelection","getOnlineTournamentSelection","getInputsToShow","Variants","getVariantIcon","getVariantText","faFlagCheckered","faDiceThree","faMountain","faHouseDamage","faChessKing","getVariantOption","changeLink","setVariant","getVariantRadio","PGNLoader","selectedSite","fetchLichessLoginStatus","panel","newExpanded","timestamp","floor","Date","now","playername","openingTreeSave","saveVersion","setEntries","gamesDetails","fetchGOATGames","auth","bearer","responseObj","username","deleteLichessAccessToken","filters","pgnUrl","SettingsView","keyHandler","srcElement","tagName","Container","Row","Col","faRetweet","clearAction","faTrashAlt","resetAction","faFastBackward","analyse","faDesktop","ReportControls","stopPropagation","simplifiedView","inputProps","spellCheck","copyFen","moveDetails","getFenField","switchToUserTab","faUser","performanceDetails","getPerformanceDetails","Table","eatClicks","performanceRating","isNaN","TableHead","TableRow","TableCell","TableBody","results","averageOpponentElo","ratingChange","launchGame","faExternalLinkAlt","removeQuestionMarksFromDate","reportFooter","TableFooter","colSpan","indexOf","playerDetails","elo","offCard","actionIcon","MovesSettings","mSettings","getTransformedBookType","indicatorInfoOpen","isArray","newMovesSettings","Modal","cancel","ModalHeader","ModalBody","getOpeningBookType","getOpeningBookRating","getOpeningBookTimeControls","getIndicatorSwitch","Link","toggleIndicatorInfo","ModalFooter","Switch","updateMoveSetting","mastersBookAvailable","ToggleButtonGroup","exclusive","ToggleButton","MovesTable","openPerformanceIndex","moveSettingsOpen","prevProps","prevState","clickedEventName","moveIndex","compareToClicked","currMove","percent","stepPositions","getIndicator","constructAlt","compareToAlt","compareClicked","altTitle","steps","click","transition","accomplished","performancePopoverOpen","openMove","Popover","trigger","namespace","togglePerformancePopover","getTranspositionWarningLevel","getInfoIcon","targetCount","difference","faWrench","toggleMovesSettings","updateSettings","getSingleItemRow","getMultiItemRow","tableFooter","isTouchDevice","highlightMove","onMouseOver","highlightArrowFn","onMouseOut","simplifyCount","getPopover","compareScores","Progress","multi","bar","percentage","getProgressLabel","compareProgress","faExclamationTriangle","total","showAsPercentage","sampleResultWhite","sampleResultBlack","sampleResult","ResultsTable","whitePlayer","blackPlayer","MovesList","resultsTable","movesTable","switchToBookTab","BookMove","enableBook","tab","EngineState","analysisCallback","multiPV","pendingAnalysis","analysisId","currentAnalysisId","debounceTimer","debounceDelay","lastActivityTime","healthCheckInterval","commandQueue","isProcessingQueue","initPromise","initResolve","initReject","readyPromise","readyResolve","stopPromise","stopResolve","recoveryAttempts","maxRecoveryAttempts","lastFenForGame","messageBuffer","Promise","resolve","reject","cleanup","scheduleRecovery","sendCommand","Error","clearInterval","clearTimeout","setInterval","recoverEngine","forceStopComplete","processPendingAnalysis","delay","pow","wasAnalyzing","lastCallback","analyzeInfinite","handleSingleMessage","startHealthCheck","wasStopping","infinite","_doAnalyzeInfinite","_doAnalyze","multipv","p","test","currentId","_startAnalysis","stopAndWait","uciMove","find","adjustedScore","mateIn","pawns","clampedScore","engineInstance","StockfishAnalysis","isEngineReady","topMoves","showSettings","analysisDepth","engineState","analysisResults","mounted","startAnalysis","stopAnalysis","handleAnalysisUpdate","handleDepthChange","handleMultiPVChange","toggleSettings","handleMoveLeave","handleCloseError","retryInit","initEngine","getState","safeSetState","setMultiPV","res","moveInfo","uciToMove","rank","formattedScore","bestResult","formatted","barPercent","onAnalysisUpdate","getScoreClass","Paper","elevation","Typography","gutterBottom","Slider","step","marks","valueLabelDisplay","Tooltip","IconButton","Refresh","Stop","PlayArrow","Settings","renderSettings","renderEvalBar","renderTopMoves","LinearProgress","Snackbar","ControlsContainer","activeTab","activeGame","highlightPlayerMove","highlightBookMove","Nav","tabs","NavItem","NavLink","classnames","active","faBook","faMicrochip","faChartBar","faCog","TabContent","TabPane","tabId","bookResults","md","timeClasses","selectedTimeControls","unselectedTimeControls","includesAll","subArray","every","v","getTimeControlLabel","timeControlState","getTimeControlsArray","timeClass","lichessTimeControlLabel","AdvancedFilters","currentlyOpenAdvancedFilter","downloadLimitMarks","eloRangeMarks","filterName","subSectionComponent","setCurrentlyOpenAdvancedFilter","getTimeControlFilters","toLocaleDateString","getFromDateFilter","getToDateLabel","getToDateFilter","selectedEloRange","getEloRangeFilters","getOpponentNameFilter","getDownloadLimitFilters","valueLabelFormat","placeholderText","selected","firstRow","middleRow","lastRow","colWidth","FormControl","FormGroup","getTimeControlFilterRow","controls","firstColumnWidth","position","clsName","sm","Checkbox","changeCallback","children","newBadge","Badge","getFilters","OpeningManager","plys","currentIndex","pgn","ChessLogic","pgnAsList","moveForward","pgnList","pgnSoFar","pgnListSoFar","moveNumber","whitePly","blackPly","moveTo","Navigator","openingManager","currentMove","previous","next","addPly","device","moveBack","opening","ChessEcoCodes","openingCode","code","Button","faStepBackward","faStepForward","ReactDOM","render","mainObject","properties","subObject","fenComponents","timeControl","totalGames","playerWins","playerLosses","scorePercentage","than","Cookies","expires","remove","path","domain","settingsCookie","lastVisitCookie","visitsCookie","firstVisitCookie","timesVisited","currDate","getTime","module","exports","LICHESS_TIME_CONTROLS","CHESS_DOT_COM_TIME_CONTROLS","TIME_CONTROL_LABELS","lichessPerf","DP_TABLE","RacingKingsChess","disambiguatedMove","problematicMove","potentialMoves","filteredMoves","potentialMove","charAt","disambiguate","CrazyhouseChess","locationOfAt","piece","PAWN","toLowerCase","put","toggleTurn","tokens","isAdvancedFiltersEnabled","isFilterPanelEnabled","treeSaveDisabledReason","exportFileName","extension"],"mappings":"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","file":"static/js/main.9aaf9edf.chunk.js","sourcesContent":["export const handleDarkMode = (darkMode) => {\n    const darkModeThemeIsCurrentlySet = document.body.classList.contains('dark-theme');\n    if (darkMode !== darkModeThemeIsCurrentlySet) {\n        document.body.classList.toggle('dark-theme');\n    }\n};\nexport const logoName = (darkMode) => {\n    return darkMode? 'opening-tree-logo-white.png':'opening-tree-logo.png'\n}\nexport const rowContentColor = (darkMode) => {\n    return darkMode ? 'white' : 'grey'\n}\n","import ReactGA from 'react-ga';\n\nexport function initializeAnalytics (segment, darkMode, openingBookType){\n    ReactGA.initialize('UA-159149755-1');\n    ReactGA.set({ dimension2: segment, \n        dimension1: darkMode,  \n        dimension3: openingBookType\n    });\n\n}\nexport function trackPageView() {\n    ReactGA.pageview(window.location.pathname);\n}\n\nexport function trackEvent(category, action, label, value, nonInteraction) {\n    ReactGA.event({\n        category: category,\n        action: action,\n        label: label,\n        value: value,\n        nonInteraction:nonInteraction\n      })\n}\n\n","import {simplifiedFen, isDateMoreRecentThan} from './util'\nimport * as Constants from './Constants'\nimport {chessLogic, rootFen} from '../app/chess/ChessLogic'\n\nexport default class OpeningGraph {\n    constructor(variant) {\n        this.graph=new Graph()\n        this.hasMoves = false\n        this.variant = variant\n    }\n    setEntries(arrayEntries, pgnStats){\n        this.graph=new Graph(arrayEntries, pgnStats)\n        this.hasMoves = true\n    }\n\n    clear() {\n        this.graph = new Graph()\n        this.hasMoves = false\n    }\n\n    addPGN(pgnStats, parsedMoves, lastFen, playerColor) {\n        pgnStats.index = this.graph.pgnStats.length\n        this.graph.pgnStats.push(pgnStats)\n        this.graph.playerColor = playerColor\n        this.hasMoves = true\n        parsedMoves.forEach(parsedMove => {\n            this.addMoveForFen(parsedMove.sourceFen, parsedMove.targetFen, parsedMove.moveSan, pgnStats)\n        })\n        this.addGameResultOnFen(lastFen, pgnStats.index)\n        this.addStatsToRoot(pgnStats, this.variant)\n    }\n\n    addGameResultOnFen(fullFen, resultIndex) {\n        var currNode = this.getNodeFromGraph(fullFen, true)\n        if(!currNode.gameResults) {\n            currNode.gameResults = []\n        }\n        currNode.gameResults.push(resultIndex)\n    }\n    addStatsToRoot(pgnStats, variant) {\n        var targetNode = this.getNodeFromGraph(rootFen(variant), true)\n        if(!targetNode.details) {\n            targetNode.details = emptyDetails()\n        }\n        let newDetails = this.getUpdatedMoveDetails(targetNode.details, pgnStats)\n        targetNode.details = newDetails\n    }\n\n    getDetailsForFen(fullFen) {\n        let node = this.getNodeFromGraph(simplifiedFen(fullFen), false)\n        let details = node && node.details\n        if (Number.isInteger(details)) {\n            details = this.getUpdatedMoveDetails(emptyDetails(), this.graph.pgnStats[details])\n        } else if(!details) {\n            return emptyDetails()\n        }\n        details = this.updateCalculatedValues(details)   \n        return details\n    }\n\n    updateCalculatedValues(details) {\n        if(Number.isInteger(details.bestWin)) {\n            details.bestWinGame = this.graph.pgnStats[details.bestWin]\n            details.bestWinElo = this.getOpponentElo(this.graph.playerColor,details.bestWinGame)\n        }\n        if(Number.isInteger(details.worstLoss)) {\n            details.worstLossGame = this.graph.pgnStats[details.worstLoss]\n            details.worstLossElo = this.getOpponentElo(this.graph.playerColor,details.worstLossGame)\n        }\n        if(Number.isInteger(details.lastPlayed)) {\n            details.lastPlayedGame = this.graph.pgnStats[details.lastPlayed]\n        }\n        if(Number.isInteger(details.longestGame)) {\n            details.longestGameInfo = this.graph.pgnStats[details.longestGame]\n        }\n        if(Number.isInteger(details.shortestGame)) {\n            details.shortestGameInfo = this.graph.pgnStats[details.shortestGame]\n        }\n        details.count = details.whiteWins+details.blackWins+details.draws\n        return details\n\n    }\n\n    addMoveForFen(fullSourceFen, fullTargetFen, move, resultObject) {\n        var targetNode = this.getNodeFromGraph(fullTargetFen, true)\n        let newDetails = this.getUpdatedMoveDetails(targetNode.details, resultObject)\n        targetNode.details = newDetails\n\n        var currNode = this.getNodeFromGraph(fullSourceFen, true)\n        if(!currNode.playedBy) {\n            currNode.playedBy = {}\n        }\n        let moveCount = currNode.playedBy[move]\n        if(!moveCount) {\n            moveCount = 0\n        }\n        moveCount = moveCount+1\n        currNode.playedBy[move] = moveCount\n        currNode.playedByMax = Math.max(currNode.playedByMax, moveCount)\n    }\n\n    addBookNode(fullFen, book) {\n        let fen = simplifiedFen(fullFen)\n        this.graph.book.set(fen, this.transform(book))\n    }\n    clearBookNodes(){\n        this.graph.book = new Map()\n    }\n    transform(book) {\n        if(!book || !book.moves) {\n            return book\n        }\n        return {\n            fetch:\"success\",\n            moves:book.moves.map((move)=>{\n                let count = move.black+move.white+move.draws\n                return {\n                    san:move.san,\n                    details:{\n                        hasData:true,\n                        blackWins:move.black,\n                        whiteWins:move.white,\n                        draws:move.draws,\n                        count:count,\n                        averageElo:move.averageRating\n                    },\n                    moveCount:count\n                }\n            })\n        }\n    }\n    getBookNode(fullFen) {\n        let fen = simplifiedFen(fullFen)\n        return this.graph.book.get(fen)\n    }\n\n    getNodeFromGraph(fullFen, addIfNull) {\n        let fen = simplifiedFen(fullFen)\n        var currNode = this.graph.nodes.get(fen)\n        if(!currNode && addIfNull) {\n            currNode = new GraphNode()\n            currNode.fen = fen\n            this.graph.nodes.set(fen, currNode)\n        }\n        return currNode\n    }\n\n    getUpdatedMoveDetails(currentMoveDetails, resultObject) {\n        if(Number.isInteger(currentMoveDetails)) {\n            // if this is the second stat object being added\n            // calculate the first move details and then merge it with the second one\n            currentMoveDetails = this.getUpdatedMoveDetails(emptyDetails(),\n                            this.graph.pgnStats[currentMoveDetails])\n        } else if(!currentMoveDetails) {\n            // if this is the first stat being added to this node,\n            // just write the index to calculate the stats later\n            return resultObject.index\n        }\n        \n        let whiteWin = 0, blackWin = 0, draw = 0, resultInt = 0;\n        let playerColor = this.graph.playerColor\n        if(resultObject.result === '1-0') {\n            whiteWin = 1\n            resultInt = playerColor === Constants.PLAYER_COLOR_WHITE? 1 : -1\n        } else if (resultObject.result === '0-1') {\n            blackWin = 1\n            resultInt = playerColor === Constants.PLAYER_COLOR_BLACK? 1 : -1\n        } else {\n            draw = 1\n        }\n\n        let opponentElo = this.getOpponentElo(playerColor, resultObject)\n        if(resultInt === 1) {\n            let currentBestWinGame = null\n            if(Number.isInteger(currentMoveDetails.bestWin)) {\n                currentBestWinGame = this.graph.pgnStats[currentMoveDetails.bestWin]\n            }\n            if(!currentBestWinGame || parseInt(opponentElo)>parseInt(this.getOpponentElo(playerColor, currentBestWinGame))) {\n                currentMoveDetails.bestWin = resultObject.index\n            }\n        }\n        if(resultInt === -1) {\n            let currentWorstLossGame = null\n            if(Number.isInteger(currentMoveDetails.worstLoss)) {\n                currentWorstLossGame = this.graph.pgnStats[currentMoveDetails.worstLoss]\n            }\n            if(!currentWorstLossGame || parseInt(opponentElo)<parseInt(this.getOpponentElo(playerColor, currentWorstLossGame))) {\n                currentMoveDetails.worstLoss = resultObject.index\n            }\n        }\n        let currentLastPlayedGame = null\n        if(Number.isInteger(currentMoveDetails.lastPlayed)) {\n            currentLastPlayedGame = this.graph.pgnStats[currentMoveDetails.lastPlayed]\n        }\n        if(!currentLastPlayedGame || \n            isDateMoreRecentThan(resultObject.date, currentLastPlayedGame.date)) {\n                currentMoveDetails.lastPlayed = resultObject.index\n        }\n        let currentLongestGame = null\n        if(Number.isInteger(currentMoveDetails.longestGame)) {\n            currentLongestGame = this.graph.pgnStats[currentMoveDetails.longestGame]\n        }\n        if(!currentLongestGame || \n            resultObject.numberOfPlys > currentLongestGame.numberOfPlys) {\n                currentMoveDetails.longestGame = resultObject.index\n        }\n\n        let currentShortestGame = null\n        if(Number.isInteger(currentMoveDetails.shortestGame)) {\n            currentShortestGame = this.graph.pgnStats[currentMoveDetails.shortestGame]\n        }\n        if(!currentShortestGame || \n            resultObject.numberOfPlys < currentShortestGame.numberOfPlys) {\n                currentMoveDetails.shortestGame = resultObject.index\n        }\n\n\n        currentMoveDetails.blackWins += blackWin\n        currentMoveDetails.whiteWins += whiteWin\n        currentMoveDetails.draws += draw\n        currentMoveDetails.totalOpponentElo += parseInt(opponentElo)\n        currentMoveDetails.hasData = true\n        return currentMoveDetails\n    }\n\n    getOpponentElo(playerColor, resultObject) {\n        if(playerColor === Constants.PLAYER_COLOR_WHITE) {\n            return resultObject.blackElo\n        }\n        return resultObject.whiteElo\n    }\n\n    gameResultsForFen(fullFen) {\n        let fen = simplifiedFen(fullFen)\n\n        var currNode = this.graph.nodes.get(fen)\n        if(currNode && currNode.gameResults) {\n            return currNode.gameResults.map((index)=>this.graph.pgnStats[index])\n        }\n        return null\n    }\n    movesForFen(fullFen) {\n        let fen = simplifiedFen(fullFen)\n\n        var currNode = this.graph.nodes.get(fen)\n        if(currNode && currNode.playedBy) {\n            return Array.from(Object.entries(currNode.playedBy)).map((entry)=> {\n                let chess = chessLogic(this.variant, fullFen)\n                let move = chess.move(entry[0], {sloppy: true})\n                if(!move) {\n                    // certain moves are not legal because of transposition\n                    // like en passant. fail safely in those cases. issue #306\n                    return null;\n                }\n                let targetNodeDetails = this.getDetailsForFen(chess.fen())\n                return {\n                    orig:move.from,\n                    dest:move.to,\n                    level:this.levelFor(entry[1], currNode.playedByMax),\n                    san:move.san,\n                    details:targetNodeDetails,\n                    moveCount:entry[1]\n                }\n            }).filter(e=>!!e) // filter out moves that are null because of issue #306\n        }        \n        return null\n    }\n\n    levelFor(moveCount, maxCount){\n        if(maxCount <= 0 ||moveCount/maxCount > 0.8) {\n            return 3\n        }\n        if(moveCount/maxCount>0.3) {\n            return 2\n        }\n        return 1\n    }\n\n}\n\n\nclass Graph {\n    constructor(arrayEntries, pgnStats){\n        this.nodes = new Map()\n        this.book = new Map()\n        this.pgnStats = []\n        this.playerColor = ''\n        if(arrayEntries) {\n            arrayEntries.forEach((entry)=> {\n                this.nodes.set(entry[0],entry[1])\n            })\n        }\n        if(pgnStats) {\n            this.pgnStats = pgnStats\n        }\n    }\n}\n\nclass GraphNode {\n            playedByMax = 0 // used to keep track of how many times the most frequent move is played for ease of calculation later\n            //playedBy = {}\n            //gameResults = []\n}\n\nfunction emptyDetails() {\n    return {\n        hasData:false,\n//        count: 0,\n        blackWins: 0,\n        whiteWins: 0,\n        draws: 0,\n        totalOpponentElo: 0,\n        shortestGame:null,\n        longestGame:null,\n//        bestWin:null,\n//        bestWinGame:null,\n//        worstLoss:null,\n//        worstLossGame:null,\n        lastPlayed:null\n//        lastPlayedGame:null\n    }\n}\n","export const TIME_CONTROL_ULTRA_BULLET = \"ultraBullet\"\nexport const TIME_CONTROL_BULLET = \"bullet\"\nexport const TIME_CONTROL_BLITZ = \"blitz\"\nexport const TIME_CONTROL_RAPID = \"rapid\"\nexport const TIME_CONTROL_CLASSICAL = \"classical\"\nexport const TIME_CONTROL_CORRESPONDENCE = \"correspondence\"\nexport const TIME_CONTROL_DAILY = \"daily\"\nexport const FILTER_NAME_RATED = \"rated\"\nexport const FILTER_NAME_DOWNLOAD_LIMIT = \"downloadLimit\"\nexport const FILTER_NAME_OPPONENT = \"opponent\"\nexport const FILTER_NAME_ELO_RANGE = \"eloRange\"\nexport const FILTER_NAME_FROM_DATE = \"fromDate\"\nexport const FILTER_NAME_TO_DATE = \"toDate\"\n\nexport const SITE_LICHESS = \"lichess\"\nexport const SITE_CHESS_DOT_COM = \"chesscom\"\nexport const SITE_PGN_FILE = \"pgnfile\"\nexport const SITE_EVENT_DB = \"eventdb\"\nexport const SITE_PLAYER_DB = \"playerdb\"\nexport const SITE_OPENING_TREE_FILE = \"opntfile\"\nexport const SITE_ONLINE_TOURNAMENTS = \"tournament\"\n\nexport const MAX_DOWNLOAD_LIMIT = 2000\nexport const MAX_ELO_RATING = 3000\n\nexport const EVENT_CATEGORY_PGN_LOADER = \"loader\"\nexport const EVENT_CATEGORY_OPENING_BOOK = \"openingBook\"\nexport const EVENT_CATEGORY_SETTINGS = \"settings\"\nexport const EVENT_CATEGORY_LICHESS_LOGIN = \"lichess\"\nexport const EVENT_CATEGORY_MAIN_ACTION = \"mainAction\"\nexport const EVENT_CATEGORY_SEGMENT = \"segment\"\nexport const EVENT_CATEGORY_MOVES_LIST = \"moves\"\nexport const EVENT_CATEGORY_CONTROLS = \"controls\"\nexport const EVENT_CATEGORY_NAVIGATOR = \"navigator\"\nexport const EVENT_CATEGORY_CHESSBOARD = \"chessboard\"\nexport const EVENT_CATEGORY_ERROR = \"error\"\nexport const EVENT_CATEGORY_MESSAGE_SHOWN = \"message\"\nexport const EVENT_CATEGORY_GLOBAL_HEADER = \"globalHeader\"\n\nexport const ROOT_FEN = \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\"\nexport const RACING_KINGS_ROOT_FEN=\"8/8/8/8/8/8/krbnNBRK/qrbnNBRQ w - - 0 1\"\n\nexport const PLAYER_COLOR_WHITE = 'white'\nexport const PLAYER_COLOR_BLACK = 'black'\n\nexport const LOADER_ANIMATION_DURATION_MS = 500\n\nexport const OPENING_TREE_EMAIL = 'feedback@openingtree.com'\nexport const OPENING_TREE_REDDIT = 'opening_tree'\nexport const OPENING_TREE_LICHESS = 'vannooz'\nexport const OPENING_TREE_CHESS_COM = 'vannooz'\nexport const OPENING_TREE_DISCORD = 'https://discord.gg/hCwKkN8'\n\nexport const OPENING_TREE_FILE_CURRENT_VERSION = 2\n\nexport const ERROR_ACTION_REPORT = 'report'\nexport const ERROR_ACTION_VISIT_OLD_SITE = 'visitOld'\nexport const ERROR_ACTION_NONE = 'noAction'\nexport const LICHESS_NOT_LOGGED_IN = 0;\nexport const LICHESS_STATE_PENDING = 1;\nexport const LICHESS_LOGGED_IN = 2;\nexport const LICHESS_FAILED_FETCH = 3;\n\nexport const ERROR_SEVERITY_ERROR = \"error\";\nexport const ERROR_SEVERITY_WARNING = \"warning\";\nexport const ERROR_SEVERITY_SUCCESS = \"success\";\n\nexport const VARIANT_STANDARD = \"standard\";\nexport const VARIANT_RACING_KINGS = \"racingkings\";\nexport const VARIANT_THREE_CHECK = \"threecheck\";\nexport const VARIANT_KING_OF_THE_HILL = \"kingofthehill\";\nexport const VARIANT_CRAZYHOUSE = \"crazyhouse\";\n\nexport const CHESS_COM_RULES_STANDARD = \"chess\";\nexport const CHESS_COM_RULES_THREE_CHECK = \"threeCheck\";\nexport const CHESS_COM_RULES_KING_OF_THE_HILL = \"kingofthehill\";\nexport const CHESS_COM_RULES_CRAZYHOUSE = \"crazyhouse\";\n\nexport const LICHESS_PERF_RACING_KINGS = \"racingKings\"\nexport const LICHESS_PERF_THREE_CHECK = \"threeCheck\"\nexport const LICHESS_PERF_KING_OF_THE_HILL = \"kingOfTheHill\"\nexport const LICHESS_PERF_CRAZYHOUSE = \"crazyhouse\"\nexport const LICHESS_PERF_STANDARD = \"standard\"\n\nexport const LICHESS_HEADER_RACING_KINGS = \"Racing Kings\"\nexport const LICHESS_HEADER_THREE_CHECK = \"Three-check\"\nexport const LICHESS_HEADER_KING_OF_THE_HILL = \"King of the Hill\"\nexport const LICHESS_HEADER_STANDARD = \"Standard\"\nexport const LICHESS_HEADER_CRAZYHOUSE = \"Crazyhouse\"\n\nexport const OPENING_BOOK_TYPE_OFF = 'off'\nexport const OPENING_BOOK_TYPE_MASTERS = 'master'\nexport const OPENING_BOOK_TYPE_LICHESS = 'lichess'\n\nexport const ALL_BOOK_RATINGS = ['1600','1800','2000','2200','2500']\n\nexport const SETTING_NAME_ORIENTATION = 'orientation'\nexport const SETTING_NAME_DARK_MODE = 'darkMode'\nexport const SETTING_NAME_MOVES_SETTINGS = 'movesSettings'\n\nexport const MILLISECS_IN_DAY = 1000 * 60 * 60 * 24;\n\nexport const LICHESS_HOST = 'https://lichess.org';\nexport const LICHESS_CLIENT_ID = 'openingtree.com';\n","import cookieManager from './CookieManager'\n\nclass UserProfile {\n    userProfile = null\n    getUserProfile(){\n        if(this.userProfile !== null) {\n            return this.userProfile\n        }\n        let visitInfo = cookieManager.getVisitInfo();\n        let userType = null\n        let userTypeDesc = null\n        if(visitInfo.numVisits === 0) {\n            userType = USER_PROFILE_FIRST_TIME_USER\n            userTypeDesc = \"first\"\n        } else if(visitInfo.numVisits < 6) {\n            userType = USER_PROFILE_NEW_USER\n            userTypeDesc = \"new\"\n        } else if (visitInfo.numVisits < 12) {\n            userType = USER_PROFILE_OCCAISONAL_USER\n            userTypeDesc = \"occasional\"\n        } else if (visitInfo.currentVisit - visitInfo.firstVisit > 1000*60*60*24*30\n            && visitInfo.currentVisit - visitInfo.lastVisit < 1000*60*60*24*7) {\n            // power user classified if :\n            // 1. has more than 10 visits total\n            // 2. first visited more than a month ago \n            // 3. last visited within the past week\n            userType = USER_PROFILE_POWER_USER\n            userTypeDesc = \"power\"\n        } else {\n            userType = USER_PROFILE_FREQUENT_USER\n            userTypeDesc = \"frequent\"\n        }\n        this.userProfile = {\n            userType:userType,\n            userTypeDesc:userTypeDesc,\n            numVisits:visitInfo.numVisits\n        }\n        return this.userProfile\n    }\n}\nexport const USER_PROFILE_FIRST_TIME_USER = 1\nexport const USER_PROFILE_NEW_USER = 2\nexport const USER_PROFILE_OCCAISONAL_USER = 3\nexport const USER_PROFILE_FREQUENT_USER = 4\nexport const USER_PROFILE_POWER_USER = 5\n\nexport default new UserProfile();","/**\n * Winning Chances Calculation\n * Based on Lichess's implementation: https://github.com/lichess-org/lila/pull/11148\n * \n * Converts centipawn and mate scores to winning chances percentage\n */\n\nconst MULTIPLIER = -0.00368208;\n\n/**\n * Calculate raw winning chances from centipawn score\n * @param {number} cp - Centipawn score\n * @returns {number} Winning chances from -1 to 1\n */\nconst rawWinningChances = (cp) => {\n  return 2 / (1 + Math.exp(MULTIPLIER * cp)) - 1;\n};\n\n/**\n * Calculate winning chances from centipawn score (clamped)\n * @param {number} cp - Centipawn score\n * @returns {number} Winning chances from -1 to 1\n */\nexport const cpWinningChances = (cp) => {\n  return rawWinningChances(Math.min(Math.max(-1000, cp), 1000));\n};\n\n/**\n * Calculate winning chances from mate score\n * @param {number} mate - Mate in N moves (positive for white, negative for black)\n * @returns {number} Winning chances from -1 to 1\n */\nexport const mateWinningChances = (mate) => {\n  const cp = (21 - Math.min(10, Math.abs(mate))) * 100;\n  const signed = cp * (mate > 0 ? 1 : -1);\n  return rawWinningChances(signed);\n};\n\n/**\n * Calculate winning chances from an evaluation score\n * @param {Object} score - Score object with either cp or mate property\n * @returns {number} Winning chances from -1 to 1\n */\nexport const evalWinningChances = (score) => {\n  if (score.mate !== undefined) {\n    return mateWinningChances(score.mate);\n  }\n  return cpWinningChances(score.cp || 0);\n};\n\n/**\n * Calculate winning chances for a specific color\n * @param {string} color - 'white' or 'black'\n * @param {Object} score - Score object with either cp or mate property\n * @returns {number} Winning chances from -1 to 1 (positive = winning for that color)\n */\nexport const povChances = (color, score) => {\n  const chances = evalWinningChances(score);\n  return color === 'white' ? chances : -chances;\n};\n\n/**\n * Convert winning chances to percentage for display\n * @param {number} chances - Winning chances from -1 to 1\n * @returns {number} Percentage from 0 to 100\n */\nexport const chancesToPercent = (chances) => {\n  return Math.round((chances + 1) * 50);\n};\n\n/**\n * Format centipawn score for display\n * @param {number} cp - Centipawn score\n * @returns {string} Formatted score (e.g., \"+1.5\", \"-0.3\")\n */\nexport const formatCp = (cp) => {\n  const value = Math.max(Math.min(Math.round(cp / 10) / 10, 99), -99);\n  return (value > 0 ? '+' : '') + value.toFixed(1);\n};\n\n/**\n * Format evaluation score for display\n * @param {Object} score - Score object with either cp or mate property\n * @returns {string} Formatted score (e.g., \"+1.5\", \"M3\", \"-M5\")\n */\nexport const formatScore = (score) => {\n  if (score.mate !== undefined) {\n    const prefix = score.mate > 0 ? '' : '-';\n    return prefix + 'M' + Math.abs(score.mate);\n  }\n  return formatCp(score.cp || 0);\n};\n\n/**\n * Get evaluation bar height percentage for white\n * @param {Object} score - Score object with either cp or mate property\n * @returns {number} Percentage from 0 to 100 (100 = white winning)\n */\nexport const getEvalBarPercent = (score) => {\n  const chances = evalWinningChances(score);\n  return chancesToPercent(chances);\n};\n\nexport default {\n  cpWinningChances,\n  mateWinningChances,\n  evalWinningChances,\n  povChances,\n  chancesToPercent,\n  formatCp,\n  formatScore,\n  getEvalBarPercent\n};\n","import React from 'react';\nimport { formatScore, getEvalBarPercent } from '../../app/stockfish/winningChances';\nimport './EvalBar.css';\n\n/**\n * EvalBar Component\n * Displays a vertical evaluation bar similar to Lichess's analysis board\n * \n * The bar visually flips when the board orientation changes:\n * - White orientation: White at bottom, Black at top\n * - Black orientation: Black at bottom, White at top\n * \n * However, the score ALWAYS remains from White's perspective:\n * - Positive scores (+0.5) = White is better\n * - Negative scores (-0.5) = Black is better\n * \n * @param {Object} props\n * @param {Object} props.score - Score object with cp or mate property (always from White's perspective)\n * @param {string} props.orientation - 'white' or 'black' (board orientation)\n * @param {number} props.depth - Current search depth\n * @param {boolean} props.isAnalyzing - Whether engine is currently analyzing\n * @param {number} props.height - Height of the eval bar in pixels\n */\nconst EvalBar = ({ \n  score, \n  orientation = 'white', \n  depth = 0, \n  isAnalyzing = false,\n  height = 400 \n}) => {\n  // Calculate the percentage for white (score is always from White's perspective)\n  // whitePercent > 50 means White is winning, < 50 means Black is winning\n  const whitePercent = score ? getEvalBarPercent(score) : 50;\n  const blackPercent = 100 - whitePercent;\n  \n  // Format the score for display (always from White's perspective)\n  const scoreText = score ? formatScore(score) : '0.0';\n  \n  // Determine which color is winning based on the score\n  const isWhiteWinning = whitePercent > 50;\n  const isBlackWinning = whitePercent < 50;\n  const isEqual = whitePercent === 50;\n  \n  // When board is flipped (black orientation), the bar should visually flip\n  const isFlipped = orientation === 'black';\n  \n  // Determine where to show the score text (on the winning side)\n  const showScoreOnWhite = isWhiteWinning || isEqual;\n  const showScoreOnBlack = isBlackWinning;\n  \n  // Build the bar sections - order determines visual position (first = top)\n  // When NOT flipped (white orientation): Black on top, White on bottom\n  // When flipped (black orientation): White on top, Black on bottom\n  const topSection = isFlipped ? (\n    <div \n      className=\"eval-bar-section eval-bar-section-white\"\n      style={{ height: `${whitePercent}%` }}\n    >\n      {showScoreOnWhite && (\n        <span className=\"eval-bar-score eval-bar-score-white\">\n          {scoreText}\n        </span>\n      )}\n    </div>\n  ) : (\n    <div \n      className=\"eval-bar-section eval-bar-section-black\"\n      style={{ height: `${blackPercent}%` }}\n    >\n      {showScoreOnBlack && (\n        <span className=\"eval-bar-score eval-bar-score-black\">\n          {scoreText}\n        </span>\n      )}\n    </div>\n  );\n  \n  const bottomSection = isFlipped ? (\n    <div \n      className=\"eval-bar-section eval-bar-section-black\"\n      style={{ height: `${blackPercent}%` }}\n    >\n      {showScoreOnBlack && (\n        <span className=\"eval-bar-score eval-bar-score-black\">\n          {scoreText}\n        </span>\n      )}\n    </div>\n  ) : (\n    <div \n      className=\"eval-bar-section eval-bar-section-white\"\n      style={{ height: `${whitePercent}%` }}\n    >\n      {showScoreOnWhite && (\n        <span className=\"eval-bar-score eval-bar-score-white\">\n          {scoreText}\n        </span>\n      )}\n    </div>\n  );\n  \n  return (\n    <div \n      className={`eval-bar ${isAnalyzing ? 'analyzing' : ''} ${isFlipped ? 'flipped' : ''}`}\n      style={{ height: `${height}px` }}\n      title={`Evaluation: ${scoreText} (depth ${depth})`}\n    >\n      <div className=\"eval-bar-fill\">\n        {topSection}\n        {bottomSection}\n      </div>\n      \n      {/* Tick marks */}\n      <div className=\"eval-bar-ticks\">\n        <div className=\"eval-bar-tick\" style={{ top: '12.5%' }} />\n        <div className=\"eval-bar-tick\" style={{ top: '25%' }} />\n        <div className=\"eval-bar-tick eval-bar-tick-major\" style={{ top: '37.5%' }} />\n        <div className=\"eval-bar-tick eval-bar-tick-zero\" style={{ top: '50%' }} />\n        <div className=\"eval-bar-tick eval-bar-tick-major\" style={{ top: '62.5%' }} />\n        <div className=\"eval-bar-tick\" style={{ top: '75%' }} />\n        <div className=\"eval-bar-tick\" style={{ top: '87.5%' }} />\n      </div>\n      \n      {/* Analyzing indicator */}\n      {isAnalyzing && (\n        <div className=\"eval-bar-analyzing\">\n          <div className=\"eval-bar-analyzing-dot\" />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default EvalBar;\n","import React, { useMemo } from 'react';\nimport Chess from 'chess.js';\nimport { formatScore, povChances } from '../../app/stockfish/winningChances';\nimport './PvLines.css';\n\n/**\n * Convert a sequence of UCI moves to SAN notation\n * @param {Array} uciMoves - Array of UCI moves (e.g., [\"e2e4\", \"e7e5\"])\n * @param {string} fen - Starting FEN position\n * @returns {Array} Array of SAN moves\n */\nconst convertPvToSan = (uciMoves, fen) => {\n  if (!uciMoves || uciMoves.length === 0) {\n    return [];\n  }\n  \n  // If no FEN provided, return UCI moves as-is\n  if (!fen) {\n    return uciMoves.map(uci => uci || '');\n  }\n  \n  const sanMoves = [];\n  \n  try {\n    // Create a new chess instance with the current position\n    const tempChess = new Chess(fen);\n    \n    for (let i = 0; i < uciMoves.length; i++) {\n      const uci = uciMoves[i];\n      \n      if (!uci || uci.length < 4) {\n        // Invalid move, stop here\n        break;\n      }\n      \n      try {\n        const from = uci.substring(0, 2);\n        const to = uci.substring(2, 4);\n        const promotion = uci.length > 4 ? uci[4] : undefined;\n        \n        const move = tempChess.move({\n          from: from,\n          to: to,\n          promotion: promotion\n        });\n        \n        if (move) {\n          sanMoves.push(move.san);\n        } else {\n          // Move failed, stop converting\n          console.warn(`Failed to convert move ${uci} at position ${tempChess.fen()}`);\n          break;\n        }\n      } catch (e) {\n        // If conversion fails, stop here\n        console.warn(`Error converting move ${uci}:`, e.message);\n        break;\n      }\n    }\n    \n    return sanMoves;\n  } catch (e) {\n    // If chess.js fails to initialize, return empty array\n    console.warn('Error initializing chess.js:', e.message);\n    return [];\n  }\n};\n\n/**\n * PvLine Component - Single principal variation line\n */\nconst PvLine = ({ \n  pvData, \n  index, \n  turnColor, \n  onMoveClick, \n  onMoveHover,\n  fen,\n  isHighlighted \n}) => {\n  const { score, pv, depth } = pvData;\n  const scoreText = formatScore(score);\n  \n  // Determine if this is a good or bad line based on turn color\n  const chances = povChances(turnColor, score);\n  const isGood = chances > 0.1;\n  const isBad = chances < -0.1;\n  \n  // Convert UCI moves to SAN notation - use the FEN from pvData if available, otherwise use prop\n  const effectiveFen = pvData.fen || fen;\n  \n  const displayMoves = useMemo(() => {\n    const uciMoves = pv.slice(0, 12);\n    const sanMoves = convertPvToSan(uciMoves, effectiveFen);\n    \n    // If conversion failed or returned fewer moves, pad with UCI notation\n    if (sanMoves.length < uciMoves.length) {\n      // Return what we have - don't mix SAN and UCI\n      return sanMoves.length > 0 ? sanMoves : uciMoves;\n    }\n    \n    return sanMoves;\n  }, [pv, effectiveFen]);\n  \n  return (\n    <div \n      className={`pv-line ${isHighlighted ? 'highlighted' : ''} ${isGood ? 'good' : ''} ${isBad ? 'bad' : ''}`}\n      onMouseEnter={() => onMoveHover && onMoveHover(pv[0])}\n      onMouseLeave={() => onMoveHover && onMoveHover(null)}\n    >\n      <div className=\"pv-line-rank\">\n        {index + 1}\n      </div>\n      <div \n        className={`pv-line-score ${score.mate !== undefined ? 'mate' : ''}`}\n        title={`Depth: ${depth}`}\n      >\n        {scoreText}\n      </div>\n      <div className=\"pv-line-moves\">\n        {displayMoves.map((move, i) => (\n          <span \n            key={i}\n            className={`pv-move ${i === 0 ? 'best-move' : ''}`}\n            onClick={() => onMoveClick && onMoveClick(pv.slice(0, i + 1))}\n            title={`Click to play ${move}`}\n          >\n            {move}\n          </span>\n        ))}\n        {pv.length > 12 && <span className=\"pv-more\">...</span>}\n      </div>\n    </div>\n  );\n};\n\n/**\n * PvLines Component\n * Displays multiple principal variation lines from engine analysis\n * \n * @param {Object} props\n * @param {Array} props.pvLines - Array of PV line data\n * @param {string} props.turnColor - 'white' or 'black'\n * @param {number} props.depth - Current search depth\n * @param {boolean} props.isAnalyzing - Whether engine is analyzing\n * @param {Function} props.onMoveClick - Callback when a move is clicked\n * @param {Function} props.onMoveHover - Callback when hovering over a move\n * @param {string} props.fen - Current FEN position for move conversion\n */\nconst PvLines = ({ \n  pvLines = [], \n  turnColor = 'white',\n  depth = 0,\n  isAnalyzing = false,\n  onMoveClick,\n  onMoveHover,\n  fen,\n  highlightedMove\n}) => {\n  if (!pvLines || pvLines.length === 0) {\n    return (\n      <div className=\"pv-lines empty\">\n        <div className=\"pv-lines-placeholder\">\n          {isAnalyzing ? (\n            <>\n              <span className=\"analyzing-spinner\" />\n              <span>Analyzing position...</span>\n            </>\n          ) : (\n            <span>Enable analysis to see engine suggestions</span>\n          )}\n        </div>\n      </div>\n    );\n  }\n  \n  return (\n    <div className=\"pv-lines\">\n      <div className=\"pv-lines-header\">\n        <span className=\"pv-lines-title\">Engine Analysis</span>\n        <span className=\"pv-lines-depth\">\n          Depth: {depth}\n          {isAnalyzing && <span className=\"analyzing-dot\" />}\n        </span>\n      </div>\n      <div className=\"pv-lines-list\">\n        {pvLines.map((pvData, index) => (\n          <PvLine\n            key={index}\n            pvData={pvData}\n            index={index}\n            turnColor={turnColor}\n            onMoveClick={onMoveClick}\n            onMoveHover={onMoveHover}\n            fen={fen}\n            isHighlighted={highlightedMove === pvData.pv[0]}\n          />\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default PvLines;\n","/**\n * StockfishEngine - A wrapper for the Stockfish chess engine\n * Provides UCI protocol communication and evaluation parsing\n * Based on Lichess's ceval implementation\n */\n\nexport class StockfishEngine {\n  constructor(options = {}) {\n    this.worker = null;\n    this.isReady = false;\n    this.isSearching = false;\n    this.onEvaluation = options.onEvaluation || (() => {});\n    this.onBestMove = options.onBestMove || (() => {});\n    this.onReady = options.onReady || (() => {});\n    this.onError = options.onError || (() => {});\n    \n    this.currentEval = null;\n    this.multiPv = options.multiPv || 3;\n    this.depth = options.depth || 20;\n    this.currentFen = null;\n    this.isWhiteTurn = true; // Track whose turn it is\n    \n    // PV lines storage\n    this.pvLines = [];\n    \n    // UCI initialization state\n    this.uciOk = false;\n    \n    // Error recovery\n    this.restartCount = 0;\n    this.maxRestarts = 3;\n    this.lastError = null;\n    \n    this.init();\n  }\n\n  init() {\n    try {\n      // The stockfish.js file from nmrugg/stockfish.js is designed to be used directly as a worker\n      // It expects the WASM file to be in the same directory with the same name (but .wasm extension)\n      // We need to pass the WASM location via URL hash\n      const wasmPath = window.location.origin + '/stockfish/stockfish.wasm';\n      const workerUrl = window.location.origin + '/stockfish/stockfish.js#' + wasmPath;\n      \n      this.worker = new Worker(workerUrl);\n      \n      this.worker.onmessage = (e) => {\n        this.handleMessage(e.data);\n      };\n      \n      this.worker.onerror = (e) => {\n        console.error('Stockfish worker error:', e);\n        this.handleWorkerError(e.message || 'Worker error');\n      };\n      \n      // Send UCI command to initialize\n      setTimeout(() => {\n        this.send('uci');\n      }, 100);\n      \n    } catch (err) {\n      console.error('Failed to create Stockfish worker:', err);\n      this.handleWorkerError(err.message);\n    }\n  }\n\n  /**\n   * Handle worker errors with automatic restart capability\n   */\n  handleWorkerError(errorMessage) {\n    this.lastError = errorMessage;\n    this.isSearching = false;\n    \n    // Check if this is a recoverable error (like index out of bounds)\n    const isRecoverable = \n      errorMessage.includes('index out of bounds') ||\n      errorMessage.includes('RuntimeError') ||\n      errorMessage.includes('memory');\n    \n    if (isRecoverable && this.restartCount < this.maxRestarts) {\n      console.log(`Stockfish error (attempt ${this.restartCount + 1}/${this.maxRestarts}), restarting...`);\n      this.restartCount++;\n      \n      // Destroy current worker\n      if (this.worker) {\n        try {\n          this.worker.terminate();\n        } catch (e) {\n          // Ignore termination errors\n        }\n        this.worker = null;\n      }\n      \n      // Reset state\n      this.isReady = false;\n      this.uciOk = false;\n      \n      // Restart after a short delay\n      setTimeout(() => {\n        this.init();\n        \n        // Re-analyze current position after restart\n        if (this.currentFen && this.isReady) {\n          setTimeout(() => {\n            this.analyze(this.currentFen, { depth: this.depth, multiPv: this.multiPv });\n          }, 500);\n        }\n      }, 1000);\n    } else {\n      // Non-recoverable error or max restarts reached\n      this.onError(errorMessage);\n    }\n  }\n\n  handleMessage(line) {\n    if (typeof line !== 'string') return;\n    \n    // Reset restart count on successful communication\n    if (this.restartCount > 0 && (line === 'readyok' || line.startsWith('info '))) {\n      this.restartCount = 0;\n    }\n    \n    // Parse UCI responses\n    if (line === 'uciok') {\n      this.uciOk = true;\n      // Set options\n      this.send('setoption name MultiPV value ' + this.multiPv);\n      this.send('setoption name UCI_AnalyseMode value true');\n      // Use smaller hash for stability\n      this.send('setoption name Hash value 16');\n      this.send('isready');\n    } else if (line === 'readyok') {\n      this.isReady = true;\n      this.onReady();\n    } else if (line.startsWith('info ')) {\n      try {\n        this.parseInfo(line);\n      } catch (e) {\n        console.warn('Error parsing info line:', e);\n        // Don't propagate parsing errors\n      }\n    } else if (line.startsWith('bestmove ')) {\n      try {\n        this.parseBestMove(line);\n      } catch (e) {\n        console.warn('Error parsing bestmove:', e);\n        this.isSearching = false;\n      }\n    }\n  }\n\n  /**\n   * Normalize score to always be from White's perspective\n   * Stockfish reports scores from the side to move's perspective\n   * @param {Object} score - Score object with cp or mate property\n   * @returns {Object} Normalized score from White's perspective\n   */\n  normalizeScore(score) {\n    if (this.isWhiteTurn) {\n      // White to move - score is already from White's perspective\n      return score;\n    } else {\n      // Black to move - negate the score to get White's perspective\n      if (score.mate !== undefined) {\n        return { mate: -score.mate };\n      } else {\n        return { cp: -(score.cp || 0) };\n      }\n    }\n  }\n\n  parseInfo(line) {\n    // Parse UCI info line\n    const parts = line.split(' ');\n    let depth = 0;\n    let seldepth = 0;\n    let multiPv = 1;\n    let score = null;\n    let scoreType = 'cp';\n    let pv = [];\n    let nodes = 0;\n    let nps = 0;\n    let time = 0;\n    \n    for (let i = 1; i < parts.length; i++) {\n      switch (parts[i]) {\n        case 'depth':\n          depth = parseInt(parts[++i], 10) || 0;\n          break;\n        case 'seldepth':\n          seldepth = parseInt(parts[++i], 10) || 0;\n          break;\n        case 'multipv':\n          multiPv = parseInt(parts[++i], 10) || 1;\n          break;\n        case 'score':\n          scoreType = parts[++i];\n          score = parseInt(parts[++i], 10) || 0;\n          break;\n        case 'nodes':\n          nodes = parseInt(parts[++i], 10) || 0;\n          break;\n        case 'nps':\n          nps = parseInt(parts[++i], 10) || 0;\n          break;\n        case 'time':\n          time = parseInt(parts[++i], 10) || 0;\n          break;\n        case 'pv':\n          pv = parts.slice(i + 1).filter(m => m && m.length >= 4);\n          i = parts.length;\n          break;\n        default:\n          break;\n      }\n    }\n    \n    // Only process if we have meaningful data\n    if (depth > 0 && pv.length > 0) {\n      // Create raw score object\n      const rawScore = scoreType === 'mate' ? { mate: score } : { cp: score };\n      \n      // Normalize score to White's perspective\n      const normalizedScore = this.normalizeScore(rawScore);\n      \n      const evalData = {\n        depth,\n        seldepth,\n        multiPv,\n        score: normalizedScore,\n        pv,\n        nodes,\n        nps,\n        time,\n        fen: this.currentFen\n      };\n      \n      // Store PV line (ensure array is large enough)\n      while (this.pvLines.length < multiPv) {\n        this.pvLines.push(null);\n      }\n      this.pvLines[multiPv - 1] = evalData;\n      \n      // Emit evaluation update\n      this.onEvaluation({\n        depth,\n        pvLines: [...this.pvLines].filter(Boolean),\n        fen: this.currentFen\n      });\n    }\n  }\n\n  parseBestMove(line) {\n    const parts = line.split(' ');\n    const bestMove = parts[1];\n    let ponder = null;\n    \n    if (parts[2] === 'ponder') {\n      ponder = parts[3];\n    }\n    \n    this.isSearching = false;\n    this.onBestMove({\n      bestMove,\n      ponder,\n      pvLines: [...this.pvLines].filter(Boolean),\n      fen: this.currentFen\n    });\n  }\n\n  send(cmd) {\n    if (this.worker) {\n      try {\n        this.worker.postMessage(cmd);\n      } catch (e) {\n        console.warn('Error sending command to Stockfish:', e);\n        this.handleWorkerError(e.message);\n      }\n    }\n  }\n\n  /**\n   * Determine whose turn it is from a FEN string\n   * @param {string} fen - FEN string\n   * @returns {boolean} True if it's White's turn\n   */\n  isWhiteToMove(fen) {\n    const parts = fen.split(' ');\n    return parts.length < 2 || parts[1] === 'w';\n  }\n\n  /**\n   * Start analysis of a position\n   * @param {string} fen - FEN string of the position\n   * @param {Object} options - Analysis options\n   */\n  analyze(fen, options = {}) {\n    if (!this.isReady) {\n      console.warn('Stockfish not ready yet');\n      return;\n    }\n    \n    // Stop any current search\n    if (this.isSearching) {\n      this.stop();\n    }\n    \n    this.currentFen = fen;\n    this.isWhiteTurn = this.isWhiteToMove(fen);\n    this.pvLines = [];\n    \n    // Update MultiPV if changed\n    const multiPv = options.multiPv || this.multiPv;\n    if (multiPv !== this.multiPv) {\n      this.multiPv = multiPv;\n      this.send('setoption name MultiPV value ' + this.multiPv);\n    }\n    \n    // Clear hash to prevent memory issues\n    this.send('ucinewgame');\n    \n    // Wait for ready before setting position\n    this.send('isready');\n    \n    // Set position\n    this.send('position fen ' + fen);\n    \n    // Start search\n    const depth = options.depth || this.depth;\n    const movetime = options.movetime;\n    \n    this.isSearching = true;\n    \n    if (movetime) {\n      this.send('go movetime ' + movetime);\n    } else {\n      this.send('go depth ' + depth);\n    }\n  }\n\n  /**\n   * Stop current analysis\n   */\n  stop() {\n    if (this.isSearching) {\n      this.send('stop');\n      this.isSearching = false;\n    }\n  }\n\n  /**\n   * Set the number of principal variations to calculate\n   * @param {number} multiPv - Number of PV lines (1-5)\n   */\n  setMultiPv(multiPv) {\n    this.multiPv = Math.max(1, Math.min(5, multiPv));\n    if (this.isReady) {\n      this.send('setoption name MultiPV value ' + this.multiPv);\n    }\n  }\n\n  /**\n   * Destroy the engine and release resources\n   */\n  destroy() {\n    this.stop();\n    if (this.worker) {\n      this.send('quit');\n      try {\n        this.worker.terminate();\n      } catch (e) {\n        // Ignore termination errors\n      }\n      this.worker = null;\n    }\n    this.isReady = false;\n  }\n}\n\nexport default StockfishEngine;\n","import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { StockfishEngine } from '../../app/stockfish/StockfishEngine';\nimport PvLines from './PvLines';\nimport './EngineAnalysis.css';\n\n/**\n * EngineControls Component - Just the toggle and controls\n */\nexport const EngineControls = ({\n  enabled,\n  isReady,\n  multiPv,\n  depth,\n  isAnalyzing,\n  targetDepth,\n  onToggle,\n  onMultiPvChange,\n  onGoDeeper,\n  error,\n  onDismissError\n}) => {\n  return (\n    <div className=\"engine-controls\">\n      <label className=\"engine-toggle\">\n        <input\n          type=\"checkbox\"\n          checked={enabled}\n          onChange={onToggle}\n          disabled={!isReady}\n        />\n        <span className=\"toggle-slider\" />\n        <span className=\"toggle-label\">\n          {isReady ? 'Engine' : 'Loading...'}\n        </span>\n      </label>\n      \n      {enabled && isReady && (\n        <>\n          <select\n            className=\"engine-multipv\"\n            value={multiPv}\n            onChange={(e) => onMultiPvChange(parseInt(e.target.value, 10))}\n            title=\"Number of lines to show\"\n          >\n            <option value={1}>1 line</option>\n            <option value={2}>2 lines</option>\n            <option value={3}>3 lines</option>\n            <option value={5}>5 lines</option>\n          </select>\n          \n          <button\n            className=\"engine-deeper\"\n            onClick={onGoDeeper}\n            disabled={isAnalyzing || targetDepth >= 40}\n            title=\"Analyze deeper\"\n          >\n            Go deeper\n          </button>\n          \n          <span className=\"engine-depth\">\n            Depth: {depth}\n          </span>\n        </>\n      )}\n      \n      {/* Error display */}\n      {error && (\n        <div className=\"engine-error\">\n          <span>Engine error: {error}</span>\n          <button onClick={onDismissError}></button>\n        </div>\n      )}\n    </div>\n  );\n};\n\n/**\n * EnginePvDisplay Component - Just the PV lines display\n */\nexport const EnginePvDisplay = ({\n  enabled,\n  pvLines,\n  turnColor,\n  depth,\n  isAnalyzing,\n  onMoveClick,\n  onMoveHover,\n  fen,\n  highlightedMove\n}) => {\n  if (!enabled) return null;\n  \n  return (\n    <div className=\"engine-pv-display\">\n      <PvLines\n        pvLines={pvLines}\n        turnColor={turnColor}\n        depth={depth}\n        isAnalyzing={isAnalyzing}\n        onMoveClick={onMoveClick}\n        onMoveHover={onMoveHover}\n        fen={fen}\n        highlightedMove={highlightedMove}\n      />\n    </div>\n  );\n};\n\n/**\n * EngineAnalysis Component\n * Main component that integrates Stockfish engine with evaluation display\n * Now provides separate components for controls and PV display\n * \n * @param {Object} props\n * @param {string} props.fen - Current position FEN\n * @param {string} props.orientation - Board orientation ('white' or 'black')\n * @param {string} props.turnColor - Whose turn it is ('white' or 'black')\n * @param {Function} props.onMove - Callback when a move is clicked in PV lines\n * @param {Function} props.onHighlightMove - Callback to highlight a move on the board\n * @param {Function} props.onStateChange - Callback for engine state changes (enabled, evaluation, depth, analyzing)\n * @param {Object} props.chess - chess.js instance for move conversion\n * @param {number} props.boardHeight - Height of the chessboard for eval bar sizing\n * @param {boolean} props.showPvLines - Whether to show PV lines in this component (default: false, for separate display)\n */\nconst EngineAnalysis = ({\n  fen,\n  orientation = 'white',\n  turnColor = 'white',\n  onMove,\n  onHighlightMove,\n  onStateChange,\n  chess,\n  boardHeight = 400,\n  showPvLines = false\n}) => {\n  const [engine, setEngine] = useState(null);\n  const [isReady, setIsReady] = useState(false);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [enabled, setEnabled] = useState(false);\n  const [evaluation, setEvaluation] = useState(null);\n  const [pvLines, setPvLines] = useState([]);\n  const [depth, setDepth] = useState(0);\n  const [error, setError] = useState(null);\n  const [highlightedMove, setHighlightedMove] = useState(null);\n  const [multiPv, setMultiPv] = useState(3);\n  const [targetDepth, setTargetDepth] = useState(20);\n  \n  const lastFenRef = useRef(null);\n  \n  // Notify parent of state changes including pvLines and fen\n  useEffect(() => {\n    if (onStateChange) {\n      onStateChange({\n        enabled,\n        evaluation,\n        depth,\n        analyzing: isAnalyzing,\n        pvLines,\n        fen: lastFenRef.current || fen,\n        multiPv,\n        targetDepth,\n        isReady,\n        error,\n        highlightedMove\n      });\n    }\n  }, [enabled, evaluation, depth, isAnalyzing, pvLines, fen, multiPv, targetDepth, isReady, error, highlightedMove, onStateChange]);\n  \n  // Initialize engine\n  useEffect(() => {\n    const sf = new StockfishEngine({\n      multiPv: multiPv,\n      depth: targetDepth,\n      onReady: () => {\n        console.log('Stockfish engine ready');\n        setIsReady(true);\n        setError(null);\n      },\n      onEvaluation: (evalData) => {\n        setDepth(evalData.depth);\n        setPvLines(evalData.pvLines);\n        \n        // Set main evaluation from first PV line\n        if (evalData.pvLines.length > 0) {\n          setEvaluation(evalData.pvLines[0].score);\n        }\n      },\n      onBestMove: (data) => {\n        setIsAnalyzing(false);\n        setPvLines(data.pvLines);\n      },\n      onError: (msg) => {\n        console.error('Stockfish error:', msg);\n        setError(msg);\n        setIsAnalyzing(false);\n      }\n    });\n    \n    setEngine(sf);\n    \n    return () => {\n      sf.destroy();\n    };\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  \n  // Update multiPv when changed\n  useEffect(() => {\n    if (engine && isReady) {\n      engine.setMultiPv(multiPv);\n    }\n  }, [engine, isReady, multiPv]);\n  \n  // Analyze position when FEN changes\n  useEffect(() => {\n    if (!engine || !isReady || !enabled || !fen) return;\n    \n    // Don't re-analyze the same position\n    if (fen === lastFenRef.current) return;\n    lastFenRef.current = fen;\n    \n    // Reset state for new position\n    setEvaluation(null);\n    setPvLines([]);\n    setDepth(0);\n    setIsAnalyzing(true);\n    \n    // Start analysis\n    engine.analyze(fen, {\n      depth: targetDepth,\n      multiPv: multiPv\n    });\n  }, [engine, isReady, enabled, fen, targetDepth, multiPv]);\n  \n  // Stop analysis when disabled\n  useEffect(() => {\n    if (!enabled && engine) {\n      engine.stop();\n      setIsAnalyzing(false);\n    }\n  }, [enabled, engine]);\n  \n  // Handle move click in PV lines\n  const handleMoveClick = useCallback((moves) => {\n    if (onMove && moves.length > 0) {\n      // Play the first move\n      const move = moves[0];\n      onMove({\n        from: move.substring(0, 2),\n        to: move.substring(2, 4),\n        promotion: move.length > 4 ? move[4] : undefined\n      });\n    }\n  }, [onMove]);\n  \n  // Handle move hover for board highlighting\n  const handleMoveHover = useCallback((uci) => {\n    setHighlightedMove(uci);\n    if (onHighlightMove) {\n      if (uci) {\n        onHighlightMove({\n          from: uci.substring(0, 2),\n          to: uci.substring(2, 4)\n        });\n      } else {\n        onHighlightMove(null);\n      }\n    }\n  }, [onHighlightMove]);\n  \n  // Toggle analysis\n  const toggleAnalysis = useCallback(() => {\n    setEnabled(prev => !prev);\n  }, []);\n  \n  // Go deeper\n  const goDeeper = useCallback(() => {\n    if (engine && isReady && fen) {\n      setTargetDepth(prev => Math.min(prev + 5, 40));\n      lastFenRef.current = null; // Force re-analysis\n    }\n  }, [engine, isReady, fen]);\n  \n  return (\n    <div className=\"engine-analysis\">\n      {/* Controls */}\n      <EngineControls\n        enabled={enabled}\n        isReady={isReady}\n        multiPv={multiPv}\n        depth={depth}\n        isAnalyzing={isAnalyzing}\n        targetDepth={targetDepth}\n        onToggle={toggleAnalysis}\n        onMultiPvChange={setMultiPv}\n        onGoDeeper={goDeeper}\n        error={error}\n        onDismissError={() => setError(null)}\n      />\n      \n      {/* PV Lines display - only if showPvLines is true */}\n      {showPvLines && enabled && (\n        <div className=\"engine-display\">\n          <div className=\"engine-pv-container\">\n            <PvLines\n              pvLines={pvLines}\n              turnColor={turnColor}\n              depth={depth}\n              isAnalyzing={isAnalyzing}\n              onMoveClick={handleMoveClick}\n              onMoveHover={handleMoveHover}\n              fen={fen}\n              highlightedMove={highlightedMove}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default EngineAnalysis;\n","export { default as EvalBar } from './EvalBar';\nexport { default as PvLines } from './PvLines';\nexport { default as EngineAnalysis, EngineControls, EnginePvDisplay } from './EngineAnalysis';\nexport { StockfishEngine } from '../../app/stockfish/StockfishEngine';\nexport * from '../../app/stockfish/winningChances';\n","import zlib from 'zlib'\nimport {Buffer} from 'buffer'\nimport { saveAs } from 'file-saver';\n\nexport function serializeOpeningTree(treeData, filename, callback) {\n    let chunkedArray = chunk(treeData)\n    let deflatedChunks = []\n    //push version number 1 for later backward compatibility\n    deflatedChunks.push(packControlWord(0x1))\n    deflatedChunks.push(packControlWord(chunkedArray.length))\n    let remainingChunks = chunkedArray.length\n    let hasError = false;\n    chunkedArray.forEach((chunk)=>{\n        zlib.deflate(\n            new Buffer(JSON.stringify(chunk)), \n            (error,data)=>{\n                remainingChunks--\n                if(error) {\n                    hasError = true\n                }\n                deflatedChunks.push(packControlWord(data.byteLength))\n                deflatedChunks.push(data)\n                if(remainingChunks<=0) {\n                    if(hasError) {\n                        callback(\"Could not save file\")\n                        return\n                    }\n                    saveAs(new Blob(deflatedChunks, {type: \"application/octet-stream\"}), filename)\n                    callback(null, `Saved opening tree to file ${filename}`)\n                }\n            });\n        })\n}\n\nexport function deserializeOpeningTree(file, callback) {\n    let reader = new FileReader()\n    reader.onload = function(evt) {\n        let data = evt.target.result\n        let index = 0\n        let version = unpackControlWord(data.slice(index,index+8))\n        index = index + 8\n        if(version !== 0x1) {\n            callback(\"File is not an openingtree save file.\", null,\"Are you loading the correct file?\")\n            return\n        }\n        let numChunks = unpackControlWord(data.slice(index,index+8))\n        index = index + 8\n        if(!numChunks) {\n            callback(\"Input file not in correct format\", null)\n            return\n        }\n        getInflatedChunks(data, index, numChunks, callback)\n    };\n    reader.onerror = function(e) {\n        callback(\"Failed to read openingtree file\", null, `${e.target.error.name}:${e.target.error.message}`)\n    }\n    reader.readAsArrayBuffer(file)\n}\n\nfunction getInflatedChunks(data, startIndex, numChunks, callback) {\n    let index = startIndex\n    let deflatedChunks = []\n    let remainingChunks = numChunks\n    let hasError=false\n    let handleInflate = (error, data)=> {\n        remainingChunks--\n        if(error) {\n            console.log(error)\n            hasError=true\n        }\n        try {\n            deflatedChunks.push(JSON.parse(data))\n        } catch (e) {\n            console.log(e)\n            hasError=true\n        }\n        if(remainingChunks===0) {\n            if(hasError) {\n                callback(\"Input file seems corrupted\", null)\n            }\n            \n            callback(null, reconstructObjectFromChunks(deflatedChunks))\n        }\n        \n    }\n    while(numChunks>0) {\n        let chunkSize = unpackControlWord(data.slice(index,index+8))\n        index = index + 8\n        zlib.inflate(\n            Buffer.from(data,index,chunkSize), handleInflate)\n        index = index + chunkSize\n        numChunks--\n    }\n}\n\nfunction reconstructObjectFromChunks(deflatedChunks) {\n    let sortedChunks = deflatedChunks.sort((a,b)=>a.index-b.index)\n    let flattenedChunks = sortedChunks.slice(1).map(el=>el.chunk).flat()\n    let header = sortedChunks[0]\n    let arrays = []\n    let index = 0\n    let arraySizes = header.arraySizes || [flattenedChunks.length]\n    arraySizes.forEach((size)=>{\n        arrays.push(flattenedChunks.slice(index,index+size))\n        index+=size\n    })\n    return {\n        header:header.chunk,\n        arrays:arrays\n    }\n}\n\nfunction unpackControlWord(control) {\n    let view = new DataView(control)\n    if(view.getUint16(0)!==0x1337 || view.getUint16(6)!==0xC0D3) {\n        return null\n    }\n    return view.getUint32(2)\n}\n\nfunction packControlWord(control) {\n    var buffer = new ArrayBuffer(8); \n    var view = new DataView(buffer); \n    view.setUint16(0, 0x1337)\n    view.setUint32(2, control>>>0)\n    view.setUint16(6, 0xC0D3)\n    return buffer\n}\n\nfunction chunk(treeData) {\n    let chunk1 = {chunk:treeData.header, index:0, \n        arraySizes:treeData.arrays.map(arr=>arr.length)}\n    let chunks = [chunk1]\n    treeData.arrays.forEach((array)=>{\n        Array.prototype.push.apply(chunks, chunkArray(array, 1000, chunks.length));\n    })\n    return chunks\n}\n\nfunction chunkArray(array, chunkSize, startIndex) {\n    let chunkedArray=[]\n    \n    for (let i=0, chunkIndex=0; i<array.length; i+=chunkSize, chunkIndex++) {\n        chunkedArray.push({chunk:array.slice(i,i+chunkSize), index:startIndex+chunkIndex});\n    }\n    return chunkedArray\n}\n","import { withStyles } from '@material-ui/core/styles';\nimport MUIAccordion from '@material-ui/core/Accordion';\nimport React from 'react'\nimport { createSubObjectWithProperties } from '../../app/util'\nimport * as Constants from '../../app/Constants'\n\nexport const Accordion = withStyles({\n    root: {\n        border: '1px solid rgba(0, 0, 0, .125)',\n        boxShadow: 'none',\n        '&:not(:last-child)': {\n            borderBottom: 0,\n        },\n        '&:before': {\n            display: 'none',\n        },\n        '&$expanded': {\n            margin: 'auto',\n        },\n    },\n    expanded: {},\n})(MUIAccordion);\n\nexport function getNumberIcon(n) {\n    return <img alt={`step ${n}`} className = 'lowOpacity styledNumbers' src={`/images/styled-${n}.png`} height={24}/>\n}\n\nexport function advancedFilters(state) {\n    return createSubObjectWithProperties(state,\n        [Constants.TIME_CONTROL_ULTRA_BULLET, Constants.TIME_CONTROL_BULLET,\n        Constants.TIME_CONTROL_BLITZ, Constants.TIME_CONTROL_RAPID,\n        Constants.TIME_CONTROL_CORRESPONDENCE, Constants.TIME_CONTROL_DAILY,\n        Constants.TIME_CONTROL_CLASSICAL, Constants.FILTER_NAME_RATED,\n        Constants.FILTER_NAME_DOWNLOAD_LIMIT,\n        Constants.FILTER_NAME_ELO_RANGE, Constants.FILTER_NAME_OPPONENT,\n        Constants.FILTER_NAME_FROM_DATE, Constants.FILTER_NAME_TO_DATE])\n}\n\nexport function copyText(elementId) {\n    /* Get the text field */\n    var copyText = document.getElementById(elementId);\n    try {\n        /* Select the text field */\n        copyText.select();\n        copyText.setSelectionRange(0, 99999); /*For mobile devices*/\n\n        /* Copy the text inside the text field */\n        document.execCommand(\"copy\");\n        return true\n    } catch(e) {\n        return false\n    }\n}","import React from 'react'\nimport Chessground from 'react-chessground'\nimport 'react-chessground/dist/styles/chessground.css'\nimport { OAuth2AuthCodePKCE } from '@bity/oauth2-auth-code-pkce';\n\nimport {\n  Button,\n  Col,\n  Collapse,\n  Container,\n  Modal,\n  ModalBody,\n  ModalFooter,\n  ModalHeader,\n  Row\n} from 'reactstrap'\n\nimport {\n  Checkbox,\n  FormControlLabel,\n  Snackbar,\n  TextField\n} from '@material-ui/core'\n\nimport * as Constants from '../app/Constants'\nimport OpeningGraph from '../app/OpeningGraph'\nimport { chessLogic } from '../app/chess/ChessLogic'\nimport cookieManager from '../app/CookieManager'\nimport { handleDarkMode } from '../pres/DarkMode';\nimport UserProfile, { USER_PROFILE_NEW_USER } from '../app/UserProfile'\nimport {initializeAnalytics} from '../app/Analytics'\n\nimport Navigator from './Navigator'\nimport GlobalHeader from './GlobalHeader'\nimport ControlsContainer from './ControlsContainer'\nimport { addStateManagement } from './StateManagement'\nimport SnackbarContentWrapper from './SnackbarContentWrapper'\n\n// Import Stockfish components\nimport { EngineAnalysis, EvalBar, PvLines } from './stockfish'\n\nexport default class MainContainer extends React.Component {\n\n  constructor(props){\n    super(props)\n  \n    let urlVariant = new URLSearchParams(window.location.search).get(\"variant\")\n    let selectedVariant = urlVariant || Constants.VARIANT_STANDARD\n    this.chess = chessLogic(selectedVariant)\n    addStateManagement(this)\n    this.state = {\n        resize:0,\n        fen: this.chess.fen(),\n        lastMove: null,\n        gamesProcessed:0,\n        openingGraph:new OpeningGraph(selectedVariant),\n        settings:{\n          playerName:'',\n          orientation:Constants.PLAYER_COLOR_WHITE,\n          playerColor:'',\n          movesSettings:this.getMovesSettingsFromCookie(),\n          darkMode: this.getDarkModeSettingFromCookie()\n        },\n        message:'',\n        downloadingGames:false,\n        feedbackOpen:false,\n        diagnosticsDataOpen:false,\n        variant:selectedVariant,\n        update:0,//increase count to force update the component\n        highlightedMove:null,\n        engineHighlightedMove: null, // For engine move highlighting\n        engineEnabled: false,\n        engineEvaluation: null,\n        engineDepth: 0,\n        engineAnalyzing: false,\n        enginePvLines: [],\n        engineFen: null\n      }\n    this.chessboardWidth = this.getChessboardWidth()\n\n    this.initializeOauth()\n\n    this.forBrushes = ['blue','paleGrey', 'paleGreen', 'green']\n    this.againstBrushes = ['blue','paleRed', 'paleRed', 'red']\n    this.engineBrush = 'yellow' // Brush for engine suggested moves\n    window.addEventListener('resize', this.handleResize.bind(this))\n    let userProfile = UserProfile.getUserProfile()\n    initializeAnalytics(userProfile.userTypeDesc, this.state.settings.darkMode?\"dark\":\"light\", \n      this.state.settings.movesSettings.openingBookType)\n\n  }\n\n  initializeOauth() {\n    let clientUrl = (() => {\n      const url = new URL(window.location.href);\n      url.search = '';\n      return `${url.href}?source=lichess`;\n    })();\n    this.oauth = new OAuth2AuthCodePKCE({\n      authorizationUrl: `${Constants.LICHESS_HOST}/oauth`,\n      tokenUrl: `${Constants.LICHESS_HOST}/api/token`,\n      clientId: Constants.LICHESS_CLIENT_ID,\n      scopes: [],\n      redirectUrl: clientUrl,\n      onAccessTokenExpiry: refreshAccessToken => refreshAccessToken(),\n      onInvalidGrant: _retry => {},\n    })\n\n    this.oauth.isReturningFromAuthServer().then( (hasAuthCode) => {\n      if (hasAuthCode) {\n        return this.oauth.getAccessToken()\n      }\n      return \"\"\n    }).then( (accessToken)=> {\n      if(!accessToken) {\n        return\n      }\n      cookieManager.setLichessAccessToken(accessToken.token.value)\n      console.log(\"access token\", accessToken)\n      window.location.replace(clientUrl)      \n    }).catch((error) => {\n      console.log(\"error\", error)\n    })\n      \n    \n\n  }\n  handleResize() {\n    this.setState({resize:this.state.resize+1})\n    this.chessboardWidth = this.getChessboardWidth()\n  }\n\n  getMovesSettingsFromCookie() {\n    let { movesSettings } = cookieManager.getSettingsCookie() || {};\n\n    if (!movesSettings || !movesSettings.openingBookType) {\n      // default settings\n      movesSettings = {\n          openingBookType:Constants.OPENING_BOOK_TYPE_LICHESS,\n          openingBookRating:Constants.ALL_BOOK_RATINGS,\n          openingBookTimeControls: [\n            Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_BLITZ,\n            Constants.TIME_CONTROL_RAPID,\n            Constants.TIME_CONTROL_CLASSICAL,\n            Constants.TIME_CONTROL_CORRESPONDENCE,\n          ],\n          openingBookScoreIndicator:false,\n          openingBookWinsIndicator:UserProfile.getUserProfile().userType>USER_PROFILE_NEW_USER\n        }\n    }\n    return movesSettings;\n  }\n\n  getDarkModeSettingFromCookie () {\n    const darkModeCookie = cookieManager.getDarkModeCookie();\n    if(darkModeCookie === undefined){\n      return true// default value\n    }\n    return darkModeCookie === 'true';\n  }\n\n  // Handle engine move highlighting\n  handleEngineHighlight = (move) => {\n    this.setState({ engineHighlightedMove: move })\n  }\n\n  // Handle engine move click - play the move\n  handleEngineMove = (move) => {\n    if (move && move.from && move.to) {\n      this.onMove(move.from, move.to)\n    }\n  }\n\n  // Handle engine state updates\n  handleEngineStateChange = (state) => {\n    this.setState({\n      engineEnabled: state.enabled,\n      engineEvaluation: state.evaluation,\n      engineDepth: state.depth,\n      engineAnalyzing: state.analyzing,\n      enginePvLines: state.pvLines || [],\n      engineFen: state.fen || this.state.fen\n    })\n  }\n\n  // Handle PV line move click\n  handlePvMoveClick = (moves) => {\n    if (moves && moves.length > 0) {\n      const move = moves[0];\n      this.onMove(move.substring(0, 2), move.substring(2, 4));\n    }\n  }\n\n  // Handle PV line move hover\n  handlePvMoveHover = (uci) => {\n    if (uci) {\n      this.setState({\n        engineHighlightedMove: {\n          from: uci.substring(0, 2),\n          to: uci.substring(2, 4)\n        }\n      });\n    } else {\n      this.setState({ engineHighlightedMove: null });\n    }\n  }\n\n  // Get auto shapes including engine highlighted move\n  getAutoShapesWithEngine(playerMoves, highlightedMove, engineHighlightedMove) {\n    let shapes = this.autoShapes(playerMoves, highlightedMove)\n    \n    // Add engine highlighted move if present\n    if (engineHighlightedMove && engineHighlightedMove.from && engineHighlightedMove.to) {\n      shapes = shapes.filter(shape => \n        !(shape.orig === engineHighlightedMove.from && shape.dest === engineHighlightedMove.to)\n      )\n      shapes.unshift({\n        orig: engineHighlightedMove.from,\n        dest: engineHighlightedMove.to,\n        brush: this.engineBrush\n      })\n    }\n    \n    return shapes\n  }\n\n  render() {\n    let lastMoveArray = this.state.lastMove ? [this.state.lastMove.from, this.state.lastMove.to] : null\n    let snackBarOpen = Boolean(this.state.message)\n\n    let playerMoves = this.getPlayerMoves()\n    let bookMoves = this.getBookMoves()\n    this.mergePlayerAndBookMoves(playerMoves, bookMoves)\n\n    // Get board height as number for eval bar\n    const boardHeightNum = parseInt(this.chessboardWidth, 10) || 400\n\n    return <div className=\"rootView\">\n      <GlobalHeader settings={this.state.settings} \n                    settingsChange={this.settingsChange.bind(this)}\n                    toggleFeedback = {this.toggleFeedback(false)}/>\n      <Container className=\"mainContainer\">\n        <Row>\n          <Col lg={{order:0, size:2}} xs={{order:2}}>\n            <Navigator fen = {this.state.fen} move={this.state.lastMove}\n              onChange ={this.navigateTo.bind(this)}\n              variant = {this.state.variant} />\n          </Col>\n          <Col lg=\"6\">\n            {/* Engine Analysis Controls (toggle, multiPV, depth) */}\n            <EngineAnalysis\n              fen={this.state.fen}\n              orientation={this.orientation()}\n              turnColor={this.turnColor()}\n              onMove={this.handleEngineMove}\n              onHighlightMove={this.handleEngineHighlight}\n              onStateChange={this.handleEngineStateChange}\n              chess={this.chess}\n              boardHeight={boardHeightNum}\n              showPvLines={false}\n            />\n            \n            {/* Board with Eval Bar - Lichess style layout */}\n            <div className=\"board-eval-wrapper\" style={{ \n              display: 'flex', \n              alignItems: 'flex-start',\n              justifyContent: 'center',\n              gap: '4px'\n            }}>\n              {/* Evaluation Bar - positioned to the left of the board */}\n              {this.state.engineEnabled && (\n                <EvalBar\n                  score={this.state.engineEvaluation}\n                  orientation={this.orientation()}\n                  depth={this.state.engineDepth}\n                  isAnalyzing={this.state.engineAnalyzing}\n                  height={boardHeightNum}\n                />\n              )}\n              \n              {/* Chessboard */}\n              <div className=\"chessboard-container\">\n                <Chessground key={this.state.resize}\n                  height={this.chessboardWidth}\n                  width={this.chessboardWidth}\n                  orientation={this.orientation()}\n                  turnColor={this.turnColor()}\n                  movable={this.calcMovable()}\n                  lastMove={lastMoveArray}\n                  fen={this.state.fen}\n                  onMove={this.onMoveAction.bind(this)}\n                  drawable ={{\n                    enabled: true,\n                    visible: true,\n                    autoShapes: this.getAutoShapesWithEngine(\n                      playerMoves, \n                      this.state.highlightedMove,\n                      this.state.engineHighlightedMove\n                    )\n                  }}\n                />\n              </div>\n            </div>\n            \n            {/* PV Lines - below the board */}\n            {this.state.engineEnabled && (\n              <div className=\"engine-pv-below-board\" style={{ marginTop: '8px' }}>\n                <PvLines\n                  pvLines={this.state.enginePvLines}\n                  turnColor={this.turnColor()}\n                  depth={this.state.engineDepth}\n                  isAnalyzing={this.state.engineAnalyzing}\n                  onMoveClick={this.handlePvMoveClick}\n                  onMoveHover={this.handlePvMoveHover}\n                  fen={this.state.engineFen || this.state.fen}\n                  highlightedMove={this.state.engineHighlightedMove ? \n                    this.state.engineHighlightedMove.from + this.state.engineHighlightedMove.to : null}\n                />\n              </div>\n            )}\n          </Col>\n          <Col lg=\"4\" className=\"paddingTop\">\n            <ControlsContainer fen={this.state.fen}\n              resize ={this.state.resize}\n              gamesProcessed={this.state.gamesProcessed}\n              updateProcessedGames={this.updateProcessedGames.bind(this)}\n              settingsChange={this.settingsChange.bind(this)}\n              settings={this.state.settings}\n              reset={this.reset.bind(this)}\n              clear={this.clear.bind(this)}\n              playerMoves={playerMoves}\n              bookMoves={bookMoves}\n              gameResults={this.gameResults()}\n              onMove={this.onMove.bind(this)}\n              turnColor={this.turnColor()}\n              showError={this.showError.bind(this)}\n              showInfo={this.showInfo.bind(this)}\n              setDownloading={this.setDownloading.bind(this)}\n              isDownloading={this.state.downloadingGames}\n              openingGraph={this.state.openingGraph}\n              importCallback={this.importGameState.bind(this)}\n              variant={this.state.variant}\n              variantChange={this.variantChange.bind(this)}\n              forceFetchBookMoves={this.forceFetchBookMoves.bind(this)}\n              highlightArrow={this.highlightArrow.bind(this)}\n              oauthManager={this.oauth}\n            />\n          </Col>\n        </Row>\n      </Container>\n      <Snackbar anchorOrigin={{ vertical:'bottom', horizontal:\"left\" }}\n        open={snackBarOpen} autoHideDuration={6000}\n        onClose={this.closeError.bind(this)}\n      >\n        <SnackbarContentWrapper\n          onClose={this.closeError.bind(this)}\n          variant={this.state.messageSeverity}\n          message={this.state.message}\n          subMessage={this.state.subMessage}\n          showReportButton={this.state.messageSeverity==='error'}\n          action={this.state.errorAction}\n          actionText={this.state.errorActionText}\n        />\n      </Snackbar>\n\n      <Modal isOpen={this.state.feedbackOpen} toggle={this.toggleFeedback(false)}>\n        <ModalHeader toggle={this.toggleFeedback(false)}>\n          Feedback\n        </ModalHeader>\n        <ModalBody>\n          Your feedback is greatly appreciated. Reach out to me for feedback, suggestions, bug report or just a game of chess.\n          <ul>\n            <li>Email me: <a rel=\"noopener noreferrer\" href={this.getEmailLink()} target=\"_blank\">{Constants.OPENING_TREE_EMAIL}</a></li>\n            <li>Message me on reddit <a rel=\"noopener noreferrer\" href={this.getRedditLink()} target=\"_blank\">u/{Constants.OPENING_TREE_REDDIT}</a></li>\n            <li>Message me on lichess: <a rel=\"noopener noreferrer\" href={`https://lichess.org/inbox/${Constants.OPENING_TREE_LICHESS}`} target=\"_blank\">{Constants.OPENING_TREE_LICHESS}</a></li>\n            <li>Message me on chess.com: <a rel=\"noopener noreferrer\" href={`https://www.chess.com/messages/compose/${Constants.OPENING_TREE_CHESS_COM}`} target=\"_blank\">{Constants.OPENING_TREE_CHESS_COM}</a></li>\n            <li>Join my <a rel=\"noopener noreferrer\" href={Constants.OPENING_TREE_DISCORD}target=\"_blank\">discord server</a> to chat</li>\n          </ul>\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={this.state.diagnosticsDataOpen}\n                onChange={this.toggleDiagnosticsData}\n                name=\"diagnostics\"\n                color=\"primary\"\n              />}\n            label=\"Add diagnostics data to message\"\n          />\n          <Collapse isOpen={this.state.diagnosticsDataOpen}>\n            <TextField id=\"diagnosticsText\" label=\"Click to copy.\" variant=\"outlined\"\n            className=\"fullWidth\" value={this.getDiagnosticsValue()}\n            rowsMax={4} onClick={this.copyDiagnostics} multiline />\n          </Collapse>\n        </ModalBody>\n        <ModalFooter>\n          <Button color=\"secondary\" onClick={this.toggleFeedback(false)}>Done</Button>\n        </ModalFooter>\n      </Modal>\n    </div>\n  }\n\n  componentDidMount() {\n      handleDarkMode(this.state.settings.darkMode);\n      \n      // hack to fix https://github.com/openingtree/openingtree/issues/243\n      // refreshing the chessboard after its initial render seems to fix this issue\n      setImmediate(this.handleResize.bind(this))\n  }\n}\n","import React, { useState } from 'react';\nimport Faq from 'react-faq-component';\nimport {\n  Navbar,\n  NavbarBrand,\n  NavbarToggler,\n  Collapse,\n  Nav,\n  UncontrolledDropdown,\n  DropdownToggle,\n  DropdownMenu,\n  DropdownItem,\n  Modal,\n  ModalHeader,\n  ModalFooter,\n  Button,\n  ListGroup,\n  ListGroupItem,\n  NavItem, NavLink, ModalBody\n} from 'reactstrap';\n\nimport {logoName, rowContentColor} from './DarkMode';\n\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faLightbulb, faCaretDown, faQuestionCircle, faMoon } from '@fortawesome/free-solid-svg-icons';\nimport { faDiscord, faYoutube} from '@fortawesome/free-brands-svg-icons';\n\nimport * as Constants from '../app/Constants';\nimport {trackEvent} from '../app/Analytics';\n\nconst GlobalHeader = (props) => {\n  const darkMode = props.settings.darkMode\n  const [isOpen, setIsOpen] = useState(false)\n  const toggle = () => setIsOpen(!isOpen)\n\n  const [modal, setModal] = useState(false);\n  const toggleModal = () => {\n    if(!modal) {\n      trackEvent(Constants.EVENT_CATEGORY_GLOBAL_HEADER, \"AcknowledgementsOpen\")\n    }\n    setModal(!modal)\n  }\n  const toggleDarkMode = () => {\n    trackEvent(Constants.EVENT_CATEGORY_GLOBAL_HEADER, \"DarkModeToggle\")\n    props.settingsChange(Constants.SETTING_NAME_DARK_MODE, !darkMode)\n  }\n\n  const [isFAQOpen, setFAQOpen] = useState(false);\n  const toggleFAQModal = () => {\n    if(!isFAQOpen) {\n      trackEvent(Constants.EVENT_CATEGORY_GLOBAL_HEADER, \"FaqOpen\")\n    }\n    setFAQOpen(!isFAQOpen)\n  }\n\n  const launch = (url, eventName) => {\n    return () => {\n      if(eventName) {\n        trackEvent(Constants.EVENT_CATEGORY_GLOBAL_HEADER, eventName)\n      }\n      window.open(url, \"_blank\")\n    }\n  }\n\n  const getHelpDropDown = ()=>{\n    return <UncontrolledDropdown>\n    <DropdownToggle className=\"bootNavColor\" nav>\n    <FontAwesomeIcon icon={faQuestionCircle} className=\"moreIcon\"/>Help\n    </DropdownToggle>\n    <DropdownMenu right>\n      <DropdownItem onClick={toggleFAQModal}>\n        <span>\n          FAQ\n        </span>\n      </DropdownItem>\n      <DropdownItem onClick={props.toggleFeedback}>\n        <span>\n          Send feedback\n        </span>\n      </DropdownItem>\n      <DropdownItem onClick={launch(\"https://www.openingtree.com/old\", \"OldVersion\")}>\n          <span>\n            Old version\n          </span>\n        </DropdownItem>\n    </DropdownMenu>\n  </UncontrolledDropdown>\n  }\n\n  const getMoreDropDown = ()=> {\n      return <UncontrolledDropdown>\n      <DropdownToggle className=\"bootNavColor\" nav>\n      <FontAwesomeIcon icon={faCaretDown} className=\"moreIcon\"/>More\n      </DropdownToggle>\n      <DropdownMenu right>\n        <DropdownItem onClick={toggleModal}>\n          <span>\n            Acknowledgements\n          </span>\n        </DropdownItem>\n        <DropdownItem onClick={launch(\"https://github.com/openingtree/openingtree\",\"github\")}>\n          <span>\n            Github\n          </span>\n        </DropdownItem>\n        <DropdownItem divider />\n        <DropdownItem onClick={launch(\"https://lichess.org/\",\"lichess\")}>\n          <span>\n            Lichess.org\n          </span>\n        </DropdownItem>\n        <DropdownItem onClick={launch(\"https://www.lichess4545.com/\",\"lichess4545\")}>\n          <span>\n            Lichess4545\n          </span>\n        </DropdownItem>\n        <DropdownItem onClick={launch(\"https://www.chess.com\",\"chessDotCom\")}>\n          <span>\n            Chess.com\n          </span>\n        </DropdownItem>\n        <DropdownItem onClick={launch(\"https://www.youtube.com/channel/UCqGhULGgnf6IbY5JXWuVVtQ/live\",\"chilledChess\")}>\n          <span>\n            ChilledChess\n          </span>\n        </DropdownItem>\n      </DropdownMenu>\n    </UncontrolledDropdown>\n\n  }\n\n  const data = {\n    rows: [\n      {\n          title: \"What is OpeningTree.com?\",\n          content: `OpeningTree.com is an open source website that helps you analyze anyone's lichess or chess.com games. You can use it to prepare for your opponents, improve your own game or learn from openings that grandmasters play.`,\n      },\n      {\n        title: \"How do I use OpeningTree?\",\n        content: `To try it out, you can load Magnus Carlsen's games by choosing, lichess as the source, enter \"DrNykterstein\" in the user name, choose \"white\" and click \"Analyze games\". Hit the stop link when a few hundred games have loaded and click \"View moves\". You can see the moves that Carlsen played as white in his recent games and his win percentages there. You can dig deeper into various lines. The moves shown for black are the moves that were played by his opponents against him.`,\n      },\n      {\n        title: \"What are some of the advanced features of OpeningTree?\",\n        content: `You can analyze games of notable grandmasters from Morphy to Nakamura. You can also analyze games from lichess tournaments to see which moves are being played by others. You can also save openingtree files locally and load them fast or load them from pgn files.`,\n      },\n\n      {\n        title: \"Do I need to login to lichess?\",\n        content: `You dont need to, but logging in increases the speed of download of games from lichess. So if you plan on processing hundreds of games, it is recommended that you login.`,\n      },\n      {\n        title: \"Do I need to keep reloading games everytime I want to analyze the same player? OR What is a .tree file?\",\n        content: `If you plan to keep reloading the same player's games over and over again. The better option is to use the \"Save .tree file\" button after your games have loaded. This saves a pre-processed file of all the games on your local computer. You can then load the file using the \"Load .tree file\" option as the source and load the same file. It can load thousands of games in a matter of seconds.`,\n      },\n      {\n        title: \"Is there a way to filter games by time control, choose only recent games etc.?\",\n        content:`Yes. You can click on \"Advanced filters\" under the \"Color and filters\" panel of openingtree to see many different filtering options that are available.`,\n      },\n      {\n        title: \"What do the triangles under the bars indicate?\",\n        content: `Little triangles indicate the openingbook statistics on the moves tab and the player statistics on the openingbook tab.\n        Everything left of the white triangle is a win for white, everything right of the black triangle is a win for black and everything in the middle is a draw.\n        If there is only a black triangle and no white, it means there are no draws.`,\n      }\n    ]\n  };\n\n  const styles = {\n    // bgColor: 'white',\n    rowTitleColor: \"black\",\n    rowContentColor: rowContentColor(darkMode),\n    rowTitleTextSize:'small',\n    rowContentTextSize:'small',\n    rowContentPaddingTop:'1'\n    // arrowColor: \"red\",\n  };\n\n  const config = {\n    // animate: true,\n    // arrowIcon: \"V\",\n    // tabFocus: true\n  };\n\n  const getFAQModal = ()=> {\n    return <Modal isOpen={isFAQOpen} toggle={toggleFAQModal}>\n      <ModalHeader toggle={toggleFAQModal}>Frequently asked questions</ModalHeader>\n      <ModalBody>\n      <Faq data={data} styles={styles} config={config} />\n      </ModalBody>\n      <ModalFooter>\n        <Button color=\"secondary\" onClick={toggleFAQModal}>Done</Button>\n      </ModalFooter>\n    </Modal>\n  };\n\n  const getAcknowledgementsModal = ()=> {\n    return <Modal isOpen={modal} toggle={toggleModal}>\n      <ModalHeader toggle={toggleModal}>Acknowledgements</ModalHeader>\n      <ListGroup className=\"acknowledgement\">\n        <ListGroupItem tag=\"a\" href=\"https://lichess.org/api\" target=\"_blank\" action>Lichess API</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.chess.com/club/chess-com-developer-community\" target=\"_blank\" action>Chess.com API</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/ruilisi/react-chessground\" target=\"_blank\" action>ChessGround</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/jhlywa/chess.js\" target=\"_blank\" action>Chess.js</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/niklasf/eco\" target=\"_blank\" action>Eco</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/jimmywarting/StreamSaver.js\" target=\"_blank\" action>StreamSaver.js</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.flaticon.com/authors/google/\" target=\"_blank\" action>Icons made by google</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.flaticon.com/\" target=\"_blank\" action>FlatIcons.com</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.freelogodesign.org\" target=\"_blank\" action>Free logo design</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/kevinludwig/pgn-parser\" target=\"_blank\" action>PGN Parser</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.npmjs.com/package/material-ui-dropzone\" target=\"_blank\" action>Dropzone</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.pgnmentor.com\" target=\"_blank\" action>PGN Mentor</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.twitch.tv/imrosen\" target=\"_blank\" action>IM Eric Rosen</ListGroupItem>\n      </ListGroup>\n      <ModalFooter>\n        <Button color=\"secondary\" onClick={toggleModal}>\n          Done\n        </Button>\n      </ModalFooter>\n    </Modal>\n  }\n\n  return (\n    <div>\n      <Navbar color={darkMode?\"dark\":\"light\"} dark={darkMode} light={!darkMode} expand=\"md\">\n        <img src={logoName(darkMode)} height=\"32px\" width=\"32px\" alt=\"Logo\"/>\n        <NavbarBrand href=\"/\">&nbsp;OpeningTree.com</NavbarBrand>\n        <NavbarToggler onClick={toggle}/>\n        <Collapse isOpen={isOpen} navbar>\n          <Nav className={`mr-auto`} navbar>\n            <NavItem>\n              <NavLink className=\"navLinkButton\" onClick={launch(\"https://www.youtube.com/watch?v=AJ66-HqdpXE\",\"mainVideo\")}>\n                <span>\n                  \"It's so powerful\" - IM Eric Rosen\n                </span>\n                <span className=\"smallText\">\n                  [Video]\n                </span>\n              </NavLink>\n            </NavItem>\n          </Nav>\n          <Nav className=\"ml-auto\" navbar>\n            <NavItem>\n              <NavLink className=\"navLinkButton\" onClick={toggleDarkMode}>\n                <FontAwesomeIcon icon={darkMode?faLightbulb:faMoon} className=\"largeHeaderIcon\"/>\n                <span>\n                  {darkMode?\"Light mode\":\"Dark mode\"}\n                </span>\n              </NavLink>\n            </NavItem>\n          </Nav>\n          <Nav className=\"\" navbar>\n            <NavItem>\n              <NavLink className=\"navLinkButton\" onClick={launch(\"https://youtu.be/9w7GdGuJoyk\", \"tutorial\")}>\n                <FontAwesomeIcon icon={faYoutube} className=\"largeHeaderIcon\"/>\n                <span>\n                  Tutorial\n                </span>\n              </NavLink>\n            </NavItem>\n          </Nav>\n          <Nav className=\"\" navbar>\n            <NavItem>\n              <NavLink className=\"navLinkButton\" onClick={launch(Constants.OPENING_TREE_DISCORD,\"discord\")}>\n                <FontAwesomeIcon icon={faDiscord} className=\"discordIcon\"/>\n                <span>\n                  Discord\n                </span>\n              </NavLink>\n            </NavItem>\n          </Nav>\n          {getHelpDropDown()}\n          {getMoreDropDown()}\n        </Collapse>\n      </Navbar>\n\n      {getAcknowledgementsModal()}\n      {getFAQModal()}\n    </div>\n  )\n}\n\nexport default GlobalHeader\n","import React from 'react'\nimport {getNumberIcon} from './Common'\nimport { AccordionDetails, AccordionSummary } from '@material-ui/core';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport Divider from '@material-ui/core/Divider';\nimport AccordionActions from '@material-ui/core/AccordionActions';\nimport {Accordion} from './Common'\nimport * as Constants from '../../app/Constants'\nimport { Collapse, Badge } from 'reactstrap'\nimport { trackEvent } from '../../app/Analytics'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { Button as MaterialUIButton } from '@material-ui/core'\nimport { faCaretDown, faCaretUp} from '@fortawesome/free-solid-svg-icons'\nimport AdvancedFilters from './AdvancedFilters'\nimport {advancedFilters} from './Common'\nimport MuiCollapse from '@material-ui/core/Collapse';\nimport * as SitePolicy from '../../app/SitePolicy'\nimport { Radio, FormControlLabel, RadioGroup, FormHelperText, FormControl, FormLabel} from '@material-ui/core';\nimport deepEqual from 'deep-equal'\n\nexport default class Filters extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            playerColor: this.props.playerColor,\n            isAdvancedFiltersOpen: false\n\n        }\n        Object.assign(this.state, this.props.advancedFilters)\n        this.defaultAdvancedFilters = this.props.advancedFilters\n    }\n\n    toggleRated() {\n        if (this.state.rated === 'all') {\n            this.setState({ rated: 'rated' })\n        } else if (this.state.rated === 'rated') {\n            this.setState({ rated: 'casual' })\n        } else {\n            this.setState({ rated: 'all' })\n        }\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"AdvancedFilterChange\", \"rated\")\n    }\n    toggleState(property) {\n        return () => {\n            let newState = {}\n            newState[property] = !this.state[property]\n            this.setState(newState)\n            trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"ToggleAdvancedFilters\", this.state.site)\n        }\n    }\n    playerColorChange(event) {\n        let playerColor = event.target.value\n        this.setState({ playerColor: playerColor })\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"ColorChange\", playerColor)\n        if(!SitePolicy.isAdvancedFiltersEnabled(this.props.site)) {\n            setImmediate(this.setFilters.bind(this))\n        }\n}\n    handleTimeControlChange(event) {\n        this.setState({ [event.target.name]: event.target.checked });\n    }\n    handleEloRangeChange(event, newValue) {\n        this.setState({ [Constants.FILTER_NAME_ELO_RANGE]: newValue });\n    }\n    handleDownloadLimitChange(event, newValue) {\n        this.setState({ [Constants.FILTER_NAME_DOWNLOAD_LIMIT]: newValue });\n    }\n    handleOpponentNameChange(event) {\n        this.setState({[Constants.FILTER_NAME_OPPONENT]: event.target.value})\n    }\n    handleFromDate(date) {\n        this.setState({[Constants.FILTER_NAME_FROM_DATE]: date})\n    }\n    handleToDate(date) {\n        this.setState({[Constants.FILTER_NAME_TO_DATE]: date})\n    }\n\n\n    setFilters(){\n        if(!this.state.playerColor) {\n            this.setState({colorError:\"Please select a color\"})\n            return\n        }\n        this.setState({colorError:\"\", isAdvancedFiltersOpen:false})\n        this.props.filtersChange(this.state)\n    }\n    getSummary(isDisabled) {\n        if(this.props.playerColor && !isDisabled) {\n            return <span>\n                {getNumberIcon('done')}\n                Color: <b>{this.props.playerColor===Constants.PLAYER_COLOR_WHITE?\"White\":\"Black\"} </b>\n                {this.areAdvancedFiltersApplied()?<span className=\"smallText\">(Filters applied)</span>:null}</span>\n\n        }\n        return <span>{getNumberIcon(3)} Color and filters</span>\n    }\n    componentWillReceiveProps(newProps) {\n        this.setState({...newProps.advancedFilters, playerColor:newProps.playerColor})\n    }\n\n    areAdvancedFiltersApplied(){\n        for (let [key, value] of Object.entries(this.defaultAdvancedFilters)) {\n            if(this.props.advancedFilters[key]===value) {\n                continue\n            }\n            if(!deepEqual(this.props.advancedFilters[key], value)) {\n                return true\n            }\n        }\n        return false\n    }\n\n\n    render(){\n        let isDisabled = !SitePolicy.isFilterPanelEnabled(this.props.site, this.props.playerName, this.props.selectedNotablePlayer)\n        return <Accordion expanded={this.props.expandedPanel === 'filters'}\n            TransitionComponent={MuiCollapse}\n            TransitionProps={{timeout:Constants.LOADER_ANIMATION_DURATION_MS}}\n            onChange={this.props.handleExpansionChange}\n            disabled={isDisabled}>\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n                {this.getSummary(isDisabled)}\n            </AccordionSummary>\n            <AccordionDetails>\n                <div className=\"pgnloadersection\">\n                    <FormControl component=\"fieldset\" error={!!this.state.colorError}>\n                        <FormLabel component=\"legend\">Games where <b>{this.props.playerName}</b> is playing as:</FormLabel>\n                        <RadioGroup onChange={this.playerColorChange.bind(this)} value={this.state.playerColor}>\n                            <FormControlLabel className=\"whitelabel\" control={<Radio color=\"primary\" />} value={Constants.PLAYER_COLOR_WHITE} label={this.state.playerColor === Constants.PLAYER_COLOR_WHITE?<b>White</b>:\"White\"}/>\n                            <FormControlLabel className=\"blacklabel\" control={<Radio color=\"primary\" />} value={Constants.PLAYER_COLOR_BLACK} label={this.state.playerColor === Constants.PLAYER_COLOR_BLACK?<b>Black</b>:\"Black\"}/>\n                        </RadioGroup>\n                        <FormHelperText>{this.state.colorError}</FormHelperText>\n                    </FormControl>\n                </div>\n    {SitePolicy.isAdvancedFiltersEnabled(this.props.site)?<div className=\"pgnloadersection\"><span className=\"linkStyle\" onClick={this.toggleState('isAdvancedFiltersOpen').bind(this)}>Advanced filters <FontAwesomeIcon icon={this.state.isAdvancedFiltersOpen ? faCaretUp : faCaretDown} /> {this.state.isAdvancedFiltersOpen?null:<Badge className=\"sourceName\" color=\"info\">New!</Badge>}</span>\n                    <Collapse isOpen={this.state.isAdvancedFiltersOpen}>\n                            <AdvancedFilters\n                                site={this.props.site}\n                                toggleRated={this.toggleRated.bind(this)}\n                                handleTimeControlChange={this.handleTimeControlChange.bind(this)}\n                                handleEloRangeChange={this.handleEloRangeChange.bind(this)}\n                                handleOpponentNameChange={this.handleOpponentNameChange.bind(this)}\n                                handleDownloadLimitChange={this.handleDownloadLimitChange.bind(this)}\n                                handleFromDate={this.handleFromDate.bind(this)}\n                                handleToDate={this.handleToDate.bind(this)}\n                                advancedFilters={advancedFilters(this.state)}\n                            />\n                    </Collapse>\n                </div>:null}\n            </AccordionDetails>\n            <Divider />\n            <AccordionActions>\n                <MaterialUIButton size=\"small\" color=\"primary\" onClick={this.setFilters.bind(this)}>Continue</MaterialUIButton>\n            </AccordionActions>\n        </Accordion>\n\n    }\n}\n","import React from 'react'\nimport * as Constants from '../../app/Constants'\nimport { trackEvent } from '../../app/Analytics'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { Button as MaterialUIButton } from '@material-ui/core'\nimport PGNReader from '../../app/PGNReaderWorker'\nimport { faList} from '@fortawesome/free-solid-svg-icons'\nimport GetApp from '@material-ui/icons/GetApp'\nimport Equalizer from '@material-ui/icons/Equalizer'\nimport Fade from '@material-ui/core/Fade'\nimport Save from '@material-ui/icons/Save';\nimport * as SitePolicy from '../../app/SitePolicy'\nimport {Tooltip} from '@material-ui/core'\nimport HourglassEmptyIcon from '@material-ui/icons/HourglassEmpty';\nimport {serializeOpeningTree, deserializeOpeningTree} from '../../app/OpeningTreeSerializer'\nimport {proxy} from 'comlink'\nimport streamsaver from 'streamsaver'\nimport cookieManager from '../../app/CookieManager'\n\nexport default class Actions extends React.Component {\n    constructor(props) {\n        super(props) \n        this.state = {\n            isGamesSubsectionOpen : false,\n            exportingInProgress : false\n        }\n        streamsaver.mitm = \"download/download-mitm.html\"\n        this.encoder = new TextEncoder()\n\n    }\n    unload = () => {\n        if (this.pgnReader) {\n            this.pgnReader.stopDownloading()\n        }\n    }\n    componentDidMount() {\n        window.addEventListener(\"beforeunload\", this.unload);\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener(\"beforeunload\", this.unload);\n    }\n    importTreeClicked() {\n        this.setState({exportingInProgress:true})\n        trackEvent(Constants.EVENT_CATEGORY_MAIN_ACTION, \"LoadTree\", this.props.site, this.props.playerColor === Constants.PLAYER_COLOR_WHITE ? 1 : 0)\n        setImmediate(this.importOpeningTree.bind(this))\n    }\n    importOpeningTree() {\n        deserializeOpeningTree(this.props.files[0], \n            (err,data, subMesage)=> {\n                if(err) {\n                    this.props.showError(err, null, subMesage)\n                    this.setState({exportingInProgress:false})\n                    return\n                }\n                let success = this.props.importOpeningTreeObject(data)\n                this.setState({exportingInProgress:false})\n                if(success) {\n                    this.props.showInfo(\"Successfuly loaded openingtree\")                \n                }\n            })\n    }\n    exportTreeClicked() {\n        this.setState({exportingInProgress:true})\n        trackEvent(Constants.EVENT_CATEGORY_MAIN_ACTION, \"SaveTree\", this.props.site, this.props.playerColor === Constants.PLAYER_COLOR_WHITE ? 1 : 0)\n        setImmediate(this.exportOpeningTree.bind(this))\n    }\n    exportOpeningTree() {\n        serializeOpeningTree(this.props.exportOpeningTreeObject(), \n            SitePolicy.exportFileName(this.props.site, this.props.playerName, this.props.playerColor, null, \"tree\"), \n            (err, info) => {\n                if(err) {\n                    this.props.showError(err)                    \n                } else {\n                    this.props.showInfo(info)\n                }\n                this.setState({exportingInProgress:false})\n            })\n    }\n    abortDownloading() {\n        if(this.fileWriter) {\n            this.fileWriter.close()\n            this.fileWriter = null\n        }\n    }\n\n    getPgnString(game){\n        return `${Object.entries(game.headers).map(header=>`[${header[0]} \"${header[1]}\"]`).join(\"\\n\")}\n                \\n${game.moves.map((moveObject, index)=>{\n                    return `${index%2!==0?'':index/2+1+\".\"} ${moveObject.move}`\n                }).join(' ')} ${game.result}\\n\\n\\n`\n    }\n    downloadResponse(result, pendingDownloads) {\n        this.fileWriter.write(this.encoder.encode(result.map(game=>this.getPgnString(game)).join(\"\"))).then(()=>{\n            if(!pendingDownloads) {\n                this.abortDownloading()\n                return false\n            }\n        })\n        return true\n    }\n\n    readPgn(shouldDownloadToFile) {\n        if(shouldDownloadToFile) {\n            let fileStream =  streamsaver.createWriteStream(\n                SitePolicy.exportFileName(\n                    this.props.site, this.props.playerName, \n                    this.props.playerColor, this.props.selectedNotableEvent, \"pgn\"))\n            this.fileWriter = fileStream.getWriter()\n        }\n\n        new PGNReader(this.props.variant).then((readerInstance) => {\n            this.pgnReader = readerInstance\n            this.pgnReader.fetchPGNFromSite(this.props.playerName,\n                this.props.playerColor,\n                this.props.site,\n                this.props.selectedNotablePlayer,\n                this.props.selectedNotableEvent,\n                this.props.selectedOnlineTournament,\n                shouldDownloadToFile,\n                this.props.advancedFilters,\n                proxy(this.props.notify),\n                proxy(this.props.showError),\n                proxy(this.stopDownloading.bind(this)),\n                this.props.files,\n                proxy(this.downloadResponse.bind(this)),\n                this.getTokens())\n        })\n    }\n    \n    getTokens(){\n        return {\n            lichess:cookieManager.getLichessAccessToken()\n        }\n    }\n    download() {\n        this.readPgn(true)\n        trackEvent(Constants.EVENT_CATEGORY_MAIN_ACTION, \"Download\", this.props.site, this.props.playerColor === Constants.PLAYER_COLOR_WHITE ? 1 : 0)\n\n    }\n\n    getPlayerName() {\n        if(this.props.site === Constants.SITE_PLAYER_DB) {\n            return this.props.selectedNotablePlayer.name\n        }\n        return this.props.playerName\n    }\n    componentWillReceiveProps(newProps) {\n        if(newProps.gamesProcessed>0) {\n            this.setState({isGamesSubsectionOpen:true})\n        }\n    }\n\n    load() {\n        this.props.clear()\n        this.setState({ isGamesSubsectionOpen: true, loadedSite:this.props.site })\n        // set the player name and color in the global state\n        this.props.onChange(\"playerName\", this.props.playerName)\n        this.props.onChange(\"playerColor\", this.props.playerColor)\n        this.readPgn(false)\n        this.props.setDownloading(true)\n        trackEvent(Constants.EVENT_CATEGORY_MAIN_ACTION, \"Load\", this.props.site, this.props.playerColor === Constants.PLAYER_COLOR_WHITE ? 1 : 0)\n    }\n    stopDownloading() {\n        this.props.setDownloading(false)\n    }\n    stopDownloadingAction() {\n        this.stopDownloading()\n        trackEvent(Constants.EVENT_CATEGORY_MAIN_ACTION, \"StopDownloading\", this.props.site)\n    }\n    openingTreeLoadActions() {\n        return <div className=\"pgnloadersection\">\n            <MaterialUIButton\n            onClick={this.importTreeClicked.bind(this)}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={this.state.exportingInProgress?<HourglassEmptyIcon/>:<GetApp/>}\n            className=\"mainButton\" disableElevation\n            disabled={this.state.exportingInProgress}\n            >\n                {this.state.exportingInProgress?\"Loading from file\":\"Load openingtree\"}\n        </MaterialUIButton></div>\n    }\n    regularActions() {\n        let downloadDisabledReason = SitePolicy.treeSaveDisabledReason(\n                                        this.state.loadedSite, \n                                        this.props.site,\n                                        this.props.gamesProcessed, \n                                        this.props.isDownloading)\n        return <div>\n        <div className=\"pgnloadersection\"><MaterialUIButton\n            onClick={this.load.bind(this)}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<Equalizer />}\n            className=\"mainButton\" disableElevation\n        >\n            Analyze games\n        </MaterialUIButton></div>\n        <div className=\"pgnloadersection\"><MaterialUIButton\n            onClick={this.download.bind(this)}\n            variant=\"contained\"\n            color=\"default\"\n            startIcon={<GetApp />}\n            className=\"mainButton\" disableElevation\n        >\n            Export as PGN\n        </MaterialUIButton></div>\n        {\n            <div className=\"pgnloadersection\"><Tooltip placement=\"top\" title={downloadDisabledReason||\"Save a .tree file locally for faster reload later\"}>\n                <span><MaterialUIButton\n                onClick={this.exportTreeClicked.bind(this)}\n                variant=\"contained\"\n                color=\"default\"\n                startIcon={this.state.exportingInProgress?<HourglassEmptyIcon/>:<Save/>}\n                className=\"mainButton\" disableElevation\n                disabled={!!downloadDisabledReason || this.state.exportingInProgress}\n                >\n                    {this.state.exportingInProgress?\"Saving to file\":\"Save .tree file\"}\n                </MaterialUIButton></span></Tooltip></div>\n            }\n        {\n            this.state.isGamesSubsectionOpen ?\n                <div>\n                    <div className=\"pgnloadersection\">\n                        {!this.props.playerColor?\"Games\":this.props.playerColor === Constants.PLAYER_COLOR_WHITE?\"White games\":\"Black games\"}{` loaded: ${this.props.gamesProcessed} `}{this.props.isDownloading ? <span className=\"stopDownloading\">[<span className=\"linkStyle\" onClick={this.stopDownloadingAction.bind(this)}><img alt=\"loading spinner\" src=\"./spinner.gif\" height=\"15\" />stop</span>]</span> : \"\"}\n                    </div>\n                    <div onClick={() => this.props.switchToMovesTab()} className=\"navLinkButton pgnloadersection\">\n                        <FontAwesomeIcon icon={faList} /> View Moves&gt;&gt;\n                </div>\n                </div>\n                : \"\"\n        }\n        </div>\n    }\n    mainComponent() {\n        if(this.props.site === Constants.SITE_OPENING_TREE_FILE) {\n            return this.openingTreeLoadActions()\n        }\n        return this.regularActions()\n    }\n    render(){\n        if(this.props.expandedPanel) {\n            return <Fade timeout={Constants.LOADER_ANIMATION_DURATION_MS*2}>\n            {this.mainComponent()}\n        </Fade>\n        }\n        return <Fade in timeout={Constants.LOADER_ANIMATION_DURATION_MS*3}>\n            {this.mainComponent()}\n        </Fade>\n    }\n}","import {wrap} from 'comlink'\n\nconst PGNReader = wrap(new Worker('./PGNReader.js', { type: 'module' }))\n\nexport default PGNReader","import * as Constants from '../app/Constants'\nimport {trackEvent} from '../app/Analytics'\nimport {copyText} from './loader/Common'\nimport {chessLogic} from '../app/chess/ChessLogic'\nimport OpeningGraph from '../app/OpeningGraph'\nimport {fetchBookMoves} from '../app/OpeningBook'\nimport CookieManager from '../app/CookieManager'\nimport { handleDarkMode } from './DarkMode';\n\nvar maxArrowsDrawn = 0\n\nfunction turnColor() {\n    return fullTurnName(this.chess.turn())\n}\n\nfunction fullTurnName(shortName) {\n    return shortName === 'w' ? Constants.PLAYER_COLOR_WHITE : Constants.PLAYER_COLOR_BLACK\n}\n\nfunction playerColor() {\n    return this.state.settings.playerColor\n}\n\nfunction brushes() {\n    if(!this.playerColor() || this.playerColor() === this.turnColor()) {\n        return this.forBrushes\n    }\n    return this.againstBrushes\n}\nfunction highlightArrow(move) {\n    this.setState({highlightedMove:move})\n}\n\nfunction calcMovable() {\nconst dests = {}\n    this.chess.SQUARES.forEach(s => {\n        const ms = this.chess.moves({square: s, verbose: true})\n        if (ms.length) dests[s] = ms.map(m => m.to)\n    })\n    return {\n        free: false,\n        dests,\n        color: this.turnColor()\n    }\n}\n\nfunction orientation() {\n    return this.state.settings.orientation\n}\n\nfunction onMove(sanOrOrig, dest) {\n    let moveObj = null\n    if(dest) {\n        moveObj = { from:sanOrOrig, to:dest, promotion: 'q'}\n    } else {\n        moveObj = sanOrOrig\n    }\n    const chess = this.chess\n    let move = chess.move(moveObj)\n    this.setState({ fen: chess.fen(), lastMove: move})\n}\n\n\nfunction onMoveAction(sanOrOrig, dest) {\n    this.onMove(sanOrOrig, dest)\n    trackEvent(Constants.EVENT_CATEGORY_CHESSBOARD, \"Move\")\n}\n\nfunction navigateTo(fen, previousMove){\n    this.chess = chessLogic(this.state.variant, fen)\n    this.setState({fen:fen, lastMove:previousMove})\n}\nfunction updateProcessedGames(downloadLimit, n, parsedGame) {\n    let totalGamesProcessed = this.state.gamesProcessed+n\n    this.state.openingGraph.addPGN(parsedGame.pgnStats, parsedGame.parsedMoves,\n            parsedGame.latestFen,parsedGame.playerColor, this.state.variant)\n    this.setState({\n        gamesProcessed: totalGamesProcessed,\n        downloadingGames: (totalGamesProcessed<downloadLimit || downloadLimit>=Constants.MAX_DOWNLOAD_LIMIT)?this.state.downloadingGames:false\n    })\n    // continue to download games if\n    // 1. we have not reached download limit OR\n    //    there is no download limit set (downloadLimit>MAX condition)\n    // 2. user did not hit stop button\n    return (totalGamesProcessed < downloadLimit || downloadLimit>=Constants.MAX_DOWNLOAD_LIMIT)&& this.state.downloadingGames\n}\nfunction moveToShape(move) {\n    return {\n        orig:move.orig,\n                    dest: move.dest !== move.orig? move.dest:null,\n                    brush: this.brushes()[move.level]\n    }\n}\n\nfunction autoShapes(moves, highlightedMove) {\n    var shapes = []\n    if(highlightedMove) {\n        if(!highlightedMove.orig || !highlightedMove.dest) {\n            let chess = chessLogic(this.state.variant, this.state.fen)\n            let move = chess.move(highlightedMove.san)\n            highlightedMove.orig=move.from\n            highlightedMove.dest=move.to\n        }\n        highlightedMove.level = 0\n        shapes.push(this.moveToShape(highlightedMove))\n    }\n    if(moves) {\n        shapes = shapes.concat(moves.filter((m)=>{\n            if(!highlightedMove) {\n                return true\n            }\n            if (highlightedMove.orig === m.orig && highlightedMove.dest === m.dest) {\n                return false\n            }\n            return true\n        }).map(this.moveToShape.bind(this)))\n    }\n    maxArrowsDrawn = Math.max(maxArrowsDrawn, shapes.length)\n    return this.fillArray(shapes,  maxArrowsDrawn)\n}\n\nfunction getPlayerMoves() {\n    if(!this.state.openingGraph.hasMoves) {\n        return null;\n    }\n    var moves = this.state.openingGraph.movesForFen(this.chess.fen())\n    return moves?moves.sort((a,b)=>{\n        if(a.moveCount === b.moveCount) {\n            return b.details.count - a.details.count\n        }\n        return b.moveCount-a.moveCount\n    }):[]\n}\n\nfunction gameResults() {\n    return this.state.openingGraph.gameResultsForFen(this.chess.fen())\n}\n\nfunction fillArray(arr, len) {\n    for (var i = arr.length; i < len; i++) {\n        arr.push({'orig':'i'+i, 'dest':'i'+(i+1), brush:this.brushes()[0]});\n    }\n    return arr;\n}\n\nfunction reset() {\n    this.chess = chessLogic(this.state.variant)\n    this.setState({fen: this.chess.fen(), lastMove:null})\n}\n\nfunction clear() {\n    this.state.openingGraph.clear()\n    this.state.gamesProcessed = 0\n    this.reset()\n}\n\nfunction settingsChange(name, value) {\n    if(name === Constants.SETTING_NAME_MOVES_SETTINGS ) {\n        let settingsToPersist = {}\n        settingsToPersist[name] = value\n        CookieManager.setSettingsCookie(settingsToPersist)\n        this.state.openingGraph.clearBookNodes()\n    } else if (name === Constants.SETTING_NAME_DARK_MODE) {\n        CookieManager.setDarkModeCookie(value)\n    }\n\n    let settings = this.state.settings\n    settings[name] = value;\n    this.setState({ settings });\n\n    if (name === Constants.SETTING_NAME_DARK_MODE) {\n        setImmediate(()=>handleDarkMode(value));\n    }\n}\n\nfunction launch(url) {\n    return () => {\n        window.open(url, \"_blank\")\n    }\n}\n\n\nfunction showError(message, trackingEvent, subMessage, action, severity) {\n    let errorActionText, errorAction\n    let messageSeverity = severity || Constants.ERROR_SEVERITY_ERROR\n    if(action === Constants.ERROR_ACTION_VISIT_OLD_SITE) {\n        errorActionText=\"Visit old site\"\n        errorAction = launch(\"https://www.openingtree.com/old\")\n    } else if(action !== Constants.ERROR_ACTION_NONE){\n        errorActionText=\"Report this\"\n        errorAction = this.toggleFeedback(true)\n    }\n    this.setState({message:message, subMessage:subMessage,\n        errorAction:errorAction, errorActionText:errorActionText,\n        messageSeverity:messageSeverity})\n    let eventName = messageSeverity+\"Shown\"\n    if(trackingEvent) {\n        eventName = eventName+\":\"+trackingEvent\n    }\n    trackEvent(Constants.EVENT_CATEGORY_MESSAGE_SHOWN,eventName, message)\n}\n\nfunction showInfo(message, trackingLabel) {\n    this.setState({message:message, messageSeverity:Constants.ERROR_SEVERITY_SUCCESS})\n    trackEvent(Constants.EVENT_CATEGORY_MESSAGE_SHOWN,\"infoShown\",\n        trackingLabel?trackingLabel:message)\n}\n\nfunction closeError() {\n    this.setState({message:'', subMessage:''})\n}\n\nfunction toggleFeedback(diagnosticsOpen) {\n    return () => {\n        let feedbackOpen = this.state.feedbackOpen\n        if(!feedbackOpen) {\n            trackEvent(Constants.EVENT_CATEGORY_GLOBAL_HEADER, \"feedbackOpen\")\n        }\n        this.closeError()\n        this.setState({feedbackOpen:!feedbackOpen,\n                diagnosticsDataOpen:diagnosticsOpen})\n    }\n}\n\nfunction setDownloading(val) {\n    this.setState({downloadingGames:val})\n}\n\nfunction toggleDiagnosticsData() {\n    this.setState({diagnosticsDataOpen:!this.state.diagnosticsDataOpen})\n}\n\nfunction copyDiagnostics() {\n    copyText(\"diagnosticsText\")\n    this.showInfo(\"Copied Diagnostics data\")\n}\n\n\nfunction importGameState(importState) {\n    let newSettings=importState.settings\n    //transfer objects from current settings that do not need serialization\n    newSettings.movesSettings=this.state.settings.movesSettings\n    this.setState({\n      settings:importState.settings,\n      openingGraph:importState.openingGraph,\n      gamesProcessed:importState.gamesProcessed,\n      variant:importState.variant?importState.variant:Constants.VARIANT_STANDARD\n    })\n    setImmediate(this.reset.bind(this))// setImmediate because we want the variant change to take effect\n  }\n  function getChessboardWidth(){\n    // getting nearest multiple of 8 because chessground has\n    // css alignment issues if board width is not a multple of 8\n\n    return `${nearestMultipleOf8(getChessboardWidthInternal())}px`\n  }\n  function nearestMultipleOf8(n){\n      while(n%8!==0) {\n          n++;\n      }\n      return n;\n  }\n  function getChessboardWidthInternal(){\n    // have to manually set the width to pixels instead of \"vw\" value\n    // this is because chessground component does not behave well with \"vw\" values\n    if (window.innerWidth<=768) {\n      return Math.round(window.innerWidth*95/100) //95vw\n    } else if ((window.innerWidth<=1424)) {\n      return Math.round(Math.min(window.innerWidth*48/100,Math.max(512,window.innerHeight-100))) // 40vw\n    } else {\n      return Math.round(Math.min(712,Math.max(512,window.innerHeight-100)))// innherHeight-100 to leave some space for header and footer\n    }\n\n  }\n\nfunction getDiagnosticsValue() {\n  return `--------------------\n  ${navigator.userAgent}\n  -------------------\n  ${JSON.stringify(this.state)}\n  -------------------\n  `\n}\nfunction getRedditLink() {\n    return `https://www.reddit.com/message/compose/?to=${Constants.OPENING_TREE_REDDIT}&subject=${this.getSubject()}&message=%0D%0A%0D%0A%0D%0A${this.getBody()}`\n}\n\nfunction getEmailLink() {\n    return `mailto:${Constants.OPENING_TREE_EMAIL}?subject=${this.getSubject()}&body=%0D%0A%0D%0A%0D%0A${this.getBody()}`\n}\n\nfunction getSubject() {\n    return this.state.diagnosticsDataOpen?\"Possible Openingtree bug\":\"Feedback on Openingtree\"\n}\nfunction getBody() {\n    return this.state.diagnosticsDataOpen?this.getDiagnosticsValue():\"\"\n}\n\nfunction variantChange(newVariant) {\n    this.setState({variant:newVariant, openingGraph:new OpeningGraph(newVariant)})\n    setImmediate(this.reset.bind(this))\n}\n\n// fetch the book moves openinggraph directly if they are available\n// otherwise\n//  1. fetch them from lichess\n//  2. store them in openinggraph\n//  3. update the component so that getBookMoves gets called again\nfunction getBookMoves() {\n    let moves = this.state.openingGraph.getBookNode(this.chess.fen())\n    if(this.state.settings.movesSettings.openingBookType === Constants.OPENING_BOOK_TYPE_OFF) {\n        return {fetch:'off'}\n    }\n\n    if(!moves) {\n        moves = this.forceFetchBookMoves()\n    }\n    return moves\n}\n\nfunction forceFetchBookMoves() {\n    let moves = fetchBookMoves(this.state.fen, this.state.variant, this.state.settings.movesSettings, (moves)=>{\n        this.state.openingGraph.addBookNode(this.chess.fen(), moves)\n        this.setState({update:this.state.update+1})\n    })\n    this.state.openingGraph.addBookNode(this.chess.fen(), moves)\n    setImmediate(()=>this.setState({update:this.state.update+1}))\n    return moves\n}\n\nfunction mergePlayerAndBookMoves(playerMovesToShow, bookMovesToShow) {\n    if(!playerMovesToShow) {\n        return\n    }\n    let bookMovesMap = createMap(bookMovesToShow.moves)\n    playerMovesToShow.forEach((move)=>{\n        let bookMove = bookMovesMap.get(move.san)\n        if(!bookMove) {\n            return\n        }\n        move.compareTo = {\n            bookScore:getCompareScores(bookMove),\n            userScore:getCompareScores(move),\n            values:getCompareToValues(bookMove)\n        }\n        bookMove.compareTo = {\n            bookScore:getCompareScores(bookMove),\n            userScore:getCompareScores(move),\n            values:getCompareToValues(move)\n        }\n    })\n}\nfunction getCompareScores(move){\n    return (move.details.whiteWins+move.details.draws/2)/move.details.count*100\n}\n\nfunction getCompareToValues(move) {\n    return [move.details.whiteWins/move.details.count*100,\n        (move.details.whiteWins+move.details.draws)/move.details.count*100]\n}\n\nfunction createMap(movesToShow){\n    let map = new Map()\n    if(!movesToShow) {\n        return map\n    }\n    movesToShow.forEach((move)=> {\n        map.set(move.san, move)\n    })\n    return map\n}\n\n\nfunction addStateManagement(obj){\n    obj.orientation  = orientation\n    obj.turnColor = turnColor\n    obj.calcMovable = calcMovable\n    obj.onMove = onMove\n    obj.onMoveAction = onMoveAction\n    obj.autoShapes = autoShapes\n    obj.updateProcessedGames = updateProcessedGames\n    obj.settingsChange = settingsChange\n    obj.reset = reset\n    obj.clear = clear\n    obj.navigateTo = navigateTo\n    obj.playerColor = playerColor\n    obj.fillArray = fillArray\n    obj.brushes = brushes\n    obj.moveToShape = moveToShape\n    obj.getPlayerMoves = getPlayerMoves\n    obj.gameResults = gameResults\n    obj.showError = showError\n    obj.showInfo = showInfo\n    obj.closeError = closeError\n    obj.toggleFeedback = toggleFeedback.bind(obj)\n    obj.setDownloading = setDownloading\n    obj.toggleDiagnosticsData = toggleDiagnosticsData.bind(obj)\n    obj.copyDiagnostics = copyDiagnostics.bind(obj)\n    obj.importGameState = importGameState\n    obj.getDiagnosticsValue = getDiagnosticsValue\n    obj.getChessboardWidth = getChessboardWidth\n    obj.getEmailLink = getEmailLink\n    obj.getSubject = getSubject\n    obj.getBody = getBody.bind(obj)\n    obj.getRedditLink = getRedditLink\n    obj.variantChange = variantChange\n    obj.getBookMoves = getBookMoves\n    obj.forceFetchBookMoves = forceFetchBookMoves\n    obj.mergePlayerAndBookMoves = mergePlayerAndBookMoves\n    obj.highlightArrow = highlightArrow\n}\n\nexport {addStateManagement}","import request from 'request'\nimport * as Common from './Common'\n\nexport function fetchBookMoves(fen, variant, bookSettings, callback) {\n    let ratings = bookSettings.openingBookRating\n    let speeds = bookSettings.openingBookTimeControls\n    let bookType = bookSettings.openingBookType\n    let url = `https://explorer.lichess.ovh/${bookType}?fen=${fen}&play=&variant=${Common.lichessPerf(variant)}&ratings=${joinParams(ratings)}&speeds=${joinParams(speeds)}`\n    request.get(url, (error, response) =>{\n        if(error) {\n            callback({fetch:\"failed\"})\n            return \n        }\n        try{\n            callback(JSON.parse(response.body))\n            return\n        } catch (e) {\n            console.log(e)\n        }\n        callback({fetch:\"failed\"})\n    })\n    return {fetch:\"pending\"}\n    //https://explorer.lichess.ovh/lichess?fen=rnbqkbnr%2Fpppppppp%2F8%2F8%2F8%2F8%2FPPPPPPPP%2FRNBQKBNR%20w%20KQkq%20-%200%201&play=&variant=kingOfTheHill&speeds%5B%5D=bullet&speeds%5B%5D=blitz&speeds%5B%5D=rapid&speeds%5B%5D=classical&ratings%5B%5D=1600&ratings%5B%5D=1800&ratings%5B%5D=2000&ratings%5B%5D=2200&ratings%5B%5D=2500\n\n}\n\nfunction joinParams(paramValues) {\n    return paramValues.join(',')\n}\n","import green from '@material-ui/core/colors/green';\nimport amber from '@material-ui/core/colors/amber';\nimport IconButton from '@material-ui/core/IconButton';\nimport SnackbarContent from '@material-ui/core/SnackbarContent';\nimport Button from '@material-ui/core/Button'\nimport {withStyles} from '@material-ui/core/styles';\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle';\nimport CloseIcon from '@material-ui/icons/Close';\nimport ErrorIcon from '@material-ui/icons/Error';\nimport InfoIcon from '@material-ui/icons/Info';\nimport WarningIcon from '@material-ui/icons/Warning';\nimport clsx from 'clsx';\nimport PropTypes from 'prop-types';\nimport * as React from 'react';\n\nconst variantIcon = {\n    success: CheckCircleIcon,\n    warning: WarningIcon,\n    error: ErrorIcon,\n    info: InfoIcon,\n};\n\nconst styles = (theme) => ({\n    success: {\n        backgroundColor: green[600],\n    },\n    error: {\n        backgroundColor: theme.palette.error.dark,\n    },\n    info: {\n        backgroundColor: theme.palette.primary.dark,\n    },\n    warning: {\n        backgroundColor: amber[700],\n    },\n    icon: {\n        fontSize: 20,\n    },\n    iconVariant: {\n        opacity: 0.9,\n        marginRight: theme.spacing(1),\n    },\n    message: {\n        display: 'flex',\n        alignItems: 'center',\n    },\n});\n\nfunction SnackbarContentWrapper(props) {\n    const {classes, className, message, onClose, variant, subMessage, action, actionText, showReportButton, ...other} = props;\n    const Icon = variantIcon[variant];\n\n    return (\n        <SnackbarContent\n            className={clsx(classes[variant], className)}\n            aria-describedby=\"client-snackbar\"\n            message={\n                <div><span id=\"client-snackbar\" className={classes.message}>\n                    <Icon className={clsx(classes.icon, classes.iconVariant)} />\n                    {message} \n                    \n                </span>\n                {!subMessage?null:<div className=\"smallText\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{subMessage}</div>}\n                </div>\n            }\n            action={[ \n                !showReportButton?null:<Button key=\"report\" onClick = {action} color=\"inherit\" size=\"small\">\n                  {actionText}\n                </Button>,\n                <IconButton\n                    key=\"close\"\n                    aria-label=\"Close\"\n                    color=\"inherit\"\n                    className={classes.close}\n                    onClick={onClose}\n                >\n                    <CloseIcon className={classes.icon} />\n                </IconButton>\n            ]}\n            {...other}\n        />\n    );\n}\n\nSnackbarContentWrapper.propTypes = {\n    classes: PropTypes.object.isRequired,\n    className: PropTypes.string,\n    message: PropTypes.node,\n    onClose: PropTypes.func,\n    onReport: PropTypes.func,\n    subMessage: PropTypes.string,\n    showReportButton: PropTypes.bool,\n    variant: PropTypes.oneOf(['success', 'warning', 'error', 'info']).isRequired,\n};\n\nexport default withStyles(styles)(SnackbarContentWrapper);","import { Accordion, getNumberIcon } from './Common';\nimport * as Constants from '../../app/Constants';\n\nimport React from 'react';\n\nimport {\n    AccordionActions,\n    AccordionDetails,\n    AccordionSummary,\n    Button as MaterialUIButton,\n    Collapse,\n    Divider,\n    FormControlLabel,\n    Radio,\n    RadioGroup\n} from '@material-ui/core';\n\nimport {\n    Backup,\n    DateRange,\n    ExpandMore,\n    People,\n    Save\n} from '@material-ui/icons';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faChessRook } from '@fortawesome/free-solid-svg-icons';\n\nconst SOURCE_VARIANT_COMBINATION = {\n    [Constants.VARIANT_RACING_KINGS]:[Constants.SITE_LICHESS, Constants.SITE_ONLINE_TOURNAMENTS, Constants.SITE_OPENING_TREE_FILE, Constants.SITE_PGN_FILE],\n    [Constants.VARIANT_KING_OF_THE_HILL]:[Constants.SITE_CHESS_DOT_COM, Constants.SITE_LICHESS, Constants.SITE_ONLINE_TOURNAMENTS, Constants.SITE_OPENING_TREE_FILE, Constants.SITE_PGN_FILE],\n    [Constants.VARIANT_THREE_CHECK]:[Constants.SITE_CHESS_DOT_COM, Constants.SITE_LICHESS, Constants.SITE_ONLINE_TOURNAMENTS, Constants.SITE_OPENING_TREE_FILE, Constants.SITE_PGN_FILE],\n    [Constants.VARIANT_CRAZYHOUSE]:[Constants.SITE_CHESS_DOT_COM, Constants.SITE_LICHESS, Constants.SITE_ONLINE_TOURNAMENTS, Constants.SITE_OPENING_TREE_FILE, Constants.SITE_PGN_FILE]\n}\n\nexport default class Source extends React.Component {\n    getSourceOption(source, addNumber) {\n        if (source === Constants.SITE_LICHESS) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<img alt=\"lichess\" className=\"siteimage\" src=\"./lichesslogo.png\" /><span className=\"sourceName\"> lichess.org </span></span>\n        } else if (source === Constants.SITE_CHESS_DOT_COM) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<img alt=\"chess.com\" className=\"siteimage\" src=\"./chesscomlogo.png\" /></span>\n        } else if (source === Constants.SITE_PGN_FILE) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<Backup className=\"lowOpacity\"/><span className=\"sourceName\"> Load <i>PGN</i> file</span></span>\n        } else if (source === Constants.SITE_EVENT_DB) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<DateRange className=\"lowOpacity\"/><span className=\"sourceName\"> Notable chess events</span></span>\n        } else if (source === Constants.SITE_PLAYER_DB) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<People className=\"lowOpacity\"/><span className=\"sourceName\"> Notable chess players</span></span>\n        }  else if (source === Constants.SITE_OPENING_TREE_FILE) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<Save className=\"lowOpacity\"/><span className=\"sourceName\"> Load <b>.tree</b> file</span></span>\n        } else if (source === Constants.SITE_ONLINE_TOURNAMENTS) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<FontAwesomeIcon icon={faChessRook} className=\"lowOpacity\" /><span className=\"sourceName\"> Lichess tournaments</span></span>\n        }\n        return <span>{getNumberIcon(1, addNumber)}Select a source</span>\n    }\n    continue(){\n        this.props.siteChange(this.props.site)\n    }\n    setSite(event) {\n        let newSite = event.target.value\n        this.props.siteChange(newSite)\n    }\n    isSourceAvailable(source, variant) {\n        let supportedSources = SOURCE_VARIANT_COMBINATION[variant]\n        if(!supportedSources) {\n            return true\n        }\n        return supportedSources.includes(source)\n    }\n    render() {\n        return <Accordion TransitionComponent={Collapse}\n            TransitionProps={{timeout:Constants.LOADER_ANIMATION_DURATION_MS}}\n            expanded={this.props.expandedPanel === 'source'}\n            onChange={this.props.handleExpansionChange}>\n            <AccordionSummary\n                expandIcon={<ExpandMore />}\n                aria-controls=\"panel1c-content\"\n                id=\"panel1c-header\"\n            >\n                <div>\n                    {this.getSourceOption(this.props.site, true)}\n                </div>\n            </AccordionSummary>\n            <AccordionDetails>\n                <RadioGroup onChange={this.setSite.bind(this)} value={this.props.site}>\n                {this.getSourceRadio(Constants.SITE_LICHESS)}\n                {this.getSourceRadio(Constants.SITE_CHESS_DOT_COM)}\n                {this.getSourceRadio(Constants.SITE_ONLINE_TOURNAMENTS)}\n                {this.getSourceRadio(Constants.SITE_OPENING_TREE_FILE)}\n                {this.props.variant === Constants.VARIANT_STANDARD?<Divider className=\"dividerMargin\"/>:null}\n                {this.getSourceRadio(Constants.SITE_PLAYER_DB)}\n                {this.getSourceRadio(Constants.SITE_EVENT_DB)}\n                {this.getSourceRadio(Constants.SITE_PGN_FILE)}\n               </RadioGroup>\n            </AccordionDetails>\n            {this.props.site?\n            <span>\n            <Divider />\n\n            <AccordionActions>\n                    <MaterialUIButton size=\"small\" color=\"primary\" onClick={this.continue.bind(this)}>Continue</MaterialUIButton>\n                </AccordionActions></span>:\n                null\n            }\n        </Accordion>\n\n    }\n\n    getSourceRadio(source) {\n        if(!this.isSourceAvailable(source,this.props.variant)) {\n            return null\n        }\n        return <FormControlLabel\n                className=\"sitelabel\"\n                value={source}\n                control={<Radio color=\"primary\" />}\n                label={this.getSourceOption(source)} />\n    }\n}","import React from 'react'\nimport {DropzoneArea} from 'material-ui-dropzone'\nimport { trackEvent } from '../../app/Analytics'\nimport * as Constants from '../../app/Constants'\n\nexport default class Dropzone extends React.Component{\n    handleFileChange(newFiles) {\n      trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"FileSaved\", newFiles.length>0?newFiles[0].name:null)\n      this.props.filesChange(newFiles)\n    }\n    render(){\n      return (\n        <DropzoneArea \n        acceptedFiles={[]}\n        dropzoneText={this.props.dropzoneText}\n          onChange={this.handleFileChange.bind(this)}\n          dropzoneParagraphClass=\"dropzonetext\"\n          showFileNames={true}\n          useChipsForPreview={true}\n          previewChipProps={{className:\"previewChip\"}}\n          dropzoneClass=\"dropzone\"\n          filesLimit={this.props.filesLimit}\n          maxFileSize={3000000000000}\n          />\n      )  \n    }\n  } ","import SelectSearch from 'react-select-search';\nimport React from 'react'\nimport * as Constants from '../../app/Constants'\nimport { trackEvent } from '../../app/Analytics';\nimport { LazyLoadImage } from 'react-lazy-load-image-component';\n\nexport default class NotableChessGames extends React.Component {\n\n    updateDetails = (value) => {\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"NotableGameSelected\", value.value)\n        this.props.onChange(value)\n    }\n    \n    renderDetails(option) {\n        return (<div>\n                <span><LazyLoadImage alt={option.name} className=\"profilePicture\" width=\"40\" height=\"40\" src={option.profile.imageUrl} /></span>\n                <div>{option.name}</div>\n                <div className=\"smallText\">{option.profile.subText}</div>\n                </div>);\n    }\n    render() {\n        if(!this.props.list) {\n            return <div className=\"lowOpacity textCenter\"><img alt=\"loading\" width='25' height='25' src=\"./spinner.gif\"/> Loading List</div>\n        } else if(!this.props.list.length) {\n            return <div className=\"lowOpacity textCenter\"> Could not fetch list</div>\n        }\n        let options = this.props.list.map(option=>{return {...option, value:option.name}})\n        return <SelectSearch\n            name=\"goatPlayers\"\n            value={this.props.selectedDetail.value}\n            options={options}\n            placeholder={this.props.placeholder}\n            renderOption={this.renderDetails}\n            onChange={this.updateDetails}\n        />\n    }\n}\n","import React from 'react'\nimport {getNumberIcon} from './Common'\nimport AccordionSummary from '@material-ui/core/AccordionSummary';\nimport { Button as MaterialUIButton, TextField, AccordionDetails } from '@material-ui/core'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faInfoCircle} from '@fortawesome/free-solid-svg-icons'\nimport {faCheck, faSync, faSignOutAlt} from '@fortawesome/free-solid-svg-icons'\nimport Divider from '@material-ui/core/Divider';\nimport AccordionActions from '@material-ui/core/AccordionActions';\nimport {Accordion} from './Common'\nimport * as Constants from '../../app/Constants'\nimport Collapse from '@material-ui/core/Collapse';\nimport Dropzone from './Dropzone'\nimport NotableChessGames from './NotableChessGames';\nimport {Card, CardBody, CardText, CardTitle} from 'reactstrap'\nimport LockOpen from '@material-ui/icons/Lock'\nimport ExitToApp from '@material-ui/icons/ExitToApp'\nimport {Spinner} from 'reactstrap'\nimport { trackEvent } from '../../app/Analytics'\n\nexport default class User extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            playerName:'',\n            tournamentUrl:'',\n            files:[],\n            selectedPlayer:{},\n            selectedEvent:{}\n        }\n        \n        \n    }\n    \n    \n    editPlayerName(event) {\n        this.setState({\n            playerName: event.target.value,\n            playerNameError:''\n        })\n    }\n    editTournamentUrl(event) {\n        this.setState({\n            tournamentUrl: event.target.value,\n            tournamentUrlError:''\n        })\n    }\n    filesChange(files) {\n        this.setState({files:files})\n    }\n\n    notablePlayerChange(player) {\n        this.setState({\n            selectedPlayer:player})\n    }\n    notableEventChange(event) {\n        this.setState({\n            selectedEvent:event})\n    }\n\n    componentWillReceiveProps(nextProps) {\n        this.setState({playerNameError:'', tournamentUrlError: ''})\n    }\n    \n    validateInputDetailsSet() {\n        if(this.props.site === Constants.SITE_EVENT_DB){\n            if(!this.state.selectedEvent){\n                this.props.showError(\"Please select an event\")\n                return false\n            } \n        } else if(this.props.site === Constants.SITE_PLAYER_DB){\n            if(!this.state.selectedPlayer){\n                this.props.showError(\"Please select a player\")\n                return false\n            } \n        } else if(this.props.site === Constants.SITE_LICHESS ||\n            this.props.site === Constants.SITE_CHESS_DOT_COM) {\n                if(!this.state.playerName){\n                    this.setState({\n                        playerNameError:'Please enter a username'\n                    })\n                    return false\n                } \n        } else if(this.props.site === Constants.SITE_PGN_FILE) {\n            if(this.state.files.length === 0) {\n                this.props.showError(\"Please upload a PGN file\")\n                return false\n            }\n        } else if(this.props.site === Constants.SITE_OPENING_TREE_FILE) {\n            if(this.state.files.length === 0) {\n                this.props.showError(\"Please upload an openingtree file\")\n                return false\n            }\n        } else if(this.props.site === Constants.SITE_ONLINE_TOURNAMENTS) {\n            if(!this.state.tournamentUrl){\n                this.setState({\n                    tournamentUrlError:'Please enter a url'\n                })\n                return false\n            } else {\n                \n                let url = this.state.tournamentUrl.trim()\n                if(!url.startsWith(\"http\")) {\n                    url = \"https://\"+url\n                }\n                let parsedUrl = null\n                try {\n                    parsedUrl = new URL(url)\n                } catch (e) {\n                    this.setState({\n                        tournamentUrlError:'Please enter a valid url'\n                    })\n                    return false\n                }\n                let hostname = parsedUrl.hostname\n                let tournamentSite = null;\n                if(hostname === 'lichess.org' || hostname.endsWith('.lichess.org')) {\n                    tournamentSite = Constants.SITE_LICHESS\n                } else if(hostname === 'chess.com' || hostname.endsWith('.chess.com')) {\n                    this.setState({\n                        tournamentUrlError:'chess.com tournaments are not currently supported'\n                    })\n                    return false;\n                }\n                if(!tournamentSite) {\n                    this.setState({\n                        tournamentUrlError:'Please enter a lichess.org url'\n                    })\n                    return false;\n                }\n                let pathComponents = parsedUrl.pathname.split(\"/\")\n                let tournamentId = null\n                let tournamentType = null\n                for(let i=0;i<pathComponents.length;i++) {\n                    if(pathComponents[i]) {\n                        tournamentType = pathComponents[i]\n                        break\n                    }\n                }\n\n                for(let i=pathComponents.length-1;i>=0;i--) {\n                    if(pathComponents[i]) {\n                        tournamentId = pathComponents[i]\n                        break\n                    }\n                }\n                if(!tournamentId) {\n                    this.setState({\n                        tournamentUrlError:'Please enter a valid tournament url'\n                    })\n                    return false;\n                }\n                \n                this.selectedOnlineTournament = {\n                    tournamentSite:tournamentSite,\n                    tournamentId:tournamentId,\n                    tournamentType:tournamentType\n                \n                }\n            }\n        }\n        return true\n    }\n    finalPlayerName(source, playerName, selectedNotablePlayer) {\n        if(source === Constants.SITE_PLAYER_DB) {\n            return selectedNotablePlayer.name\n        }\n        if(source === Constants.SITE_EVENT_DB) {\n            return ''\n        }\n        if(!playerName) {\n            return playerName\n        }\n        return playerName.trim()\n    }\n    setPlayerDetails() {\n         if(this.validateInputDetailsSet()) {\n            this.props.playerDetailsChange(\n                this.finalPlayerName(\n                    this.props.site, \n                    this.state.playerName,\n                    this.state.selectedPlayer), \n                this.state.files, \n                this.state.selectedEvent, \n                this.state.selectedPlayer,\n                this.selectedOnlineTournament)\n        }\n    }\n    \n    getSummary() {\n        if(this.props.site === Constants.SITE_PLAYER_DB){\n            if(this.props.selectedPlayer && this.props.selectedPlayer.name) {\n                return <span>\n                        {getNumberIcon('done')}\n                        {this.props.selectedPlayer.profile.title}{'\\u00A0'}\n                        <b>{this.props.selectedPlayer.name}</b>\n                    </span>\n            }\n        } else if(this.props.site === Constants.SITE_LICHESS || \n            this.props.site === Constants.SITE_CHESS_DOT_COM){\n            if(this.props.playerName) {\n                return <span>{getNumberIcon('done')}User: <b>{this.props.playerName}</b></span>\n            }\n        } else if(this.props.site === Constants.SITE_PGN_FILE || \n            this.props.site === Constants.SITE_OPENING_TREE_FILE){\n            if(this.props.files.length===1) {\n                return <span>{getNumberIcon('done')}File: <b>{this.props.files[0].name}</b></span>\n            }\n            if(this.props.files.length>1) {\n                return <span>{getNumberIcon('done')}{this.props.files.length} PGN files uploaded</span>\n            }\n        } else if(this.props.site === Constants.SITE_EVENT_DB) {\n            if(this.props.selectedEvent && this.props.selectedEvent.name) {\n                return <span>{getNumberIcon('done')}{this.props.selectedEvent.name}</span>\n            }\n        }\n        else if(this.props.site === Constants.SITE_ONLINE_TOURNAMENTS) {\n            if(this.props.selectedOnlineTournament) {\n                return <span>{getNumberIcon('done')}Id: <b>{this.props.selectedOnlineTournament.tournamentId}</b></span>\n            }\n        }\n        return <span>{getNumberIcon(2)}{this.title(this.props.site)}</span>\n    }\n\n    title(site){\n        if(site === Constants.SITE_ONLINE_TOURNAMENTS \n            || site === Constants.SITE_EVENT_DB) {\n            return \"Tournament details\"\n        } else if(site === Constants.SITE_OPENING_TREE_FILE \n            || site === Constants.SITE_PGN_FILE) {\n                return \"File details\"\n        } \n        return \"Player details\"\n    }\n\n    launchLichessOauth() {\n        trackEvent(\n            Constants.EVENT_CATEGORY_LICHESS_LOGIN, \"lichessLogin\")\n        console.log(this)\n        setTimeout(\n            this.props.oauthManager.fetchAuthorizationCode.bind(this.props.oauthManager), 150)\n        }\n    getLichessSelection() {\n        return <div>\n            {this.getLichessCardBody()}\n            <br/>\n            {this.getPlayerNameInput('lichess username')}\n        </div>\n    }\n\n    getLichessCardBody() {\n        if (this.props.lichessLoginState === Constants.LICHESS_STATE_PENDING) {\n            return <Card>\n                <div className=\"center\">\n                    <Spinner className=\"bigSpinner dividerMargin\" /><br/>\n                </div>\n            </Card>\n        } else if(this.props.lichessLoginState === Constants.LICHESS_FAILED_FETCH) {\n            return <Card><CardBody className=\"singlePadding\">\n            <CardTitle className=\"smallBottomMargin redColor\"><FontAwesomeIcon icon={faInfoCircle} className=\"lowOpacity\"/> Failed to fetch login status</CardTitle>\n            <CardTitle className=\"smallBottomMargin\"><FontAwesomeIcon icon={faSync} className=\"lowOpacity smallText leftMargin2\"/>\n            <span onClick={this.props.refreshLichessStatus} className=\"smallText linkStyle leftMargin4\"> Retry fetching status</span>\n            </CardTitle>\n            <CardTitle><FontAwesomeIcon icon={faSignOutAlt} className=\"lowOpacity smallText leftMargin2\"/>\n            <span onClick={this.props.logoutOfLichess} className=\"smallText linkStyle leftMargin4\"> Logout of lichess</span>\n            </CardTitle>\n    \n                    <MaterialUIButton\n                onClick={this.launchLichessOauth.bind(this)}\n                variant=\"contained\"\n                color=\"default\"\n                className=\"mainButton\" disableElevation\n                startIcon={<LockOpen />}\n                >\n                    LOGIN AGAIN\n                </MaterialUIButton>\n            </CardBody></Card>\n        } else if (this.props.lichessLoginState === Constants.LICHESS_LOGGED_IN && this.props.lichessLoginName) {\n            return <Card>\n                <CardBody className=\"singlePadding\">\n                    <CardTitle>\n                        <FontAwesomeIcon icon={faCheck} className=\"lowOpacity greenColor\"/> Logged in as\n                        <b> {this.props.lichessLoginName}</b>\n                        \n                    </CardTitle>\n                    \n                    <MaterialUIButton\n                        onClick={this.props.logoutOfLichess}\n                        variant=\"contained\"\n                        color=\"default\"\n                        className=\"mainButton\" disableElevation\n                        startIcon={<ExitToApp />}\n                        >\n                            LOGOUT\n                    </MaterialUIButton>\n                </CardBody>\n            </Card>\n        }\n        return <Card><CardBody className=\"singlePadding\">\n        <CardTitle className=\"smallBottomMargin\"><FontAwesomeIcon icon={faInfoCircle} className=\"lowOpacity\"/> Speed up tree building (optional)</CardTitle>\n        <CardText className=\"smallText\">\n            Lichess allows much faster download of games if you login. You can learn more about this <a href = 'https://lichess.org/api#operation/apiGamesUser' rel=\"noopener noreferrer\" target=\"_blank\">here</a>. \n            Recommended for viewing your own games or when your opponent has lots of games.\n        </CardText>\n        <MaterialUIButton\n                onClick={this.launchLichessOauth.bind(this)}\n                variant=\"contained\"\n                color=\"default\"\n                className=\"mainButton\" disableElevation\n                startIcon={<LockOpen />}\n                >\n                    LOGIN TO LICHESS\n                </MaterialUIButton>\n        </CardBody>\n        </Card>\n    }\n\n    getChessComSelection() {\n        return this.getPlayerNameInput('chess.com username')\n    }\n\n    getPlayerNameInput(label, helperText) {\n        return <TextField\n            className=\"playernameField\" name=\"playerName\" id=\"playerNameTextBox\" \n            margin=\"dense\" onChange={this.editPlayerName.bind(this)}\n            label={label} variant=\"outlined\" value={this.state.playerName}\n            helperText={this.state.playerNameError? this.state.playerNameError:helperText}\n            error={this.state.playerNameError?true:false} onKeyUp={this.playerNameKeyUp.bind(this)}/>\n    }\n\n    getOnlineTournamentSelection() {\n        return <div>\n            {this.getOnlineTournamentCard()}\n            <br/>\n            {this.getOnlineTournamentInput('Enter tournament url', 'eg. https://lichess.org/tournament/QlooVt7W')}\n        </div>\n    }\n    getOnlineTournamentCard(){\n        return <Card>\n        <CardBody className=\"singlePadding\">\n        <CardTitle className=\"smallBottomMargin\"><FontAwesomeIcon icon={faInfoCircle} className=\"lowOpacity\"/> How it works</CardTitle>\n        <CardText className=\"smallText\">\n            You can load all of the games of a lichess tournament by copying the  url from your address bar on those sites and pasting it below.\n            <br/><br/>\n            <b>Why is chess.com not supported?</b>\n            <br/>chess.com API has a few bugs in returning tournament games so we are not able to support them currently. Bugs have been reported to chess.com.\n            \n        </CardText>\n        </CardBody>\n        </Card>\n    }\n    \n\n    getOnlineTournamentInput(label, helperText) {\n        return <TextField\n            className=\"urlField\" name=\"onlineTournament\" id=\"onlineTournamentTextBox\" \n            margin=\"dense\" onChange={this.editTournamentUrl.bind(this)}\n            label={label} variant=\"outlined\" value={this.state.tournamentUrl}\n            helperText={this.state.tournamentUrlError? this.state.tournamentUrlError:helperText}\n            error={this.state.tournamentUrlError?true:false} onKeyUp={this.playerNameKeyUp.bind(this)}/>\n    }\n\n    playerNameKeyUp(evt) {\n        if(evt.keyCode === 13) { // enter key pressed\n            this.setPlayerDetails()\n        }\n    }\n    getGoatDBSelection(){\n        return <NotableChessGames \n            list={this.props.notablePlayers} \n            placeholder=\"Select a player\"\n            onChange={this.notablePlayerChange.bind(this)}\n            selectedDetail={this.state.selectedPlayer}/>\n    }\n    getGoatDBEventSelection(){\n        return <NotableChessGames \n            list={this.props.notableEvents} \n            placeholder=\"Select an event\"\n            onChange={this.notableEventChange.bind(this)}\n            selectedDetail={this.state.selectedEvent}/>\n    }\n\n    getPgnFileSelection() {\n        return <div><Dropzone filesChange={this.filesChange.bind(this)} filesLimit={10}\n        dropzoneText=\"Drag and drop up to 10 pgn files here or click here to select files\"\n                />\n                {this.getPlayerNameInput('player name in PGN', 'Leave blank to load all games')}\n                </div>\n    }\n\n    getOpeningTreeSelection() {\n        return <div>\n            <Card>\n                <CardBody className=\"singlePadding\">\n                <CardTitle className=\"smallBottomMargin\"><FontAwesomeIcon icon={faInfoCircle} className=\"lowOpacity\"/> How it works</CardTitle>\n                <CardText className=\"smallText\">\n                    If you plan to revisit the same player, you can save a <b>.tree</b> file locally by loading a tree and then clicking <i>\"Save .tree file\"</i>.\n                    To reload the same tree, drop the <b>.tree</b> file in the dropzone below.\n                </CardText>\n                </CardBody>\n                </Card><br/>\n            <Dropzone filesChange={this.filesChange.bind(this)} filesLimit={1}\n                    dropzoneText=\"Drag and drop openingtree save file here or click here to select a file\"\n                />\n        </div>\n    }\n\n    getInputsToShow() {\n        if(this.props.site === Constants.SITE_PGN_FILE) {\n            return this.getPgnFileSelection()\n        } else if (this.props.site === Constants.SITE_LICHESS) {\n            return this.getLichessSelection()\n        } else if (this.props.site === Constants.SITE_CHESS_DOT_COM) {\n            return this.getChessComSelection()\n        } else if (this.props.site === Constants.SITE_EVENT_DB) {\n            return this.getGoatDBEventSelection()\n        } else if (this.props.site === Constants.SITE_PLAYER_DB) {\n            return this.getGoatDBSelection()\n        } else if(this.props.site === Constants.SITE_OPENING_TREE_FILE) {\n            return this.getOpeningTreeSelection()\n        } else if(this.props.site === Constants.SITE_ONLINE_TOURNAMENTS) {\n            return this.getOnlineTournamentSelection()\n        }\n        return <div/>\n    }\n\n    render() {\n        return <Accordion expanded={this.props.expandedPanel === 'user'}\n                TransitionComponent={Collapse}\n                TransitionProps={{timeout:Constants.LOADER_ANIMATION_DURATION_MS}}\n                onChange={this.props.handleExpansionChange} \n                disabled={this.props.site===''}>\n                <AccordionSummary expandIcon={<ExpandMoreIcon />}>{this.getSummary()}</AccordionSummary>\n                <AccordionDetails>\n                        {this.getInputsToShow()}\n                </AccordionDetails>\n                <Divider />\n                <AccordionActions>\n                    <MaterialUIButton size=\"small\" color=\"primary\" onClick={this.setPlayerDetails.bind(this)}>Continue</MaterialUIButton>\n                </AccordionActions></Accordion>\n            \n    }\n}","import { Accordion, getNumberIcon } from './Common';\nimport * as Constants from '../../app/Constants';\n\nimport React from 'react';\n\nimport {\n    AccordionActions,\n    AccordionDetails,\n    AccordionSummary,\n    Button as MaterialUIButton,\n    Collapse,\n    Divider,\n    FormControlLabel,\n    Radio,\n    RadioGroup\n} from '@material-ui/core';\n\nimport { ExpandMore } from '@material-ui/icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faFlagCheckered, faChessKing, faDiceThree, faMountain, faHouseDamage } from '@fortawesome/free-solid-svg-icons';\n\nexport default class Variants extends React.Component {\n\n\n    getVariantOption(variant, addNumber) {\n        return <span>\n            {addNumber?getNumberIcon('done', addNumber):null}\n            <FontAwesomeIcon icon={this.getVariantIcon(variant)} /> <span> {this.getVariantText(variant)} </span>\n        </span>\n    }\n\n    getVariantText(variant) {\n        if (variant === Constants.VARIANT_RACING_KINGS) {\n            return \"Racing kings\"\n        } else if (variant === Constants.VARIANT_THREE_CHECK) {\n            return \"Three check\"\n        } else if (variant === Constants.VARIANT_KING_OF_THE_HILL) {\n            return \"King of the hill\"\n        } else if (variant === Constants.VARIANT_CRAZYHOUSE) {\n            return \"Crazyhouse\"\n        }\n        return \"Standard rules\"\n    }\n\n    getVariantIcon(variant) {\n        if (variant === Constants.VARIANT_RACING_KINGS) {\n            return faFlagCheckered\n        } else if (variant === Constants.VARIANT_THREE_CHECK) {\n            return faDiceThree\n        } else if (variant === Constants.VARIANT_KING_OF_THE_HILL) {\n            return faMountain\n        } else if (variant === Constants.VARIANT_CRAZYHOUSE) {\n            return faHouseDamage\n        }\n        return faChessKing\n    }\n    changeLink(){\n        return this.props.expandedPanel === 'variant'?null:<span className=\"smallText\" style={{\"verticalAlign\":\"text-bottom\"}}>&nbsp;[<span className=\"linkStyle\">change</span>]</span>\n    }\n    getVariantRadio(source) {\n        return <FormControlLabel\n                className=\"sitelabel\"\n                value={source}\n                control={<Radio color=\"primary\" />}\n                label={this.getVariantOption(source)} />\n    }\n    continue(){\n        this.props.variantChange(this.props.variant)\n    }\n    setVariant(event){\n        let newVariant = event.target.value\n        this.props.variantChange(newVariant)\n    }\n\n    render() {\n        return <Accordion TransitionComponent={Collapse}\n            TransitionProps={{timeout:Constants.LOADER_ANIMATION_DURATION_MS}}\n            expanded={this.props.expandedPanel === 'variant'}\n            onChange={this.props.handleExpansionChange}>\n            <AccordionSummary\n                expandIcon={<ExpandMore />}\n                aria-controls=\"panel1c-content\"\n                id=\"panel1c-header\"\n            >\n                <div>\n                    {this.getVariantOption(this.props.variant, true)}\n                </div>\n                <div>\n                    {this.changeLink()}\n                </div>\n            </AccordionSummary>\n            <AccordionDetails>\n                <RadioGroup onChange={this.setVariant.bind(this)} value={this.props.variant}>\n                    {this.getVariantRadio(Constants.VARIANT_STANDARD)}\n                    {this.getVariantRadio(Constants.VARIANT_CRAZYHOUSE)}\n                    {this.getVariantRadio(Constants.VARIANT_THREE_CHECK)}\n                    {this.getVariantRadio(Constants.VARIANT_KING_OF_THE_HILL)}\n                    {this.getVariantRadio(Constants.VARIANT_RACING_KINGS)}\n               </RadioGroup>\n            </AccordionDetails>\n            <Divider />\n\n            <AccordionActions>\n                <MaterialUIButton size=\"small\" color=\"primary\" onClick={this.continue.bind(this)}>Continue</MaterialUIButton>\n            </AccordionActions>\n        </Accordion>\n\n    }\n}\n","import React from 'react'\nimport { createSubObjectWithProperties } from '../../app/util'\nimport * as Constants from '../../app/Constants'\nimport { trackEvent } from '../../app/Analytics'\nimport Source from './Source'\nimport User from './User'\nimport Filters from './Filters'\nimport Actions from './Actions'\nimport Variants from './Variants'\nimport request from 'request'\nimport * as SitePolicy from '../../app/SitePolicy'\nimport cookieManager from '../../app/CookieManager'\n\nexport default class PGNLoader extends React.Component {\n\n    constructor(props) {\n        super(props)\n        let selectedSite = new URLSearchParams(window.location.search).get(\"source\")\n\n        this.state = {\n            playerName: '',\n            site: selectedSite?selectedSite:'',\n            playerColor: this.props.settings.playerColor,\n            isAdvancedFiltersOpen: false,\n            isGamesSubsectionOpen: false,\n            expandedPanel: selectedSite?'user':'source',\n            notablePlayers:null,\n            notableEvents:null,\n            files:[],\n            selectedNotableEvent:{},\n            selectedNotablePlayer:{},\n            lichessLoginState: Constants.LICHESS_NOT_LOGGED_IN,\n            lichessLoginName: null\n        }\n        if(selectedSite === Constants.SITE_LICHESS) {\n            this.fetchLichessLoginStatus()\n        }\n        this.state[Constants.FILTER_NAME_DOWNLOAD_LIMIT] = Constants.MAX_DOWNLOAD_LIMIT\n        this.state[Constants.TIME_CONTROL_ULTRA_BULLET] = true\n        this.state[Constants.TIME_CONTROL_BULLET] = true\n        this.state[Constants.TIME_CONTROL_BLITZ] = true\n        this.state[Constants.TIME_CONTROL_RAPID] = true\n        this.state[Constants.TIME_CONTROL_CLASSICAL] = true\n        this.state[Constants.TIME_CONTROL_CORRESPONDENCE] = true\n        this.state[Constants.TIME_CONTROL_DAILY] = true\n        this.state[Constants.FILTER_NAME_RATED] = \"all\"\n        this.state[Constants.FILTER_NAME_ELO_RANGE] = [0, Constants.MAX_ELO_RATING]\n        this.state[Constants.FILTER_NAME_OPPONENT] = ''\n    }\n\n\n    advancedFilters() {\n        return createSubObjectWithProperties(this.state,\n            [Constants.TIME_CONTROL_ULTRA_BULLET, Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_BLITZ, Constants.TIME_CONTROL_RAPID,\n            Constants.TIME_CONTROL_CORRESPONDENCE, Constants.TIME_CONTROL_DAILY,\n            Constants.TIME_CONTROL_CLASSICAL, Constants.FILTER_NAME_RATED,\n            Constants.FILTER_NAME_DOWNLOAD_LIMIT,\n            Constants.FILTER_NAME_ELO_RANGE, Constants.FILTER_NAME_OPPONENT,\n            Constants.FILTER_NAME_FROM_DATE, Constants.FILTER_NAME_TO_DATE])\n    }\n\n\n    handleExpansionChange(panel) {\n        return (event, newExpanded) => {\n            this.setState({ expandedPanel: newExpanded ? panel : false });\n        };\n    }\n\n    exportOpeningTreeObject(){\n        return {\n            header:{\n                version:2,// current openingtree file version. used to check compatibility of files\n                timestamp:Math.floor(Date.now() / 1000),\n                gamesProcessed:this.props.gamesProcessed,\n                settings:this.props.settings,\n                playerName:this.state.playername,\n                site: this.state.site,\n                advancedFilters:this.advancedFilters(),\n                variant:this.props.variant\n            },\n            arrays: [[...this.props.openingGraph.graph.nodes.entries()],\n                        [...this.props.openingGraph.graph.pgnStats]]\n        }\n    }\n\n    importOpeningTreeObject(openingTreeSave) {\n        let saveVersion = 1;\n        if(openingTreeSave.header.version) {\n            saveVersion = openingTreeSave.header.version\n        }\n        if(saveVersion < Constants.OPENING_TREE_FILE_CURRENT_VERSION) {\n            this.props.showError(\"This is an old format of openingtree file.\", null, \n                \"You can try loading it by visiting the old website\", Constants.ERROR_ACTION_VISIT_OLD_SITE)\n            return false\n        }\n        this.setState({\n            ...openingTreeSave.header.advancedFilters,\n            playerColor:openingTreeSave.header.settings.playerColor,\n            site:openingTreeSave.header.site,\n            playerName:openingTreeSave.header.settings.playerName,\n        })\n        this.props.openingGraph.setEntries(openingTreeSave.arrays[0], openingTreeSave.arrays[1])\n        this.props.importCallback({\n            settings:openingTreeSave.header.settings,\n            gamesProcessed:openingTreeSave.header.gamesProcessed,\n            openingGraph:this.props.openingGraph,\n            variant:openingTreeSave.header.variant\n        })\n        return true\n    }\n\n    playerDetailsChange(playerName, files, selectedNotableEvent, selectedNotablePlayer, selectedOnlineTournament) {\n        this.setState({\n            playerName: playerName,\n            expandedPanel:SitePolicy.isFilterPanelEnabled(this.state.site, playerName, selectedNotablePlayer)?'filters':'',\n            files:files,\n            selectedNotableEvent:selectedNotableEvent,\n            selectedNotablePlayer:selectedNotablePlayer,\n            playerColor:'',\n            selectedOnlineTournament:selectedOnlineTournament\n        })\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"PlayerNameSaved\")\n    }\n    fetchGOATGames(url, callback){\n        request.get(url, (error, response) =>{\n            if(error) {\n                this.props.showError(\"Could not fetch player list. Failed to connect to DB.\")\n                callback([])\n                return \n            }\n            let gamesDetails\n            try{\n                gamesDetails = JSON.parse(response.body).list\n            } catch (e) {\n                console.log(e)\n            }\n            if(!gamesDetails) {\n                this.props.showError(\"Failed to load games.\")\n                callback([])\n            } else {\n                callback(gamesDetails)\n            }\n        })\n    }\n\n\n\n    siteChange(newSite) {\n        if(newSite === Constants.SITE_PLAYER_DB && !this.state.notablePlayers) {\n            this.fetchGOATGames('https://goatchess.github.io/list.json', (gamesDetails)=>{\n                this.setState({notablePlayers:gamesDetails})\n            })\n        }\n        if(newSite === Constants.SITE_EVENT_DB && !this.state.notableEvents) {\n            this.fetchGOATGames('https://goatevents.github.io/list.json', (gamesDetails)=>{\n                this.setState({notableEvents:gamesDetails})\n            })\n        }\n        if(newSite === Constants.SITE_LICHESS) {\n            this.fetchLichessLoginStatus()\n        }\n\n        this.setState({ site: newSite, expandedPanel:'user'})\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"ChangeSite\", newSite)\n    }\n    fetchLichessLoginStatus(){\n        let lichessAccessToken = cookieManager.getLichessAccessToken()\n        if(lichessAccessToken) {\n            trackEvent(Constants.EVENT_CATEGORY_LICHESS_LOGIN, \"lichessTokenFound\")\n\n            this.setState({lichessLoginState:Constants.LICHESS_STATE_PENDING})\n            \n            request.get(\"https://lichess.org/api/account\", {timeout:5000, auth:{bearer:cookieManager.getLichessAccessToken()}}, (error, response)=>{\n                if(!error && response) {\n                    let responseObj = JSON.parse(response.body) \n                    if(responseObj && responseObj.username) {\n                        this.setState({\n                            lichessLoginState:Constants.LICHESS_LOGGED_IN,\n                            lichessLoginName:responseObj.username\n                        })\n                        trackEvent(Constants.EVENT_CATEGORY_LICHESS_LOGIN, \"lichessFetchSuccess\")\n                        return\n                    } \n                } \n                trackEvent(Constants.EVENT_CATEGORY_LICHESS_LOGIN, \"lichessFetchFailed\")\n                this.setState({lichessLoginState:Constants.LICHESS_FAILED_FETCH})\n            })\n        } else {\n            trackEvent(Constants.EVENT_CATEGORY_LICHESS_LOGIN, \"lichessNoToken\")\n        }\n    }\n    logoutOfLichess() {\n        cookieManager.deleteLichessAccessToken()\n        this.setState({\n            lichessLoginState:Constants.LICHESS_NOT_LOGGED_IN,\n            lichessLoginName:''\n        })\n        trackEvent(Constants.EVENT_CATEGORY_LICHESS_LOGIN, \"lichessLogout\")\n    }\n\n    filtersChange(filters) {\n        this.setState({...filters, expandedPanel:''})\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"FitlersSaved\", this.state.site)\n    }\n    variantChange(newVariant) {\n        this.setState({expandedPanel:'source'})\n        this.props.variantChange(newVariant)\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"VariantChange\", newVariant)\n    }\n\n    render() {\n        return <div><div className=\"pgnloadersection\">\n            <Variants expandedPanel={this.state.expandedPanel}\n                handleExpansionChange={this.handleExpansionChange('variant').bind(this)}\n                variantChange={this.variantChange.bind(this)} variant={this.props.variant}/>\n            <Source expandedPanel={this.state.expandedPanel}\n                handleExpansionChange={this.handleExpansionChange('source').bind(this)}\n                site={this.state.site} siteChange={this.siteChange.bind(this)}\n                variant={this.props.variant}/>\n            <User expandedPanel={this.state.expandedPanel} playerName={this.state.playerName}\n                handleExpansionChange={this.handleExpansionChange('user').bind(this)} \n                showError={this.props.showError} files={this.state.files} notablePlayers={this.state.notablePlayers}\n                notableEvents={this.state.notableEvents} site={this.state.site} playerDetailsChange={this.playerDetailsChange.bind(this)}\n                pgnUrl={this.state.pgnUrl} selectedPlayer={this.state.selectedNotablePlayer} selectedEvent={this.state.selectedNotableEvent}\n                lichessLoginState={this.state.lichessLoginState} lichessLoginName={this.state.lichessLoginName}\n                logoutOfLichess={this.logoutOfLichess.bind(this)} refreshLichessStatus={this.fetchLichessLoginStatus.bind(this)}\n                selectedOnlineTournament={this.state.selectedOnlineTournament} oauthManager={this.props.oauthManager}\n            />\n            <Filters expandedPanel={this.state.expandedPanel} playerColor={this.state.playerColor}\n                handleExpansionChange={this.handleExpansionChange('filters').bind(this)}\n                site={this.state.site} playerName={this.state.playerName} advancedFilters={this.advancedFilters()}\n                filtersChange={this.filtersChange.bind(this)}\n                selectedNotablePlayer={this.state.selectedNotablePlayer} />\n            </div>\n            <Actions expandedPanel={this.state.expandedPanel} playerColor={this.state.playerColor} files={this.state.files}\n                playerName={this.state.playerName} site={this.state.site} advancedFilters={this.advancedFilters()}\n                notify={this.props.notify} showError={this.props.showError} onChange={this.props.onChange}\n                setDownloading={this.props.setDownloading} clear={this.props.clear} isDownloading={this.props.isDownloading}\n                switchToMovesTab={this.props.switchToMovesTab} gamesProcessed={this.props.gamesProcessed} \n                selectedNotablePlayer={this.state.selectedNotablePlayer} selectedNotableEvent={this.state.selectedNotableEvent}\n                exportOpeningTreeObject={this.exportOpeningTreeObject.bind(this)} showInfo={this.props.showInfo}\n                importOpeningTreeObject={this.importOpeningTreeObject.bind(this)} selectedOnlineTournament={this.state.selectedOnlineTournament}\n                variant={this.props.variant}/>\n        </div>\n    }\n\n}","import React from 'react';\nimport { Button, Col, Container, Row } from 'reactstrap';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faDesktop, faFastBackward, faMoon, faLightbulb, faRetweet, faTrashAlt } from '@fortawesome/free-solid-svg-icons';\n\nimport { trackEvent } from '../app/Analytics';\nimport * as Constants from '../app/Constants';\n\nexport default class SettingsView extends React.Component {\n    constructor(props){\n        super(props)\n        window.addEventListener(\"keydown\",this.keyHandler.bind(this))\n    }\n\n    keyHandler(e){\n        if (e.srcElement && e.srcElement.tagName === 'INPUT') {\n            return;\n        }\n\n        switch(e.keyCode) {\n            case 70: // F key\n                this.toggle(Constants.SETTING_NAME_ORIENTATION)();\n                break;\n            default:\n                break;\n        }\n    }\n\n    toggle(eventName) {\n        return (() => {\n            let newValue;\n            switch (eventName) {\n                case Constants.SETTING_NAME_ORIENTATION:\n                    newValue = this.props.settings[eventName] === Constants.PLAYER_COLOR_WHITE\n                        ? Constants.PLAYER_COLOR_BLACK\n                        : Constants.PLAYER_COLOR_WHITE;\n                    trackEvent(Constants.EVENT_CATEGORY_CONTROLS, \"ChangeOrientation\")\n                    break;\n                case Constants.SETTING_NAME_DARK_MODE:\n                    newValue = !this.props.settings[eventName];\n                    trackEvent(Constants.EVENT_CATEGORY_CONTROLS, \"DarkMode\");\n                    break;\n                default:\n                    break;\n            }\n            this.props.onChange(eventName, newValue);\n        })\n    }\n\n    analyse() {\n        window.open(`https://www.lichess.org/analysis/standard/${this.props.fen}`, '_blank');\n        trackEvent(Constants.EVENT_CATEGORY_CONTROLS, \"AnalyzeGame\")\n    }\n\n    resetAction() {\n        this.props.reset()\n        trackEvent(Constants.EVENT_CATEGORY_CONTROLS, \"Reset\")\n    }\n\n    clearAction() {\n        this.props.clear()\n        trackEvent(Constants.EVENT_CATEGORY_CONTROLS, \"Clear\")\n    }\n\n    render() {\n        return <div>\n            <Container>\n                <Row>\n                    <Col xs=\"4\">\n                        <Button className=\"settingButton\" onClick = {this.toggle(Constants.SETTING_NAME_ORIENTATION)} color=\"\">\n                            <h3>\n                                <FontAwesomeIcon icon={faRetweet} />\n                            </h3>\n                            <span>\n                                Flip board\n                            </span>\n                        </Button>\n                    </Col>\n                    <Col xs=\"4\">\n                        <Button className=\"settingButton\" onClick = {this.clearAction.bind(this)} color=\"\">\n                            <h3>\n                                <FontAwesomeIcon icon={faTrashAlt} />\n                            </h3>\n                            <span>\n                                Clear games\n                            </span>\n                        </Button>\n                    </Col>\n                    <Col xs=\"4\">\n                        <Button className=\"settingButton\" onClick = {this.resetAction.bind(this)} color=\"\">\n                            <h3>\n                                <FontAwesomeIcon icon={faFastBackward} />\n                            </h3>\n                            <span>\n                                Starting position\n                            </span>\n                        </Button>\n                    </Col>\n                    <Col xs=\"4\">\n                        <Button className=\"settingButton\" onClick = {this.analyse.bind(this)} color=\"\">\n                            <h3>\n                                <FontAwesomeIcon icon={faDesktop} />\n                            </h3>\n                            <span>\n                                Computer analysis\n                            </span>\n                        </Button>\n                    </Col>\n                    <Col xs=\"4\">\n                        <Button className=\"settingButton\" onClick={this.toggle(Constants.SETTING_NAME_DARK_MODE)} color=\"\">\n                            <h3>\n                                <FontAwesomeIcon icon={this.props.settings.darkMode?faLightbulb:faMoon} />\n                            </h3>\n                            <span>\n                                {this.props.settings.darkMode?\"Light mode\":\"Dark mode\"}\n                            </span>\n                        </Button>\n                    </Col>\n                </Row>\n            </Container>\n        </div>\n    }\n}","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faExternalLinkAlt, faUser } from '@fortawesome/free-solid-svg-icons'\nimport { Table, TableRow, TableHead, TableBody, TableCell, TableFooter, TextField } from '@material-ui/core';\nimport React from 'react'\nimport {getPerformanceDetails} from '../app/util'\nimport {copyText} from './loader/Common'\n\nexport default class ReportControls extends React.Component {\n    eatClicks(e) {\n        e.stopPropagation()\n    }\n\n    copyFen() {\n        copyText(\"fenField\")/* Get the text field */\n        /* Alert the copied text */\n        this.props.showInfo(\"FEN copied\");\n    }\n\n    getFenField() {\n        return this.props.simplifiedView?null:\n            <div className=\"fenDiv\">\n            <TextField\n                id=\"fenField\"\n                multiline\n                label=\"FEN\"\n                rowsMax=\"2\"\n                value={this.props.fen}\n                inputProps={{\n                    style: {fontSize: 12},\n                    spellCheck: false,\n                  }}\n                  variant=\"outlined\"\n                className=\"fenField\"\n                margin=\"dense\"\n                onClick = {this.copyFen.bind(this)}\n                /></div>\n    }\n\n\n    render() {\n        let moveDetails = this.props.moveDetails\n        if(!moveDetails.hasData) {\n            return <div>{this.getFenField()}<div className = \"infoMessage\" >No data to show. Please enter a lichess or chess.com user name in the\n                <span className = \"navLinkButton\" onClick={()=>this.props.switchToUserTab()}> <FontAwesomeIcon icon={faUser} /> User</span> tab and click \"Load\"</div>\n                </div>\n        }\n        let performanceDetails = {}\n        if(this.props.isOpen) {\n            performanceDetails = getPerformanceDetails(moveDetails.totalOpponentElo,\n                                                        moveDetails.averageElo,\n                                                        moveDetails.whiteWins,\n                                                        moveDetails.draws,\n                                                        moveDetails.blackWins,\n                                                        this.props.settings.playerColor)\n        }\n\n        return <div className=\"performanceOverlay\">\n            {this.getFenField()}\n            <Table onClick={this.eatClicks}>\n            {!performanceDetails.performanceRating || (isNaN(performanceDetails.performanceRating) || !this.props.settings.playerName)?\n            null:\n            <TableHead className={`performanceRatingRow${this.props.simplifiedView?\" performanceHeader\":\"\"}`}>\n                <TableRow>\n                <TableCell className=\"performanceRatingRow\"><b>Performance</b></TableCell>\n                <TableCell className=\"performanceRatingRow\"><b>{performanceDetails.performanceRating}</b></TableCell>\n                </TableRow>\n            </TableHead>}\n            <TableBody>\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Results</TableCell>\n                <TableCell className=\"performanceRatingRow\">{performanceDetails.results}</TableCell>\n            </TableRow>\n            {(isNaN(performanceDetails.averageOpponentElo) || performanceDetails.averageOpponentElo <= 0 || !this.props.settings.playerName)?null:\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Avg opponent</TableCell>\n                <TableCell className=\"performanceRatingRow\">{performanceDetails.averageOpponentElo}</TableCell>\n            </TableRow>}\n            {(isNaN(performanceDetails.averageElo))?null:\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Avg Rating</TableCell>\n                <TableCell className=\"performanceRatingRow\">{performanceDetails.averageElo}</TableCell>\n            </TableRow>}\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Score</TableCell>\n                <TableCell className=\"performanceRatingRow\">{performanceDetails.score}</TableCell>\n            </TableRow>\n            {((this.props.simplifiedView || isNaN(performanceDetails.averageElo)) || !this.props.settings.playerName)?null:\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Rating change</TableCell>\n                <TableCell className=\"performanceRatingRow\">{performanceDetails.ratingChange}</TableCell>\n            </TableRow>\n            }\n            {(this.props.settings.playerName && !this.props.simplifiedView && moveDetails.bestWinElo)?<TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Best win</TableCell>\n                <TableCell className=\"performanceRatingRow\">{moveDetails.bestWinElo} <FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(moveDetails.bestWinGame)} icon={faExternalLinkAlt}/></TableCell>\n            </TableRow>:null}\n            {(this.props.settings.playerName && !this.props.simplifiedView && moveDetails.worstLossElo)?<TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Worst loss</TableCell>\n                <TableCell className=\"performanceRatingRow\">{moveDetails.worstLossElo} <FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(moveDetails.worstLossGame)} icon={faExternalLinkAlt}/></TableCell>\n            </TableRow>:null}\n            {(!this.props.simplifiedView && moveDetails.longestGameInfo)?<TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Longest game</TableCell>\n                <TableCell className=\"performanceRatingRow\">{moveDetails.longestGameInfo.numberOfPlys} Plys <FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(moveDetails.longestGameInfo)} icon={faExternalLinkAlt}/></TableCell>\n            </TableRow>:null}\n            {(!this.props.simplifiedView && moveDetails.shortestGameInfo)?<TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Shortest game</TableCell>\n                <TableCell className=\"performanceRatingRow\">{moveDetails.shortestGameInfo.numberOfPlys} Plys <FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(moveDetails.shortestGameInfo)} icon={faExternalLinkAlt}/></TableCell>\n            </TableRow>:null}\n\n            {moveDetails.lastPlayedGame?<TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Last played</TableCell>\n                <TableCell className=\"performanceRatingRow\">{this.removeQuestionMarksFromDate(moveDetails.lastPlayedGame.date)} <FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(moveDetails.lastPlayedGame)} icon={faExternalLinkAlt}/></TableCell>\n            </TableRow>:null}\n            </TableBody>\n            {!this.props.reportFooter?null:\n            <TableFooter>\n                <TableRow>\n                    <TableCell colSpan=\"2\">{this.props.reportFooter}</TableCell>\n                </TableRow>\n            </TableFooter>\n            }\n        </Table></div>\n    }\n\n    removeQuestionMarksFromDate(date) {\n        if(!date || date.indexOf('?') === -1) {\n            return date\n        }\n        return date.slice(0, date.indexOf('.'))\n    }\n}","import React from 'react'\nimport { Card, CardBody, CardText, CardTitle } from 'reactstrap'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faInfoCircle} from '@fortawesome/free-solid-svg-icons'\nimport { Button as MaterialUIButton } from '@material-ui/core'\n\nexport function playerDetails(name, elo) {\n    return `${name}${elo?`(${elo})`:''}`\n}\n\nexport function offCard(title, message, action, actionText, actionIcon) {\n    return <Card className=\"errorCard\">\n               <CardBody className=\"singlePadding\">\n                   <CardTitle className=\"smallBottomMargin\">\n                       <FontAwesomeIcon icon={faInfoCircle}\n                                        className=\"lowOpacity\"/>\n\t\t       {' ' + title}\n                   </CardTitle>\n                   <CardText className=\"smallText\">\n                       {message}<br/><br/>\n                       {actionText ?\n                        <MaterialUIButton onClick={action}\n                                          variant=\"contained\"\n                                          color=\"default\"\n                                          className=\"mainButton\"\n                                          disableElevation\n                                          startIcon={actionIcon}>\n                            {actionText}\n                        </MaterialUIButton>\n                        :\n                        null}\n                   </CardText>\n               </CardBody>\n           </Card>\n}\n","import React from 'react'\nimport {\n    Modal,\n    ModalHeader,\n    ModalBody,\n    ModalFooter,\n    Button\n} from 'reactstrap'\nimport Switch from '@material-ui/core/Switch';\nimport {\n    FormControlLabel\n} from '@material-ui/core'\nimport {\n    ToggleButtonGroup,\n    ToggleButton\n} from '@material-ui/lab'\nimport * as Constants from '../../app/Constants'\nimport { Collapse, CardBody, Card, CardText } from 'reactstrap';\nimport Link from '@material-ui/core/Link'\nimport {trackEvent} from '../../app/Analytics'\n\nexport default class MovesSettings extends React.Component {\n    constructor(props) {\n        super(props)\n        let mSettings = Object.assign({},this.props.settings.movesSettings)\n        mSettings.openingBookType = this.getTransformedBookType(mSettings.openingBookType)\n        this.state={\n            movesSettings: mSettings,\n            indicatorInfoOpen:false\n        }\n    }\n\n    updateMoveSetting(key) {\n        return (e, value) => {\n            if(Array.isArray(value) && value.length <1) {\n                return\n            }\n            let newMovesSettings = Object.assign({},this.state.movesSettings)\n            newMovesSettings[key] = value\n            this.setState({\n                movesSettings:newMovesSettings\n            })\n        }\n    }\n\n    cancel() {\n        //reset to original settings\n        this.setState({movesSettings: this.props.settings.movesSettings})\n        this.props.toggle()\n        trackEvent(Constants.EVENT_CATEGORY_SETTINGS, \"MoveSettingsCancel\")\n    }\n\n    set() {\n        //reset to  new settings\n        this.props.settingsChange(Constants.SETTING_NAME_MOVES_SETTINGS, this.state.movesSettings)\n        this.props.toggle()\n        trackEvent(Constants.EVENT_CATEGORY_SETTINGS, \"MoveSettingsSet\")\n    }\n\n    toggleIndicatorInfo(e) {\n        this.setState({indicatorInfoOpen:!this.state.indicatorInfoOpen})\n        if(!this.state.indicatorInfoOpen) {\n            trackEvent(Constants.EVENT_CATEGORY_SETTINGS, \"MoveSettingsIndicatorInfo\")\n        }\n    }\n\n    render() {\n        return <Modal isOpen={this.props.isOpen} toggle={this.cancel.bind(this)}>\n            <ModalHeader toggle={this.cancel.bind(this)}>Opening book settings</ModalHeader>\n            <ModalBody>\n                <div className=\"littlePaddingTop\">{this.getOpeningBookType()}</div>\n                {this.state.movesSettings.openingBookType === Constants.OPENING_BOOK_TYPE_LICHESS?\n                <div className=\"littlePaddingTop\">{this.getOpeningBookRating()}</div>\n                :null}   \n                {this.state.movesSettings.openingBookType === Constants.OPENING_BOOK_TYPE_LICHESS?\n                <div className=\"littlePaddingTop\">{this.getOpeningBookTimeControls()}</div>\n                :null}   \n                <div className=\"littlePaddingTop\">{this.getIndicatorSwitch(\"openingBookWinsIndicator\", <span>Book indicators <Link href=\"#\" className=\"smallText\" onClick={this.toggleIndicatorInfo.bind(this)}>whats this?</Link></span>)}</div>\n                <Collapse isOpen={this.state.indicatorInfoOpen}>\n                <Card>\n                    <CardBody className=\"singlePadding\">\n                    <img src=\"./images/bookIndicator.png\" alt=\"bookIndicator\"/>\n                    <CardText className=\"smallText\">\n                        Little triangles indicate the openingbook statistics on the moves tab and the player \n                        statistics on the openingbook tab. <br/>Everything left of the white triangle is a win for white, \n                        everything right of the black triangle is a win for black and everything in the middle is a draw.<br/>\n                        If there is only a black triangle and no white, it means there are no draws.</CardText>\n                    </CardBody>\n                    </Card>\n                </Collapse>\n            </ModalBody>\n            <ModalFooter>\n            <Button color=\"link\" onClick={this.cancel.bind(this)}>Cancel</Button>\n            <Button color=\"primary\" onClick={this.set.bind(this)}>Set</Button>\n\n            </ModalFooter>\n        </Modal>\n    }\n\n    getIndicatorSwitch(name, label) {\n        return <div><FormControlLabel\n            control={\n                <Switch\n                    checked={this.state.movesSettings[name]}\n                    name={name}\n                    color=\"primary\"\n                />\n            }\n            onChange={this.updateMoveSetting(name)}\n            label={label}\n      /></div>\n    }\n\n    mastersBookAvailable() {\n        // masters book is only available for standard mode\n        return this.props.variant === Constants.VARIANT_STANDARD\n    }\n\n    getTransformedBookType(value){\n        //if masters book is not available, use lichess book\n        if(value === Constants.OPENING_BOOK_TYPE_MASTERS\n            && !this.mastersBookAvailable()) {\n            return Constants.OPENING_BOOK_TYPE_LICHESS\n        }\n        return value\n    }\n\n    getOpeningBookType() {\n        return <div>Book type<br/><ToggleButtonGroup size=\"small\" exclusive={true} value={this.getTransformedBookType(this.state.movesSettings.openingBookType)} onChange={this.updateMoveSetting('openingBookType')} aria-label=\"book type\">\n            <ToggleButton value={Constants.OPENING_BOOK_TYPE_OFF} aria-label={Constants.OPENING_BOOK_TYPE_OFF}>\n                Off\n            </ToggleButton> {\n                this.mastersBookAvailable()?\n                <ToggleButton value={Constants.OPENING_BOOK_TYPE_MASTERS} aria-label={Constants.OPENING_BOOK_TYPE_MASTERS}>\n                    Masters\n                </ToggleButton>\n                :null\n            }\n            <ToggleButton value={Constants.OPENING_BOOK_TYPE_LICHESS} aria-label={Constants.OPENING_BOOK_TYPE_LICHESS}>\n                Lichess\n            </ToggleButton>\n        </ToggleButtonGroup></div>\n    }\n    getOpeningBookRating() {\n        return <div>Rating<br/><ToggleButtonGroup size=\"small\" value={this.state.movesSettings.openingBookRating} onChange={this.updateMoveSetting('openingBookRating')} aria-label=\"text formatting\">\n            <ToggleButton value=\"1600\" aria-label=\"1600\">\n                1600\n            </ToggleButton>\n            <ToggleButton value=\"1800\" aria-label=\"1800\">\n                1800\n            </ToggleButton>\n            <ToggleButton value=\"2000\" aria-label=\"2000\">\n                2000\n            </ToggleButton>\n            <ToggleButton value=\"2200\" aria-label=\"2200\">\n                2200\n            </ToggleButton>\n            <ToggleButton value=\"2500\" aria-label=\"2500\">\n                2500\n            </ToggleButton>\n        </ToggleButtonGroup></div>\n    }\n\n    getOpeningBookTimeControls() {\n        return <div>Time controls<br/><ToggleButtonGroup size=\"small\" value={this.state.movesSettings.openingBookTimeControls} onChange={this.updateMoveSetting('openingBookTimeControls')} aria-label=\"text formatting\">\n            <ToggleButton value=\"bullet\" aria-label=\"bullet\">\n            Bullet\n            </ToggleButton>\n            <ToggleButton value=\"blitz\" aria-label=\"blitz\">\n            Blitz\n            </ToggleButton>\n            <ToggleButton value=\"rapid\" aria-label=\"rapid\">\n            Rapid\n            </ToggleButton>\n            <ToggleButton value=\"classical\" aria-label=\"classical\">\n            Classical\n            </ToggleButton>\n            <ToggleButton value=\"correspondence\" aria-label=\"correspondence\">\n            Correspondence\n            </ToggleButton>\n        </ToggleButtonGroup></div>\n    }\n\n}\n","import React from 'react'\nimport {Progress, Popover } from \"reactstrap\"\nimport { Table, TableRow, TableHead, TableBody, TableCell, TableFooter } from '@material-ui/core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faExternalLinkAlt, faInfoCircle, faExclamationTriangle, faWrench } from '@fortawesome/free-solid-svg-icons'\nimport ReportControls from '../ReportControls'\nimport {Container, Row, Col} from 'reactstrap'\nimport \"react-step-progress-bar/styles.css\";\nimport {trackEvent} from '../../app/Analytics'\nimport * as Constants from '../../app/Constants'\nimport { ProgressBar,Step } from \"react-step-progress-bar\";\nimport {playerDetails, offCard} from './MovesCommon'\nimport {simplifyCount} from '../../app/util'\nimport MovesSettings from './MovesSettings'\n\nexport default class MovesTable extends React.Component {\n    constructor(props){\n        super(props)\n        this.state = {\n            openPerformanceIndex: null,\n            moveSettingsOpen:false\n        }\n    }\n    isTouchDevice() {\n        return 'ontouchstart' in window;\n    }\n      \n      \n\n    componentDidUpdate(prevProps, prevState) {\n        if(prevProps.turnColor !== this.props.turnColor) {\n            this.setState({\n                openPerformanceIndex: null,\n            })\n        }\n    }\n\n    move(san) {\n        return () => {\n            this.props.onMove(san)\n            trackEvent(Constants.EVENT_CATEGORY_MOVES_LIST, this.props.clickedEventName)\n        }\n    }\n\n    toggleMovesSettings(){\n        if(!this.state.moveSettingsOpen) {\n            trackEvent(Constants.EVENT_CATEGORY_SETTINGS, \"MoveSettingsOpen\")\n        }\n        this.setState({moveSettingsOpen:!this.state.moveSettingsOpen})\n    }\n\n    togglePerformancePopover(moveIndex) {\n        return (e) => {\n            if(this.state.openPerformanceIndex !== null) {\n                this.setState({openPerformanceIndex:null})\n            } else {\n                this.setState({openPerformanceIndex: moveIndex})\n            }\n            if (e && e.stopPropagation) {\n                e.stopPropagation()\n            }\n        }\n    }\n    \n    compareClicked(san){\n        return (e)=>{\n            e.stopPropagation()\n            this.props.compareToClicked(san)\n        }\n    }\n\n    compareScores(currMove) {\n        let compareTo = currMove.compareTo\n        if(!compareTo) {\n            return null\n        }\n        let values = [compareTo.bookScore, compareTo.userScore]\n        return (\n            <ProgressBar\n              percent={0}\n              stepPositions={values}\n            >\n                {this.getIndicator(\"./images/book.png\", \"12\", \"12\", \n                    this.constructAlt(this.props.compareToAlt,values),\n                    this.compareClicked(currMove.san))}\n                {this.getIndicator(\"./images/user.png\", \"12\", \"12\", \n                    this.constructAlt(this.props.compareToAlt,values),\n                    this.compareClicked(currMove.san))}\n            </ProgressBar>\n          )\n    }\n\n    compareProgress(currMove){\n        let compareTo = currMove.compareTo\n        if(!compareTo) {\n            return null\n        }\n        return (\n            <ProgressBar\n              percent={0}\n              stepPositions={compareTo.values}\n            >\n                {this.getIndicator(\"./images/arrow-white.png\", \"20\", \"16\", \n                    this.constructAlt(this.props.compareToAlt,compareTo.values),\n                    this.compareClicked(currMove.san))}\n                {this.getIndicator(\"./images/arrow-black.png\", \"18\", \"14\", \n                    this.constructAlt(this.props.compareToAlt,compareTo.values),\n                    this.compareClicked(currMove.san))}\n            </ProgressBar>\n          )\n    }\n    constructAlt(altTitle, steps) {\n        let white = Math.round(steps[0])\n        let draws = Math.round(steps[1])-white\n        let black = 100-white-draws\n        return `${altTitle} \\nWhite wins ${white}% \\nDraws ${draws}% \\nBlack wins ${black}%`\n    }\n    //&#013;\n\n    getIndicator(src, height, width, alt, click) {\n        return <Step transition=\"scale\">\n            {({ accomplished }) => (\n            <img onClick = {click}\n                alt={alt}\n                title={alt}\n                className=\"pointerExternalLink\"\n                width={width}\n                height={height}\n                src={src}\n            />\n            )}\n          </Step>\n    }\n\n    getPopover(moveIndex) {\n        let performancePopoverOpen = this.state.openPerformanceIndex === moveIndex\n        let openMove = this.props.movesToShow[moveIndex]\n\n        return <Popover trigger=\"hover\" placement=\"right\" isOpen={performancePopoverOpen} target={`p${this.props.namespace}${moveIndex}`} toggle={this.togglePerformancePopover(moveIndex)}>\n                <ReportControls moveDetails={openMove.details} simplifiedView={true} \n                isOpen = {performancePopoverOpen} launchGame={this.props.launchGame} \n                settings={this.props.settings} reportFooter ={this.reportFooter(moveIndex)}/>\n            </Popover>\n    }\n\n    reportFooter(moveIndex) {\n        let currMove = this.props.movesToShow[moveIndex]\n\n        if(this.getTranspositionWarningLevel(moveIndex)!=='none') {\n            return <div>{this.getInfoIcon(moveIndex)}<b> This move has transpositions</b> <div>{currMove.san} has been played {currMove.moveCount === 1? `once`:`${currMove.moveCount} times`}  in this position but the resulting position has appeared {currMove.details.count} times through other move orders.</div></div>\n        }\n    }\n\n    getTranspositionWarningLevel(moveIndex){\n        let currMove = this.props.movesToShow[moveIndex]\n        let targetCount = currMove.details.count\n        let difference = targetCount - currMove.moveCount\n        if (difference>0) {\n            if(currMove.moveCount === 1) {\n                return \"warning\"\n            } else if(difference>10 && difference/targetCount>0.1) {\n                return \"warning\"\n            } else {\n                return \"info\"\n            }\n        }\n        return \"none\"\n    }\n\n    render() {\n        let hasMoves = (this.props.movesToShow && this.props.movesToShow.length>0)\n        if (!hasMoves)\n            return offCard(\n                'No moves found',\n                'The opening book does not have any moves in this position',\n                this.toggleMovesSettings.bind(this),\n                <b>Modify Book Settings\n                    <MovesSettings isOpen={this.state.moveSettingsOpen}\n                                   toggle={this.toggleMovesSettings.bind(this)}\n                                   settingsChange={this.props.settingsChange}\n                                   updateSettings={this.props.updateSettings}\n                                   settings={this.props.settings}\n                                   variant={this.props.variant}/></b>)\n\n        return <Table>\n        <TableHead>\n        <TableRow>\n            <TableCell size=\"small\" className=\"smallCol\"><b>Move</b></TableCell>\n            <TableCell size=\"small\" className=\"smallCol\"><b>Games</b></TableCell>\n            <TableCell><b>Results</b><FontAwesomeIcon \n                className={`floatRight pointer`} \n                icon={faWrench} onClick={this.toggleMovesSettings.bind(this)}/>\n                <MovesSettings isOpen={this.state.moveSettingsOpen} \n                    toggle={this.toggleMovesSettings.bind(this)}\n                    settingsChange={this.props.settingsChange}\n                    updateSettings = {this.props.updateSettings}\n                    settings={this.props.settings}\n                    variant={this.props.variant}/>\n            </TableCell>\n        </TableRow></TableHead>\n        <TableBody>\n        {\n        this.props.movesToShow.map((move, moveIndex) => {\n            let lastPlayedGame = move.details.lastPlayedGame\n            return lastPlayedGame && move.details.count === 1?\n                this.getSingleItemRow(move,lastPlayedGame):\n                this.getMultiItemRow(move, moveIndex)\n                \n            }\n        )}\n    </TableBody>\n        <TableFooter><TableRow>\n            <TableCell colSpan=\"3\">\n                {this.props.tableFooter}\n            </TableCell>\n        </TableRow></TableFooter>\n    </Table>\n    }\n    highlightArrowFn(move) {\n        if(this.isTouchDevice()) {\n            // do not highlight on touch screens because it gives weird behavior\n            // single touch just highlights the arrow and user will need to double touch to make the move\n            return ()=>{return}\n        }\n        return ()=>{\n            this.props.highlightArrow(move)\n        }\n    }\n    getMultiItemRow(move, moveIndex) {\n        return <TableRow className={`${this.props.highlightMove === move.san?'bgColor ':''}moveRow`} \n                        key = {`m${move.orig}${move.dest}${move.san}`} \n                        onClick={this.move(move.san)} \n                        onMouseOver={this.highlightArrowFn(move).bind(this)} \n                        onMouseOut={()=>this.props.highlightArrow(null)}>\n            <TableCell size=\"small\" className=\"smallCol\">{move.san} </TableCell>\n            <TableCell size=\"small\" id={`p${this.props.namespace}${moveIndex}`} className=\"smallCol\" onClick ={this.togglePerformancePopover(moveIndex)}>\n                {simplifyCount(move.moveCount)}{this.getInfoIcon(moveIndex)}\n                {this.getPopover(moveIndex)}\n            </TableCell>\n            <TableCell>\n                <Container>\n                {this.props.settings.movesSettings.openingBookScoreIndicator?\n                <Row className=\"scoresProgress\"><Col className=\"navCol\">\n                {this.compareScores(move)}\n                </Col></Row>:null}\n                <Row><Col className=\"navCol\">\n                <Progress className = \"border\" multi>\n                    <Progress bar className=\"whiteMove\" value={`${this.percentage(move.details.whiteWins,move.details.count)}`}>{this.getProgressLabel(move.details.whiteWins,move.details.count)}</Progress>\n                    <Progress bar className=\"grayMove\" value={`${this.percentage(move.details.draws,move.details.count)}`}>{this.getProgressLabel(move.details.draws,move.details.count)}</Progress>\n                    <Progress bar className=\"blackMove\" value={`${this.percentage(move.details.blackWins,move.details.count)}`}>{this.getProgressLabel(move.details.blackWins,move.details.count)}</Progress>\n                </Progress></Col></Row>\n                {this.props.settings.movesSettings.openingBookWinsIndicator?\n                <Row className=\"zeroHeight\"><Col className=\"navCol\">\n                {this.compareProgress(move)}\n                </Col></Row>:null}\n                </Container>\n            </TableCell>\n        </TableRow>\n    }\n\n    getInfoIcon(moveIndex) {\n        if(this.getTranspositionWarningLevel(moveIndex) === \"warning\"){\n            return <FontAwesomeIcon \n                className={`leftPadding redColor lowOpacity`} \n                icon={faExclamationTriangle}/>\n        }\n        return <FontAwesomeIcon \n            className={`lowOpacity leftPadding`} \n            icon={faInfoCircle}/>\n\n    }\n\n    getProgressLabel(count, total){\n        let percentage = this.percentage(count,total)\n        if(percentage<10) {\n            return ''\n        }\n        if(this.props.showAsPercentage) {\n            return `${percentage.toFixed(1)}%`\n        }\n        return count\n\n    }\n\n    percentage(count, total){\n        return count/total*100\n    }\n    getSingleItemRow(move,lastPlayedGame) {\n        let sampleResultWhite = playerDetails(lastPlayedGame.white, lastPlayedGame.whiteElo)\n        let sampleResultBlack = playerDetails(lastPlayedGame.black, lastPlayedGame.blackElo)\n        let sampleResult = lastPlayedGame.result\n\n        return <TableRow className={`${this.props.highlightMove === move.san?'bgColor ':''}moveRow`} \n                key = {`${move.orig}${move.dest}`} \n                onClick={this.move(move.san)}\n                onMouseOver={this.highlightArrowFn(move).bind(this)} \n                onMouseOut={()=>this.props.highlightArrow(null)}>\n                <TableCell size=\"small\" className=\"smallCol\">{move.san}</TableCell>\n                <TableCell colSpan = \"2\">\n                        {sampleResultWhite} {sampleResult} {sampleResultBlack} {<FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(move.details.lastPlayedGame)} icon={faExternalLinkAlt}/>}\n                </TableCell>\n            </TableRow>\n    }\n\n}\n","import React from 'react'\nimport { Table, TableRow, TableBody, TableCell } from '@material-ui/core';\nimport {playerDetails} from './MovesCommon'\n\nexport default class ResultsTable extends React.Component {\n    render() {\n        return <Table>\n            <TableBody>\n                {\n                this.props.gameResults.map(result => {\n                    let whitePlayer = playerDetails(result.white, result.whiteElo)\n                    let blackPlayer = playerDetails(result.black, result.blackElo)\n                    return <TableRow className=\"moveRow\" key = {`${result.url}`} onClick={this.props.launchGame(result)}>\n                        <TableCell>\n                            {result.result===\"1-0\"?<b>{whitePlayer}</b>:whitePlayer} {result.result} {result.result === \"0-1\"?<b>{blackPlayer}</b>:blackPlayer}\n                        </TableCell>\n                    </TableRow>\n                })}\n            </TableBody>\n        </Table>\n    }\n}","import React from 'react'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faUser } from '@fortawesome/free-solid-svg-icons'\nimport MovesTable from './MovesTable'\nimport ResultsTable from './ResultsTable';\n\nexport default class MovesList extends React.Component {\n\n    render(){\n        if(!this.props.playerMoves) {\n            return <div className = \"infoMessage\" >No moves to show. Please select a source from the \n                <span className = \"navLinkButton\" onClick={()=>this.props.switchToUserTab()}> <FontAwesomeIcon icon={faUser} /> User</span> tab and enter the details.</div>\n        }\n        return <div>{(this.props.gameResults && this.props.gameResults.length>0)?this.resultsTable():null}\n                {this.movesTable()}</div>\n    }\n\n    movesTable() {\n        return <MovesTable movesToShow={this.props.playerMoves} namespace='moves'\n                launchGame={this.props.launchGame} settings={this.props.settings}\n                turnColor={this.props.turnColor} onMove={this.props.onMove}\n                clickedEventName=\"MoveClicked\" tableFooter={this.tableFooter()}\n                highlightMove={this.props.highlightMove} \n                compareToClicked={this.props.switchToBookTab}\n                compareToAlt=\"Indicator for book moves - Click me\"\n                settingsChange={this.props.settingsChange}\n                variant={this.props.variant}\n                highlightArrow={this.props.highlightArrow}\n                />\n    }\n    resultsTable() {\n        return <ResultsTable gameResults={this.props.gameResults}\n                launchGame={this.props.launchGame}/>\n    }\n\n    tableFooter() {\n        let hasMoves = (this.props.playerMoves && this.props.playerMoves.length>0)\n        if(this.props.settings.playerName) {\n            if(hasMoves) {\n                return <span>\n                    Showing moves that have been  played {this.props.turnColor === this.props.settings.playerColor? \"by\" : \"by others against\"} <b>{this.props.settings.playerName}</b> in \n                    this position. <b>{this.props.settings.playerName}</b> is playing as <b>{this.props.settings.playerColor}</b>.\n                    </span>\n            } else {\n                return <span>No moves found played by {this.props.turnColor === this.props.settings.playerColor? \"by\" : \"by others against\"} <b>{this.props.settings.playerName}</b> in \n                    this position. <b>{this.props.settings.playerName}</b> is playing as <b>{this.props.settings.playerColor}</b>.</span>\n            }\n        } else {\n            if(hasMoves) {\n                return <span>\n                    Showing all moves that have been played by <b>{this.props.turnColor}</b> in this position.\n                    </span>\n            } else {\n                return <span>\n                    No moves found played by <b>{this.props.turnColor}</b> in this position.\n                    </span>\n            }\n        }\n    }\n\n}","import React from 'react'\nimport MovesTable from './MovesTable'\nimport ResultsTable from './ResultsTable';\nimport { Spinner } from 'reactstrap';\nimport Cached from '@material-ui/icons/Cached'\nimport * as Constants from '../../app/Constants'\nimport { offCard } from './MovesCommon'\n\nexport default class BookMove extends React.Component {\n\n    render(){\n        if(!this.props.bookMoves) {\n            return <div className = \"infoMessage\" >No book moves found in this position</div>\n        }\n        return <div>{(this.props.gameResults && this.props.gameResults.length>0)?this.resultsTable():null}\n                {this.movesTable()}</div>\n    }\n\n    enableBook(){\n        let newMovesSettings = Object.assign({},this.props.settings.movesSettings)\n        newMovesSettings.openingBookType = Constants.OPENING_BOOK_TYPE_LICHESS\n        this.props.settingsChange(Constants.SETTING_NAME_MOVES_SETTINGS, newMovesSettings)\n    }\n\n    movesTable() {\n        if(this.props.bookMoves.fetch === \"pending\") {\n            return <div className=\"center\"><br/><Spinner/></div>\n        }\n        if(this.props.bookMoves.fetch === \"off\") {\n            return offCard('Opening book is disabled',\n                           'Click the button below to enable it',\n                           this.enableBook.bind(this),\n                           'Enable opening book',\n                           <Cached />)\n        }\n        if(this.props.bookMoves.fetch === \"failed\") {\n            return offCard('Failed to fetch book moves',\n                           'Please check your internet connection. Lichess could also be down.',\n                           this.props.forceFetchBookMoves,\n                           'Try again',\n                           <Cached />)\n        }\n\n        return <MovesTable movesToShow={this.props.bookMoves.moves} namespace='book'\n                launchGame={this.props.launchGame} settings={this.props.settings}\n                turnColor={this.props.turnColor} onMove={this.props.onMove}\n                clickedEventName=\"BookMoveClicked\" tab=\"book\" showAsPercentage\n                highlightMove={this.props.highlightMove} \n                compareToClicked={this.props.switchToMovesTab}\n                compareToAlt=\"Indicator for player moves - Click me\"\n                settingsChange={this.props.settingsChange}\n                variant={this.props.variant}\n                highlightArrow={this.props.highlightArrow}\n                />\n    }\n\n    resultsTable() {\n        return <ResultsTable gameResults={this.props.gameResults}\n                launchGame={this.props.launchGame}/>\n    }\n}\n","/**\n * Stockfish Engine Wrapper\n * Handles communication with Stockfish 17 via Web Worker\n * With robust state management for rapid position changes\n * \n * Improvements:\n * - Proper UCI protocol handling with command queue\n * - Wait for bestmove after stop before sending new commands\n * - Reduced use of ucinewgame (only for truly new games)\n * - Better timeout handling with exponential backoff\n * - Improved error recovery and state management\n */\n\n// Engine states for proper state machine management\nconst EngineState = {\n    UNINITIALIZED: 'uninitialized',\n    INITIALIZING: 'initializing',\n    READY: 'ready',\n    ANALYZING: 'analyzing',\n    STOPPING: 'stopping',\n    ERROR: 'error'\n};\n\nclass StockfishEngine {\n    constructor() {\n        this.worker = null;\n        this.state = EngineState.UNINITIALIZED;\n        this.currentFen = null;\n        this.analysisCallback = null;\n        this.depth = 20; // Default depth\n        this.multiPV = 3; // Number of lines to analyze (top 3 moves)\n        this.pendingAnalysis = null;\n        this.analysisId = 0; // Unique ID for each analysis request\n        this.currentAnalysisId = 0; // ID of the currently running analysis\n        this.debounceTimer = null;\n        this.debounceDelay = 100; // ms to wait before starting new analysis (increased for stability)\n        this.lastActivityTime = Date.now();\n        this.healthCheckInterval = null;\n        this.commandQueue = [];\n        this.isProcessingQueue = false;\n        this.initPromise = null;\n        this.initResolve = null;\n        this.initReject = null;\n        this.readyPromise = null;\n        this.readyResolve = null;\n        this.stopPromise = null;\n        this.stopResolve = null;\n        this.recoveryAttempts = 0;\n        this.maxRecoveryAttempts = 3;\n        this.lastFenForGame = null; // Track if we're in a new game\n        this.messageBuffer = ''; // Buffer for incomplete messages\n    }\n\n    /**\n     * Initialize the Stockfish engine\n     */\n    init() {\n        // Return existing promise if already initializing\n        if (this.initPromise && this.state === EngineState.INITIALIZING) {\n            return this.initPromise;\n        }\n\n        // Return resolved promise if already ready\n        if (this.state === EngineState.READY && this.worker) {\n            return Promise.resolve();\n        }\n\n        this.initPromise = new Promise((resolve, reject) => {\n            this.initResolve = resolve;\n            this.initReject = reject;\n\n            // Clean up any existing worker\n            this.cleanup();\n            this.state = EngineState.INITIALIZING;\n\n            try {\n                // Use the stockfish 17 lite single-threaded version from public folder\n                this.worker = new Worker('./stockfish-17.js');\n                \n                this.worker.onmessage = (event) => {\n                    const data = typeof event === 'string' ? event : event.data;\n                    this.lastActivityTime = Date.now();\n                    this.handleMessage(data);\n                };\n\n                this.worker.onerror = (error) => {\n                    console.error('Stockfish worker error:', error);\n                    this.state = EngineState.ERROR;\n                    if (this.initReject) {\n                        this.initReject(error);\n                        this.initReject = null;\n                        this.initResolve = null;\n                    }\n                    // Try to recover\n                    this.scheduleRecovery();\n                };\n\n                // Initialize UCI\n                this.sendCommand('uci');\n                \n                // Timeout after 15 seconds\n                setTimeout(() => {\n                    if (this.state === EngineState.INITIALIZING) {\n                        const error = new Error('Stockfish initialization timeout');\n                        if (this.initReject) {\n                            this.initReject(error);\n                            this.initReject = null;\n                            this.initResolve = null;\n                        }\n                        this.state = EngineState.ERROR;\n                    }\n                }, 15000);\n\n            } catch (error) {\n                console.error('Failed to initialize Stockfish:', error);\n                this.state = EngineState.ERROR;\n                reject(error);\n            }\n        });\n\n        return this.initPromise;\n    }\n\n    /**\n     * Clean up resources\n     */\n    cleanup() {\n        if (this.healthCheckInterval) {\n            clearInterval(this.healthCheckInterval);\n            this.healthCheckInterval = null;\n        }\n        if (this.debounceTimer) {\n            clearTimeout(this.debounceTimer);\n            this.debounceTimer = null;\n        }\n        if (this.worker) {\n            try {\n                this.worker.terminate();\n            } catch (e) {\n                // Ignore termination errors\n            }\n            this.worker = null;\n        }\n        this.state = EngineState.UNINITIALIZED;\n        this.pendingAnalysis = null;\n        this.commandQueue = [];\n        this.isProcessingQueue = false;\n        this.readyPromise = null;\n        this.readyResolve = null;\n        this.stopPromise = null;\n        this.stopResolve = null;\n        this.messageBuffer = '';\n    }\n\n    /**\n     * Start health check to detect stalled engine\n     */\n    startHealthCheck() {\n        if (this.healthCheckInterval) {\n            clearInterval(this.healthCheckInterval);\n        }\n        \n        this.healthCheckInterval = setInterval(() => {\n            // If we're analyzing and haven't received any message in 15 seconds, something is wrong\n            if (this.state === EngineState.ANALYZING && (Date.now() - this.lastActivityTime > 15000)) {\n                console.warn('Stockfish appears stalled, attempting recovery...');\n                this.recoverEngine();\n            }\n            // If we're stopping and haven't received bestmove in 5 seconds, force recovery\n            if (this.state === EngineState.STOPPING && (Date.now() - this.lastActivityTime > 5000)) {\n                console.warn('Stockfish stop timeout, forcing recovery...');\n                this.forceStopComplete();\n            }\n        }, 5000);\n    }\n\n    /**\n     * Force complete a stuck stop operation\n     */\n    forceStopComplete() {\n        if (this.stopResolve) {\n            this.stopResolve();\n            this.stopResolve = null;\n            this.stopPromise = null;\n        }\n        this.state = EngineState.READY;\n        this.processPendingAnalysis();\n    }\n\n    /**\n     * Schedule engine recovery with exponential backoff\n     */\n    scheduleRecovery() {\n        if (this.recoveryAttempts >= this.maxRecoveryAttempts) {\n            console.error('Max recovery attempts reached, giving up');\n            this.state = EngineState.ERROR;\n            return;\n        }\n\n        const delay = Math.min(1000 * Math.pow(2, this.recoveryAttempts), 10000);\n        this.recoveryAttempts++;\n        \n        setTimeout(() => {\n            this.recoverEngine();\n        }, delay);\n    }\n\n    /**\n     * Recover the engine by reinitializing\n     */\n    async recoverEngine() {\n        console.log('Recovering Stockfish engine...');\n        const wasAnalyzing = this.state === EngineState.ANALYZING;\n        const lastFen = this.currentFen;\n        const lastCallback = this.analysisCallback;\n        \n        this.cleanup();\n        \n        try {\n            await this.init();\n            console.log('Stockfish engine recovered');\n            this.recoveryAttempts = 0; // Reset on successful recovery\n            \n            // Resume analysis if we were analyzing before\n            if (wasAnalyzing && lastFen && lastCallback) {\n                this.analyzeInfinite(lastFen, lastCallback);\n            }\n        } catch (error) {\n            console.error('Failed to recover Stockfish engine:', error);\n            this.scheduleRecovery();\n        }\n    }\n\n    /**\n     * Send a command to Stockfish\n     */\n    sendCommand(cmd) {\n        if (this.worker) {\n            try {\n                this.worker.postMessage(cmd);\n            } catch (e) {\n                console.error('Error sending command to Stockfish:', e);\n                this.scheduleRecovery();\n            }\n        }\n    }\n\n    /**\n     * Handle messages from Stockfish\n     */\n    handleMessage(message) {\n        if (!message) return;\n\n        // Handle multi-line messages\n        if (message.indexOf('\\n') > -1) {\n            const lines = message.split('\\n');\n            lines.forEach(line => {\n                if (line.trim()) {\n                    this.handleSingleMessage(line.trim());\n                }\n            });\n            return;\n        }\n\n        this.handleSingleMessage(message.trim());\n    }\n\n    /**\n     * Handle a single message line from Stockfish\n     */\n    handleSingleMessage(message) {\n        if (!message) return;\n\n        // UCI initialization complete\n        if (message === 'uciok') {\n            // Set options after UCI is ready\n            this.sendCommand('setoption name MultiPV value ' + this.multiPV);\n            // Send isready to confirm engine is ready\n            this.sendCommand('isready');\n        }\n\n        // Engine is ready\n        if (message === 'readyok') {\n            if (this.state === EngineState.INITIALIZING) {\n                this.state = EngineState.READY;\n                this.startHealthCheck();\n                if (this.initResolve) {\n                    this.initResolve();\n                    this.initResolve = null;\n                    this.initReject = null;\n                }\n            }\n            \n            // Resolve any pending ready promise\n            if (this.readyResolve) {\n                this.readyResolve();\n                this.readyResolve = null;\n                this.readyPromise = null;\n            }\n\n            // Process pending analysis if we were waiting for ready\n            this.processPendingAnalysis();\n        }\n\n        // Parse analysis info - check for score and pv\n        if (message.startsWith('info') && message.includes(' pv ') && message.includes(' score ')) {\n            this.parseInfo(message);\n        }\n\n        // Best move found - analysis complete\n        if (message.startsWith('bestmove')) {\n            const wasAnalyzing = this.state === EngineState.ANALYZING;\n            const wasStopping = this.state === EngineState.STOPPING;\n            \n            this.state = EngineState.READY;\n            \n            // Resolve stop promise if we were waiting for it\n            if (wasStopping && this.stopResolve) {\n                this.stopResolve();\n                this.stopResolve = null;\n                this.stopPromise = null;\n            }\n\n            // Process any pending analysis\n            this.processPendingAnalysis();\n        }\n    }\n\n    /**\n     * Process pending analysis if conditions are met\n     */\n    processPendingAnalysis() {\n        if (this.state !== EngineState.READY) {\n            return;\n        }\n\n        if (this.pendingAnalysis) {\n            const { fen, callback, infinite, id } = this.pendingAnalysis;\n            this.pendingAnalysis = null;\n            \n            // Only start if this is still the latest request\n            if (id === this.analysisId) {\n                this.currentAnalysisId = id;\n                if (infinite) {\n                    this._doAnalyzeInfinite(fen, callback);\n                } else {\n                    this._doAnalyze(fen, callback);\n                }\n            }\n        }\n    }\n\n    /**\n     * Wait for engine to be ready\n     */\n    waitForReady() {\n        if (this.state === EngineState.READY) {\n            return Promise.resolve();\n        }\n\n        if (!this.readyPromise) {\n            this.readyPromise = new Promise((resolve) => {\n                this.readyResolve = resolve;\n                this.sendCommand('isready');\n                \n                // Safety timeout\n                setTimeout(() => {\n                    if (this.readyResolve) {\n                        console.warn('Ready timeout, resolving anyway');\n                        this.readyResolve();\n                        this.readyResolve = null;\n                        this.readyPromise = null;\n                    }\n                }, 3000);\n            });\n        }\n\n        return this.readyPromise;\n    }\n\n    /**\n     * Stop current analysis and wait for completion\n     */\n    async stopAndWait() {\n        if (this.state !== EngineState.ANALYZING) {\n            return Promise.resolve();\n        }\n\n        if (!this.stopPromise) {\n            this.stopPromise = new Promise((resolve) => {\n                this.stopResolve = resolve;\n                this.state = EngineState.STOPPING;\n                this.sendCommand('stop');\n                \n                // Safety timeout - if we don't get bestmove in 3 seconds, resolve anyway\n                setTimeout(() => {\n                    if (this.stopResolve) {\n                        console.warn('Stop timeout, forcing completion');\n                        this.forceStopComplete();\n                    }\n                }, 3000);\n            });\n        }\n\n        return this.stopPromise;\n    }\n\n    /**\n     * Parse info string from Stockfish\n     */\n    parseInfo(info) {\n        const result = {\n            depth: 0,\n            seldepth: 0,\n            multipv: 1,\n            score: null,\n            scoreType: 'cp', // cp (centipawns) or mate\n            pv: [],\n            nodes: 0,\n            nps: 0,\n            time: 0\n        };\n\n        const parts = info.split(' ');\n        \n        for (let i = 0; i < parts.length; i++) {\n            switch (parts[i]) {\n                case 'depth':\n                    result.depth = parseInt(parts[i + 1]) || 0;\n                    break;\n                case 'seldepth':\n                    result.seldepth = parseInt(parts[i + 1]) || 0;\n                    break;\n                case 'multipv':\n                    result.multipv = parseInt(parts[i + 1]) || 1;\n                    break;\n                case 'score':\n                    result.scoreType = parts[i + 1];\n                    result.score = parseInt(parts[i + 2]) || 0;\n                    break;\n                case 'nodes':\n                    result.nodes = parseInt(parts[i + 1]) || 0;\n                    break;\n                case 'nps':\n                    result.nps = parseInt(parts[i + 1]) || 0;\n                    break;\n                case 'time':\n                    result.time = parseInt(parts[i + 1]) || 0;\n                    break;\n                case 'pv':\n                    // Everything after 'pv' is the principal variation\n                    result.pv = parts.slice(i + 1).filter(p => p && p.length >= 4 && /^[a-h][1-8][a-h][1-8]/.test(p));\n                    i = parts.length; // Exit loop\n                    break;\n            }\n        }\n\n        // Only call callback if we have valid data and this is the current analysis\n        if (this.analysisCallback && result.pv.length > 0 && result.depth > 0 && \n            this.currentAnalysisId === this.analysisId) {\n            this.analysisCallback(result);\n        }\n    }\n\n    /**\n     * Internal method to start analysis\n     */\n    _doAnalyze(fen, callback) {\n        this.currentFen = fen;\n        this.analysisCallback = callback;\n        this.state = EngineState.ANALYZING;\n        this.lastActivityTime = Date.now();\n\n        // Set up new position (no ucinewgame for same-game analysis)\n        this.sendCommand('position fen ' + fen);\n        // Start analysis\n        this.sendCommand('go depth ' + this.depth);\n    }\n\n    /**\n     * Internal method to start infinite analysis\n     */\n    _doAnalyzeInfinite(fen, callback) {\n        this.currentFen = fen;\n        this.analysisCallback = callback;\n        this.state = EngineState.ANALYZING;\n        this.lastActivityTime = Date.now();\n\n        // Set up new position (no ucinewgame for same-game analysis)\n        this.sendCommand('position fen ' + fen);\n        // Start infinite analysis\n        this.sendCommand('go infinite');\n    }\n\n    /**\n     * Start analysis for a given FEN position with debouncing\n     */\n    analyze(fen, callback, depth = null) {\n        if (!this.worker || this.state === EngineState.UNINITIALIZED || this.state === EngineState.ERROR) {\n            console.error('Stockfish not ready');\n            return;\n        }\n\n        if (depth) {\n            this.depth = depth;\n        }\n\n        // Increment analysis ID to invalidate any pending analysis\n        this.analysisId++;\n        const currentId = this.analysisId;\n\n        // Clear any existing debounce timer\n        if (this.debounceTimer) {\n            clearTimeout(this.debounceTimer);\n        }\n\n        // Debounce rapid position changes\n        this.debounceTimer = setTimeout(() => {\n            this._startAnalysis(fen, callback, false, currentId);\n        }, this.debounceDelay);\n    }\n\n    /**\n     * Start infinite analysis with debouncing\n     */\n    analyzeInfinite(fen, callback) {\n        if (!this.worker || this.state === EngineState.UNINITIALIZED || this.state === EngineState.ERROR) {\n            console.error('Stockfish not ready');\n            return;\n        }\n\n        // Increment analysis ID to invalidate any pending analysis\n        this.analysisId++;\n        const currentId = this.analysisId;\n\n        // Clear any existing debounce timer\n        if (this.debounceTimer) {\n            clearTimeout(this.debounceTimer);\n        }\n\n        // Debounce rapid position changes\n        this.debounceTimer = setTimeout(() => {\n            this._startAnalysis(fen, callback, true, currentId);\n        }, this.debounceDelay);\n    }\n\n    /**\n     * Internal method to start analysis after debounce\n     */\n    async _startAnalysis(fen, callback, infinite, id) {\n        // Check if this is still the latest request\n        if (id !== this.analysisId) {\n            return;\n        }\n\n        // Queue the analysis\n        this.pendingAnalysis = { fen, callback, infinite, id };\n\n        // If currently analyzing, stop first and wait for completion\n        if (this.state === EngineState.ANALYZING || this.state === EngineState.STOPPING) {\n            await this.stopAndWait();\n        }\n\n        // If ready, process immediately\n        if (this.state === EngineState.READY) {\n            this.processPendingAnalysis();\n        } else if (this.state === EngineState.INITIALIZING) {\n            // Wait for initialization to complete\n            await this.initPromise;\n            this.processPendingAnalysis();\n        }\n    }\n\n    /**\n     * Stop current analysis\n     */\n    stop() {\n        this.analysisId++; // Invalidate any pending analysis\n        this.pendingAnalysis = null;\n        \n        if (this.debounceTimer) {\n            clearTimeout(this.debounceTimer);\n            this.debounceTimer = null;\n        }\n        \n        if (this.state === EngineState.ANALYZING) {\n            this.state = EngineState.STOPPING;\n            this.sendCommand('stop');\n        }\n    }\n\n    /**\n     * Signal start of a new game (clears hash, etc.)\n     */\n    newGame() {\n        if (this.state === EngineState.READY) {\n            this.sendCommand('ucinewgame');\n            this.sendCommand('isready');\n            this.lastFenForGame = null;\n        }\n    }\n\n    /**\n     * Set the number of lines to analyze\n     */\n    setMultiPV(n) {\n        this.multiPV = n;\n        if (this.state === EngineState.READY || this.state === EngineState.ANALYZING) {\n            this.sendCommand('setoption name MultiPV value ' + n);\n        }\n    }\n\n    /**\n     * Set analysis depth\n     */\n    setDepth(depth) {\n        this.depth = depth;\n    }\n\n    /**\n     * Check if engine is ready\n     */\n    isReady() {\n        return this.state === EngineState.READY || this.state === EngineState.ANALYZING;\n    }\n\n    /**\n     * Check if engine is analyzing\n     */\n    isAnalyzing() {\n        return this.state === EngineState.ANALYZING;\n    }\n\n    /**\n     * Terminate the engine\n     */\n    terminate() {\n        this.cleanup();\n    }\n\n    /**\n     * Convert UCI move to algebraic notation\n     * @param {string} uciMove - Move in UCI format (e.g., \"e2e4\")\n     * @param {object} chess - chess.js instance\n     * @returns {object} Move object with from, to, and san\n     */\n    static uciToMove(uciMove, chess) {\n        if (!uciMove || uciMove.length < 4) return null;\n\n        const from = uciMove.substring(0, 2);\n        const to = uciMove.substring(2, 4);\n        const promotion = uciMove.length > 4 ? uciMove[4] : undefined;\n\n        // Get the SAN notation\n        try {\n            const moves = chess.moves({ verbose: true });\n            const move = moves.find(m => \n                m.from === from && \n                m.to === to && \n                (!promotion || m.promotion === promotion)\n            );\n\n            if (move) {\n                return {\n                    from: from,\n                    to: to,\n                    san: move.san,\n                    promotion: promotion\n                };\n            }\n        } catch (e) {\n            console.error('Error converting UCI move:', e);\n        }\n\n        return {\n            from: from,\n            to: to,\n            san: uciMove,\n            promotion: promotion\n        };\n    }\n\n    /**\n     * Format score for display\n     * @param {number} score - Score in centipawns or mate count\n     * @param {string} scoreType - 'cp' for centipawns, 'mate' for mate\n     * @param {string} turn - 'w' for white, 'b' for black\n     * @returns {string} Formatted score string\n     */\n    static formatScore(score, scoreType, turn) {\n        // Adjust score based on whose turn it is (Stockfish gives score from current player's perspective)\n        const adjustedScore = turn === 'b' ? -score : score;\n\n        if (scoreType === 'mate') {\n            const mateIn = turn === 'b' ? -score : score;\n            if (mateIn > 0) {\n                return `M${mateIn}`;\n            } else {\n                return `M${mateIn}`;\n            }\n        }\n\n        // Convert centipawns to pawns\n        const pawns = adjustedScore / 100;\n        if (pawns >= 0) {\n            return `+${pawns.toFixed(2)}`;\n        }\n        return pawns.toFixed(2);\n    }\n\n    /**\n     * Get evaluation bar percentage (0-100, 50 is equal)\n     * @param {number} score - Score in centipawns\n     * @param {string} scoreType - 'cp' or 'mate'\n     * @param {string} turn - 'w' or 'b'\n     * @returns {number} Percentage for white (0-100)\n     */\n    static getEvalBarPercent(score, scoreType, turn) {\n        if (scoreType === 'mate') {\n            const mateScore = turn === 'b' ? -score : score;\n            return mateScore > 0 ? 100 : 0;\n        }\n\n        // Adjust for current turn\n        const adjustedScore = turn === 'b' ? -score : score;\n        \n        // Use sigmoid-like function to map score to percentage\n        // This gives a nice curve where small advantages show clearly\n        // but extreme advantages don't dominate\n        const maxScore = 1000; // 10 pawns\n        const clampedScore = Math.max(-maxScore, Math.min(maxScore, adjustedScore));\n        \n        // Map to 0-100 range with sigmoid curve\n        const percent = 50 + (50 * (2 / (1 + Math.exp(-clampedScore / 200)) - 1));\n        \n        return Math.max(0, Math.min(100, percent));\n    }\n\n    /**\n     * Get the engine version\n     */\n    static getVersion() {\n        return \"Stockfish 17.1 (NNUE Lite)\";\n    }\n\n    /**\n     * Get current engine state (for debugging)\n     */\n    getState() {\n        return this.state;\n    }\n}\n\n// Singleton instance\nlet engineInstance = null;\n\nexport function getStockfishEngine() {\n    if (!engineInstance) {\n        engineInstance = new StockfishEngine();\n    }\n    return engineInstance;\n}\n\nexport default StockfishEngine;\n","import React from 'react';\nimport { \n    Box, \n    Typography, \n    LinearProgress, \n    IconButton,\n    Tooltip,\n    Switch,\n    FormControlLabel,\n    Slider,\n    Paper,\n    Snackbar\n} from '@material-ui/core';\nimport { PlayArrow, Stop, Settings, Refresh } from '@material-ui/icons';\nimport { getStockfishEngine } from '../../app/StockfishEngine';\nimport StockfishEngine from '../../app/StockfishEngine';\nimport { chessLogic } from '../../app/chess/ChessLogic';\nimport './StockfishAnalysis.css';\n\nexport default class StockfishAnalysis extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            isEngineReady: false,\n            isAnalyzing: false,\n            evaluation: null,\n            topMoves: [],\n            depth: 0,\n            showSettings: false,\n            analysisDepth: 20,\n            multiPV: 3,\n            error: null,\n            engineState: 'uninitialized',\n            showError: false,\n            errorMessage: ''\n        };\n        this.engine = null;\n        this.analysisResults = new Map(); // Store results by multipv\n        this.lastFen = null; // Track last analyzed FEN\n        this.mounted = false;\n        \n        // Bind methods\n        this.startAnalysis = this.startAnalysis.bind(this);\n        this.stopAnalysis = this.stopAnalysis.bind(this);\n        this.toggleAnalysis = this.toggleAnalysis.bind(this);\n        this.handleAnalysisUpdate = this.handleAnalysisUpdate.bind(this);\n        this.handleDepthChange = this.handleDepthChange.bind(this);\n        this.handleMultiPVChange = this.handleMultiPVChange.bind(this);\n        this.toggleSettings = this.toggleSettings.bind(this);\n        this.handleMoveClick = this.handleMoveClick.bind(this);\n        this.handleMoveHover = this.handleMoveHover.bind(this);\n        this.handleMoveLeave = this.handleMoveLeave.bind(this);\n        this.handleCloseError = this.handleCloseError.bind(this);\n        this.retryInit = this.retryInit.bind(this);\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.initEngine();\n    }\n\n    componentDidUpdate(prevProps) {\n        // Re-analyze when FEN changes and we're analyzing\n        if (prevProps.fen !== this.props.fen && this.state.isAnalyzing) {\n            // Clear previous results when position changes\n            this.analysisResults.clear();\n            this.setState({ \n                topMoves: [],\n                depth: 0 \n            });\n            this.startAnalysis();\n        }\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n        if (this.engine) {\n            this.engine.stop();\n        }\n    }\n\n    safeSetState(state, callback) {\n        if (this.mounted) {\n            this.setState(state, callback);\n        }\n    }\n\n    async initEngine() {\n        try {\n            this.engine = getStockfishEngine();\n            await this.engine.init();\n            if (this.mounted) {\n                this.setState({ \n                    isEngineReady: true,\n                    engineState: this.engine.getState()\n                });\n            }\n        } catch (error) {\n            console.error('Failed to initialize Stockfish:', error);\n            if (this.mounted) {\n                this.setState({ \n                    error: 'Failed to load Stockfish engine. Click refresh to retry.',\n                    showError: true,\n                    errorMessage: 'Engine initialization failed'\n                });\n            }\n        }\n    }\n\n    async retryInit() {\n        this.setState({ \n            error: null, \n            isEngineReady: false,\n            showError: false \n        });\n        await this.initEngine();\n    }\n\n    startAnalysis() {\n        if (!this.engine || !this.state.isEngineReady) {\n            this.setState({\n                showError: true,\n                errorMessage: 'Engine not ready. Please wait or refresh.'\n            });\n            return;\n        }\n\n        // Check if engine is in a valid state\n        const engineState = this.engine.getState();\n        if (engineState === 'error') {\n            this.setState({\n                showError: true,\n                errorMessage: 'Engine error. Attempting recovery...'\n            });\n            this.retryInit();\n            return;\n        }\n\n        this.lastFen = this.props.fen;\n        this.analysisResults.clear();\n        this.safeSetState({ \n            isAnalyzing: true, \n            topMoves: [],\n            evaluation: null,\n            depth: 0,\n            engineState: 'analyzing'\n        });\n\n        this.engine.setMultiPV(this.state.multiPV);\n        this.engine.analyzeInfinite(this.props.fen, this.handleAnalysisUpdate);\n    }\n\n    stopAnalysis() {\n        if (this.engine) {\n            this.engine.stop();\n        }\n        this.safeSetState({ \n            isAnalyzing: false,\n            engineState: this.engine ? this.engine.getState() : 'ready'\n        });\n    }\n\n    toggleAnalysis() {\n        if (this.state.isAnalyzing) {\n            this.stopAnalysis();\n        } else {\n            this.startAnalysis();\n        }\n    }\n\n    handleAnalysisUpdate(result) {\n        // Ignore results if component is unmounted or FEN has changed\n        if (!this.mounted || this.props.fen !== this.lastFen) {\n            return;\n        }\n\n        // Store result by multipv index\n        this.analysisResults.set(result.multipv, result);\n\n        // Get current turn from FEN\n        let chess;\n        try {\n            chess = chessLogic(this.props.variant, this.props.fen);\n        } catch (e) {\n            console.error('Error creating chess instance:', e);\n            return;\n        }\n        \n        const turn = chess.turn();\n\n        // Convert all stored results to display format\n        const topMoves = [];\n        for (let i = 1; i <= this.state.multiPV; i++) {\n            const res = this.analysisResults.get(i);\n            if (res && res.pv.length > 0) {\n                const moveInfo = StockfishEngine.uciToMove(res.pv[0], chess);\n                topMoves.push({\n                    rank: i,\n                    move: moveInfo,\n                    score: res.score,\n                    scoreType: res.scoreType,\n                    depth: res.depth,\n                    pv: res.pv,\n                    formattedScore: StockfishEngine.formatScore(res.score, res.scoreType, turn)\n                });\n            }\n        }\n\n        // Get the best line's evaluation for the main display\n        const bestResult = this.analysisResults.get(1);\n        let evaluation = null;\n        if (bestResult) {\n            evaluation = {\n                score: bestResult.score,\n                scoreType: bestResult.scoreType,\n                formatted: StockfishEngine.formatScore(bestResult.score, bestResult.scoreType, turn),\n                barPercent: StockfishEngine.getEvalBarPercent(bestResult.score, bestResult.scoreType, turn)\n            };\n        }\n\n        this.safeSetState({\n            topMoves: topMoves,\n            evaluation: evaluation,\n            depth: bestResult ? bestResult.depth : 0,\n            engineState: this.engine ? this.engine.getState() : 'unknown'\n        });\n\n        // Notify parent about top moves for arrow display\n        if (this.props.onAnalysisUpdate) {\n            this.props.onAnalysisUpdate(topMoves);\n        }\n    }\n\n    handleDepthChange(event, newValue) {\n        this.setState({ analysisDepth: newValue });\n        if (this.engine) {\n            this.engine.setDepth(newValue);\n        }\n    }\n\n    handleMultiPVChange(event, newValue) {\n        this.setState({ multiPV: newValue }, () => {\n            if (this.state.isAnalyzing) {\n                // Clear results and restart analysis with new multiPV\n                this.analysisResults.clear();\n                this.startAnalysis();\n            }\n        });\n    }\n\n    toggleSettings() {\n        this.setState({ showSettings: !this.state.showSettings });\n    }\n\n    handleMoveClick(move) {\n        if (this.props.onMove && move.move) {\n            this.props.onMove(move.move.from, move.move.to);\n        }\n    }\n\n    handleMoveHover(move) {\n        if (this.props.highlightArrow && move.move) {\n            this.props.highlightArrow({\n                orig: move.move.from,\n                dest: move.move.to,\n                san: move.move.san\n            });\n        }\n    }\n\n    handleMoveLeave() {\n        if (this.props.highlightArrow) {\n            this.props.highlightArrow(null);\n        }\n    }\n\n    handleCloseError() {\n        this.setState({ showError: false });\n    }\n\n    renderEvalBar() {\n        const { evaluation } = this.state;\n        const percent = evaluation ? evaluation.barPercent : 50;\n        \n        return (\n            <div className=\"eval-bar-container\">\n                <div className=\"eval-bar\">\n                    <div \n                        className=\"eval-bar-white\" \n                        style={{ height: `${percent}%` }}\n                    />\n                    <div \n                        className=\"eval-bar-black\" \n                        style={{ height: `${100 - percent}%` }}\n                    />\n                </div>\n                <div className=\"eval-score\">\n                    {evaluation ? evaluation.formatted : '0.00'}\n                </div>\n            </div>\n        );\n    }\n\n    renderTopMoves() {\n        const { topMoves, isAnalyzing, depth } = this.state;\n        \n        if (topMoves.length === 0) {\n            return (\n                <div className=\"no-analysis\">\n                    {isAnalyzing ? (\n                        depth === 0 ? 'Starting analysis...' : 'Analyzing...'\n                    ) : (\n                        'Click play to start analysis'\n                    )}\n                </div>\n            );\n        }\n\n        return (\n            <div className=\"top-moves-list\">\n                {topMoves.map((move, index) => (\n                    <div \n                        key={`${move.rank}-${move.pv[0]}`}\n                        className={`top-move-item ${index === 0 ? 'best-move' : ''}`}\n                        onClick={() => this.handleMoveClick(move)}\n                        onMouseEnter={() => this.handleMoveHover(move)}\n                        onMouseLeave={() => this.handleMoveLeave()}\n                    >\n                        <span className=\"move-rank\">{move.rank}</span>\n                        <span className=\"move-san\">{move.move ? move.move.san : move.pv[0]}</span>\n                        <span className={`move-score ${this.getScoreClass(move)}`}>\n                            {move.formattedScore}\n                        </span>\n                        <span className=\"move-depth\">d{move.depth}</span>\n                    </div>\n                ))}\n            </div>\n        );\n    }\n\n    getScoreClass(move) {\n        if (move.scoreType === 'mate') {\n            return move.score > 0 ? 'score-winning' : 'score-losing';\n        }\n        const score = move.score;\n        if (score > 100) return 'score-winning';\n        if (score < -100) return 'score-losing';\n        return 'score-equal';\n    }\n\n    renderSettings() {\n        if (!this.state.showSettings) return null;\n\n        return (\n            <Paper className=\"analysis-settings\" elevation={2}>\n                <Typography variant=\"subtitle2\" gutterBottom>\n                    Analysis Settings\n                </Typography>\n                <div className=\"setting-item\">\n                    <Typography variant=\"body2\">Lines: {this.state.multiPV}</Typography>\n                    <Slider\n                        value={this.state.multiPV}\n                        onChange={this.handleMultiPVChange}\n                        min={1}\n                        max={5}\n                        step={1}\n                        marks\n                        valueLabelDisplay=\"auto\"\n                    />\n                </div>\n            </Paper>\n        );\n    }\n\n    render() {\n        const { isEngineReady, isAnalyzing, depth, error, showError, errorMessage } = this.state;\n\n        if (error) {\n            return (\n                <div className=\"stockfish-analysis error\">\n                    <Typography color=\"error\">{error}</Typography>\n                    <Tooltip title=\"Retry initialization\">\n                        <IconButton \n                            onClick={this.retryInit}\n                            color=\"primary\"\n                            size=\"small\"\n                        >\n                            <Refresh />\n                        </IconButton>\n                    </Tooltip>\n                </div>\n            );\n        }\n\n        return (\n            <div className=\"stockfish-analysis\">\n                <div className=\"analysis-header\">\n                    <div className=\"analysis-title\">\n                        <Typography variant=\"h6\">Stockfish 17</Typography>\n                        {isAnalyzing && (\n                            <Typography variant=\"caption\" className=\"depth-indicator\">\n                                Depth: {depth}\n                            </Typography>\n                        )}\n                    </div>\n                    <div className=\"analysis-controls\">\n                        <Tooltip title={isAnalyzing ? \"Stop\" : \"Analyze\"}>\n                            <span>\n                                <IconButton \n                                    onClick={this.toggleAnalysis}\n                                    disabled={!isEngineReady}\n                                    color={isAnalyzing ? \"secondary\" : \"primary\"}\n                                    size=\"small\"\n                                >\n                                    {isAnalyzing ? <Stop /> : <PlayArrow />}\n                                </IconButton>\n                            </span>\n                        </Tooltip>\n                        <Tooltip title=\"Settings\">\n                            <IconButton \n                                onClick={this.toggleSettings}\n                                size=\"small\"\n                            >\n                                <Settings />\n                            </IconButton>\n                        </Tooltip>\n                    </div>\n                </div>\n\n                {this.renderSettings()}\n\n                <div className=\"analysis-content\">\n                    {this.renderEvalBar()}\n                    <div className=\"analysis-moves\">\n                        {this.renderTopMoves()}\n                    </div>\n                </div>\n\n                {!isEngineReady && (\n                    <div className=\"loading-engine\">\n                        <Typography variant=\"body2\">Loading Stockfish...</Typography>\n                        <LinearProgress />\n                    </div>\n                )}\n\n                <Snackbar\n                    open={showError}\n                    autoHideDuration={4000}\n                    onClose={this.handleCloseError}\n                    message={errorMessage}\n                />\n            </div>\n        );\n    }\n}\n","import React from 'react'\nimport PGNLoader from './loader/PGNLoader'\nimport SettingsView from './Settings'\nimport {\n  Button,\n  Col,\n  Modal,\n  ModalFooter,\n  ModalHeader,\n  Nav,\n  NavItem,\n  NavLink,\n  Row,\n  TabContent,\n  TabPane\n} from 'reactstrap';\nimport classnames from 'classnames';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faUser, faList, faCog, faChartBar, faBook, faMicrochip } from '@fortawesome/free-solid-svg-icons'\nimport MovesList from './moves/MovesList'\nimport BookMoves from './moves/BookMoves'\nimport StockfishAnalysis from './analysis/StockfishAnalysis'\nimport {trackEvent} from '../app/Analytics'\nimport * as Constants from '../app/Constants'\nimport ReportControls from './ReportControls'\nimport { Table, TableRow, TableBody, TableCell } from '@material-ui/core'\n\nexport default class ControlsContainer extends React.Component {\n    constructor(props){\n      super(props)\n      this.state = {\n          activeTab:'user',\n          activeGame:null\n      }\n      this.toggleModal = ()=>{\n        this.setState({activeGame:null})\n      }\n    }\n\n    launchGame(game) {\n      if(game.url) {\n          return (e) => {\n              e.stopPropagation()\n              window.open(game.url, '_blank');\n              trackEvent(Constants.EVENT_CATEGORY_MOVES_LIST, \"ViewGameExternal\")\n          }\n      }\n      return ((e) => {\n        e.stopPropagation()\n        this.setState({activeGame:game})\n      })\n    }\n    shouldComponentUpdate(newProps){\n      if(this.props.resize !== newProps.resize) {\n        // dont update component on resize\n        return false\n      }\n      return true\n    }\n    toggle(tab) {\n        if(this.state.activeTab !== tab) {\n            this.setState({activeTab:tab})\n            trackEvent(Constants.EVENT_CATEGORY_CONTROLS,`activeTab:${tab}`)\n        }\n    }\n    switchToUserTab() {\n      this.toggle('user')\n    }\n    switchToMovesTab(highlightMove) {\n      this.toggle('moves')\n      if(highlightMove) {\n        this.setState({highlightPlayerMove:highlightMove})\n        setTimeout(() => {\n          this.setState({\n            highlightPlayerMove:null\n          })\n        }, 1000);\n      }\n    }\n    switchToBookTab(highlightMove) {\n      this.toggle('book')\n      if(highlightMove) {\n        this.setState({highlightBookMove:highlightMove})\n        setTimeout(() => {\n          this.setState({\n            highlightBookMove:null\n          })\n        }, 1000);\n      }\n    }\n\n    render(){\n        return <div>\n              <Modal isOpen={this.state.activeGame} toggle={this.toggleModal}>\n              <ModalHeader toggle={this.toggleModal}>Game details</ModalHeader>\n              {!this.state.activeGame?null:\n              <Table>\n                <TableBody>\n                  {\n                    Object.entries(this.state.activeGame.headers).map((entry)=>!entry[1]?null:<TableRow className=\"performanceRatingRow\">\n                        <TableCell className=\"performanceRatingRow\">{entry[0]}</TableCell>\n                        <TableCell className=\"performanceRatingRow\">{entry[1]}</TableCell>\n                    </TableRow>\n                    )}\n                </TableBody>\n              </Table>\n              }\n              <ModalFooter>\n          <Button color=\"secondary\" onClick={this.toggleModal}>Done</Button>\n        </ModalFooter>\n              </Modal>\n            <Nav tabs>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'user' })}\n            onClick={() => { this.toggle('user'); }}\n          >\n            <FontAwesomeIcon icon={faUser} /> {this.state.activeTab === 'user'?\"User\":\"\"}\n          </NavLink>\n        </NavItem>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'moves' })}\n            onClick={() => { this.toggle('moves'); }}\n          >\n            <FontAwesomeIcon icon={faList} /> {this.state.activeTab === 'moves'?\"Moves\":\"\"}\n          </NavLink>\n        </NavItem>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'book' })}\n            onClick={() => { this.toggle('book'); }}\n          >\n            <FontAwesomeIcon icon={faBook} /> {this.state.activeTab === 'book'?\"Opening book\":\"\"}\n          </NavLink>\n        </NavItem>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'analysis' })}\n            onClick={() => { this.toggle('analysis'); }}\n          >\n            <FontAwesomeIcon icon={faMicrochip} /> {this.state.activeTab === 'analysis'?\"Analysis\":\"\"}\n          </NavLink>\n        </NavItem>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'report' })}\n            onClick={() => { this.toggle('report'); }}\n          >\n            <FontAwesomeIcon icon={faChartBar} /> {this.state.activeTab === 'report'?\"Report\":\"\"}\n          </NavLink>\n        </NavItem>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'settings' })}\n            onClick={() => { this.toggle('settings'); }}\n          >\n            <FontAwesomeIcon icon={faCog} /> {this.state.activeTab === 'settings'?\"Controls\":\"\"}\n          </NavLink>\n        </NavItem>\n      </Nav>\n      <TabContent activeTab={this.state.activeTab}>\n        <TabPane tabId=\"user\">\n            <PGNLoader\n              switchToMovesTab={this.switchToMovesTab.bind(this)}\n              clear = {this.props.clear}\n              gamesProcessed = {this.props.gamesProcessed}\n              settings = {this.props.settings}\n              onChange = {this.props.settingsChange}\n              notify = {this.props.updateProcessedGames}\n              showError = {this.props.showError}\n              showInfo = {this.props.showInfo}\n              setDownloading = {this.props.setDownloading}\n              isDownloading = {this.props.isDownloading}\n              openingGraph={this.props.openingGraph}\n              importCallback={this.props.importCallback}\n              variant={this.props.variant}\n              variantChange={this.props.variantChange}\n              oauthManager={this.props.oauthManager}\n              />\n            </TabPane>\n        <TabPane tabId=\"moves\">\n            <MovesList\n              switchToUserTab={this.switchToUserTab.bind(this)}\n              playerMoves={this.props.playerMoves}\n              gameResults={this.props.gameResults}\n              onMove={this.props.onMove}\n              settings={this.props.settings}\n              turnColor={this.props.turnColor}\n              settingsChange={this.props.settingsChange}\n              launchGame = {this.launchGame.bind(this)}\n              switchToBookTab={this.switchToBookTab.bind(this)}\n              highlightMove={this.state.highlightPlayerMove}\n              variant={this.props.variant}\n              highlightArrow={this.props.highlightArrow}\n            />\n        </TabPane>\n        <TabPane tabId=\"book\">\n            <BookMoves\n              bookMoves={this.props.bookMoves}\n              gameResults={this.props.bookResults}\n              onMove={this.props.onMove}\n              settings={this.props.settings}\n              turnColor={this.props.turnColor}\n              settingsChange={this.props.settingsChange}\n              launchGame = {this.launchGame.bind(this)}\n              switchToMovesTab = {this.switchToMovesTab.bind(this)}\n              highlightMove = {this.state.highlightBookMove}\n              forceFetchBookMoves = {this.props.forceFetchBookMoves}\n              variant={this.props.variant}\n              highlightArrow={this.props.highlightArrow}\n              />\n        </TabPane>\n        <TabPane tabId=\"analysis\">\n            <StockfishAnalysis\n              fen={this.props.fen}\n              variant={this.props.variant}\n              onMove={this.props.onMove}\n              highlightArrow={this.props.highlightArrow}\n              onAnalysisUpdate={this.props.onAnalysisUpdate}\n            />\n        </TabPane>\n        <TabPane tabId=\"report\">\n          <ReportControls fen={this.props.fen} simplifiedView = {false}\n            moveDetails = {this.props.openingGraph.getDetailsForFen(this.props.fen)}\n            launchGame={this.launchGame.bind(this)} settings={this.props.settings}\n            switchToUserTab={this.switchToUserTab.bind(this)}\n            isOpen = {this.state.activeTab === \"report\"}\n            showInfo = {this.props.showInfo} reportFooter={this.reportFooter()}/>\n        </TabPane>\n        <TabPane tabId=\"settings\">\n          <Row>\n            <Col md=\"9\" xs=\"12\">\n            <SettingsView\n              fen={this.props.fen}\n              settings={this.props.settings}\n              isOpen = {true}\n              clear = {this.props.clear}\n              reset = {this.props.reset}\n              onChange = {this.props.settingsChange} />\n            </Col>\n          </Row>\n        </TabPane>\n      </TabContent>\n        </div>\n    }\n\n    reportFooter(){\n      return <span>Performance rating calculated based on <a href=\"https://handbook.fide.com/chapter/B022017\" target=\"_blank\" rel=\"noopener noreferrer\">FIDE regulations</a></span>\n    }\n}\n","import * as Constants from '../../app/Constants'\nimport * as Common from '../../app/Common'\nimport {getTimeControlsArray} from '../../app/util'\n\nlet timeClasses = [\n    {\n        label:\"Fast time controls\",\n        selectedTimeControls:[\n            Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_ULTRA_BULLET,\n            Constants.TIME_CONTROL_BLITZ\n        ],\n        unselectedTimeControls:[\n            Constants.TIME_CONTROL_RAPID,\n            Constants.TIME_CONTROL_CLASSICAL,\n            Constants.TIME_CONTROL_CORRESPONDENCE\n        ]\n    },\n    {\n        label:\"Slow time controls\",\n        selectedTimeControls:[\n            Constants.TIME_CONTROL_RAPID,\n            Constants.TIME_CONTROL_CLASSICAL,\n            Constants.TIME_CONTROL_CORRESPONDENCE\n        ],\n        unselectedTimeControls:[\n            Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_ULTRA_BULLET,\n            Constants.TIME_CONTROL_BLITZ\n        ]\n    },\n    {\n        label:\"Reasonable time controls\",\n        selectedTimeControls:[\n            Constants.TIME_CONTROL_BLITZ,\n            Constants.TIME_CONTROL_RAPID,\n            Constants.TIME_CONTROL_CLASSICAL,\n            Constants.TIME_CONTROL_CORRESPONDENCE\n        ],\n        unselectedTimeControls:[\n            Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_ULTRA_BULLET\n        ]\n    },\n    {\n        label:\"Exclude slow time controls\",\n        selectedTimeControls:[\n            Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_ULTRA_BULLET,\n            Constants.TIME_CONTROL_BLITZ,\n            Constants.TIME_CONTROL_RAPID\n        ],\n        unselectedTimeControls:[\n            Constants.TIME_CONTROL_CLASSICAL,\n            Constants.TIME_CONTROL_CORRESPONDENCE\n        ]\n    }\n]\n        \n\n\nexport function timeControlLabel(site, timeControlState) {\n    let selectedTimeControls = getTimeControlsArray(site, timeControlState, true)\n    let unselectedTimeControls = getTimeControlsArray(site, timeControlState, false)\n    if(unselectedTimeControls.length === 0 || selectedTimeControls.length === 0) {\n        return \"All time controls\"\n    }\n    if(selectedTimeControls.length === 1) {\n        return Common.TIME_CONTROL_LABELS[selectedTimeControls[0]]\n    }\n    if(unselectedTimeControls.length === 1) {\n        return `All except ${Common.TIME_CONTROL_LABELS[unselectedTimeControls[0]]}`\n    }\n    if(selectedTimeControls.length === 2) {\n        return `${Common.TIME_CONTROL_LABELS[selectedTimeControls[0]]} and ${Common.TIME_CONTROL_LABELS[selectedTimeControls[1]]}`\n    }\n\n    return lichessTimeControlLabel(selectedTimeControls, unselectedTimeControls)\n}\n\nfunction lichessTimeControlLabel(selectedTimeControls, unselectedTimeControls) {\n    let timeClass = timeClasses.filter(\n        (timeClass) => {\n            return includesAll(unselectedTimeControls,timeClass.unselectedTimeControls)\n                && includesAll(selectedTimeControls,timeClass.selectedTimeControls)\n    })\n    if(timeClass.length) {\n        return timeClass[0].label\n    } \n    return selectedTimeControls.map(control=>Common.TIME_CONTROL_LABELS[control]).join(', ')\n}\n\nfunction includesAll(arr, subArray) {\n    return subArray.every(v => arr.includes(v));\n}\n","import {timeControlLabel} from './TimeControlLabels'\nimport * as Constants from '../../app/Constants'\n\nexport const getTimeControlLabel = timeControlLabel\n\nexport function getRatedLabel(rated) {\n    if(rated === 'all') {\n        return \"Rated and casual\"\n    } else if (rated === 'rated') {\n        return \"Rated only\"\n    } else if (rated === 'casual') {\n        return \"Casual only\"\n    }\n}\n\nexport function getELORangeLabel(selectedEloRange) {\n    if(selectedEloRange[0] === 0 && selectedEloRange[1]===Constants.MAX_ELO_RATING) {\n        return \"Any rating\"\n    } else if (selectedEloRange[0] === 0) {\n        return `Below ${selectedEloRange[1]}`\n    } else if (selectedEloRange[1] === Constants.MAX_ELO_RATING) {\n        return `Above ${selectedEloRange[0]}`\n    } else {\n        return `Between ${selectedEloRange[0]} and ${selectedEloRange[1]}`\n    }\n}\n\nexport function opponentNameLabel(value) {\n    return value?value:\"All opponents\"\n}\nexport function getDownloadLimitLabel(downloadLimit) {\n    return downloadLimit>= Constants.MAX_DOWNLOAD_LIMIT?\"No limit\":`${downloadLimit} games`\n}\n\nexport function getFromDateLabel(date) {\n    return date?date.toLocaleDateString('en-US'): 'Big Bang'\n}\n\nexport function getToDateLabel(date) {\n    return date?date.toLocaleDateString('en-US'): 'Now'\n}\n","import FormControl from '@material-ui/core/FormControl';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport React from 'react'\nimport {Collapse, Container, Row, Col, Badge} from 'reactstrap'\nimport { FormControlLabel,Slider } from '@material-ui/core';\nimport * as Constants from '../../app/Constants'\nimport {getTimeControlLabel, getELORangeLabel, getRatedLabel, \n    getDownloadLimitLabel, opponentNameLabel, getFromDateLabel, getToDateLabel} from './FilterLabels'\nimport * as Common from '../../app/Common'\nimport { trackEvent } from '../../app/Analytics'\nimport { TextField } from '@material-ui/core'\nimport DatePicker from 'react-datepicker'\nimport \"react-datepicker/dist/react-datepicker.css\";\n\nexport default class AdvancedFilters extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            currentlyOpenAdvancedFilter:'',\n        }\n        this.downloadLimitMarks=[\n            {\n                value:0,\n                label:\"0\"\n            }, {\n                value:Constants.MAX_DOWNLOAD_LIMIT,\n                label:`No limit`\n            }]\n        this.eloRangeMarks=[\n            {\n                value:0,\n                label:\"0\"\n            }, {\n                value:Constants.MAX_ELO_RATING,\n                label:`No limit`\n            }]\n    \n    }\n    setCurrentlyOpenAdvancedFilter(filterName) {\n        return () => {\n            if(this.state.currentlyOpenAdvancedFilter === filterName) {\n                //close if already open\n                filterName = ''\n            }\n            this.setState({currentlyOpenAdvancedFilter:filterName})\n            trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"AdvancedFilterChange\", filterName)\n        }\n    }\n\n    getFilters(site){\n        return <div>\n            {this.subSectionComponent('Mode', getRatedLabel(this.props.advancedFilters.rated), this.props.toggleRated)}\n            {this.subSectionComponent('Time control', getTimeControlLabel(this.props.site, this.props.advancedFilters), \n                    this.setCurrentlyOpenAdvancedFilter('timeControl').bind(this),\n                <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'timeControl'}>\n                    {this.getTimeControlFilters(site, 4)}\n                </Collapse>\n            )}\n            {this.subSectionComponent('From Date', getFromDateLabel(this.props.advancedFilters[Constants.FILTER_NAME_FROM_DATE]), \n                this.setCurrentlyOpenAdvancedFilter('fromDate').bind(this),\n                <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'fromDate'}>\n                    {this.getFromDateFilter()}\n                </Collapse>, true)}\n            {this.subSectionComponent('To Date', getToDateLabel(this.props.advancedFilters[Constants.FILTER_NAME_TO_DATE]), \n            this.setCurrentlyOpenAdvancedFilter('toDate').bind(this),\n            <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'toDate'}>\n                {this.getToDateFilter()}\n            </Collapse>, true)}\n\n            {this.subSectionComponent('Opponent rating range', getELORangeLabel(this.props.advancedFilters[Constants.FILTER_NAME_ELO_RANGE]), \n                this.setCurrentlyOpenAdvancedFilter('eloRange').bind(this),\n                <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'eloRange'}>\n                    {this.getEloRangeFilters()}\n                </Collapse>)}\n            {this.subSectionComponent('Opponent name', opponentNameLabel(this.props.advancedFilters[Constants.FILTER_NAME_OPPONENT]), \n                this.setCurrentlyOpenAdvancedFilter('opponent').bind(this),\n                <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'opponent'}>\n                    {this.getOpponentNameFilter()}\n                </Collapse>, true)}\n            {this.subSectionComponent('Download limit', getDownloadLimitLabel(this.props.advancedFilters[Constants.FILTER_NAME_DOWNLOAD_LIMIT]), \n                this.setCurrentlyOpenAdvancedFilter('downloadLimit').bind(this),\n                <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'downloadLimit'}>\n                    {this.getDownloadLimitFilters()}\n                </Collapse>)}\n      </div>\n    }\n\n    getDownloadLimitFilters() {\n        return <Slider className = \"sliderCustom\"\n            value={this.props.advancedFilters[Constants.FILTER_NAME_DOWNLOAD_LIMIT]}\n            onChange={this.props.handleDownloadLimitChange}\n            valueLabelDisplay=\"auto\"\n            valueLabelFormat={(val)=>val>=Constants.MAX_DOWNLOAD_LIMIT?\"All\":val}\n            step={100}\n            min={0}\n            marks={this.downloadLimitMarks}\n            max={Constants.MAX_DOWNLOAD_LIMIT}\n        />\n    }\n    getFromDateFilter() {\n        return <DatePicker placeholderText = \"mm/dd/yyyy\" selected={this.props.advancedFilters[Constants.FILTER_NAME_FROM_DATE]}\n                            onChange={this.props.handleFromDate}/>\n    }\n    getToDateFilter() {\n        return <DatePicker placeholderText = \"mm/dd/yyyy\" selected={this.props.advancedFilters[Constants.FILTER_NAME_TO_DATE]}\n                            onChange={this.props.handleToDate}/>\n    }\n\n    getEloRangeFilters() {\n        return <Slider className = \"sliderCustom\"\n            value={this.props.advancedFilters[Constants.FILTER_NAME_ELO_RANGE]}\n            onChange={this.props.handleEloRangeChange}\n            valueLabelDisplay=\"off\"\n            marks={this.eloRangeMarks}\n            min={0}\n            max={Constants.MAX_ELO_RATING}\n        />\n    }\n    getOpponentNameFilter() {\n        return <TextField\n            className=\"playernameField\" name=\"opponentName\" id=\"opponentNameTextBox\" \n            margin=\"dense\" onChange={this.props.handleOpponentNameChange}\n            label={\"Opponent Name\"} variant=\"outlined\" value={this.props.advancedFilters[Constants.FILTER_NAME_OPPONENT]}/>\n    }\n\n    getTimeControlFilters(site){\n        let firstRow = null, middleRow = null, lastRow = null\n        let colWidth = null\n        if(site === 'lichess') {\n            firstRow = [Constants.TIME_CONTROL_BULLET,\n                        Constants.TIME_CONTROL_ULTRA_BULLET]\n            middleRow = [Constants.TIME_CONTROL_BLITZ,\n                        Constants.TIME_CONTROL_CLASSICAL]\n            lastRow = [Constants.TIME_CONTROL_RAPID,\n                        Constants.TIME_CONTROL_CORRESPONDENCE]\n            colWidth = '4'\n                    \n        } else {\n            firstRow = [Constants.TIME_CONTROL_BULLET,\n                        Constants.TIME_CONTROL_BLITZ]\n            lastRow = [Constants.TIME_CONTROL_RAPID, \n                        Constants.TIME_CONTROL_DAILY]\n            colWidth = '6'\n        }\n        return <FormControl><FormGroup><Container>\n            {this.getTimeControlFilterRow(firstRow,colWidth,'first')}\n            {middleRow?this.getTimeControlFilterRow(middleRow,colWidth,'middle'):null}\n            {this.getTimeControlFilterRow(lastRow,colWidth,'last')}\n          </Container>\n        </FormGroup></FormControl>\n      \n    }\n\n    getTimeControlFilterRow(controls,firstColumnWidth, position){\n        let clsName = 'topBottomNegativeMargin'\n        if(position === \"first\") {\n            clsName = 'bottomNegativeMargin'\n        } else if (position === \"last\") {\n            clsName = 'topNegativeMargin'\n        } \n        return <Row className={clsName}>\n            {controls.map((control) => \n            <Col sm={firstColumnWidth} key={`ctrl${control}`}>\n                \n            <FormControlLabel className = \"nomargin\"\n                control={<Checkbox checked={this.props.advancedFilters[control]} color=\"primary\" \n                onChange={this.props.handleTimeControlChange} name={control} />}\n                label={Common.TIME_CONTROL_LABELS[control]}\n          /></Col>)}</Row>\n    }\n\n    subSectionComponent(title, label, changeCallback, children, newBadge) {\n        return <div className=\"pgnloadersection\">{title}: <span className=\"smallText\">[<span className=\"linkStyle\" onClick={changeCallback}>change</span>]</span> {newBadge?<Badge className=\"sourceName\" color=\"info\">New!</Badge>:null}\n            <div><b>{label}</b></div>{children}\n            </div>\n    }\n\n\n    render() {\n        return this.getFilters(this.props.site)\n    }\n\n}","import * as ChessLogic from './chess/ChessLogic'\n\nexport default class OpeningManager {\n    plys = []\n    currentIndex = 0\n    constructor(variant) {\n        this.plys = [{pgn:'', fen:ChessLogic.rootFen(variant), move:null}]\n        this.currentIndex = 0\n    }\n    addPly(fen,move) {\n        if(this.currentIndex<this.plys.length-1 && this.plys[this.currentIndex+1].move.san === move.san) {\n            this.moveForward()\n            return\n        }\n        this.plys = this.plys.slice(0,this.currentIndex+1)\n        this.plys.push({\n            pgnAsList:this.pgnAsList(move.san),\n            fen: fen,\n            move: move\n        })\n        this.currentIndex++;\n        return this.plys[this.currentIndex]\n    }\n\n    pgnAsList(san) {\n        let pgnSoFar = this.pgnListSoFar()\n        let pgnList\n        if (!pgnSoFar) {\n            pgnList = []\n        } else {\n            pgnList = [...pgnSoFar]\n        }\n        let numPlys = this.plys.length\n        if(numPlys%2 !== 0) {\n            pgnList.push({\n                moveNumber:pgnList.length+1,\n                whitePly:san,\n                blackPly:''\n            })\n        } else {\n            let currMove = pgnList[pgnList.length-1]\n            currMove.blackPly = san\n            pgnList[pgnList.length-1] = currMove\n        }\n        return pgnList\n    }\n\n    currentMove() {\n        return Math.floor((this.currentIndex-1)/2);\n    }\n\n    pgnListSoFar(){\n        return this.plys[this.plys.length-1].pgnAsList\n    }\n\n    fen(){\n        return this.plys[this.currentIndex].fen\n    }\n\n    moveForward() {\n        return this.moveTo(this.currentIndex+1)\n    }\n    moveBack() {\n        return this.moveTo(this.currentIndex-1)\n    }\n    moveTo(index) {\n        if(index>=0 && index<this.plys.length) {\n            this.currentIndex = index\n        }\n        return this.plys[this.currentIndex]\n    }\n\n}","import React from 'react'\nimport ChessEcoCodes from 'chess-eco-codes'\nimport OpeningManager from '../app/OpeningManager'\nimport {Container, Row, Col, Button} from 'reactstrap'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faStepForward, faStepBackward } from '@fortawesome/free-solid-svg-icons'\nimport * as Constants from '../app/Constants'\nimport {trackEvent} from '../app/Analytics'\n\nexport default class Navigator extends React.Component {\n\n    constructor(props){\n        super(props)\n        this.openingManager = new OpeningManager(this.props.variant)\n        this.state = {\n            currentMove:0,\n        }\n        window.addEventListener(\"keydown\",this.keyHandler.bind(this))\n    }\n    keyHandler(e){\n        switch(e.keyCode) {\n            case 37:\n                this.previous(e, \"keyboard\");\n                break\n            case 39:\n                this.next(e, \"keyboard\")\n                break\n            default:\n                break\n        }\n    }\n\n    // TODO: Put scroll handler behind setting\n    // scrollHandler(e) {\n    //     e.preventDefault();\n\n    //     if (e.deltaY > 0) {\n    //         this.next(e, \"wheel\");\n    //     }\n\n    //     else if (e.deltaY < 0) {\n    //         this.previous(e, \"wheel\");\n    //     }\n    // }\n\n    shouldComponentUpdate(newProps) {\n        //console.log(newProps)\n        if(newProps.variant !== this.props.variant) {\n            this.openingManager = new OpeningManager(newProps.variant)\n            return true\n\n        }\n        if(newProps.fen !== this.openingManager.fen()) {\n            if(newProps.move === null) {\n                // called when \"clear\" or \"starting position\" actions are hit\n                this.openingManager = new OpeningManager(newProps.variant)\n                return true\n            }\n            this.openingManager.addPly(newProps.fen, newProps.move)\n            return true\n        }\n        return true\n    }\n\n    previous(e, device) {\n        let newState = this.openingManager.moveBack()\n        this.props.onChange(newState.fen, newState.move)\n        this.setState({\n            currentMove: this.openingManager.currentMove()\n        })\n        trackEvent(Constants.EVENT_CATEGORY_NAVIGATOR, \"Previous\", device || \"mouse\")\n    }\n\n    next(e, device) {\n        let newState = this.openingManager.moveForward()\n        this.props.onChange(newState.fen, newState.move)\n        this.setState({currentMove:this.openingManager.currentMove()})\n        trackEvent(Constants.EVENT_CATEGORY_NAVIGATOR, \"Next\", device || \"mouse\")\n    }\n\n    moveTo(index) {\n        return () => {\n            let newState = this.openingManager.moveTo(index+1)\n            this.props.onChange(newState.fen, newState.move)\n            this.setState({currentMove:this.openingManager.currentMove()})\n            trackEvent(Constants.EVENT_CATEGORY_NAVIGATOR, \"move\", null, index)\n        }\n    }\n\n    render(){\n        let opening = ChessEcoCodes(this.openingManager.fen())\n        if (opening) {\n            this.opening = opening.name\n            this.openingCode = opening.code\n        }\n        if(!this.openingManager.pgnListSoFar()) {\n            return <div></div>\n        }\n        return <Container id=\"navigator\">\n            <Row>\n                <Col lg=\"6\" className=\"navSection\">\n                    <Button color=\"\" onClick= {this.previous.bind(this)}>\n                        <FontAwesomeIcon icon={faStepBackward} />&nbsp;\n                        <span>prev</span>\n                    </Button>\n                </Col>\n                <Col lg=\"6\" className=\"navSection\">\n                    <Button color=\"\" onClick = {this.next.bind(this)}>\n                        <span>next</span>&nbsp;\n                        <FontAwesomeIcon icon={faStepForward} /> \n                    </Button>\n                </Col>\n            </Row>\n            <Row className=\"greyText\">{this.openingCode}: {this.opening}</Row>\n            {\n                this.openingManager.pgnListSoFar().map((move, index)=>\n                    <Row key={`${move.moveNumber}`} className=\"navCol\">\n                        <Col sm=\"2\" className = \"navItem navMoveNumber\">\n                            {`${move.moveNumber}.`}\n                        </Col>\n                        <Col sm=\"5\"\n                            className = {`navItem navMove border ${this.openingManager.currentIndex-1 === index*2 ? 'selectedMove':''}`}\n                            onClick={this.moveTo(index*2).bind(this)}>\n                            {`${move.whitePly}`}\n                        </Col>\n                        <Col sm=\"5\"\n                            className = {`navItem navMove border ${this.openingManager.currentIndex-1 === index*2+1 ? 'selectedMove':''}`}\n                            onClick={\n                                this.moveTo(index*2+1).bind(this)}>\n                            {`${move.blackPly}`}\n                        </Col>\n                    </Row>)\n            }\n        </Container>\n    }\n\n    // TODO: Put scroll handler behind setting\n    // componentDidUpdate () {\n    //     const chessBoard = document.querySelector('cg-board');\n    //     const navigator = document.querySelector('#navigator');\n\n    //     if (chessBoard) chessBoard.onwheel = this.scrollHandler.bind(this);\n    //     if (navigator) navigator.onwheel = this.scrollHandler.bind(this);\n    // }\n}","import ReactDOM from 'react-dom'\nimport MainContainer from './pres/MainContainer'\nimport React from 'react'\nimport {trackPageView} from './app/Analytics'\n\nReactDOM.render(<MainContainer />, document.getElementById('root'))\ntrackPageView()","import * as Constants from '../app/Constants'\nimport * as Common from '../app/Common'\n\nexport function createSubObjectWithProperties(mainObject, properties) {\n    let subObject = {}\n    properties.forEach(property => {\n        subObject[property] = mainObject[property]\n    });\n    return subObject\n}\nexport function simplifiedFen(fen) {\n    let fenComponents = fen.split(' ')\n    if(fenComponents.length <=4) {\n        return fen\n    }\n    //exclude move and halfMove components\n    return `${fenComponents[0]} ${fenComponents[1]} ${fenComponents[2]}`\n}\n\nexport function getTimeControlsArray(site,timeControlState, selected) {\n    let allTimeControls = site === Constants.SITE_LICHESS ? \n        Common.LICHESS_TIME_CONTROLS : Common.CHESS_DOT_COM_TIME_CONTROLS\n    return allTimeControls.filter((timeControl)=>!!timeControlState[timeControl] === selected)\n}\n\nexport function simplifyCount(count){\n    if(count>=1000000){\n        return `${(count/1000000).toFixed(1)}M`\n    }        \n    if(count>=10000){\n        return `${Math.round(count/1000)}k`\n    }\n\n    return count\n}\n\nexport function getPerformanceDetails(totalOpponentElo, averageElo, white, draws, black, playerColor) {\n    let totalGames = white + draws + black\n    let averageOpponentElo = totalOpponentElo?Math.round(totalOpponentElo/totalGames):null\n    let playerWins = playerColor === Constants.PLAYER_COLOR_BLACK?black:white\n    let playerLosses = playerColor !== Constants.PLAYER_COLOR_BLACK?black:white\n    let score = playerWins+(draws/2)\n    let scorePercentage = score*100/totalGames\n    let ratingChange = Common.DP_TABLE[Math.round(scorePercentage)]\n    let performanceRating = null\n    if(averageOpponentElo) {\n        performanceRating = averageOpponentElo+ratingChange\n    }\n    return {\n        results:`+${simplifyCount(playerWins)}-${simplifyCount(playerLosses)}=${simplifyCount(draws)}`,\n        performanceRating:performanceRating,\n        averageOpponentElo: averageOpponentElo,// avg rating of opponents only\n        averageElo:averageElo, // avg rating of all players\n        score:`${Number.isInteger(scorePercentage)?scorePercentage:scorePercentage.toFixed(1)}% for ${playerColor === Constants.PLAYER_COLOR_BLACK?'black':'white'}`,\n        ratingChange:`${ratingChange===0?'':(ratingChange>0?'+':'-')}${Math.abs(ratingChange)}`\n    }\n}\n\nexport function isOpponentEloInSelectedRange(elo, range) {\n    if(range[1]===Constants.MAX_ELO_RATING) {\n        return elo>=range[0]\n    }\n    return elo<=range[1] && elo>=range[0]\n}\n\nexport function isDateMoreRecentThan(date, than) {\n    // give priority to game which has a date\n    if(!than) {\n        return false\n    }\n    if(!date) {\n        return true\n    } \n    return new Date(date)>new Date(than)\n}","import Cookies from 'js-cookie'\n\nclass CookieManager {\n    getLichessAccessToken() {\n        return Cookies.get('at')\n    }\n\n    setLichessAccessToken(value) {\n        Cookies.set('at', value, {expires: 365})\n    }\n\n    deleteLichessAccessToken() {\n        // delete cookie set by cloudflare worker\n        // This is only for older logins.\n        Cookies.remove('at', { path: '/', domain:'www.openingtree.com' })\n        //delete cookie set by pkce\n        Cookies.remove('at')\n    }\n\n    setSettingsCookie(settings) {\n        Cookies.set('set',JSON.stringify(settings))\n    }\n\n    setDarkModeCookie(darkMode) {\n        Cookies.set('dm',darkMode)\n    }\n    getDarkModeCookie() {\n        return Cookies.get('dm')\n\n    }\n\n    getSettingsCookie() {\n        let settingsCookie = null\n        try {\n            settingsCookie = Cookies.get('set')\n        } catch (e) {\n            console.log(e)\n            return null\n        }\n        if(!settingsCookie) {\n            return null\n        }\n        return JSON.parse(settingsCookie)\n    }\n\n    currentVisit = null\n\n    getVisitInfo(){\n        if(this.currentVisit) {\n            return this.currentVisit\n        }\n        // executes when page loads\n        let lastVisitCookie = Cookies.get('lst')\n        let visitsCookie = Cookies.get('vcnt')\n        let firstVisitCookie = Cookies.get('fst')\n        let lastVisit = lastVisitCookie?parseInt(lastVisitCookie):null\n        let timesVisited = visitsCookie?parseInt(visitsCookie):0\n        let firstVisit = firstVisitCookie?parseInt(firstVisitCookie):null\n        let currDate = new Date().getTime()\n        this.currentVisit = {\n            firstVisit:firstVisit,\n            lastVisit: lastVisit,\n            currentVisit: currDate,\n            numVisits: timesVisited,\n        }\n        if(lastVisit === null || currDate-lastVisit>1000*60*60*24){\n            // increment count if visit in more than an day\n            Cookies.set('lst', currDate);\n            Cookies.set('vcnt', timesVisited+1)\n        }\n        if(firstVisit === null) {\n            Cookies.set('fst', currDate);\n        }\n        return this.currentVisit\n    }\n\n}\n\nexport default new CookieManager();","module.exports = __webpack_public_path__ + \"static/js/0.a1253645.chunk.worker.js\"","import * as Constants from './Constants'\n\nexport const LICHESS_TIME_CONTROLS = [\n    Constants.TIME_CONTROL_ULTRA_BULLET,\n    Constants.TIME_CONTROL_BULLET,\n    Constants.TIME_CONTROL_BLITZ,\n    Constants.TIME_CONTROL_RAPID,\n    Constants.TIME_CONTROL_CLASSICAL,\n    Constants.TIME_CONTROL_CORRESPONDENCE\n]\nexport const CHESS_DOT_COM_TIME_CONTROLS = [\n    Constants.TIME_CONTROL_BULLET,\n    Constants.TIME_CONTROL_BLITZ,\n    Constants.TIME_CONTROL_RAPID,\n    Constants.TIME_CONTROL_DAILY,\n]\n\nexport const TIME_CONTROL_LABELS = {\n    [Constants.TIME_CONTROL_ULTRA_BULLET]: \"Ultrabullet\",\n    [Constants.TIME_CONTROL_BULLET]: \"Bullet\",\n    [Constants.TIME_CONTROL_BLITZ]: \"Blitz\",\n    [Constants.TIME_CONTROL_RAPID]: \"Rapid\",\n    [Constants.TIME_CONTROL_CLASSICAL]: \"Classical\",\n    [Constants.TIME_CONTROL_CORRESPONDENCE]: \"Correspondence\",\n    [Constants.TIME_CONTROL_DAILY]: \"Daily\"\n}\n\nexport function trimString(str) {\n    return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nexport function lichessVariantHeader(variant) {\n    if(variant === Constants.VARIANT_RACING_KINGS) {\n        return Constants.LICHESS_HEADER_RACING_KINGS\n    } else if(variant === Constants.VARIANT_KING_OF_THE_HILL) {\n        return Constants.LICHESS_HEADER_KING_OF_THE_HILL\n    } else if(variant === Constants.VARIANT_THREE_CHECK) {\n        return Constants.LICHESS_HEADER_THREE_CHECK\n    } else if(variant === Constants.VARIANT_CRAZYHOUSE) {\n        return Constants.LICHESS_HEADER_CRAZYHOUSE\n    }\n    return Constants.LICHESS_HEADER_STANDARD\n}\nexport function lichessPerf(variant) {\n    if (variant === Constants.VARIANT_KING_OF_THE_HILL) {\n        return Constants.LICHESS_PERF_KING_OF_THE_HILL\n    } else if (variant === Constants.VARIANT_RACING_KINGS) {\n        return Constants.LICHESS_PERF_RACING_KINGS\n    } else if (variant === Constants.VARIANT_THREE_CHECK) {\n        return Constants.LICHESS_PERF_THREE_CHECK\n    } else if (variant === Constants.VARIANT_CRAZYHOUSE) {\n        return Constants.LICHESS_PERF_CRAZYHOUSE\n    } else if (variant === Constants.VARIANT_STANDARD) {\n        return Constants.LICHESS_PERF_STANDARD\n    }\n}\nexport function chessDotComRules(variant) {\n    if(variant === Constants.VARIANT_KING_OF_THE_HILL) {\n        return Constants.CHESS_COM_RULES_KING_OF_THE_HILL\n    } else if(variant === Constants.VARIANT_THREE_CHECK) {\n        return Constants.CHESS_COM_RULES_THREE_CHECK\n    } else if(variant === Constants.VARIANT_CRAZYHOUSE) {\n        return Constants.CHESS_COM_RULES_CRAZYHOUSE\n    }\n    return Constants.CHESS_COM_RULES_STANDARD\n}\n\n\nexport const DP_TABLE = {\n    \"100\":800,   \"99\":677,    \"98\":589,    \"97\":538,\n    \"96\":501,    \"95\":470,    \"94\":444,    \"93\":422,\n    \"92\":401,    \"91\":383,    \"90\":366,    \"89\":351,\n    \"88\":336,    \"87\":322,    \"86\":309,    \"85\":296,\n    \"84\":284,    \"83\":273,    \"82\":262,    \"81\":251,\n    \"80\":240,    \"79\":230,    \"78\":220,    \"77\":211,\n    \"76\":202,    \"75\":193,    \"74\":184,    \"73\":175,\n    \"72\":166,    \"71\":158,    \"70\":149,    \"69\":141,\n    \"68\":133,    \"67\":125,    \"66\":117,    \"65\":110,\n    \"64\":102,    \"63\":95,     \"62\":87,     \"61\":80,\n    \"60\":72,     \"59\":65,     \"58\":57,     \"57\":50,\n    \"56\":43,     \"55\":36,     \"54\":29,     \"53\":21,\n    \"52\":14,     \"51\":7,      \"50\":0,      \"49\":-7,\n    \"48\":-14,    \"47\":-21,    \"46\":-29,    \"45\":-36,\n    \"44\":-43,    \"43\":-50,    \"42\":-57,    \"41\":-65,\n    \"40\":-72,    \"39\":-80,    \"38\":-87,    \"37\":-95,\n    \"36\":-102,   \"35\":-110,   \"34\":-117,   \"33\":-125,\n    \"32\":-133,   \"31\":-141,   \"30\":-149,   \"29\":-158,\n    \"28\":-166,   \"27\":-175,   \"26\":-184,   \"25\":-193,\n    \"24\":-202,   \"23\":-211,   \"22\":-220,   \"21\":-230,\n    \"20\":-240,   \"19\":-251,   \"18\":-262,   \"17\":-273,\n    \"16\":-284,   \"15\":-296,   \"14\":-309,   \"13\":-322,\n    \"12\":-336,   \"11\":-351,   \"10\":-366,   \"9\":-383,\n    \"8\":-401,    \"7\":-422,    \"6\":-444,    \"5\":-470,\n    \"4\":-501,    \"3\":-538,    \"2\":-589,    \"1\":-677,\n    \"0\":-800,\n}","import Chess from 'chess.js'\n\nexport default class RacingKingsChess {\n    constructor(fen){\n        if(process.env.NODE_ENV===\"test\") {\n            this.chess=new (Chess.Chess)(fen);\n        } else {\n            this.chess = new Chess(fen);\n        }\n        this.SQUARES = this.chess.SQUARES\n    }\n    fen(){\n        return this.chess.fen()\n    }\n    turn() {\n        return this.chess.turn()\n    }\n    load(fen) {\n        this.chess.load(fen)\n    }\n    moves(options) {\n        // checks are not allowed in racing kings \n        // so remove moves that cause a check\n        return this.chess.moves(options).filter((move)=>{\n            let san = move.san || move\n            return !san.endsWith(\"+\") && !san.endsWith(\"#\")\n        })\n    }\n\n    move(moveObject, options) {\n        if(typeof moveObject !== \"string\") {\n            return this.chess.move(moveObject, options)\n        }\n        \n        if (moveObject.endsWith('#')) {\n            // a move ending in checkmate in racing kings will not \n            // be a checkmate under standard rules. so remove the # at the end \n            // to make it pass as a standard notation \n            moveObject = moveObject.substring(0, moveObject.length - 1);\n        } \n        let move = this.chess.move(moveObject, options)\n        if(move) {\n            return move\n        }\n        let disambiguatedMove = disambiguate(moveObject, this.moves())\n        if(!disambiguatedMove) {\n            // disambiguation failed\n            return move\n        }\n        // making this move failed so try disambiguating\n        return this.chess.move(disambiguatedMove, options)\n    }\n\n}\n\n// this is needed because in certain positions, while a disambiguating notation is needed \n// in standard chess, it is not needed in racing kings. \n// for example in this position \"1q4R1/1kN2Q2/8/5K2/8/4Nn2/8/b7 w - - 1 21\"\n// Move Nd5 is ambiguous in standard chess but is clear in Racing kings\n// because Ncd5 will lead to check\n\n// The way this function works is by actually finding the disambiguated move Ned5\n// to pass to the chess.js library. Since the move Ncd5 will end with a check (+) \n// it will fail the filter below\nfunction disambiguate(problematicMove, potentialMoves) {\n    let filteredMoves = potentialMoves.filter((potentialMove)=>{\n        if(problematicMove.charAt(0) !== potentialMove.charAt(0)) {\n            return false;\n        }\n        return problematicMove.slice(-2) === potentialMove.slice(-2)\n    })\n    if(filteredMoves.length !== 1) {\n        return null\n    }\n    return filteredMoves[0]\n}","import Chess from 'chess.js'\n\nexport default class CrazyhouseChess {\n    constructor(fen){\n        if(process.env.NODE_ENV===\"test\") {\n            this.chess= new (Chess.Chess)(fen)\n        } else {\n            this.chess = new Chess(fen);\n        }\n        this.SQUARES = this.chess.SQUARES\n    }\n    fen(){\n        return this.chess.fen()\n    }\n    turn() {\n        return this.chess.turn()\n    }\n    moves(options) {\n        return this.chess.moves(options)\n    }\n    load(fen) {\n        this.chess.load(fen)\n    }\n    move(moveObject, options) {\n        let move = this.chess.move(moveObject, options)\n        if(move) {\n            return move\n        }\n        if(typeof moveObject === \"string\") {\n            return this.moveSan(moveObject)\n        } else {\n            return this.moveSan(moveObject.san)\n        }\n    }\n\n    moveSan(san) {\n        if(san.includes('@')){\n            let locationOfAt = san.indexOf('@')\n            let piece = ''\n            if(locationOfAt === 0) {\n                piece = this.chess.PAWN\n            } else {\n                piece = san.charAt(0).toLowerCase()\n            }\n            let location = san.slice(locationOfAt+1,locationOfAt+3)\n            let success = this.chess.put({type:piece, color:this.turn()}, location)\n            if(!success) {\n                return null\n            }\n            let color = this.turn()\n\n            this.toggleTurn()\n            return {\n                color: color,\n                from:location,\n                to:location,\n                san:san\n            }\n        }\n        return null\n    }\n    toggleTurn() {\n        var tokens = this.chess.fen().split(' ');\n        // switch the color\n        tokens[1] = tokens[1] === 'b'? 'w' : 'b'\n        // remove en passent\n        tokens[3] = '-'\n        this.chess.load(tokens.join(' '));\n    }\n    \n}\n\n","import * as Constants from '../Constants'\nimport Chess from 'chess.js'\nimport RacingKingsChess from './RacingKingsChess'\nimport CrazyhouseChess from './CrazyhouseChess'\nexport function chessLogic(variant, fen) {\n    if(!fen) {\n        fen = rootFen(variant)\n    }\n    if(variant === Constants.VARIANT_RACING_KINGS) {\n        return new RacingKingsChess(fen)\n    }\n    if(variant === Constants.VARIANT_CRAZYHOUSE) {\n        return new CrazyhouseChess(fen)\n    }\n    if(process.env.NODE_ENV===\"test\") {\n        return new (Chess.Chess)(fen)\n    } \n    return new Chess(fen)\n}\n\nexport function rootFen(variant) {\n    if(variant === Constants.VARIANT_RACING_KINGS) {\n        return Constants.RACING_KINGS_ROOT_FEN\n    }\n    return Constants.ROOT_FEN\n}","import * as Constants from './Constants'\n\nexport function isAdvancedFiltersEnabled(source) {\n    return source === Constants.SITE_CHESS_DOT_COM ||\n        source === Constants.SITE_LICHESS\n}\n\n\nexport function isFilterPanelEnabled(source, playerName) {\n    if(source === Constants.SITE_EVENT_DB ||\n        source === Constants.SITE_OPENING_TREE_FILE ||\n        source === Constants.SITE_ONLINE_TOURNAMENTS) {\n            return false\n    }\n    return !!playerName\n}\n\nexport function treeSaveDisabledReason(loadedSite, selectedSite, gamesProcessed, isDownloading){\n    if(selectedSite === Constants.SITE_ONLINE_TOURNAMENTS) {\n        return \"Not currently supported for tournaments\"\n    }\n    if(selectedSite !== Constants.SITE_LICHESS && \n        selectedSite !== Constants.SITE_CHESS_DOT_COM) {\n        return \"Only supported for chess.com and lichess\"\n    }\n    if(loadedSite !== selectedSite || gamesProcessed<=0) {\n        return \"You need to analyze games before saving\"\n    }\n    if(isDownloading) {\n        return \"Action not supported while games are loading\"\n    }\n    return ''\n}\nexport function exportFileName(source, playerName, playerColor, selectedEvent, extension) {\n    if(source === Constants.SITE_EVENT_DB) {\n        return `${selectedEvent.name}.${extension}`\n    }\n    if(playerName) {\n        return `${playerName}-${playerColor}.${extension}`\n    }\n    return `openingtree-exportedgames.${extension}`\n}"],"sourceRoot":""}